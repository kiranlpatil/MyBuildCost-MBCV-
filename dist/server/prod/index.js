"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var express = require("express");
var path = require("path");
var LoggerService = require("./app/framework/shared/logger/LoggerService");
var sharedService = require("./app/framework/shared/logger/shared.service");
var Middlewares = require("./app/framework/middlewares/base/MiddlewaresBase");
var RateAnalysisService = require("./app/applicationProject/services/RateAnalysisService");
var log4js = require('log4js');
var config = require('config');
var spdy = require('spdy');
__dirname = './';
var _clientDir = '/dist/client/dev';
var _serverDir = '/dist/server/dev';
var app = express();
var CronJob = require('cron').CronJob;
function init(port, mode, protocol, dist_runner) {
    var loggerConfig = config.get('logger');
    log4js.configure(loggerConfig);
    var loggerCategory = config.get('logger.levels.[all]');
    var logger = log4js.getLogger('User Controller');
    logger.info('Initialization info');
    logger.error('Initialization error');
    logger.debug('Initialization debug');
    process.on('uncaughtException', function (err) {
        var _loggerService = new LoggerService('uncaught exception Handler');
        var error = {
            reason: 'uncaught exception',
            message: err,
            stack: err.stack,
            code: 500
        };
        console.error(error);
        _loggerService.logError('Catching uncaught Exceptions. : ' + err);
        _loggerService.logError('Catching uncaught Exceptions stack : ' + err.stack);
        sharedService.mailToAdmin(error);
    });
    var syncAtEveryFifteenMinute = new CronJob('00 */5 * * * *', function () {
        var rateAnalysisServices = new RateAnalysisService();
        rateAnalysisServices.SyncRateAnalysis();
    }, function () {
        console.log('restart server');
    }, true);
    syncAtEveryFifteenMinute.start();
    if (mode === 'dev') {
        if (dist_runner === 'dist') {
            app.all('/*', function (req, res, next) {
                res.header('Access-Control-Allow-Origin', '*');
                res.header('Access-Control-Allow-Headers', 'X-Requested-With');
                next();
            });
            app.use(Middlewares.configuration);
            var root = path.resolve(process.cwd());
            var clientRoot = path.resolve(process.cwd(), './client/dev');
            app.use(express.static(root));
            app.use(express.static(clientRoot));
            _serverDir = '/dist/server/dev';
            app.use('/public', express.static(path.resolve(__dirname + _serverDir + '/public')));
            var renderIndex = function (req, res) {
                _clientDir = '/client/dev';
                res.sendFile(path.resolve(__dirname + _clientDir + '/index.html'));
            };
            app.get('/*', renderIndex);
        }
        else {
            app.all('/*', function (req, res, next) {
                res.header('Access-Control-Allow-Origin', '*');
                res.header('Access-Control-Allow-Headers', 'X-Requested-With');
                next();
            });
            app.use(Middlewares.configuration);
            var root = path.resolve(process.cwd());
            var clientRoot = path.resolve(process.cwd(), './dist/client/dev');
            app.use(express.static(root));
            app.use(express.static(clientRoot));
            _serverDir = '/dist/server/dev';
            app.use('/public', express.static(path.resolve(__dirname + _serverDir + '/public')));
            var renderIndex_1 = function (req, res) {
                _clientDir = '/dist/client/dev';
                res.sendFile(path.resolve(__dirname + _clientDir + '/index.html'));
            };
            app.get('/*', renderIndex_1);
        }
    }
    else {
        if (dist_runner === 'dist') {
            _clientDir = './client/prod';
            _serverDir = '/server/prod';
            app.use('/js', express.static(path.resolve(__dirname, _clientDir + '/js')));
            app.use('/css', express.static(path.resolve(__dirname, _clientDir + '/css')));
            app.use('/assets', express.static(path.resolve(__dirname, _clientDir + '/assets')));
            app.use('/public', express.static(path.resolve(__dirname + _serverDir + '/public')));
            var renderIndex = function (req, res) {
                _clientDir = '/client/prod';
                res.sendFile(path.resolve(__dirname + _clientDir + '/index.html'));
            };
            app.get('/*', renderIndex);
        }
        else {
            app.use(Middlewares.configuration);
            _clientDir = './dist/client/prod';
            _serverDir = '/dist/server/prod';
            app.use('/js', express.static(path.resolve(__dirname, _clientDir + '/js')));
            app.use('/css', express.static(path.resolve(__dirname, _clientDir + '/css')));
            app.use('/assets', express.static(path.resolve(__dirname, _clientDir + '/assets')));
            app.use('/public', express.static(path.resolve(__dirname + _serverDir + '/public')));
            var renderIndex = function (req, res) {
                _clientDir = '/dist/client/prod';
                res.sendFile(path.resolve(__dirname + _clientDir + '/index.html'));
            };
            app.get('/*', renderIndex);
        }
    }
    if (protocol === 'http') {
        return new Promise(function (resolve, reject) {
            var server = app.listen(port, function () {
                var port = server.address().port;
                console.log('App is listening on port:' + port);
                resolve(server);
            });
            server.timeout = 600000;
        });
    }
    else {
        var options = {
            handshakeTimeout: 600000,
            passphrase: 'tpl123',
            spdy: {
                protocols: ['h2']
            }
        };
        return spdy.createServer(options, app)
            .listen(port, function (error) {
            if (error) {
                console.error(error);
                process.exit(1);
            }
            else {
                console.log('http2 Listening on port: ' + port + '.');
            }
        });
    }
}
exports.init = init;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O2dCQUM1QixJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDO2dCQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixHQUFHLElBQUksQ0FBQyxDQUFDO2dCQUNoRCxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbEIsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQU0sT0FBTyxHQUFHO1lBR2QsZ0JBQWdCLEVBQUUsTUFBTTtZQUN4QixVQUFVLEVBQUUsUUFBUTtZQUNwQixJQUFJLEVBQUU7Z0JBQ0osU0FBUyxFQUFFLENBQUMsSUFBSSxDQUFDO2FBQ2xCO1NBQ0YsQ0FBQztRQUVGLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUM7YUFDbkMsTUFBTSxDQUFDLElBQUksRUFBRSxVQUFDLEtBQVU7WUFDdkIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUVwQixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixHQUFHLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztZQUN4RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0FBQ0gsQ0FBQztBQWhQRCxvQkFnUEMiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBodHRwIGZyb20gJ2h0dHAnO1xyXG5pbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG4vKmltcG9ydCAqIGFzIHJvdXRlcyBmcm9tIFwiLi9yb3V0ZXNcIjsqL1xyXG4vKmltcG9ydCAqIGFzIGNuZXh0Um91dGVzIGZyb20gXCIuL2NuZXh0LXJvdXRlc1wiOyovXHJcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcclxuaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKCcuL2FwcC9mcmFtZXdvcmsvc2hhcmVkL2xvZ2dlci9Mb2dnZXJTZXJ2aWNlJyk7XHJcbmltcG9ydCAqIGFzIHNoYXJlZFNlcnZpY2UgZnJvbSAnLi9hcHAvZnJhbWV3b3JrL3NoYXJlZC9sb2dnZXIvc2hhcmVkLnNlcnZpY2UnO1xyXG5pbXBvcnQgTWlkZGxld2FyZXMgPSByZXF1aXJlKCcuL2FwcC9mcmFtZXdvcmsvbWlkZGxld2FyZXMvYmFzZS9NaWRkbGV3YXJlc0Jhc2UnKTtcclxuaW1wb3J0IFJhdGVBbmFseXNpcyA9IHJlcXVpcmUoXCIuL2FwcC9hcHBsaWNhdGlvblByb2plY3QvZGF0YWFjY2Vzcy9tb2RlbC9SYXRlQW5hbHlzaXMvUmF0ZUFuYWx5c2lzXCIpO1xyXG5pbXBvcnQgUmF0ZUFuYWx5c2lzU2VydmljZSA9IHJlcXVpcmUoXCIuL2FwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvUmF0ZUFuYWx5c2lzU2VydmljZVwiKTtcclxudmFyIGxvZzRqcyA9IHJlcXVpcmUoJ2xvZzRqcycpO1xyXG52YXIgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbi8qdmFyIGxvZ0RpciA9ICdMb2dzJzsqL1xyXG5cclxudmFyIHNwZHkgPSByZXF1aXJlKCdzcGR5Jyk7XHJcbl9fZGlybmFtZSA9ICcuLyc7XHJcbnZhciBfY2xpZW50RGlyID0gJy9kaXN0L2NsaWVudC9kZXYnO1xyXG52YXIgX3NlcnZlckRpciA9ICcvZGlzdC9zZXJ2ZXIvZGV2JztcclxudmFyIGFwcCA9IGV4cHJlc3MoKTtcclxudmFyIENyb25Kb2IgPSByZXF1aXJlKCdjcm9uJykuQ3JvbkpvYjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbml0KHBvcnQ6IG51bWJlciwgbW9kZTogc3RyaW5nLCBwcm90b2NvbDogc3RyaW5nLCBkaXN0X3J1bm5lcjogc3RyaW5nKSB7XHJcblxyXG5cclxuXHJcblxyXG5cclxuICB2YXIgbG9nZ2VyQ29uZmlnPWNvbmZpZy5nZXQoJ2xvZ2dlcicpO1xyXG5cclxuICBsb2c0anMuY29uZmlndXJlKGxvZ2dlckNvbmZpZyk7XHJcbiAgdmFyIGxvZ2dlckNhdGVnb3J5ID1jb25maWcuZ2V0KCdsb2dnZXIubGV2ZWxzLlthbGxdJylcclxuICB2YXIgbG9nZ2VyPWxvZzRqcy5nZXRMb2dnZXIoJ1VzZXIgQ29udHJvbGxlcicpO1xyXG4gIGxvZ2dlci5pbmZvKCdJbml0aWFsaXphdGlvbiBpbmZvJyk7XHJcbiAgbG9nZ2VyLmVycm9yKCdJbml0aWFsaXphdGlvbiBlcnJvcicpO1xyXG4gIGxvZ2dlci5kZWJ1ZygnSW5pdGlhbGl6YXRpb24gZGVidWcnKTtcclxuXHJcblxyXG5cclxuICBwcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIGZ1bmN0aW9uIChlcnI6YW55KSB7XHJcbiAgICBsZXQgX2xvZ2dlclNlcnZpY2U6IExvZ2dlclNlcnZpY2UgPSBuZXcgTG9nZ2VyU2VydmljZSgndW5jYXVnaHQgZXhjZXB0aW9uIEhhbmRsZXInKTtcclxuICAgIGxldCBlcnJvcj0ge1xyXG4gICAgICByZWFzb246ICd1bmNhdWdodCBleGNlcHRpb24nLFxyXG4gICAgICBtZXNzYWdlOiBlcnIsXHJcbiAgICAgIHN0YWNrOiBlcnIuc3RhY2ssXHJcbiAgICAgIGNvZGU6IDUwMFxyXG4gICAgfTtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoJ0NhdGNoaW5nIHVuY2F1Z2h0IEV4Y2VwdGlvbnMuIDogJyArZXJyKTtcclxuICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKCdDYXRjaGluZyB1bmNhdWdodCBFeGNlcHRpb25zIHN0YWNrIDogJyArZXJyLnN0YWNrKTtcclxuICAgIC8vc2hhcmVkU2VydmljZS5lcnJvckhhbmRsZXIoZXJyb3IpO1xyXG4gICAgc2hhcmVkU2VydmljZS5tYWlsVG9BZG1pbihlcnJvcik7XHJcbiAgfSk7XHJcblxyXG4gIGxldCBzeW5jQXRFdmVyeUZpZnRlZW5NaW51dGUgPSBuZXcgQ3JvbkpvYignMDAgKi81ICogKiAqIConLCBmdW5jdGlvbigpIHtcclxuICAgICAgbGV0IHJhdGVBbmFseXNpc1NlcnZpY2VzOiBSYXRlQW5hbHlzaXNTZXJ2aWNlID0gbmV3IFJhdGVBbmFseXNpc1NlcnZpY2UoKTtcclxuICAgICAgcmF0ZUFuYWx5c2lzU2VydmljZXMuU3luY1JhdGVBbmFseXNpcygpO1xyXG4gICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjb25zb2xlLmxvZygncmVzdGFydCBzZXJ2ZXInKTtcclxuICAgIH0sXHJcbiAgICB0cnVlXHJcbiAgKTtcclxuICBzeW5jQXRFdmVyeUZpZnRlZW5NaW51dGUuc3RhcnQoKTtcclxuICAvL2xvZ2dlciBsb2c0anMgaW5pdGlhbGl6YXRpb25cclxuICAvKlxyXG4gICAgY29uc29sZS5sb2coJ0xvZ2dlciBJbml0aWFsaXphdGlvbicpO1xyXG5cclxuICAgdmFyIGxvZ0NvbmZpZz1jb25maWcuZ2V0KCdsb2dnZXInKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnTG9nZ2VyIEluaXRpYWxpemF0aW9uIDEnKTtcclxuXHJcbiAgIHZhciBsb2dnZXJMZXZlbD1jb25maWcuZ2V0KCdsb2dnZXIubGV2ZWxzLlthbGxdJyk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0xvZ2dlciBJbml0aWFsaXphdGlvbiAyJyk7XHJcblxyXG4gICAgdmFyIGxvZ2dlciA9IGxvZzRqcy5nZXRMb2dnZXIobG9nZ2VyTGV2ZWwpOyAvLyBpbml0aWFsaXplIHRoZSB2YXIgdG8gdXNlLlxyXG5cclxuICAgIGNvbnNvbGUubG9nKCdMb2dnZXIgSW5pdGlhbGl6YXRpb24gY29tcGxldGVkJyk7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ1RoaXMgaXMgSW5mb3JtYXRpb24gTG9nZ2VyJyk7XHJcbiAgICBsb2dnZXIuZXJyb3IoJ1RoaXMgaXMgRXJyb3IgTG9nZ2VyJyk7XHJcbiAgICBsb2dnZXIuZGVidWcoJ1RoaXMgaXMgRGVidWdnZXInKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnTG9nZ2VyIGFwcGVuZGVkIGluIGZpbGUnKTsqL1xyXG4gIC8qKlxyXG4gICAqIERldiBNb2RlLlxyXG4gICAqIEBub3RlIERldiBzZXJ2ZXIgd2lsbCBvbmx5IGdpdmUgZm9yIHlvdSBtaWRkbGV3YXJlLlxyXG4gICAqL1xyXG4gIGlmIChtb2RlID09PSAnZGV2Jykge1xyXG4gICAgaWYgKGRpc3RfcnVubmVyID09PSAnZGlzdCcpIHtcclxuICAgICAgYXBwLmFsbCgnLyonLCBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgICAgICByZXMuaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nLCAnKicpO1xyXG4gICAgICAgIHJlcy5oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnMnLCAnWC1SZXF1ZXN0ZWQtV2l0aCcpO1xyXG4gICAgICAgIG5leHQoKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBhcHAudXNlKE1pZGRsZXdhcmVzLmNvbmZpZ3VyYXRpb24pO1xyXG5cclxuICAgICAgbGV0IHJvb3QgPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSk7XHJcbiAgICAgIGxldCBjbGllbnRSb290ID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksICcuL2NsaWVudC9kZXYnKTtcclxuICAgICAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhyb290KSk7XHJcbiAgICAgIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMoY2xpZW50Um9vdCkpO1xyXG4gICAgICBfc2VydmVyRGlyID0gJy9kaXN0L3NlcnZlci9kZXYnO1xyXG4gICAgICBhcHAudXNlKCcvcHVibGljJywgZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSArIF9zZXJ2ZXJEaXIgKycvcHVibGljJykpKTtcclxuICAgICAgdmFyIHJlbmRlckluZGV4ID0gKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcclxuICAgICAgICBfY2xpZW50RGlyID0gJy9jbGllbnQvZGV2JztcclxuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSArIF9jbGllbnREaXIgKyAnL2luZGV4Lmh0bWwnKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIGFwcC5nZXQoJy8qJywgcmVuZGVySW5kZXgpO1xyXG4gICAgICAvKipcclxuICAgICAgICogQXBpIFJvdXRlcyBmb3IgYERldmVsb3BtZW50YC5cclxuICAgICAgICovXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhcHAuYWxsKCcvKicsIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgICAgIHJlcy5oZWFkZXIoJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbicsICcqJyk7XHJcbiAgICAgICAgcmVzLmhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycycsICdYLVJlcXVlc3RlZC1XaXRoJyk7XHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8qcm91dGVzLmluaXQoYXBwKTsqL1xyXG4gICAgICBhcHAudXNlKE1pZGRsZXdhcmVzLmNvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAvL2NuZXh0Um91dGVzLmNuZXh0SW5pdChhcHApO1xyXG5cclxuICAgICAgbGV0IHJvb3QgPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSk7XHJcbiAgICAgIGxldCBjbGllbnRSb290ID0gcGF0aC5yZXNvbHZlKHByb2Nlc3MuY3dkKCksICcuL2Rpc3QvY2xpZW50L2RldicpO1xyXG4gICAgICBhcHAudXNlKGV4cHJlc3Muc3RhdGljKHJvb3QpKTtcclxuICAgICAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhjbGllbnRSb290KSk7XHJcbiAgICAgIF9zZXJ2ZXJEaXIgPSAnL2Rpc3Qvc2VydmVyL2Rldic7XHJcbiAgICAgIGFwcC51c2UoJy9wdWJsaWMnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lKyBfc2VydmVyRGlyICsnL3B1YmxpYycpKSk7XHJcbiAgICAgIGxldCByZW5kZXJJbmRleCA9IChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgX2NsaWVudERpciA9ICcvZGlzdC9jbGllbnQvZGV2JztcclxuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSArIF9jbGllbnREaXIgKyAnL2luZGV4Lmh0bWwnKSk7XHJcbiAgICAgIH07XHJcbiAgICAgIGFwcC5nZXQoJy8qJywgcmVuZGVySW5kZXgpO1xyXG4gICAgICAvKipcclxuICAgICAgICogQXBpIFJvdXRlcyBmb3IgYERldmVsb3BtZW50YC5cclxuICAgICAgICovXHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIGlmKGRpc3RfcnVubmVyID09PSAnZGlzdCcpIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIFByb2QgTW9kZS5cclxuICAgICAgICogQG5vdGUgUHJvZCBtb2Qgd2lsbCBnaXZlIHlvdSBzdGF0aWMgKyBtaWRkbGV3YXJlLlxyXG4gICAgICAgKi9cclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBBcGkgUm91dGVzIGZvciBgUHJvZHVjdGlvbmAuXHJcbiAgICAgICAqL1xyXG4gICAgICAvKnJvdXRlcy5pbml0KGFwcCk7Ki9cclxuICAgICAgLypjbmV4dFJvdXRlcy5jbmV4dEluaXQoYXBwKTsqL1xyXG4gICAgICAvKipcclxuICAgICAgICogQ2xpZW50IERpclxyXG4gICAgICAgKi9cclxuICAgICAgX2NsaWVudERpciA9ICcuL2NsaWVudC9wcm9kJztcclxuICAgICAgX3NlcnZlckRpciA9ICcvc2VydmVyL3Byb2QnO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIFN0YXRpYy5cclxuICAgICAgICovXHJcbiAgICAgIGFwcC51c2UoJy9qcycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIF9jbGllbnREaXIgKyAnL2pzJykpKTtcclxuICAgICAgYXBwLnVzZSgnL2NzcycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIF9jbGllbnREaXIgKyAnL2NzcycpKSk7XHJcbiAgICAgIGFwcC51c2UoJy9hc3NldHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBfY2xpZW50RGlyICsgJy9hc3NldHMnKSkpO1xyXG4gICAgICBhcHAudXNlKCcvcHVibGljJywgZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSsgX3NlcnZlckRpciArICcvcHVibGljJykpKTtcclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBTcGEgUmVzIFNlbmRlci5cclxuICAgICAgICogQHBhcmFtIHJlcSB7YW55fVxyXG4gICAgICAgKiBAcGFyYW0gcmVzIHthbnl9XHJcbiAgICAgICAqL1xyXG4gICAgICB2YXIgcmVuZGVySW5kZXggPSBmdW5jdGlvbiAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgICAgIF9jbGllbnREaXIgPSAnL2NsaWVudC9wcm9kJztcclxuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSArIF9jbGllbnREaXIgKyAnL2luZGV4Lmh0bWwnKSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL2FwcC5nZXQoJyonLCBmdW5jdGlvbihyZXEscmVzKSB7XHJcbiAgICAgIC8vICByZXMuc2VuZEZpbGUocHJvY2Vzcy5jd2QoKSArICcvZGlzdC9wcm9kL2NsaWVudC9pbmRleC5odG1sJyk7XHJcbiAgICAgIC8vfSk7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogUHJldmVudCBzZXJ2ZXIgcm91dGluZyBhbmQgdXNlIEBuZzItcm91dGVyLlxyXG4gICAgICAgKi9cclxuICAgICAgYXBwLmdldCgnLyonLCByZW5kZXJJbmRleCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvKipcclxuICAgICAgICogUHJvZCBNb2RlLlxyXG4gICAgICAgKiBAbm90ZSBQcm9kIG1vZCB3aWxsIGdpdmUgeW91IHN0YXRpYyArIG1pZGRsZXdhcmUuXHJcbiAgICAgICAqL1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIEFwaSBSb3V0ZXMgZm9yIGBQcm9kdWN0aW9uYC5cclxuICAgICAgICovXHJcbiAgICAgIGFwcC51c2UoTWlkZGxld2FyZXMuY29uZmlndXJhdGlvbik7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBDbGllbnQgRGlyXHJcbiAgICAgICAqL1xyXG4gICAgICBfY2xpZW50RGlyID0gJy4vZGlzdC9jbGllbnQvcHJvZCc7XHJcbiAgICAgIF9zZXJ2ZXJEaXIgPSAnL2Rpc3Qvc2VydmVyL3Byb2QnO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIFN0YXRpYy5cclxuICAgICAgICovXHJcbiAgICAgIGFwcC51c2UoJy9qcycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIF9jbGllbnREaXIgKyAnL2pzJykpKTtcclxuICAgICAgYXBwLnVzZSgnL2NzcycsIGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIF9jbGllbnREaXIgKyAnL2NzcycpKSk7XHJcbiAgICAgIGFwcC51c2UoJy9hc3NldHMnLCBleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBfY2xpZW50RGlyICsgJy9hc3NldHMnKSkpO1xyXG4gICAgICBhcHAudXNlKCcvcHVibGljJywgZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSsgX3NlcnZlckRpcisnL3B1YmxpYycpKSk7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogU3BhIFJlcyBTZW5kZXIuXHJcbiAgICAgICAqIEBwYXJhbSByZXEge2FueX1cclxuICAgICAgICogQHBhcmFtIHJlcyB7YW55fVxyXG4gICAgICAgKi9cclxuICAgICAgdmFyIHJlbmRlckluZGV4ID0gZnVuY3Rpb24gKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpIHtcclxuICAgICAgICBfY2xpZW50RGlyID0gJy9kaXN0L2NsaWVudC9wcm9kJztcclxuICAgICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSArIF9jbGllbnREaXIgKyAnL2luZGV4Lmh0bWwnKSk7XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvL2FwcC5nZXQoJyonLCBmdW5jdGlvbihyZXEscmVzKSB7XHJcbiAgICAgIC8vICByZXMuc2VuZEZpbGUocHJvY2Vzcy5jd2QoKSArICcvZGlzdC9wcm9kL2NsaWVudC9pbmRleC5odG1sJyk7XHJcbiAgICAgIC8vfSk7XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogUHJldmVudCBzZXJ2ZXIgcm91dGluZyBhbmQgdXNlIEBuZzItcm91dGVyLlxyXG4gICAgICAgKi9cclxuICAgICAgYXBwLmdldCgnLyonLCByZW5kZXJJbmRleCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXJ2ZXIgd2l0aCBnemlwIGNvbXByZXNzaW9uLlxyXG4gICAqL1xyXG4gIC8vSFRUUCBTVEFSVDpcclxuICBpZiAocHJvdG9jb2wgPT09ICdodHRwJykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPGh0dHAuU2VydmVyPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIGxldCBzZXJ2ZXIgPSBhcHAubGlzdGVuKHBvcnQsICgpID0+IHtcclxuICAgICAgICB2YXIgcG9ydCA9IHNlcnZlci5hZGRyZXNzKCkucG9ydDtcclxuICAgICAgICBjb25zb2xlLmxvZygnQXBwIGlzIGxpc3RlbmluZyBvbiBwb3J0OicgKyBwb3J0KTtcclxuICAgICAgICByZXNvbHZlKHNlcnZlcik7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzZXJ2ZXIudGltZW91dCA9IDYwMDAwMDsgLy9ieSBkZWZhdWx0IHRpbWVvdXQgc2V0IHRvIDEwIG1pbiBmb3IgZXhwb3J0IGZ1bmN0aW9uYWxpdHlcclxuICAgIH0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAvLyBrZXk6IGZzLnJlYWRGaWxlU3luYygnLi9zdGFnaW5nLmpvYm1vc2lzLmNvbS5rZXknKSxcclxuICAgICAgLy8gY2VydDogZnMucmVhZEZpbGVTeW5jKCcuL3N0YWdpbmcuam9ibW9zaXMuY29tLmNydCcpLFxyXG4gICAgICBoYW5kc2hha2VUaW1lb3V0OiA2MDAwMDAsIC8vYnkgZGVmYXVsdCB0aW1lb3V0IHNldCB0byAxMCBtaW4gZm9yIGV4cG9ydCBmdW5jdGlvbmFsaXR5LCBOZWVkIHRvIHRlc3QgdGhpc1xyXG4gICAgICBwYXNzcGhyYXNlOiAndHBsMTIzJyxcclxuICAgICAgc3BkeToge1xyXG4gICAgICAgIHByb3RvY29sczogWydoMiddXHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHNwZHkuY3JlYXRlU2VydmVyKG9wdGlvbnMsIGFwcClcclxuICAgICAgLmxpc3Rlbihwb3J0LCAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcilcclxuICAgICAgICAgIC8vIHJldHVybiBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdodHRwMiBMaXN0ZW5pbmcgb24gcG9ydDogJyArIHBvcnQgKyAnLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==
