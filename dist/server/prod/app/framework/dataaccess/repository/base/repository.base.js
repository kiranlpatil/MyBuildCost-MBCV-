"use strict";
var mongoose = require("mongoose");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, callback);
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, {}).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithIncluded = function (field, included, callback) {
        this._model.find(field, included).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithoutLean = function (field, callback) {
        this._model.find(field, {}).exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithLean = function (field, projection, callback) {
        console.time('repo2 time');
        this._model.find(field, projection).lean().exec(function (err, res) {
            console.timeEnd('repo2 time');
            callback(err, res);
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, callback);
    };
    RepositoryBase.prototype.updateByUserId = function (_id, item, callback) {
        this._model.update({ 'userId': _id }, item, callback);
    };
    RepositoryBase.prototype.retrieveAll = function (excluded, callback) {
        this._model.find({}, excluded).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIds = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsForComplexity = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndNames = function (field, names, excluded, callback) {
        this._model.find({ $and: [{ _id: { $in: field } }, { name: { $in: JSON.parse(names) } }] }, excluded, callback);
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (err) { return callback(err, null); });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, callback);
    };
    RepositoryBase.prototype.findByIdwithExclude = function (_id, exclude, callback) {
        this._model.findById(_id, exclude, callback);
    };
    RepositoryBase.prototype.findByName = function (name, callback) {
        this._model.find({ "name": name }, callback);
    };
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.findOneAndUpdateIndustry = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.pushInJobpost = function (id, value, callback) {
        this._model.update({ _id: id }, { $push: { "postedJobs": value.postedJobs } }, callback);
    };
    RepositoryBase.prototype.pushElementInArray = function (value, callback) {
        this._model.update({ $push: { "proficiencies": value } }, callback);
    };
    RepositoryBase.prototype.retrieveByMultiRefrenceIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ 'userId': { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveBySortedOrder = function (query, projection, sortingQuery, callback) {
        this._model.find(query, projection).sort(sortingQuery).lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.getCount = function (query, callback) {
        this._model.find(query).count().lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBcUM7QUFFckM7SUFJRSx3QkFBWSxXQUE4QztRQUN4RCxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLElBQU8sRUFBRSxRQUEyQztRQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQy9DLFFBQVEsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNkNBQW9CLEdBQXBCLFVBQXFCLEtBQVUsRUFBQyxRQUFhLEVBQUUsUUFBMkM7UUFDeEYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQ3JELFFBQVEsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQW1CLEdBQW5CLFVBQW9CLEtBQVUsRUFBRSxRQUEyQztRQUN6RSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7WUFDeEMsUUFBUSxDQUFDLEdBQUcsRUFB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QUcsRUFBRSxHQUFHLEVBQUMsRUFBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsS0FBSztZQUM3RixRQUFRLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELDhDQUFxQixHQUFyQixVQUFzQixLQUFVLEVBQUUsVUFBZSxFQUFFLFlBQWlCLEVBQUUsUUFBMkM7UUFDL0csSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsS0FBSztZQUNyRixRQUFRLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLEtBQUs7WUFDOUQsUUFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCxxQkFBQztBQUFELENBN0lBLEFBNklDLElBQUE7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvYmFzZS9yZXBvc2l0b3J5LmJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlYWQgPSByZXF1aXJlKFwiLi9yZWFkXCIpO1xuaW1wb3J0IElXcml0ZSA9IHJlcXVpcmUoXCIuL3dyaXRlXCIpO1xuaW1wb3J0ICogYXMgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbmNsYXNzIFJlcG9zaXRvcnlCYXNlPFQgZXh0ZW5kcyBtb25nb29zZS5Eb2N1bWVudD4gaW1wbGVtZW50cyBJUmVhZDxUPiwgSVdyaXRlPFQ+IHtcblxuICBwcml2YXRlIF9tb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+O1xuXG4gIGNvbnN0cnVjdG9yKHNjaGVtYU1vZGVsOiBtb25nb29zZS5Nb2RlbDxtb25nb29zZS5Eb2N1bWVudD4pIHtcbiAgICB0aGlzLl9tb2RlbCA9IHNjaGVtYU1vZGVsO1xuICB9XG5cbiAgY3JlYXRlKGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5jcmVhdGUoaXRlbSwgY2FsbGJhY2spO1xuICB9XG5cbiAgcmV0cmlldmUoZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHt9KS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHJpZXZlV2l0aEluY2x1ZGVkKGZpZWxkOiBhbnksaW5jbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIGluY2x1ZGVkKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHJpZXZlV2l0aG91dExlYW4oZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHt9KS5leGVjKChlcnIsIHJlcykgPT4ge1xuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xuICAgIH0pO1xuICB9XG4vL1RPRE86IFJFTU9WRSBDT05TT0xFIExPRyBcbiAgcmV0cmlldmVXaXRoTGVhbihmaWVsZDogYW55LCBwcm9qZWN0aW9uOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICBjb25zb2xlLnRpbWUoJ3JlcG8yIHRpbWUnKTtcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCBwcm9qZWN0aW9uKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcbiAgICAgIGNvbnNvbGUudGltZUVuZCgncmVwbzIgdGltZScpO1xuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xuICAgIH0pO1xuICB9XG5cblxuICB1cGRhdGUoX2lkOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCwgaXRlbTogVCwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XG4gIH1cbi8vVE9ETzpDT0RFIE1PVkUgVE8gQ0FORElEQVRFIFJFUE9TSVRFT1JZXG4gIHVwZGF0ZUJ5VXNlcklkKF9pZDogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQsIGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyd1c2VySWQnOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XG5cbiAgfVxuXG4gIHJldHJpZXZlQWxsKGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHt9LCBleGNsdWRlZCkubGVhbigpLmV4ZWMoKGVyciwgcmVzKSA9PiB7XG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XG4gICAgfSk7XG4gIH1cblxuICByZXRyaWV2ZUJ5TXVsdGlJZHMoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHtfaWQ6IHskaW46IGlkc319LCBleGNsdWRlZCwgY2FsbGJhY2spO1xuICB9XG5cbiAgcmV0cmlldmVCeU11bHRpSWRzRm9yQ29tcGxleGl0eShpZHM6IHN0cmluZ1tdLCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XG4gIH1cblxuICByZXRyaWV2ZUJ5TXVsdGlJZHNBbmROYW1lcyhmaWVsZDogYW55W10sIG5hbWVzOiBhbnksIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZCh7JGFuZDogW3tfaWQ6IHskaW46IGZpZWxkfX0sIHtuYW1lOiB7JGluOiBKU09OLnBhcnNlKG5hbWVzKX19XX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XG4gIH1cblxuICBkZWxldGUoX2lkOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5yZW1vdmUoe19pZDogdGhpcy50b09iamVjdElkKF9pZCl9LCAoZXJyKSA9PiBjYWxsYmFjayhlcnIsIG51bGwpKTtcbiAgfVxuXG4gIGZpbmRCeUlkKF9pZDogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEJ5SWR3aXRoRXhjbHVkZShfaWQ6IHN0cmluZywgZXhjbHVkZTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgZXhjbHVkZSwgY2FsbGJhY2spO1xuICB9XG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcbiAgZmluZEJ5TmFtZShuYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZCh7XCJuYW1lXCI6IG5hbWV9LCBjYWxsYmFjayk7XG4gIH1cblxuICB0b09iamVjdElkKF9pZDogc3RyaW5nKTogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQge1xuICAgIHJldHVybiBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5jcmVhdGVGcm9tSGV4U3RyaW5nKF9pZCk7XG4gIH1cblxuICBmaW5kQW5kUG9wdWxhdGUoc2VhcmNoRmllbGQ6IGFueSwgcG9wdWxhdGVGaWVsZDogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoc2VhcmNoRmllbGQpLnBvcHVsYXRlKHBvcHVsYXRlRmllbGQpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xuICAgIH0pO1xuICB9XG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcbiAgcmV0cmlldmVCeU11bHRpSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkKS5wb3B1bGF0ZSgndXNlcklkJykuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XG4gICAgfSk7XG4gIH1cblxuICBmaW5kT25lQW5kVXBkYXRlKHF1ZXJ5OiBhbnksIG5ld0RhdGE6IGFueSwgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xuICAgIH0pO1xuICB9XG5cbiAgZmluZE9uZUFuZFVwZGF0ZUluZHVzdHJ5KHF1ZXJ5OiBhbnksIG5ld0RhdGE6IGFueSwgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xuICAgIH0pO1xuICB9XG5cbiAgLy9jdXN0b20gQVBJIGNyZWF0ZWQgZm9yIEMtbmV4dCBSb2xlcyBjYXBhYmlsaXRpZXMgYW5kIGNvbXBsZXhpdGllc1xuXG4gIC8vY2hhbmdlIHRoZSBhbnkgZGF0YSB0eXBlIHRvIG1vZGVsXG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcbiAgcHVzaEluSm9icG9zdChpZDogc3RyaW5nLCB2YWx1ZTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHtfaWQ6IGlkfSwgeyRwdXNoOiB7XCJwb3N0ZWRKb2JzXCI6IHZhbHVlLnBvc3RlZEpvYnN9fSwgY2FsbGJhY2spO1xuICB9XG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcbiAgcHVzaEVsZW1lbnRJbkFycmF5KHZhbHVlOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyRwdXNoOiB7XCJwcm9maWNpZW5jaWVzXCI6IHZhbHVlfX0sIGNhbGxiYWNrKTtcbiAgfVxuLy9UT0RPOiBNT1ZFIENPREUgVE8gSVRTIFJFTEVBVEVEIFJFUE9TSVRFT1JZXG4gIC8vaW4gYmVsb3cgcXVlcnkgd2UgdXNlIHVzZXJJZCBmb3Igc2VhcmNoIGFzIHJlZnJlbmNlIGlkXG4gIHJldHJpZXZlQnlNdWx0aVJlZnJlbmNlSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoeyd1c2VySWQnOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHJpZXZlQnlTb3J0ZWRPcmRlcihxdWVyeTogYW55LCBwcm9qZWN0aW9uOiBhbnksIHNvcnRpbmdRdWVyeTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSwgcHJvamVjdGlvbikuc29ydChzb3J0aW5nUXVlcnkpLmxlYW4oKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldENvdW50KHF1ZXJ5OiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHF1ZXJ5KS5jb3VudCgpLmxlYW4oKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcbiAgICB9KTtcbiAgfVxuXG59XG5cbmV4cG9ydCA9IFJlcG9zaXRvcnlCYXNlO1xuIl19
