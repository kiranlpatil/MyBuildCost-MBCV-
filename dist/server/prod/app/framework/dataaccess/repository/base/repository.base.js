"use strict";
var mongoose = require("mongoose");
var CostControllException = require("../../../../applicationProject/exception/CostControllException");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, function (error, result) {
            if (error) {
                callback(new CostControllException('Create Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, function (error, result) {
            if (error) {
                callback(new CostControllException('retrieve Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, function (error, result) {
            if (error) {
                callback(new CostControllException('update Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (error) {
            if (error) {
                callback(new CostControllException('Delete Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, 'Done.');
            }
        });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, function (error, result) {
            if (error) {
                callback(new CostControllException('findById Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('findAndPopulate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (error, result) {
            if (error) {
                callback(new CostControllException('findAndUpdate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.insertMany = function (data, callback) {
        console.log('Inserting into base repo : ' + JSON.stringify(data));
        this._model.insertMany(data, function (error, result) {
            if (error) {
                callback(new CostControllException('InsertMany Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.aggregate = function (field, callback) {
        this._model.aggregate(field).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('aggregate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.findByIdWithProjection = function (_id, projection, callback) {
        this._model.findById(_id, projection).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('retrieveByProjection Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBc0M7QUFDdEMsc0dBQXlHO0FBRXpHO0lBSUUsd0JBQVksV0FBOEM7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUM7SUFDNUIsQ0FBQztJQUVELCtCQUFNLEdBQU4sVUFBUSxJQUFPLEVBQUUsUUFBMkM7UUFDMUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFVBQUMsS0FBWSxFQUFFLE1BQVM7WUFDL0MsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVCxRQUFRLENBQUMsSUFBSSxxQkFBcUIsQ0FBQyxpQkFBaUIsR0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RixDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBRUQsaUNBQVEsR0FBUixVQUFVLEtBQVMsRUFBRSxRQUEyQztRQUM5RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsVUFBQyxLQUFZLEVBQUUsTUFBUztZQUM5QyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNULFFBQVEsQ0FBQyxJQUFJLHFCQUFxQixDQUFDLG1CQUFtQixHQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzNGLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pCLENBQUM7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QUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVCxRQUFRLENBQUMsSUFBSSxxQkFBcUIsQ0FBQyxvQkFBb0IsR0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM1RixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsK0NBQXNCLEdBQXRCLFVBQXVCLEdBQVcsRUFBRSxVQUFlLEVBQUUsUUFBMkM7UUFDOUYsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQUssRUFBRSxNQUFRO1lBQ3pELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsUUFBUSxDQUFDLElBQUkscUJBQXFCLENBQUMsK0JBQStCLEdBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDdkcsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDekIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQWtKSCxxQkFBQztBQUFELENBclFBLEFBcVFDLElBQUE7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvYmFzZS9yZXBvc2l0b3J5LmJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlYWQgPSByZXF1aXJlKCcuL3JlYWQnKTtcclxuaW1wb3J0IElXcml0ZSA9IHJlcXVpcmUoJy4vd3JpdGUnKTtcclxuaW1wb3J0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxuaW1wb3J0IENvc3RDb250cm9sbEV4Y2VwdGlvbiA9IHJlcXVpcmUoJy4uLy4uLy4uLy4uL2FwcGxpY2F0aW9uUHJvamVjdC9leGNlcHRpb24vQ29zdENvbnRyb2xsRXhjZXB0aW9uJyk7XHJcblxyXG5jbGFzcyBSZXBvc2l0b3J5QmFzZTxUIGV4dGVuZHMgbW9uZ29vc2UuRG9jdW1lbnQ+IGltcGxlbWVudHMgSVJlYWQ8VD4sIElXcml0ZTxUPiB7XHJcblxyXG4gIHByaXZhdGUgX21vZGVsOiBtb25nb29zZS5Nb2RlbDxtb25nb29zZS5Eb2N1bWVudD47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHNjaGVtYU1vZGVsOiBtb25nb29zZS5Nb2RlbDxtb25nb29zZS5Eb2N1bWVudD4pIHtcclxuICAgIHRoaXMuX21vZGVsID0gc2NoZW1hTW9kZWw7XHJcbiAgfVxyXG5cclxuICBjcmVhdGUgKGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmNyZWF0ZShpdGVtLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdDcmVhdGUgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIHJldHJpZXZlIChmaWVsZDphbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIChlcnJvciA6RXJyb3IsIHJlc3VsdDogVCkgPT4ge1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKG5ldyBDb3N0Q29udHJvbGxFeGNlcHRpb24oJ3JldHJpZXZlIEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGUgKF9pZDogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQsIGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBfaWR9LCBpdGVtLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCd1cGRhdGUgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBkZWxldGUgKF9pZDogc3RyaW5nLCBjYWxsYmFjazooZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnJlbW92ZSh7X2lkOiB0aGlzLnRvT2JqZWN0SWQoX2lkKX0sIChlcnJvciA6RXJyb3IpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdEZWxldGUgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCAnRG9uZS4nKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgZmluZEJ5SWQgKF9pZDogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZEJ5SWQoIF9pZCwgKGVycm9yIDpFcnJvciwgcmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbignZmluZEJ5SWQgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICB0b09iamVjdElkIChfaWQ6IHN0cmluZykgOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCB7XHJcbiAgICByZXR1cm4gbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuY3JlYXRlRnJvbUhleFN0cmluZyhfaWQpO1xyXG4gIH1cclxuXHJcbiAgZmluZEFuZFBvcHVsYXRlKHNlYXJjaEZpZWxkOiBhbnksIHBvcHVsYXRlRmllbGQgOmFueSwgY2FsbGJhY2s6KGVycjogYW55LCByZXN1bHQ6IGFueSk9PnZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoc2VhcmNoRmllbGQpLnBvcHVsYXRlKHBvcHVsYXRlRmllbGQpLmV4ZWMoKGVycm9yIDpFcnJvciwgcmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbignZmluZEFuZFBvcHVsYXRlIEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kT25lQW5kVXBkYXRlKHF1ZXJ5OiBhbnksIG5ld0RhdGE6IGFueSwgb3B0aW9uczogYW55LCBjYWxsYmFjazooZXJyOiBhbnksIHJlc3VsdDogYW55KT0+dm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgbmV3RGF0YSwgb3B0aW9ucywgKGVycm9yIDpFcnJvciwgcmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbignZmluZEFuZFVwZGF0ZSBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9ZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpbnNlcnRNYW55KGRhdGE6IGFueSwgY2FsbGJhY2s6KGVycjogYW55LCByZXN1bHQgOiBhbnkpPT4gdm9pZCkge1xyXG4gICAgY29uc29sZS5sb2coJ0luc2VydGluZyBpbnRvIGJhc2UgcmVwbyA6ICcrSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgdGhpcy5fbW9kZWwuaW5zZXJ0TWFueShkYXRhLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdJbnNlcnRNYW55IEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhZ2dyZWdhdGUoZmllbGQgOmFueSwgY2FsbGJhY2s6IChlcnJvcjphbnksIHJlc3VsdCA6IGFueSk9PiB2b2lkICkge1xyXG4gICAgdGhpcy5fbW9kZWwuYWdncmVnYXRlKCBmaWVsZCkuZXhlYygoZXJyb3IsIHJlc3VsdCkgPT4ge1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKG5ldyBDb3N0Q29udHJvbGxFeGNlcHRpb24oJ2FnZ3JlZ2F0ZSBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmluZEJ5SWRXaXRoUHJvamVjdGlvbihfaWQ6IHN0cmluZywgcHJvamVjdGlvbjogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZChfaWQsIHByb2plY3Rpb24pLmV4ZWMoKGVycm9yLCByZXN1bHQ6VCk9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbigncmV0cmlldmVCeVByb2plY3Rpb24gRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLypjcmVhdGUoaXRlbTogVCwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuY3JlYXRlKGl0ZW0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlKGZpZWxkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHt9KS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZVdpdGhJbmNsdWRlZChmaWVsZDogYW55LGluY2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIGluY2x1ZGVkKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZVdpdGhvdXRMZWFuKGZpZWxkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHt9KS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlV2l0aExlYW4oZmllbGQ6IGFueSwgcHJvamVjdGlvbjogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCBwcm9qZWN0aW9uKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNvdW50V2l0aExlYW4oZmllbGQ6IGFueSxwcm9qZWN0aW9uOmFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgY29uc29sZS50aW1lKCdjb3VudCB0aW1lJyk7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCBwcm9qZWN0aW9uKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY29uc29sZS50aW1lRW5kKCdjb3VudCB0aW1lJyk7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pOyovXHJcblxyXG4gLyogdXBkYXRlKF9pZDogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQsIGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVXaXRoUXVlcnkocXVlcnk6IGFueSwgaXRlbTogVCwgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBpdGVtLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuLy9UT0RPOkNPREUgTU9WRSBUTyBDQU5ESURBVEUgUkVQT1NJVEVPUllcclxuICB1cGRhdGVCeVVzZXJJZChfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkLCBpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyd1c2VySWQnOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XHJcblxyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVBbGwoZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7fSwgZXhjbHVkZWQpLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkcyhxdWVyeTogYW55LCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkc0ZvckNvbXBsZXhpdHkoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUJ5TXVsdGlJZHNBbmROYW1lcyhmaWVsZDogYW55W10sIG5hbWVzOiBhbnksIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHskYW5kOiBbe19pZDogeyRpbjogZmllbGR9fSwge25hbWU6IHskaW46IEpTT04ucGFyc2UobmFtZXMpfX1dfSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZShfaWQ6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwucmVtb3ZlKHtfaWQ6IHRoaXMudG9PYmplY3RJZChfaWQpfSwgKGVycikgPT4gY2FsbGJhY2soZXJyLCBudWxsKSk7XHJcbiAgfVxyXG5cclxuICBmaW5kQnlJZChfaWQ6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZmluZEJ5SWR3aXRoRXhjbHVkZShfaWQ6IHN0cmluZywgZXhjbHVkZTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZEJ5SWQoX2lkLCBleGNsdWRlLCBjYWxsYmFjayk7XHJcbiAgfVxyXG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcclxuICBmaW5kQnlOYW1lKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoeyduYW1lJzogbmFtZX0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHRvT2JqZWN0SWQoX2lkOiBzdHJpbmcpOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCB7XHJcbiAgICByZXR1cm4gbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuY3JlYXRlRnJvbUhleFN0cmluZyhfaWQpO1xyXG4gIH1cclxuXHJcbiAgZmluZEFuZFBvcHVsYXRlKHNlYXJjaEZpZWxkOiBhbnksIHBvcHVsYXRlRmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoc2VhcmNoRmllbGQpLnBvcHVsYXRlKHBvcHVsYXRlRmllbGQpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcbi8vVE9ETzogTU9WRSBDT0RFIFRPIElUUyBSRUxFQVRFRCBSRVBPU0lURU9SWVxyXG4gIHJldHJpZXZlQnlNdWx0aUlkc0FuZFBvcHVsYXRlKGlkczogc3RyaW5nW10sIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkKS5wb3B1bGF0ZSgndXNlcklkJykuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVBbmRQb3B1bGF0ZShxdWVyeSA6IE9iamVjdCxpbmNsdWRlZCA6IE9iamVjdCwgY2FsbGJhY2s6KGVycm9yIDogYW55LCByZXN1bHQgOiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQocXVlcnksIGluY2x1ZGVkKS5wb3B1bGF0ZSgndXNlcklkJykubGVhbigpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZpbmRPbmVBbmRVcGRhdGUocXVlcnk6IGFueSwgbmV3RGF0YTogYW55LCBvcHRpb25zOiBhbnksIGNhbGxiYWNrOiAoZXJyOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBuZXdEYXRhLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kT25lQW5kVXBkYXRlSW5kdXN0cnkocXVlcnk6IGFueSwgbmV3RGF0YTogYW55LCBvcHRpb25zOiBhbnksIGNhbGxiYWNrOiAoZXJyOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBuZXdEYXRhLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXN1bHQpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvL2N1c3RvbSBBUEkgY3JlYXRlZCBmb3IgQy1uZXh0IFJvbGVzIGNhcGFiaWxpdGllcyBhbmQgY29tcGxleGl0aWVzXHJcblxyXG4gIC8vY2hhbmdlIHRoZSBhbnkgZGF0YSB0eXBlIHRvIG1vZGVsXHJcblxyXG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcclxuICBwdXNoRWxlbWVudEluQXJyYXkodmFsdWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHskcHVzaDogeydwcm9maWNpZW5jaWVzJzogdmFsdWV9fSwgY2FsbGJhY2spO1xyXG4gIH1cclxuLy9UT0RPOiBNT1ZFIENPREUgVE8gSVRTIFJFTEVBVEVEIFJFUE9TSVRFT1JZXHJcbiAgLy9pbiBiZWxvdyBxdWVyeSB3ZSB1c2UgdXNlcklkIGZvciBzZWFyY2ggYXMgcmVmcmVuY2UgaWRcclxuICByZXRyaWV2ZUJ5TXVsdGlSZWZyZW5jZUlkc0FuZFBvcHVsYXRlKGlkczogc3RyaW5nW10sIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoeyd1c2VySWQnOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUJ5U29ydGVkT3JkZXIocXVlcnk6IGFueSwgcHJvamVjdGlvbjogYW55LCBzb3J0aW5nUXVlcnk6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSwgcHJvamVjdGlvbikuc29ydChzb3J0aW5nUXVlcnkpLmxlYW4oKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRDb3VudChxdWVyeTogYW55LCAgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSkuY291bnQoKS5sZWFuKCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH0qL1xyXG59XHJcblxyXG5leHBvcnQgPSBSZXBvc2l0b3J5QmFzZTtcclxuIl19
