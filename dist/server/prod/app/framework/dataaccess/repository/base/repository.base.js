"use strict";
var mongoose = require("mongoose");
var CostControllException = require("../../../../applicationProject/exception/CostControllException");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, function (error, result) {
            if (error) {
                callback(new CostControllException('Create Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, function (error, result) {
            if (error) {
                callback(new CostControllException('retrieve Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.retrieveWithProjection = function (field, projection, callback) {
        this._model.find(field, projection, function (error, result) {
            if (error) {
                callback(new CostControllException('retrieve Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, function (error, result) {
            if (error) {
                callback(new CostControllException('update Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (error) {
            if (error) {
                callback(new CostControllException('Delete Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, 'Done.');
            }
        });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, function (error, result) {
            if (error) {
                callback(new CostControllException('findById Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('findAndPopulate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (error, result) {
            if (error) {
                callback(new CostControllException('findAndUpdate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.insertMany = function (data, callback) {
        console.log('Inserting into base repo : ' + JSON.stringify(data));
        this._model.insertMany(data, function (error, result) {
            if (error) {
                callback(new CostControllException('InsertMany Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.aggregate = function (field, callback) {
        this._model.aggregate(field).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('aggregate Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    RepositoryBase.prototype.findByIdWithProjection = function (_id, projection, callback) {
        this._model.findById(_id, projection).exec(function (error, result) {
            if (error) {
                callback(new CostControllException('retrieveByProjection Failed. ' + error.message, error, 500), null);
            }
            else {
                callback(null, result);
            }
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBc0M7QUFDdEMsc0dBQXlHO0FBRXpHO0lBSUUsd0JBQVksV0FBOEM7UUFDeEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxXQUFXLENBQUM7SUFDNUIsQ0FBQztJQUVELCtCQUFNLEdBQU4sVUFBUSxJQUFPLEVBQUUsUUFBMkM7UUFDMUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFVBQUMsS0FBWSxFQUFFLE1BQVM7WUFDL0MsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVCxRQUFRLENBQUMsSUFBSSxxQkFBcUIsQ0FBQyxpQkFBaUIsR0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RixDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBRUQsaUNBQVEsR0FBUixVQUFVLEtBQVMsRUFBRSxRQUEyQztRQUM5RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsVUFBQyxLQUFZLEVBQUUsTUFBUztZQUM5QyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNULFFBQVEsQ0FBQyxJQUFJLHFCQUFxQixDQUFDLG1CQUFtQixHQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzNGLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pCLENBQUM7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QUksQ0FBQyxDQUFDO1lBQ3ZHLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3pCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFrSkgscUJBQUM7QUFBRCxDQTlRQSxBQThRQyxJQUFBO0FBRUQsaUJBQVMsY0FBYyxDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IElSZWFkID0gcmVxdWlyZSgnLi9yZWFkJyk7XHJcbmltcG9ydCBJV3JpdGUgPSByZXF1aXJlKCcuL3dyaXRlJyk7XHJcbmltcG9ydCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcbmltcG9ydCBDb3N0Q29udHJvbGxFeGNlcHRpb24gPSByZXF1aXJlKCcuLi8uLi8uLi8uLi9hcHBsaWNhdGlvblByb2plY3QvZXhjZXB0aW9uL0Nvc3RDb250cm9sbEV4Y2VwdGlvbicpO1xyXG5cclxuY2xhc3MgUmVwb3NpdG9yeUJhc2U8VCBleHRlbmRzIG1vbmdvb3NlLkRvY3VtZW50PiBpbXBsZW1lbnRzIElSZWFkPFQ+LCBJV3JpdGU8VD4ge1xyXG5cclxuICBwcml2YXRlIF9tb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihzY2hlbWFNb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+KSB7XHJcbiAgICB0aGlzLl9tb2RlbCA9IHNjaGVtYU1vZGVsO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlIChpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5jcmVhdGUoaXRlbSwgKGVycm9yIDpFcnJvciwgcmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbignQ3JlYXRlIEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH1lbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZSAoZmllbGQ6YW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdyZXRyaWV2ZSBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICByZXRyaWV2ZVdpdGhQcm9qZWN0aW9uIChmaWVsZDphbnkscHJvamVjdGlvbjphbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHByb2plY3Rpb24sKGVycm9yIDpFcnJvciwgcmVzdWx0OiBUKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbigncmV0cmlldmUgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZSAoX2lkOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCwgaXRlbTogVCwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHtfaWQ6IF9pZH0sIGl0ZW0sIChlcnJvciA6RXJyb3IsIHJlc3VsdDogVCkgPT4ge1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKG5ldyBDb3N0Q29udHJvbGxFeGNlcHRpb24oJ3VwZGF0ZSBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9XHJcblxyXG4gIGRlbGV0ZSAoX2lkOiBzdHJpbmcsIGNhbGxiYWNrOihlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwucmVtb3ZlKHtfaWQ6IHRoaXMudG9PYmplY3RJZChfaWQpfSwgKGVycm9yIDpFcnJvcikgPT4ge1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKG5ldyBDb3N0Q29udHJvbGxFeGNlcHRpb24oJ0RlbGV0ZSBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsICdEb25lLicpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBmaW5kQnlJZCAoX2lkOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZCggX2lkLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdmaW5kQnlJZCBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIHRvT2JqZWN0SWQgKF9pZDogc3RyaW5nKSA6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkIHtcclxuICAgIHJldHVybiBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5jcmVhdGVGcm9tSGV4U3RyaW5nKF9pZCk7XHJcbiAgfVxyXG5cclxuICBmaW5kQW5kUG9wdWxhdGUoc2VhcmNoRmllbGQ6IGFueSwgcG9wdWxhdGVGaWVsZCA6YW55LCBjYWxsYmFjazooZXJyOiBhbnksIHJlc3VsdDogYW55KT0+dm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChzZWFyY2hGaWVsZCkucG9wdWxhdGUocG9wdWxhdGVGaWVsZCkuZXhlYygoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdmaW5kQW5kUG9wdWxhdGUgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZpbmRPbmVBbmRVcGRhdGUocXVlcnk6IGFueSwgbmV3RGF0YTogYW55LCBvcHRpb25zOiBhbnksIGNhbGxiYWNrOihlcnI6IGFueSwgcmVzdWx0OiBhbnkpPT52b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBuZXdEYXRhLCBvcHRpb25zLCAoZXJyb3IgOkVycm9yLCByZXN1bHQ6IFQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdmaW5kQW5kVXBkYXRlIEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH1lbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGluc2VydE1hbnkoZGF0YTogYW55LCBjYWxsYmFjazooZXJyOiBhbnksIHJlc3VsdCA6IGFueSk9PiB2b2lkKSB7XHJcbiAgICBjb25zb2xlLmxvZygnSW5zZXJ0aW5nIGludG8gYmFzZSByZXBvIDogJytKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICB0aGlzLl9tb2RlbC5pbnNlcnRNYW55KGRhdGEsIChlcnJvciA6RXJyb3IsIHJlc3VsdDogVCkgPT4ge1xyXG4gICAgICBpZihlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKG5ldyBDb3N0Q29udHJvbGxFeGNlcHRpb24oJ0luc2VydE1hbnkgRmFpbGVkLiAnK2Vycm9yLm1lc3NhZ2UsIGVycm9yLCA1MDApLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFnZ3JlZ2F0ZShmaWVsZCA6YW55LCBjYWxsYmFjazogKGVycm9yOmFueSwgcmVzdWx0IDogYW55KT0+IHZvaWQgKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5hZ2dyZWdhdGUoIGZpZWxkKS5leGVjKChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IENvc3RDb250cm9sbEV4Y2VwdGlvbignYWdncmVnYXRlIEZhaWxlZC4gJytlcnJvci5tZXNzYWdlLCBlcnJvciwgNTAwKSwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kQnlJZFdpdGhQcm9qZWN0aW9uKF9pZDogc3RyaW5nLCBwcm9qZWN0aW9uOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgcHJvamVjdGlvbikuZXhlYygoZXJyb3IsIHJlc3VsdDpUKT0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgQ29zdENvbnRyb2xsRXhjZXB0aW9uKCdyZXRyaWV2ZUJ5UHJvamVjdGlvbiBGYWlsZWQuICcrZXJyb3IubWVzc2FnZSwgZXJyb3IsIDUwMCksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuICAvKmNyZWF0ZShpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5jcmVhdGUoaXRlbSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmUoZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChmaWVsZCwge30pLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlV2l0aEluY2x1ZGVkKGZpZWxkOiBhbnksaW5jbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChmaWVsZCwgaW5jbHVkZWQpLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlV2l0aG91dExlYW4oZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChmaWVsZCwge30pLmV4ZWMoKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVXaXRoTGVhbihmaWVsZDogYW55LCBwcm9qZWN0aW9uOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHByb2plY3Rpb24pLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY291bnRXaXRoTGVhbihmaWVsZDogYW55LHByb2plY3Rpb246YW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICBjb25zb2xlLnRpbWUoJ2NvdW50IHRpbWUnKTtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQsIHByb2plY3Rpb24pLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjb25zb2xlLnRpbWVFbmQoJ2NvdW50IHRpbWUnKTtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7Ki9cclxuXHJcbiAvKiB1cGRhdGUoX2lkOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCwgaXRlbTogVCwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHtfaWQ6IF9pZH0sIGl0ZW0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVdpdGhRdWVyeShxdWVyeTogYW55LCBpdGVtOiBULCBvcHRpb25zOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIGl0ZW0sIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4vL1RPRE86Q09ERSBNT1ZFIFRPIENBTkRJREFURSBSRVBPU0lURU9SWVxyXG4gIHVwZGF0ZUJ5VXNlcklkKF9pZDogbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQsIGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7J3VzZXJJZCc6IF9pZH0sIGl0ZW0sIGNhbGxiYWNrKTtcclxuXHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUFsbChleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHt9LCBleGNsdWRlZCkubGVhbigpLmV4ZWMoKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVCeU11bHRpSWRzKHF1ZXJ5OiBhbnksIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHF1ZXJ5LCBleGNsdWRlZCwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVCeU11bHRpSWRzRm9yQ29tcGxleGl0eShpZHM6IHN0cmluZ1tdLCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkc0FuZE5hbWVzKGZpZWxkOiBhbnlbXSwgbmFtZXM6IGFueSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoeyRhbmQ6IFt7X2lkOiB7JGluOiBmaWVsZH19LCB7bmFtZTogeyRpbjogSlNPTi5wYXJzZShuYW1lcyl9fV19LCBleGNsdWRlZCwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlKF9pZDogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5yZW1vdmUoe19pZDogdGhpcy50b09iamVjdElkKF9pZCl9LCAoZXJyKSA9PiBjYWxsYmFjayhlcnIsIG51bGwpKTtcclxuICB9XHJcblxyXG4gIGZpbmRCeUlkKF9pZDogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZEJ5SWQoX2lkLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBmaW5kQnlJZHdpdGhFeGNsdWRlKF9pZDogc3RyaW5nLCBleGNsdWRlOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZChfaWQsIGV4Y2x1ZGUsIGNhbGxiYWNrKTtcclxuICB9XHJcbi8vVE9ETzogTU9WRSBDT0RFIFRPIElUUyBSRUxFQVRFRCBSRVBPU0lURU9SWVxyXG4gIGZpbmRCeU5hbWUobmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7J25hbWUnOiBuYW1lfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgdG9PYmplY3RJZChfaWQ6IHN0cmluZyk6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkIHtcclxuICAgIHJldHVybiBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5jcmVhdGVGcm9tSGV4U3RyaW5nKF9pZCk7XHJcbiAgfVxyXG5cclxuICBmaW5kQW5kUG9wdWxhdGUoc2VhcmNoRmllbGQ6IGFueSwgcG9wdWxhdGVGaWVsZDogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChzZWFyY2hGaWVsZCkucG9wdWxhdGUocG9wdWxhdGVGaWVsZCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuLy9UT0RPOiBNT1ZFIENPREUgVE8gSVRTIFJFTEVBVEVEIFJFUE9TSVRFT1JZXHJcbiAgcmV0cmlldmVCeU11bHRpSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUFuZFBvcHVsYXRlKHF1ZXJ5IDogT2JqZWN0LGluY2x1ZGVkIDogT2JqZWN0LCBjYWxsYmFjazooZXJyb3IgOiBhbnksIHJlc3VsdCA6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSwgaW5jbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5sZWFuKCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmluZE9uZUFuZFVwZGF0ZShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZpbmRPbmVBbmRVcGRhdGVJbmR1c3RyeShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vY3VzdG9tIEFQSSBjcmVhdGVkIGZvciBDLW5leHQgUm9sZXMgY2FwYWJpbGl0aWVzIGFuZCBjb21wbGV4aXRpZXNcclxuXHJcbiAgLy9jaGFuZ2UgdGhlIGFueSBkYXRhIHR5cGUgdG8gbW9kZWxcclxuXHJcbi8vVE9ETzogTU9WRSBDT0RFIFRPIElUUyBSRUxFQVRFRCBSRVBPU0lURU9SWVxyXG4gIHB1c2hFbGVtZW50SW5BcnJheSh2YWx1ZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyRwdXNoOiB7J3Byb2ZpY2llbmNpZXMnOiB2YWx1ZX19LCBjYWxsYmFjayk7XHJcbiAgfVxyXG4vL1RPRE86IE1PVkUgQ09ERSBUTyBJVFMgUkVMRUFURUQgUkVQT1NJVEVPUllcclxuICAvL2luIGJlbG93IHF1ZXJ5IHdlIHVzZSB1c2VySWQgZm9yIHNlYXJjaCBhcyByZWZyZW5jZSBpZFxyXG4gIHJldHJpZXZlQnlNdWx0aVJlZnJlbmNlSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7J3VzZXJJZCc6IHskaW46IGlkc319LCBleGNsdWRlZCkucG9wdWxhdGUoJ3VzZXJJZCcpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlTb3J0ZWRPcmRlcihxdWVyeTogYW55LCBwcm9qZWN0aW9uOiBhbnksIHNvcnRpbmdRdWVyeTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHF1ZXJ5LCBwcm9qZWN0aW9uKS5zb3J0KHNvcnRpbmdRdWVyeSkubGVhbigpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldENvdW50KHF1ZXJ5OiBhbnksICBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHF1ZXJ5KS5jb3VudCgpLmxlYW4oKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xyXG4gICAgfSk7XHJcbiAgfSovXHJcbn1cclxuXHJcbmV4cG9ydCA9IFJlcG9zaXRvcnlCYXNlO1xyXG4iXX0=
