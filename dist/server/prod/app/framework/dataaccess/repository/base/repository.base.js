"use strict";
var mongoose = require("mongoose");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, callback);
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, {}).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithoutLean = function (field, callback) {
        this._model.find(field, {}).exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithLean = function (field, projection, callback) {
        console.time('repo2 time');
        this._model.find(field, projection).lean().exec(function (err, res) {
            console.timeEnd('repo2 time');
            callback(err, res);
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, callback);
    };
    RepositoryBase.prototype.updateByUserId = function (_id, item, callback) {
        this._model.update({ 'userId': _id }, item, callback);
    };
    RepositoryBase.prototype.retrieveAll = function (excluded, callback) {
        this._model.find({}, excluded).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIds = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsForComplexity = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndNames = function (field, names, excluded, callback) {
        this._model.find({ $and: [{ _id: { $in: field } }, { name: { $in: JSON.parse(names) } }] }, excluded, callback);
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (err) { return callback(err, null); });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, callback);
    };
    RepositoryBase.prototype.findByIdwithExclude = function (_id, exclude, callback) {
        this._model.findById(_id, exclude, callback);
    };
    RepositoryBase.prototype.findByName = function (name, callback) {
        this._model.find({ "name": name }, callback);
    };
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.findOneAndUpdateIndustry = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.pushInJobpost = function (id, value, callback) {
        this._model.update({ _id: id }, { $push: { "postedJobs": value.postedJobs } }, callback);
    };
    RepositoryBase.prototype.pushElementInArray = function (value, callback) {
        this._model.update({ $push: { "proficiencies": value } }, callback);
    };
    RepositoryBase.prototype.retrieveByMultiRefrenceIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ 'userId': { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveBySortedOrder = function (query, projection, sortingQuery, callback) {
        this._model.find(query, projection).sort(sortingQuery).lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.getCount = function (query, callback) {
        this._model.find(query).count().lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBcUM7QUFFckM7SUFJRSx3QkFBWSxXQUE4QztRQUN4RCxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLElBQU8sRUFBRSxRQUEyQztRQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQy9DLFFBQVEsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQW1CLEdBQW5CLFVBQW9CLEtBQVUsRUFBRSxRQUEyQztRQUN6RSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7WUFDeEMsUUFBUSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBZ0IsR0FBaEIsVUFBaUIsS0FBVSxFQUFFLFVBQWUsRUFBRSxRQUEyQztRQUN2RixPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFB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MkM7UUFDL0csSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsS0FBSztZQUNyRixRQUFRLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLEtBQUs7WUFDOUQsUUFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCxxQkFBQztBQUFELENBdklBLEFBdUlDLElBQUE7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvYmFzZS9yZXBvc2l0b3J5LmJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlYWQgPSByZXF1aXJlKFwiLi9yZWFkXCIpO1xyXG5pbXBvcnQgSVdyaXRlID0gcmVxdWlyZShcIi4vd3JpdGVcIik7XHJcbmltcG9ydCAqIGFzIG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiO1xyXG5cclxuY2xhc3MgUmVwb3NpdG9yeUJhc2U8VCBleHRlbmRzIG1vbmdvb3NlLkRvY3VtZW50PiBpbXBsZW1lbnRzIElSZWFkPFQ+LCBJV3JpdGU8VD4ge1xyXG5cclxuICBwcml2YXRlIF9tb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihzY2hlbWFNb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+KSB7XHJcbiAgICB0aGlzLl9tb2RlbCA9IHNjaGVtYU1vZGVsO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlKGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmNyZWF0ZShpdGVtLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZShmaWVsZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCB7fSkubGVhbigpLmV4ZWMoKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVXaXRob3V0TGVhbihmaWVsZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCB7fSkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZVdpdGhMZWFuKGZpZWxkOiBhbnksIHByb2plY3Rpb246IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgY29uc29sZS50aW1lKCdyZXBvMiB0aW1lJyk7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCBwcm9qZWN0aW9uKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY29uc29sZS50aW1lRW5kKCdyZXBvMiB0aW1lJyk7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIHVwZGF0ZShfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkLCBpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoe19pZDogX2lkfSwgaXRlbSwgY2FsbGJhY2spO1xyXG4gIH1cclxuICBcclxuICB1cGRhdGVCeVVzZXJJZChfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkLCBpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyd1c2VySWQnOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XHJcblxyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVBbGwoZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7fSwgZXhjbHVkZWQpLmxlYW4oKS5leGVjKChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkcyhpZHM6IHN0cmluZ1tdLCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkc0ZvckNvbXBsZXhpdHkoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUJ5TXVsdGlJZHNBbmROYW1lcyhmaWVsZDogYW55W10sIG5hbWVzOiBhbnksIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHskYW5kOiBbe19pZDogeyRpbjogZmllbGR9fSwge25hbWU6IHskaW46IEpTT04ucGFyc2UobmFtZXMpfX1dfSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIGRlbGV0ZShfaWQ6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwucmVtb3ZlKHtfaWQ6IHRoaXMudG9PYmplY3RJZChfaWQpfSwgKGVycikgPT4gY2FsbGJhY2soZXJyLCBudWxsKSk7XHJcbiAgfVxyXG5cclxuICBmaW5kQnlJZChfaWQ6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZmluZEJ5SWR3aXRoRXhjbHVkZShfaWQ6IHN0cmluZywgZXhjbHVkZTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZEJ5SWQoX2lkLCBleGNsdWRlLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBmaW5kQnlOYW1lKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe1wibmFtZVwiOiBuYW1lfSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgdG9PYmplY3RJZChfaWQ6IHN0cmluZyk6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkIHtcclxuICAgIHJldHVybiBtb25nb29zZS5UeXBlcy5PYmplY3RJZC5jcmVhdGVGcm9tSGV4U3RyaW5nKF9pZCk7XHJcbiAgfVxyXG5cclxuICBmaW5kQW5kUG9wdWxhdGUoc2VhcmNoRmllbGQ6IGFueSwgcG9wdWxhdGVGaWVsZDogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChzZWFyY2hGaWVsZCkucG9wdWxhdGUocG9wdWxhdGVGaWVsZCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVCeU11bHRpSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kT25lQW5kVXBkYXRlKHF1ZXJ5OiBhbnksIG5ld0RhdGE6IGFueSwgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgbmV3RGF0YSwgb3B0aW9ucywgZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzdWx0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmluZE9uZUFuZFVwZGF0ZUluZHVzdHJ5KHF1ZXJ5OiBhbnksIG5ld0RhdGE6IGFueSwgb3B0aW9uczogYW55LCBjYWxsYmFjazogKGVycjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgbmV3RGF0YSwgb3B0aW9ucywgZnVuY3Rpb24gKGVyciwgcmVzdWx0KSB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzdWx0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy9jdXN0b20gQVBJIGNyZWF0ZWQgZm9yIEMtbmV4dCBSb2xlcyBjYXBhYmlsaXRpZXMgYW5kIGNvbXBsZXhpdGllc1xyXG5cclxuICAvL2NoYW5nZSB0aGUgYW55IGRhdGEgdHlwZSB0byBtb2RlbFxyXG5cclxuICBwdXNoSW5Kb2Jwb3N0KGlkOiBzdHJpbmcsIHZhbHVlOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBpZH0sIHskcHVzaDoge1wicG9zdGVkSm9ic1wiOiB2YWx1ZS5wb3N0ZWRKb2JzfX0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHB1c2hFbGVtZW50SW5BcnJheSh2YWx1ZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoeyRwdXNoOiB7XCJwcm9maWNpZW5jaWVzXCI6IHZhbHVlfX0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIC8vaW4gYmVsb3cgcXVlcnkgd2UgdXNlIHVzZXJJZCBmb3Igc2VhcmNoIGFzIHJlZnJlbmNlIGlkXHJcbiAgcmV0cmlldmVCeU11bHRpUmVmcmVuY2VJZHNBbmRQb3B1bGF0ZShpZHM6IHN0cmluZ1tdLCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHsndXNlcklkJzogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkKS5wb3B1bGF0ZSgndXNlcklkJykuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVCeVNvcnRlZE9yZGVyKHF1ZXJ5OiBhbnksIHByb2plY3Rpb246IGFueSwgc29ydGluZ1F1ZXJ5OiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQocXVlcnksIHByb2plY3Rpb24pLnNvcnQoc29ydGluZ1F1ZXJ5KS5sZWFuKCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q291bnQocXVlcnk6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZChxdWVyeSkuY291bnQoKS5sZWFuKCkuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbmV4cG9ydCA9IFJlcG9zaXRvcnlCYXNlO1xyXG4iXX0=
