"use strict";
var mongoose = require("mongoose");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, callback);
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, {}).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithoutLean = function (field, callback) {
        this._model.find(field, {}).exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithLean = function (field, projection, callback) {
        console.time('repo2 time');
        this._model.find(field, projection).lean().exec(function (err, res) {
            console.timeEnd('repo2 time');
            callback(err, res);
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, callback);
    };
    RepositoryBase.prototype.retrieveAll = function (excluded, callback) {
        this._model.find({}, excluded).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIds = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsForComplexity = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndNames = function (field, names, excluded, callback) {
        this._model.find({ $and: [{ _id: { $in: field } }, { name: { $in: JSON.parse(names) } }] }, excluded, callback);
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (err) { return callback(err, null); });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, callback);
    };
    RepositoryBase.prototype.findByIdwithExclude = function (_id, exclude, callback) {
        this._model.findById(_id, exclude, callback);
    };
    RepositoryBase.prototype.findByName = function (name, callback) {
        this._model.find({ "name": name }, callback);
    };
    ;
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.findOneAndUpdateIndustry = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.pushInJobpost = function (id, value, callback) {
        this._model.update({ _id: id }, { $push: { "postedJobs": value.postedJobs } }, callback);
    };
    RepositoryBase.prototype.pushElementInArray = function (value, callback) {
        this._model.update({ $push: { "proficiencies": value } }, callback);
    };
    RepositoryBase.prototype.retrieveByMultiRefrenceIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ 'userId': { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBcUM7QUFFckM7SUFJRSx3QkFBWSxXQUE4QztRQUN4RCxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLElBQU8sRUFBRSxRQUEyQztRQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQzlDLFFBQVEsQ0FBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQW1CLEdBQW5CLFVBQW9CLEtBQVUsRUFBRSxRQUEyQztRQUN6RSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7WUFDdkMsUUFBUSxDQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBZ0IsR0FBaEIsVUFBaUIsS0FBVSxFQUFFLFVBQWUsRUFBRSxRQUEyQztRQUN2RixPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQyxHQUFHLEVBQUUsR0FBRztZQUN0RCxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzlCLFFBQVEsQ0FBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBR0QsK0JBQU0sR0FBTixVQUFPLEdBQTRCLEVBQUUsSUFBTyxFQUFFLFFBQTJDO1FBQ3ZGLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBQyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztJQUVqRCxDQUFDO0lBRUQsb0NBQVcsR0FBWCxVQUFZLFFBQWEsRUFBRSxRQUEyQztRQUNwRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7WUFDbEQsUUFBUSxDQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztRQUNwQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCwyQ0FBa0IsR0FBbEIsVUFBbUIsR0FBYSxFQUFFLFFBQWEsRUFBRSxRQUF5QztRQUN4RixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLEdBQUcsRUFBRSxFQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUMsRUFBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQsd0RBQStCLEdBQS9CLFVBQWdDLEdBQWEsRUFBRSxRQUFhLEVBQUUsUUFBeUM7UUFDckcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBQyxHQUFHLEVBQUUsRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLEVBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDMUQsQ0FBQztJQUVELG1EQUEwQixHQUExQixVQUEyQixLQUFZLEVBQUUsS0FBVSxFQUFFLFFBQWEsRUFBRSxRQUF5QztRQUMzRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUMsR0FBRyxFQUFFLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxFQUFDLEVBQUUsRUFBQyxJQUFJLEVBQUUsRUFBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBQyxFQUFDLENBQUMsRUFBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLEdBQVcsRUFBRSxRQUEyQztRQUM3RCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFDLEVBQUUsVUFBQyxHQUFHLElBQUssT0FBQSxRQUFRLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFuQixDQUFtQixDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxHQUFXLEVBQUUsUUFBeUM7UUFDN0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCw0Q0FBbUIsR0FBbkIsVUFBb0IsR0FBVyxFQUFFLE9BQVksRUFBRSxRQUF5QztRQUN0RixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFDRCxtQ0FBVSxHQUFWLFVBQVcsSUFBWSxFQUFFLFFBQXlDO1FBQ2hFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFDSCxDQUFDO0lBQ0MsbUNBQVUsR0FBVixVQUFXLEdBQVc7UUFDcEIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3pELENBQUM7SUFFRCx3Q0FBZSxHQUFmLFVBQWdCLFdBQWdCLEVBQUUsYUFBa0IsRUFBRSxRQUF5QztRQUM3RixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLEtBQUs7WUFDN0UsUUFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRCxzREFBNkIsR0FBN0IsVUFBOEIsR0FBYSxFQUFFLFFBQWEsRUFBRSxRQUEyQztRQUNyRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFDLEdBQUcsRUFBRSxFQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUMsRUFBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBUyxHQUFHLEVBQUUsS0FBSztZQUN2RixRQUFRLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNELHlDQUFnQixHQUFoQixVQUFpQixLQUFVLEVBQUUsT0FBWSxFQUFFLE9BQVksRUFBRSxRQUF5QztRQUNoRyxJQUFJLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsR0FBRyxFQUFFLE1BQU07WUFDekUsUUFBUSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxpREFBd0IsR0FBeEIsVUFBeUIsS0FBVSxFQUFFLE9BQVksRUFBRSxPQUFZLEVBQUUsUUFBeUM7UUFDeEcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFVLEdBQUcsRUFBRSxNQUFNO1lBQ3pFLFFBQVEsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBTUQsc0NBQWEsR0FBYixVQUFjLEVBQVUsRUFBRSxLQUFVLEVBQUUsUUFBMkM7UUFDL0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBQyxHQUFHLEVBQUUsRUFBRSxFQUFDLEVBQUUsRUFBQyxLQUFLLEVBQUUsRUFBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBQyxFQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUVELDJDQUFrQixHQUFsQixVQUFtQixLQUFhLEVBQUUsUUFBMkM7UUFDM0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBQyxLQUFLLEVBQUUsRUFBQyxlQUFlLEVBQUUsS0FBSyxFQUFDLEVBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBR0QsOERBQXFDLEdBQXJDLFVBQXNDLEdBQVksRUFBRSxRQUFZLEVBQUUsUUFBd0M7UUFDeEcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBQyxRQUFRLEVBQUUsRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLEVBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLEtBQUs7WUFDN0YsUUFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCxxQkFBQztBQUFELENBcEhBLEFBb0hDLElBQUE7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvYmFzZS9yZXBvc2l0b3J5LmJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlYWQgPSByZXF1aXJlKFwiLi9yZWFkXCIpO1xuaW1wb3J0IElXcml0ZSA9IHJlcXVpcmUoXCIuL3dyaXRlXCIpO1xuaW1wb3J0ICogYXMgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5cbmNsYXNzIFJlcG9zaXRvcnlCYXNlPFQgZXh0ZW5kcyBtb25nb29zZS5Eb2N1bWVudD4gaW1wbGVtZW50cyBJUmVhZDxUPiwgSVdyaXRlPFQ+IHtcblxuICBwcml2YXRlIF9tb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+O1xuXG4gIGNvbnN0cnVjdG9yKHNjaGVtYU1vZGVsOiBtb25nb29zZS5Nb2RlbDxtb25nb29zZS5Eb2N1bWVudD4pIHtcbiAgICB0aGlzLl9tb2RlbCA9IHNjaGVtYU1vZGVsO1xuICB9XG5cbiAgY3JlYXRlKGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5jcmVhdGUoaXRlbSwgY2FsbGJhY2spO1xuICB9XG5cbiAgcmV0cmlldmUoZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQse30pLmxlYW4oKS5leGVjKChlcnIsIHJlcyk9PiB7XG4gICAgICBjYWxsYmFjayhlcnIscmVzKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHJpZXZlV2l0aG91dExlYW4oZmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoZmllbGQse30pLmV4ZWMoKGVyciwgcmVzKT0+IHtcbiAgICAgIGNhbGxiYWNrKGVycixyZXMpO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0cmlldmVXaXRoTGVhbihmaWVsZDogYW55LCBwcm9qZWN0aW9uIDphbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICBjb25zb2xlLnRpbWUoJ3JlcG8yIHRpbWUnKTtcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLHByb2plY3Rpb24pLmxlYW4oKS5leGVjKChlcnIsIHJlcyk9PiB7XG4gICAgICBjb25zb2xlLnRpbWVFbmQoJ3JlcG8yIHRpbWUnKTtcbiAgICAgIGNhbGxiYWNrKGVycixyZXMpO1xuICAgIH0pO1xuICB9XG5cblxuICB1cGRhdGUoX2lkOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCwgaXRlbTogVCwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBfaWR9LCBpdGVtLCBjYWxsYmFjayk7XG5cbiAgfVxuXG4gIHJldHJpZXZlQWxsKGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHt9LCBleGNsdWRlZCkubGVhbigpLmV4ZWMoKGVyciwgcmVzKT0+IHtcbiAgICAgIGNhbGxiYWNrKGVycixyZXMpO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0cmlldmVCeU11bHRpSWRzKGlkczogc3RyaW5nW10sIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIHJldHJpZXZlQnlNdWx0aUlkc0ZvckNvbXBsZXhpdHkoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHtfaWQ6IHskaW46IGlkc319LCBleGNsdWRlZCwgY2FsbGJhY2spO1xuICB9XG5cbiAgcmV0cmlldmVCeU11bHRpSWRzQW5kTmFtZXMoZmllbGQ6IGFueVtdLCBuYW1lczogYW55LCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoeyRhbmQ6IFt7X2lkOiB7JGluOiBmaWVsZH19LCB7bmFtZTogeyRpbjogSlNPTi5wYXJzZShuYW1lcyl9fV19LCBleGNsdWRlZCwgY2FsbGJhY2spO1xuICB9XG5cbiAgZGVsZXRlKF9pZDogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwucmVtb3ZlKHtfaWQ6IHRoaXMudG9PYmplY3RJZChfaWQpfSwgKGVycikgPT4gY2FsbGJhY2soZXJyLCBudWxsKSk7XG4gIH1cblxuICBmaW5kQnlJZChfaWQ6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZChfaWQsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRCeUlkd2l0aEV4Y2x1ZGUoX2lkOiBzdHJpbmcsIGV4Y2x1ZGU6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZChfaWQsZXhjbHVkZSwgY2FsbGJhY2spO1xuICB9XG4gIGZpbmRCeU5hbWUobmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLmZpbmQoe1wibmFtZVwiOiBuYW1lfSwgY2FsbGJhY2spO1xuICB9XG47XG4gIHRvT2JqZWN0SWQoX2lkOiBzdHJpbmcpOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCB7XG4gICAgcmV0dXJuIG1vbmdvb3NlLlR5cGVzLk9iamVjdElkLmNyZWF0ZUZyb21IZXhTdHJpbmcoX2lkKVxuICB9XG5cbiAgZmluZEFuZFBvcHVsYXRlKHNlYXJjaEZpZWxkOiBhbnksIHBvcHVsYXRlRmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kKHNlYXJjaEZpZWxkKS5wb3B1bGF0ZShwb3B1bGF0ZUZpZWxkKS5leGVjKGZ1bmN0aW9uIChlcnIsIGl0ZW1zKSB7XG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcbiAgICB9KTtcbiAgfVxuICByZXRyaWV2ZUJ5TXVsdGlJZHNBbmRQb3B1bGF0ZShpZHM6IHN0cmluZ1tdLCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZCh7X2lkOiB7JGluOiBpZHN9fSwgZXhjbHVkZWQpLnBvcHVsYXRlKCd1c2VySWQnKS5leGVjKGZ1bmN0aW9uKGVyciwgaXRlbXMpe1xuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XG4gICAgfSk7XG4gIH1cbiAgZmluZE9uZUFuZFVwZGF0ZShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBuZXdEYXRhLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzdWx0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZpbmRPbmVBbmRVcGRhdGVJbmR1c3RyeShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcbiAgICB0aGlzLl9tb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCBuZXdEYXRhLCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCByZXN1bHQpIHtcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzdWx0KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vY3VzdG9tIEFQSSBjcmVhdGVkIGZvciBDLW5leHQgUm9sZXMgY2FwYWJpbGl0aWVzIGFuZCBjb21wbGV4aXRpZXNcblxuICAvL2NoYW5nZSB0aGUgYW55IGRhdGEgdHlwZSB0byBtb2RlbFxuXG4gIHB1c2hJbkpvYnBvc3QoaWQ6IHN0cmluZywgdmFsdWU6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX21vZGVsLnVwZGF0ZSh7X2lkOiBpZH0sIHskcHVzaDoge1wicG9zdGVkSm9ic1wiOiB2YWx1ZS5wb3N0ZWRKb2JzfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIHB1c2hFbGVtZW50SW5BcnJheSh2YWx1ZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHskcHVzaDoge1wicHJvZmljaWVuY2llc1wiOiB2YWx1ZX19LCBjYWxsYmFjayk7XG4gIH1cblxuICAvL2luIGJlbG93IHF1ZXJ5IHdlIHVzZSB1c2VySWQgZm9yIHNlYXJjaCBhcyByZWZyZW5jZSBpZFxuICByZXRyaWV2ZUJ5TXVsdGlSZWZyZW5jZUlkc0FuZFBvcHVsYXRlKGlkczpzdHJpbmdbXSwgZXhjbHVkZWQ6YW55LCBjYWxsYmFjazooZXJyb3I6YW55LCByZXN1bHQ6YW55KSA9PiB2b2lkKSB7XG4gICAgdGhpcy5fbW9kZWwuZmluZCh7J3VzZXJJZCc6IHskaW46IGlkc319LCBleGNsdWRlZCkucG9wdWxhdGUoJ3VzZXJJZCcpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcbiAgICAgIGNhbGxiYWNrKGVyciwgaXRlbXMpO1xuICAgIH0pO1xuICB9XG5cbn1cblxuZXhwb3J0ID0gUmVwb3NpdG9yeUJhc2U7XG4iXX0=
