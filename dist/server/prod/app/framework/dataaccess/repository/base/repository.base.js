"use strict";
var mongoose = require("mongoose");
var RepositoryBase = (function () {
    function RepositoryBase(schemaModel) {
        this._model = schemaModel;
    }
    RepositoryBase.prototype.create = function (item, callback) {
        this._model.create(item, callback);
    };
    RepositoryBase.prototype.retrieve = function (field, callback) {
        this._model.find(field, {}).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithoutLean = function (field, callback) {
        this._model.find(field, {}).exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveWithLean = function (field, projection, callback) {
        console.time('repo2 time');
        this._model.find(field, projection).lean().exec(function (err, res) {
            console.timeEnd('repo2 time');
            callback(err, res);
        });
    };
    RepositoryBase.prototype.update = function (_id, item, callback) {
        this._model.update({ _id: _id }, item, callback);
    };
    RepositoryBase.prototype.retrieveAll = function (excluded, callback) {
        this._model.find({}, excluded).lean().exec(function (err, res) {
            callback(err, res);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIds = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsForComplexity = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded, callback);
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndNames = function (field, names, excluded, callback) {
        this._model.find({ $and: [{ _id: { $in: field } }, { name: { $in: JSON.parse(names) } }] }, excluded, callback);
    };
    RepositoryBase.prototype.delete = function (_id, callback) {
        this._model.remove({ _id: this.toObjectId(_id) }, function (err) { return callback(err, null); });
    };
    RepositoryBase.prototype.findById = function (_id, callback) {
        this._model.findById(_id, callback);
    };
    RepositoryBase.prototype.findByIdwithExclude = function (_id, exclude, callback) {
        this._model.findById(_id, exclude, callback);
    };
    RepositoryBase.prototype.findByName = function (name, callback) {
        this._model.find({ "name": name }, callback);
    };
    RepositoryBase.prototype.toObjectId = function (_id) {
        return mongoose.Types.ObjectId.createFromHexString(_id);
    };
    RepositoryBase.prototype.findAndPopulate = function (searchField, populateField, callback) {
        this._model.find(searchField).populate(populateField).exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveByMultiIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ _id: { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.findOneAndUpdate = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.findOneAndUpdateIndustry = function (query, newData, options, callback) {
        this._model.findOneAndUpdate(query, newData, options, function (err, result) {
            callback(err, result);
        });
    };
    RepositoryBase.prototype.pushInJobpost = function (id, value, callback) {
        this._model.update({ _id: id }, { $push: { "postedJobs": value.postedJobs } }, callback);
    };
    RepositoryBase.prototype.pushElementInArray = function (value, callback) {
        this._model.update({ $push: { "proficiencies": value } }, callback);
    };
    RepositoryBase.prototype.retrieveByMultiRefrenceIdsAndPopulate = function (ids, excluded, callback) {
        this._model.find({ 'userId': { $in: ids } }, excluded).populate('userId').exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.retrieveBySortedOrder = function (query, projection, sortingQuery, callback) {
        this._model.find(query, projection).sort(sortingQuery).lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    RepositoryBase.prototype.getCount = function (query, callback) {
        this._model.find(query).count().lean().exec(function (err, items) {
            callback(err, items);
        });
    };
    return RepositoryBase;
}());
module.exports = RepositoryBase;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2Jhc2UvcmVwb3NpdG9yeS5iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxtQ0FBcUM7QUFFckM7SUFJRSx3QkFBWSxXQUE4QztRQUN4RCxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBRUQsK0JBQU0sR0FBTixVQUFPLElBQU8sRUFBRSxRQUEyQztRQUN6RCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQy9DLFFBQVEsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQW1CLEdBQW5CLFVBQW9CLEtBQVUsRUFBRSxRQUEyQztRQUN6RSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7WUFDeEMsUUFBUSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx5Q0FBZ0IsR0FBaEIsVUFBaUIsS0FBVSxFQUFFLFVBQWUsRUFBRSxRQUEyQztRQUN2RixPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFB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R0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELGlDQUFRLEdBQVIsVUFBUyxLQUFVLEVBQUUsUUFBMkM7UUFDOUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLEtBQUs7WUFDOUQsUUFBUSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFSCxxQkFBQztBQUFELENBbklBLEFBbUlDLElBQUE7QUFFRCxpQkFBUyxjQUFjLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvYmFzZS9yZXBvc2l0b3J5LmJhc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSVJlYWQgPSByZXF1aXJlKFwiLi9yZWFkXCIpO1xyXG5pbXBvcnQgSVdyaXRlID0gcmVxdWlyZShcIi4vd3JpdGVcIik7XHJcbmltcG9ydCAqIGFzIG1vbmdvb3NlIGZyb20gXCJtb25nb29zZVwiO1xyXG5cclxuY2xhc3MgUmVwb3NpdG9yeUJhc2U8VCBleHRlbmRzIG1vbmdvb3NlLkRvY3VtZW50PiBpbXBsZW1lbnRzIElSZWFkPFQ+LCBJV3JpdGU8VD4ge1xyXG5cclxuICBwcml2YXRlIF9tb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihzY2hlbWFNb2RlbDogbW9uZ29vc2UuTW9kZWw8bW9uZ29vc2UuRG9jdW1lbnQ+KSB7XHJcbiAgICB0aGlzLl9tb2RlbCA9IHNjaGVtYU1vZGVsO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlKGl0ZW06IFQsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmNyZWF0ZShpdGVtLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZShmaWVsZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCB7fSkubGVhbigpLmV4ZWMoKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVXaXRob3V0TGVhbihmaWVsZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCB7fSkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZVdpdGhMZWFuKGZpZWxkOiBhbnksIHByb2plY3Rpb246IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgY29uc29sZS50aW1lKCdyZXBvMiB0aW1lJyk7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKGZpZWxkLCBwcm9qZWN0aW9uKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY29uc29sZS50aW1lRW5kKCdyZXBvMiB0aW1lJyk7XHJcbiAgICAgIGNhbGxiYWNrKGVyciwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIHVwZGF0ZShfaWQ6IG1vbmdvb3NlLlR5cGVzLk9iamVjdElkLCBpdGVtOiBULCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoe19pZDogX2lkfSwgaXRlbSwgY2FsbGJhY2spO1xyXG5cclxuICB9XHJcblxyXG4gIHJldHJpZXZlQWxsKGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe30sIGV4Y2x1ZGVkKS5sZWFuKCkuZXhlYygoZXJyLCByZXMpID0+IHtcclxuICAgICAgY2FsbGJhY2soZXJyLCByZXMpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUJ5TXVsdGlJZHMoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICByZXRyaWV2ZUJ5TXVsdGlJZHNGb3JDb21wbGV4aXR5KGlkczogc3RyaW5nW10sIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHtfaWQ6IHskaW46IGlkc319LCBleGNsdWRlZCwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVCeU11bHRpSWRzQW5kTmFtZXMoZmllbGQ6IGFueVtdLCBuYW1lczogYW55LCBleGNsdWRlZDogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogVCkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7JGFuZDogW3tfaWQ6IHskaW46IGZpZWxkfX0sIHtuYW1lOiB7JGluOiBKU09OLnBhcnNlKG5hbWVzKX19XX0sIGV4Y2x1ZGVkLCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBkZWxldGUoX2lkOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLnJlbW92ZSh7X2lkOiB0aGlzLnRvT2JqZWN0SWQoX2lkKX0sIChlcnIpID0+IGNhbGxiYWNrKGVyciwgbnVsbCkpO1xyXG4gIH1cclxuXHJcbiAgZmluZEJ5SWQoX2lkOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kQnlJZChfaWQsIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIGZpbmRCeUlkd2l0aEV4Y2x1ZGUoX2lkOiBzdHJpbmcsIGV4Y2x1ZGU6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IFQpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRCeUlkKF9pZCwgZXhjbHVkZSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgZmluZEJ5TmFtZShuYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBUKSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHtcIm5hbWVcIjogbmFtZX0sIGNhbGxiYWNrKTtcclxuICB9XHJcblxyXG4gIHRvT2JqZWN0SWQoX2lkOiBzdHJpbmcpOiBtb25nb29zZS5UeXBlcy5PYmplY3RJZCB7XHJcbiAgICByZXR1cm4gbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQuY3JlYXRlRnJvbUhleFN0cmluZyhfaWQpO1xyXG4gIH1cclxuXHJcbiAgZmluZEFuZFBvcHVsYXRlKHNlYXJjaEZpZWxkOiBhbnksIHBvcHVsYXRlRmllbGQ6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoc2VhcmNoRmllbGQpLnBvcHVsYXRlKHBvcHVsYXRlRmllbGQpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlNdWx0aUlkc0FuZFBvcHVsYXRlKGlkczogc3RyaW5nW10sIGV4Y2x1ZGVkOiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQoe19pZDogeyRpbjogaWRzfX0sIGV4Y2x1ZGVkKS5wb3B1bGF0ZSgndXNlcklkJykuZXhlYyhmdW5jdGlvbiAoZXJyLCBpdGVtcykge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIGl0ZW1zKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmluZE9uZUFuZFVwZGF0ZShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZpbmRPbmVBbmRVcGRhdGVJbmR1c3RyeShxdWVyeTogYW55LCBuZXdEYXRhOiBhbnksIG9wdGlvbnM6IGFueSwgY2FsbGJhY2s6IChlcnI6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIG5ld0RhdGEsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xyXG4gICAgICBjYWxsYmFjayhlcnIsIHJlc3VsdCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vY3VzdG9tIEFQSSBjcmVhdGVkIGZvciBDLW5leHQgUm9sZXMgY2FwYWJpbGl0aWVzIGFuZCBjb21wbGV4aXRpZXNcclxuXHJcbiAgLy9jaGFuZ2UgdGhlIGFueSBkYXRhIHR5cGUgdG8gbW9kZWxcclxuXHJcbiAgcHVzaEluSm9icG9zdChpZDogc3RyaW5nLCB2YWx1ZTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC51cGRhdGUoe19pZDogaWR9LCB7JHB1c2g6IHtcInBvc3RlZEpvYnNcIjogdmFsdWUucG9zdGVkSm9ic319LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBwdXNoRWxlbWVudEluQXJyYXkodmFsdWU6IHN0cmluZywgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwudXBkYXRlKHskcHVzaDoge1wicHJvZmljaWVuY2llc1wiOiB2YWx1ZX19LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICAvL2luIGJlbG93IHF1ZXJ5IHdlIHVzZSB1c2VySWQgZm9yIHNlYXJjaCBhcyByZWZyZW5jZSBpZFxyXG4gIHJldHJpZXZlQnlNdWx0aVJlZnJlbmNlSWRzQW5kUG9wdWxhdGUoaWRzOiBzdHJpbmdbXSwgZXhjbHVkZWQ6IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgdGhpcy5fbW9kZWwuZmluZCh7J3VzZXJJZCc6IHskaW46IGlkc319LCBleGNsdWRlZCkucG9wdWxhdGUoJ3VzZXJJZCcpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlQnlTb3J0ZWRPcmRlcihxdWVyeTogYW55LCBwcm9qZWN0aW9uOiBhbnksIHNvcnRpbmdRdWVyeTogYW55LCBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLl9tb2RlbC5maW5kKHF1ZXJ5LCBwcm9qZWN0aW9uKS5zb3J0KHNvcnRpbmdRdWVyeSkubGVhbigpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldENvdW50KHF1ZXJ5OiBhbnksIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuX21vZGVsLmZpbmQocXVlcnkpLmNvdW50KCkubGVhbigpLmV4ZWMoZnVuY3Rpb24gKGVyciwgaXRlbXMpIHtcclxuICAgICAgY2FsbGJhY2soZXJyLCBpdGVtcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgPSBSZXBvc2l0b3J5QmFzZTtcclxuIl19
