"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Messages = require("../shared/messages");
var JobProfileService = require("../services/jobprofile.service");
var CNextMessages = require("../shared/cnext-messages");
var SearchService = require("../search/services/search.service");
var sharedconstants_1 = require("../shared/sharedconstants");
var RecruiterService = require("../services/recruiter.service");
var usestracking = require('uses-tracking');
function searchCandidatesByJobProfile(req, res, next) {
    try {
        var jobProfile = req.body;
        var jobProfileService = new JobProfileService();
        jobProfileService.searchCandidatesByJobProfile(jobProfile, function (error, result) {
            if (error) {
                next({
                    reason: 'No candidates are present for this Job Profile',
                    message: Messages.MSG_ERROR_WRONG_TOKEN,
                    code: 401
                });
            }
            else {
                res.send({
                    'status': 'success',
                    'data': result
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.searchCandidatesByJobProfile = searchCandidatesByJobProfile;
function retrieve(req, res, next) {
    try {
        var jobProfileService = new JobProfileService();
        var data = {
            'postedJob': req.params.id
        };
        jobProfileService.retrieve(data, function (error, result) {
            if (error) {
                next({
                    reason: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    message: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    code: 401
                });
            }
            else {
                var currentDate = Number(new Date());
                var expiringDate = Number(new Date(result.postedJobs[0].expiringDate));
                var daysRemainingForExpiring = Math.round(Number(new Date(expiringDate - currentDate)) / (1000 * 60 * 60 * 24));
                result.postedJobs[0].daysRemainingForExpiring = daysRemainingForExpiring;
                if (daysRemainingForExpiring <= 0) {
                    result.postedJobs[0].isJobPostExpired = true;
                }
                else {
                    result.postedJobs[0].isJobPostExpired = false;
                }
                res.status(200).send({
                    'data': {
                        'industry': result
                    }
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.retrieve = retrieve;
function getCapabilityMatrix(req, res, next) {
    try {
        var jobProfileService = new JobProfileService();
        var data = {
            'postedJob': req.params.id
        };
        jobProfileService.getCapabilityValueKeyMatrix(req.params.id, function (error, result) {
            if (error) {
                next({
                    reason: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    message: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    code: 401
                });
            }
            else {
                res.status(200).send({
                    'data': result
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getCapabilityMatrix = getCapabilityMatrix;
function update(req, res, next) {
    try {
        var jobProfileService = new JobProfileService();
        var data = {
            'recruiterId': req.params.recruiterId,
            'profileId': req.params.profileId,
            'listName': req.params.listName,
            'candidateId': req.params.candidateId,
            'action': req.params.action
        };
        jobProfileService.update(data, function (err, result) {
            if (err) {
                next({
                    reason: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                    message: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                    code: 403
                });
            }
            else {
                res.status(200).send({
                    'status': Messages.STATUS_SUCCESS,
                    'data': result
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.update = update;
function apply(req, res, next) {
    try {
        var jobProfileService = new JobProfileService();
        var data = {
            'candidateId': req.params.id,
            'profileId': req.params.profileId,
            'action': req.params.action,
            'listName': req.params.listName
        };
        jobProfileService.applyJob(data, function (err, result) {
            if (err) {
                next({
                    reason: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                    message: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                    code: 403
                });
            }
            else {
                res.status(200).send({
                    'status': Messages.STATUS_SUCCESS,
                    'data': result
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.apply = apply;
function metchResultForJob(req, res, next) {
    try {
        var searchService = new SearchService();
        var jobId = req.params.jobId;
        var candidateId = req.params.candidateId;
        searchService.getMatchingResult(candidateId, jobId, false, function (error, result) {
            if (error) {
                next({
                    reason: 'Problem in Search Matching Result',
                    message: 'Problem in Search Matching Result',
                    code: 401
                });
            }
            else {
                res.send({
                    'status': 'success',
                    'data': result,
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.metchResultForJob = metchResultForJob;
function createUsesTracking(req, res) {
    try {
        var data = void 0;
        data = req.body;
        data.timestamp = new Date();
        var obj = new usestracking.MyController();
        obj._controller.create(data);
        res.send({
            'status': 'success',
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.createUsesTracking = createUsesTracking;
function getQCardDetails(req, res, next) {
    try {
        var jobProfileService = new JobProfileService();
        var data = {
            'jobId': req.params.id,
            'candidateIds': req.body.candidateIds
        };
        jobProfileService.getQCardDetails(data, function (error, result) {
            if (error) {
                res.status(304).send(error);
            }
            else {
                res.status(200).send(result);
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getQCardDetails = getQCardDetails;
function cloneJob(req, res, next) {
    try {
        var newJobTitle = req.query.newJobTitle;
        var jobProfileService = new JobProfileService();
        var data = {
            'postedJob': req.params.id
        };
        jobProfileService.retrieve(data, function (error, result) {
            if (error) {
                next({
                    reason: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    message: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    code: 401
                });
            }
            else {
                var newJob = result.postedJobs[0];
                delete newJob._id;
                newJob.jobTitle = newJobTitle;
                newJob.isJobPosted = false;
                newJob.isJobShared = false;
                newJob.sharedLink = '';
                newJob.postingDate = new Date();
                newJob.candidate_list = [];
                newJob.expiringDate = new Date((new Date().getTime() + sharedconstants_1.ConstVariables.JOB__EXPIRIY_PERIOD));
                var recruiterService = new RecruiterService();
                recruiterService.addCloneJob(result.userId, newJob, function (err, result) {
                    if (err) {
                        next({
                            reason: err,
                            message: err.message,
                            code: 403
                        });
                    }
                    else {
                        res.status(200).send({
                            'status': Messages.STATUS_SUCCESS,
                            'data': result.postedJobs[0]._id
                        });
                    }
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.cloneJob = cloneJob;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvY29udHJvbGxlcnMvam9iLXByb2ZpbGUuY29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDZDQUFnRDtBQUVoRCxrRUFBcUU7QUFDckUsd0RBQTJEO0FBQzNELGlFQUFvRTtBQUVwRSw2REFBa0U7QUFDbEUsZ0VBQW1FO0FBQ25FLElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUc1QyxzQ0FBNkMsR0FBb0IsRUFBRSxHQUFxQixFQUFFLElBQVM7SUFDakcsSUFBSSxDQUFDO1FBQ0gsSUFBSSxVQUFVLEdBQXFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDNUQsSUFBSSxpQkFBaUIsR0FBc0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1FBQ25FLGlCQUFpQixDQUFDLDRCQUE0QixDQUFDLFVBQVUsRUFBRSxVQUFDLEtBQUssRUFBRSxNQUFNO1lBQ3ZFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsSUFBSSxDQUFDO29CQUNILE1BQU0sRUFBRSxnREFBZ0Q7b0JBQ3hELE9BQU8sRUFBRSxRQUFRLENBQUMscUJBQXFCO29CQUN2QyxJQUFJLEVBQUUsR0FBRztpQkFDVixDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sR0FBRyxDQUFDLElBQUksQ0FBQztvQkFDUCxRQUFRLEVBQUUsU0FBUztvQkFDbkIsTUFBTSxFQUFFLE1BQU07aUJBQ2YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBRUwsQ0FBQztJQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0FBRUgsQ0FBQztBQXZCRCxv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Q0FBQztRQUVILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0FBQ0gsQ0FBQztBQS9DRCw0QkErQ0MiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9jb250cm9sbGVycy9qb2ItcHJvZmlsZS5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vc2hhcmVkL21lc3NhZ2VzJyk7XHJcbmltcG9ydCBKb2JQcm9maWxlTW9kZWwgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL2pvYnByb2ZpbGUubW9kZWwnKTtcclxuaW1wb3J0IEpvYlByb2ZpbGVTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvam9icHJvZmlsZS5zZXJ2aWNlJyk7XHJcbmltcG9ydCBDTmV4dE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vc2hhcmVkL2NuZXh0LW1lc3NhZ2VzJyk7XHJcbmltcG9ydCBTZWFyY2hTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VhcmNoL3NlcnZpY2VzL3NlYXJjaC5zZXJ2aWNlJyk7XHJcbmltcG9ydCB7IFVzYWdlVHJhY2tpbmcgfSBmcm9tICcuLi9kYXRhYWNjZXNzL21vZGVsL3VzYWdlLXRyYWNraW5nJztcclxuaW1wb3J0IHtBY3Rpb25zLCBDb25zdFZhcmlhYmxlc30gZnJvbSAnLi4vc2hhcmVkL3NoYXJlZGNvbnN0YW50cyc7XHJcbmltcG9ydCBSZWNydWl0ZXJTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvcmVjcnVpdGVyLnNlcnZpY2UnKTtcclxubGV0IHVzZXN0cmFja2luZyA9IHJlcXVpcmUoJ3VzZXMtdHJhY2tpbmcnKTtcclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VhcmNoQ2FuZGlkYXRlc0J5Sm9iUHJvZmlsZShyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IGpvYlByb2ZpbGU6IEpvYlByb2ZpbGVNb2RlbCA9IDxKb2JQcm9maWxlTW9kZWw+cmVxLmJvZHk7XHJcbiAgICBsZXQgam9iUHJvZmlsZVNlcnZpY2U6IEpvYlByb2ZpbGVTZXJ2aWNlID0gbmV3IEpvYlByb2ZpbGVTZXJ2aWNlKCk7XHJcbiAgICBqb2JQcm9maWxlU2VydmljZS5zZWFyY2hDYW5kaWRhdGVzQnlKb2JQcm9maWxlKGpvYlByb2ZpbGUsIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIG5leHQoe1xyXG4gICAgICAgICAgcmVhc29uOiAnTm8gY2FuZGlkYXRlcyBhcmUgcHJlc2VudCBmb3IgdGhpcyBKb2IgUHJvZmlsZScsLy9NZXNzYWdlcy5NU0dfRVJST1JfUlNOX0lOVkFMSURfQ1JFREVOVElBTFMsXHJcbiAgICAgICAgICBtZXNzYWdlOiBNZXNzYWdlcy5NU0dfRVJST1JfV1JPTkdfVE9LRU4sXHJcbiAgICAgICAgICBjb2RlOiA0MDFcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc2VuZCh7XHJcbiAgICAgICAgICAnc3RhdHVzJzogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgJ2RhdGEnOiByZXN1bHRcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmV0cmlldmUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dDogYW55KSB7XHJcbiAgdHJ5IHtcclxuICAgIHZhciBqb2JQcm9maWxlU2VydmljZSA9IG5ldyBKb2JQcm9maWxlU2VydmljZSgpO1xyXG4gICAgbGV0IGRhdGEgPSB7XHJcbiAgICAgICdwb3N0ZWRKb2InOiByZXEucGFyYW1zLmlkXHJcbiAgICB9O1xyXG4gICAgam9iUHJvZmlsZVNlcnZpY2UucmV0cmlldmUoZGF0YSwgKGVycm9yLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgbmV4dCh7XHJcbiAgICAgICAgICByZWFzb246IENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9SRVRSSUVWRV9KT0JfUFJPRklMRSxcclxuICAgICAgICAgIG1lc3NhZ2U6IENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9SRVRSSUVWRV9KT0JfUFJPRklMRSxcclxuICAgICAgICAgIGNvZGU6IDQwMVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCBjdXJyZW50RGF0ZSA9IE51bWJlcihuZXcgRGF0ZSgpKTtcclxuICAgICAgICBsZXQgZXhwaXJpbmdEYXRlID0gTnVtYmVyKG5ldyBEYXRlKHJlc3VsdC5wb3N0ZWRKb2JzWzBdLmV4cGlyaW5nRGF0ZSkpO1xyXG4gICAgICAgIGxldCBkYXlzUmVtYWluaW5nRm9yRXhwaXJpbmcgPSBNYXRoLnJvdW5kKE51bWJlcihuZXcgRGF0ZShleHBpcmluZ0RhdGUgLSBjdXJyZW50RGF0ZSkpLygxMDAwKjYwKjYwKjI0KSk7XHJcbiAgICAgICAgcmVzdWx0LnBvc3RlZEpvYnNbMF0uZGF5c1JlbWFpbmluZ0ZvckV4cGlyaW5nPWRheXNSZW1haW5pbmdGb3JFeHBpcmluZztcclxuICAgICAgICBpZiAoZGF5c1JlbWFpbmluZ0ZvckV4cGlyaW5nIDw9IDApIHtcclxuICAgICAgICAgIHJlc3VsdC5wb3N0ZWRKb2JzWzBdLmlzSm9iUG9zdEV4cGlyZWQ9dHJ1ZTtcclxuXHJcbiAgICAgICAgfSBlbHNle1xyXG4gICAgICAgICAgcmVzdWx0LnBvc3RlZEpvYnNbMF0uaXNKb2JQb3N0RXhwaXJlZD1mYWxzZTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICdkYXRhJzoge1xyXG4gICAgICAgICAgICAnaW5kdXN0cnknOiByZXN1bHRcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2FwYWJpbGl0eU1hdHJpeChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgdmFyIGpvYlByb2ZpbGVTZXJ2aWNlID0gbmV3IEpvYlByb2ZpbGVTZXJ2aWNlKCk7XHJcbiAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgJ3Bvc3RlZEpvYic6IHJlcS5wYXJhbXMuaWRcclxuICAgIH07XHJcbiAgICBqb2JQcm9maWxlU2VydmljZS5nZXRDYXBhYmlsaXR5VmFsdWVLZXlNYXRyaXgocmVxLnBhcmFtcy5pZCwgKGVycm9yLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgbmV4dCh7XHJcbiAgICAgICAgICByZWFzb246IENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9SRVRSSUVWRV9KT0JfUFJPRklMRSxcclxuICAgICAgICAgIG1lc3NhZ2U6IENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9SRVRSSUVWRV9KT0JfUFJPRklMRSxcclxuICAgICAgICAgIGNvZGU6IDQwMVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICdkYXRhJzogcmVzdWx0XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZShyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICB0cnkge1xyXG5cclxuICAgIHZhciBqb2JQcm9maWxlU2VydmljZSA9IG5ldyBKb2JQcm9maWxlU2VydmljZSgpO1xyXG4gICAgbGV0IGRhdGEgPSB7XHJcbiAgICAgICdyZWNydWl0ZXJJZCc6IHJlcS5wYXJhbXMucmVjcnVpdGVySWQsXHJcbiAgICAgICdwcm9maWxlSWQnOiByZXEucGFyYW1zLnByb2ZpbGVJZCxcclxuICAgICAgJ2xpc3ROYW1lJzogcmVxLnBhcmFtcy5saXN0TmFtZSxcclxuICAgICAgJ2NhbmRpZGF0ZUlkJzogcmVxLnBhcmFtcy5jYW5kaWRhdGVJZCxcclxuICAgICAgJ2FjdGlvbic6IHJlcS5wYXJhbXMuYWN0aW9uXHJcbiAgICB9O1xyXG5cclxuICAgIGpvYlByb2ZpbGVTZXJ2aWNlLnVwZGF0ZShkYXRhLCAoZXJyLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYgKGVycikge1xyXG4gICAgICAgIG5leHQoe1xyXG4gICAgICAgICAgcmVhc29uOiBNZXNzYWdlcy5NU0dfRVJST1JfUlNOX1VTRVJfTk9UX0ZPVU5ELFxyXG4gICAgICAgICAgbWVzc2FnZTogTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9VU0VSX05PVF9GT1VORCxcclxuICAgICAgICAgIGNvZGU6IDQwM1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcclxuICAgICAgICAgICdkYXRhJzogcmVzdWx0XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhcHBseShyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgdmFyIGpvYlByb2ZpbGVTZXJ2aWNlID0gbmV3IEpvYlByb2ZpbGVTZXJ2aWNlKCk7XHJcbiAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgJ2NhbmRpZGF0ZUlkJzogcmVxLnBhcmFtcy5pZCxcclxuICAgICAgJ3Byb2ZpbGVJZCc6IHJlcS5wYXJhbXMucHJvZmlsZUlkLFxyXG4gICAgICAnYWN0aW9uJzogcmVxLnBhcmFtcy5hY3Rpb24sXHJcbiAgICAgICdsaXN0TmFtZSc6IHJlcS5wYXJhbXMubGlzdE5hbWVcclxuICAgIH07XHJcbiAgICBqb2JQcm9maWxlU2VydmljZS5hcHBseUpvYihkYXRhLCAoZXJyLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYgKGVycikge1xyXG4gICAgICAgIG5leHQoe1xyXG4gICAgICAgICAgcmVhc29uOiBNZXNzYWdlcy5NU0dfRVJST1JfUlNOX1VTRVJfTk9UX0ZPVU5ELFxyXG4gICAgICAgICAgbWVzc2FnZTogTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9VU0VSX05PVF9GT1VORCxcclxuICAgICAgICAgIGNvZGU6IDQwM1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcclxuICAgICAgICAgICdkYXRhJzogcmVzdWx0XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1ldGNoUmVzdWx0Rm9ySm9iKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xyXG4gIHRyeSB7XHJcbiAgICB2YXIgc2VhcmNoU2VydmljZSA9IG5ldyBTZWFyY2hTZXJ2aWNlKCk7XHJcbiAgICBsZXQgam9iSWQgPSByZXEucGFyYW1zLmpvYklkO1xyXG4gICAgbGV0IGNhbmRpZGF0ZUlkID0gcmVxLnBhcmFtcy5jYW5kaWRhdGVJZDtcclxuICAgIHNlYXJjaFNlcnZpY2UuZ2V0TWF0Y2hpbmdSZXN1bHQoY2FuZGlkYXRlSWQsIGpvYklkLCBmYWxzZSwoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgbmV4dCh7XHJcbiAgICAgICAgICByZWFzb246ICdQcm9ibGVtIGluIFNlYXJjaCBNYXRjaGluZyBSZXN1bHQnLC8vTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9JTlZBTElEX0NSRURFTlRJQUxTLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ1Byb2JsZW0gaW4gU2VhcmNoIE1hdGNoaW5nIFJlc3VsdCcsLy9NZXNzYWdlcy5NU0dfRVJST1JfV1JPTkdfVE9LRU4sXHJcbiAgICAgICAgICBjb2RlOiA0MDFcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc2VuZCh7XHJcbiAgICAgICAgICAnc3RhdHVzJzogJ3N1Y2Nlc3MnLFxyXG4gICAgICAgICAgJ2RhdGEnOiByZXN1bHQsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVXNlc1RyYWNraW5nKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IGRhdGEgOiBVc2FnZVRyYWNraW5nO1xyXG4gICAgZGF0YSA9IHJlcS5ib2R5O1xyXG4gICAgZGF0YS50aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbGV0IG9iajogYW55ID0gbmV3IHVzZXN0cmFja2luZy5NeUNvbnRyb2xsZXIoKTtcclxuICAgIG9iai5fY29udHJvbGxlci5jcmVhdGUoZGF0YSk7XHJcbiAgICByZXMuc2VuZCh7XHJcbiAgICAgICdzdGF0dXMnOiAnc3VjY2VzcycsXHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UUNhcmREZXRhaWxzKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xyXG4gIHRyeSB7XHJcbiAgICB2YXIgam9iUHJvZmlsZVNlcnZpY2UgPSBuZXcgSm9iUHJvZmlsZVNlcnZpY2UoKTtcclxuICAgIGxldCBkYXRhID0ge1xyXG4gICAgICAnam9iSWQnOiByZXEucGFyYW1zLmlkLFxyXG4gICAgICAnY2FuZGlkYXRlSWRzJzogcmVxLmJvZHkuY2FuZGlkYXRlSWRzXHJcbiAgICB9O1xyXG4gICAgam9iUHJvZmlsZVNlcnZpY2UuZ2V0UUNhcmREZXRhaWxzKGRhdGEsIChlcnJvcjogRXJyb3IsIHJlc3VsdDogYW55KSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMzA0KS5zZW5kKGVycm9yKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlKSB7XHJcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBjbG9uZUpvYihyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICB0cnkge1xyXG4gICAgdmFyIG5ld0pvYlRpdGxlID0gcmVxLnF1ZXJ5Lm5ld0pvYlRpdGxlO1xyXG4gICAgdmFyIGpvYlByb2ZpbGVTZXJ2aWNlID0gbmV3IEpvYlByb2ZpbGVTZXJ2aWNlKCk7XHJcbiAgICBsZXQgZGF0YSA9IHtcclxuICAgICAgJ3Bvc3RlZEpvYic6cmVxLnBhcmFtcy5pZFxyXG4gICAgfTtcclxuICAgIGpvYlByb2ZpbGVTZXJ2aWNlLnJldHJpZXZlKGRhdGEsIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIG5leHQoe1xyXG4gICAgICAgICAgcmVhc29uOiBDTmV4dE1lc3NhZ2VzLlBST0JMRU1fSU5fUkVUUklFVkVfSk9CX1BST0ZJTEUsXHJcbiAgICAgICAgICBtZXNzYWdlOiBDTmV4dE1lc3NhZ2VzLlBST0JMRU1fSU5fUkVUUklFVkVfSk9CX1BST0ZJTEUsXHJcbiAgICAgICAgICBjb2RlOiA0MDFcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgbmV3Sm9iOmFueT1yZXN1bHQucG9zdGVkSm9ic1swXTtcclxuXHJcbiAgICAgICAgZGVsZXRlIG5ld0pvYi5faWQ7XHJcbiAgICAgICAgbmV3Sm9iLmpvYlRpdGxlPW5ld0pvYlRpdGxlO1xyXG4gICAgICAgIG5ld0pvYi5pc0pvYlBvc3RlZD1mYWxzZTtcclxuICAgICAgICBuZXdKb2IuaXNKb2JTaGFyZWQ9ZmFsc2U7XHJcbiAgICAgICAgbmV3Sm9iLnNoYXJlZExpbms9Jyc7XHJcbiAgICAgICAgbmV3Sm9iLnBvc3RpbmdEYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBuZXdKb2IuY2FuZGlkYXRlX2xpc3Q9W107XHJcblxyXG4gICAgICAgIG5ld0pvYi5leHBpcmluZ0RhdGUgPSBuZXcgRGF0ZSgobmV3IERhdGUoKS5nZXRUaW1lKCkgKyBDb25zdFZhcmlhYmxlcy5KT0JfX0VYUElSSVlfUEVSSU9EKSk7XHJcbiAgICAgICAgdmFyIHJlY3J1aXRlclNlcnZpY2UgPSBuZXcgUmVjcnVpdGVyU2VydmljZSgpO1xyXG4gICAgICAgIHJlY3J1aXRlclNlcnZpY2UuYWRkQ2xvbmVKb2IoIHJlc3VsdC51c2VySWQsIG5ld0pvYiwgKGVyciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICBuZXh0KHtcclxuICAgICAgICAgICAgICAgIHJlYXNvbjplcnIsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZSxcclxuICAgICAgICAgICAgICAgIGNvZGU6IDQwM1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcclxuICAgICAgICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcclxuICAgICAgICAgICAgICAgICdkYXRhJzogcmVzdWx0LnBvc3RlZEpvYnNbMF0uX2lkXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZSkge1xyXG4gICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG4iXX0=
