"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var mongoose = require("mongoose");
var AuthInterceptor = require("../interceptor/auth.interceptor");
var Messages = require("../shared/messages");
var CandidateService = require("../services/candidate.service");
var RecruiterService = require("../services/recruiter.service");
var CNextMessages = require("../shared/cnext-messages");
var SearchService = require("../search/services/search.service");
var UserService = require("../services/user.service");
var CandidateSearchService = require("../services/candidate-search.service");
function create(req, res, next) {
    try {
        var newUser = req.body;
        var recruiterService = new RecruiterService();
        recruiterService.createUser(newUser, function (error, result) {
            if (error) {
                if (error == Messages.MSG_ERROR_CHECK_EMAIL_PRESENT) {
                    next({
                        reason: Messages.MSG_ERROR_RSN_EXISTING_USER,
                        message: Messages.MSG_ERROR_VERIFY_ACCOUNT,
                        code: 403
                    });
                }
                else if (error == Messages.MSG_ERROR_CHECK_MOBILE_PRESENT) {
                    next({
                        reason: Messages.MSG_ERROR_RSN_EXISTING_USER,
                        message: Messages.MSG_ERROR_REGISTRATION_MOBILE_NUMBER,
                        code: 403
                    });
                }
                else {
                    next({
                        reason: Messages.MSG_ERROR_RSN_EXISTING_USER,
                        message: Messages.MSG_ERROR_USER_WITH_EMAIL_PRESENT,
                        code: 403
                    });
                }
            }
            else {
                var auth = new AuthInterceptor();
                var token = auth.issueTokenWithUid(result);
                res.status(200).send({
                    'status': Messages.STATUS_SUCCESS,
                    'data': {
                        'reason': Messages.MSG_SUCCESS_REGISTRATION,
                        '_id': result.userId,
                        'company_name': result.company_name,
                        'current_theme': result.current_theme,
                        'email': result.email,
                        'isRecruitingForself': result.isRecruitingForself,
                        'mobile_number': result.mobile_number,
                        'isCandidate': result.iscandidate
                    },
                    access_token: token
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ 'status': Messages.STATUS_ERROR, 'error_message': e.message });
    }
}
exports.create = create;
function postJob(req, res, next) {
    try {
        var newJob = req.body;
        var recruiterService = new RecruiterService();
        var userId = req.params.id;
        if (newJob.postedJobs._id !== undefined && newJob.postedJobs._id !== null && newJob.postedJobs._id !== '') {
            var currentDate = Number(new Date());
            var expiringDate = Number(new Date(newJob.postedJobs.expiringDate));
            var daysRemainingForExpiring = Math.round(Number(new Date(expiringDate - currentDate)) / (1000 * 60 * 60 * 24));
            newJob.postedJobs.daysRemainingForExpiring = daysRemainingForExpiring;
            if (daysRemainingForExpiring <= 0) {
                newJob.postedJobs.isJobPostExpired = true;
            }
            else {
                newJob.postedJobs.isJobPostExpired = false;
            }
            recruiterService.updateJob(userId, newJob, function (err, result) {
                if (err) {
                    next({
                        reason: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                        message: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                        code: 403
                    });
                }
                else {
                    res.status(200).send({
                        'status': Messages.STATUS_SUCCESS,
                        'data': result
                    });
                }
            });
        }
        else {
            recruiterService.addJob(userId, newJob, function (err, result) {
                if (err) {
                    next({
                        reason: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                        message: Messages.MSG_ERROR_RSN_USER_NOT_FOUND,
                        code: 403
                    });
                }
                else {
                    res.status(200).send({
                        'status': Messages.STATUS_SUCCESS,
                        'data': result
                    });
                }
            });
        }
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.postJob = postJob;
function updateDetails(req, res, next) {
    try {
        var newRecruiter = req.body;
        var params = req.query;
        delete params.access_token;
        var userId = req.params.id;
        var auth = new AuthInterceptor();
        var recruiterService = new RecruiterService();
        recruiterService.updateDetails(userId, newRecruiter, function (error, result) {
            if (error) {
                next(error);
            }
            else {
                var token = auth.issueTokenWithUid(newRecruiter);
                res.send({
                    'status': 'success',
                    'data': result,
                    access_token: token
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.updateDetails = updateDetails;
function retrieve(req, res, next) {
    try {
        var recruiterService = new RecruiterService();
        var data = {
            'userId': new mongoose.Types.ObjectId(req.params.id)
        };
        recruiterService.retrieve(data, function (error, result) {
            if (error) {
                next({
                    reason: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    message: CNextMessages.PROBLEM_IN_RETRIEVE_JOB_PROFILE,
                    code: 401
                });
            }
            else {
                if (result[0]) {
                    res.status(200).send({
                        'status': Messages.STATUS_SUCCESS,
                        'data': result,
                        'jobCountModel': result[0].jobCountModel
                    });
                }
                else {
                    var currentDate = Number(new Date());
                    var expiringDate = Number(new Date(result[0].postedJobs[0].expiringDate));
                    var daysRemainingForExpiring = Math.round(Number(new Date(expiringDate - currentDate)) / (1000 * 60 * 60 * 24));
                    result[0].postedJobs[0].daysRemainingForExpiring = daysRemainingForExpiring;
                    if (daysRemainingForExpiring <= 0) {
                        result[0].postedJobs[0].isJobPostExpired = true;
                    }
                    else {
                        result[0].postedJobs[0].isJobPostExpired = false;
                    }
                    res.status(200).send({
                        'status': Messages.STATUS_SUCCESS,
                        'data': result
                    });
                }
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.retrieve = retrieve;
function getFilterList(req, res) {
    __dirname = './';
    var filepath = 'recruiter-filter-list.json';
    try {
        res.sendFile(filepath, { root: __dirname });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getFilterList = getFilterList;
function getList(req, res, next) {
    try {
        var data = {
            'jobProfileId': req.params.id,
            'listName': req.params.listName
        };
        var recruiterService = new RecruiterService();
        recruiterService.getCandidateList(data, function (error, response) {
            if (error) {
                next({
                    reason: Messages.MSG_ERROR_RSN_EXISTING_USER,
                    message: Messages.MSG_ERROR_VERIFY_ACCOUNT,
                    code: 403
                });
            }
            else {
                res.send({
                    'status': 'success',
                    'data': response,
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getList = getList;
function getCompareDetailsOfCandidate(req, res, next) {
    try {
        var searchService = new SearchService();
        var params = req.query;
        var jobId = req.params.jobId;
        var recruiterId = req.params.id;
        var candidateId = JSON.parse(params.candidateId);
        searchService.getMultiCompareResult(candidateId, jobId, recruiterId, false, function (error, result) {
            if (error) {
                next({
                    reason: "Problem in Search Matching Result",
                    message: 'Problem in Search Matching Result',
                    code: 401
                });
            }
            else {
                res.send({
                    "status": "success",
                    "data": result,
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getCompareDetailsOfCandidate = getCompareDetailsOfCandidate;
function getCandidatesByName(req, res, next) {
    try {
        var userService = new UserService();
        var candidateService = new CandidateService();
        var candidateSearchService_1 = new CandidateSearchService();
        var userName = req.params.searchvalue;
        var query;
        var searchValueArray = userName.split(" ");
        if (searchValueArray.length > 1) {
            var exp1 = eval('/^' + searchValueArray[0] + '/i');
            var exp2 = eval('/^' + searchValueArray[1] + '/i');
            var searchString1 = exp1.toString().replace(/'/g, "");
            var searchString2 = exp2.toString().replace(/'/g, "");
            query = {
                'isCandidate': true,
                $or: [{
                        'first_name': { $regex: eval(searchString1) },
                        'last_name': { $regex: eval(searchString2) }
                    }, { 'first_name': { $regex: eval(searchString2) }, 'last_name': { $regex: eval(searchString1) } }]
            };
        }
        else {
            var exp = eval('/^' + searchValueArray[0] + '/i');
            var searchString = exp.toString().replace(/'/g, "");
            query = {
                'isCandidate': true,
                $or: [{ 'first_name': { $regex: eval(searchString) } }, { 'last_name': { $regex: eval(searchString) } }]
            };
        }
        userService.retrieve(query, function (error, result) {
            if (error) {
                next({
                    reason: 'Problem in Search user details',
                    message: 'Problem in Search user details',
                    code: 401
                });
            }
            else {
                var candidateId = new Array(0);
                for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {
                    var obj = result_1[_i];
                    candidateId.push(obj._id);
                }
                candidateSearchService_1.getCandidateInfo(candidateId, function (error, candidateInfo) {
                    if (error) {
                        next({
                            reason: 'Problem in Search user details',
                            message: 'Problem in Search user details',
                            code: 401
                        });
                    }
                    else {
                        var searchArray = candidateSearchService_1.buidResultOnCandidateSearch(candidateInfo);
                        res.send({
                            'status': 'success',
                            'data': searchArray,
                        });
                    }
                });
            }
        });
    }
    catch (e) {
        res.status(403).send({ message: e.message });
    }
}
exports.getCandidatesByName = getCandidatesByName;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvY29udHJvbGxlcnMvcmVjcnVpdGVyLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxtQ0FBcUM7QUFFckMsaUVBQW9FO0FBQ3BFLDZDQUFnRDtBQUNoRCxnRUFBbUU7QUFFbkUsZ0VBQW1FO0FBRW5FLHdEQUEyRDtBQUMzRCxpRUFBb0U7QUFHcEUsc0RBQXlEO0FBQ3pELDZFQUFnRjtBQUdoRixnQkFBdUIsR0FBb0IsRUFBRSxHQUFxQixFQUFFLElBQVM7SUFDM0UsSUFBSSxDQUFDO1FBRUgsSUFBSSxPQUFPLEdBQW1DLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDdkQsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUM7UUFDOUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxVQUFDLEtBQUssRUFBRSxNQUFNO1lBQ2pELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDLENBQUM7b0JBQ3BELElBQUksQ0FBQzt3QkFDSCxNQUFNLEVBQUUsUUFBUSxDQUFDLDJCQUEyQjt3QkFDNUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyx3QkFBd0I7d0JBQzFDLElBQUksRUFBRSxHQUFHO3FCQUNWLENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUNELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLDhCQUE4QixDQUFDLENBQUMsQ0FBQztvQkFDMUQsSUFBSSxDQUFDO3dCQUNILE1BQU0sRUFBRSxRQUFRLENBQUMsMkJBQTJCO3dCQUM1QyxPQUFPLEVBQUUsUUFBUSxDQUFDLG9DQUFvQzt3QkFDdEQsSUFBSSxFQUFFLEdBQUc7cUJBQ1YsQ0FBQyxDQUFDO2dCQUNMLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLENBQUM7b0JBQ0osSUFBSSxDQUFDO3dC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QUFDLENBQUM7Z0JBQ0osSUFBSSxXQUFXLEdBQVksSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLEdBQUcsQ0FBQyxDQUFZLFVBQU0sRUFBTixpQkFBTSxFQUFOLG9CQUFNLEVBQU4sSUFBTTtvQkFBakIsSUFBSSxHQUFHLGVBQUE7b0JBQ1YsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7aUJBQzNCO2dCQUNELHdCQUFzQixDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxVQUFDLEtBQVMsRUFBRSxhQUE4QjtvQkFDN0YsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzt3QkFDVixJQUFJLENBQUM7NEJBQ0gsTUFBTSxFQUFFLGdDQUFnQzs0QkFDeEMsT0FBTyxFQUFFLGdDQUFnQzs0QkFDekMsSUFBSSxFQUFFLEdBQUc7eUJBQ1YsQ0FBQyxDQUFDO29CQUNMLENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ04sSUFBSSxXQUFXLEdBQXlCLHdCQUFzQixDQUFDLDJCQUEyQixDQUFDLGFBQWEsQ0FBQyxDQUFDO3dCQUMxRyxHQUFHLENBQUMsSUFBSSxDQUFDOzRCQUNQLFFBQVEsRUFBRSxTQUFTOzRCQUNuQixNQUFNLEVBQUUsV0FBVzt5QkFDcEIsQ0FBQyxDQUFDO29CQUNMLENBQUM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBQ0QsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNULEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDO0lBQzdDLENBQUM7QUFFSCxDQUFDO0FBakVELGtEQWlFQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL2NvbnRyb2xsZXJzL3JlY3J1aXRlci5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0ICogYXMgbW9uZ29vc2UgZnJvbSBcIm1vbmdvb3NlXCI7XG5pbXBvcnQge1JlY3J1aXRlcn0gZnJvbSBcIi4uL2RhdGFhY2Nlc3MvbW9kZWwvcmVjcnVpdGVyLWZpbmFsLm1vZGVsXCI7XG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vaW50ZXJjZXB0b3IvYXV0aC5pbnRlcmNlcHRvcicpO1xuaW1wb3J0IE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vc2hhcmVkL21lc3NhZ2VzJyk7XG5pbXBvcnQgQ2FuZGlkYXRlU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL2NhbmRpZGF0ZS5zZXJ2aWNlJyk7XG5pbXBvcnQgUmVjcnVpdGVyTW9kZWwgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3JlY3J1aXRlci5tb2RlbCcpO1xuaW1wb3J0IFJlY3J1aXRlclNlcnZpY2UgPSByZXF1aXJlKCcuLi9zZXJ2aWNlcy9yZWNydWl0ZXIuc2VydmljZScpO1xuaW1wb3J0IEpvYlByb2ZpbGVNb2RlbCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvam9icHJvZmlsZS5tb2RlbCcpO1xuaW1wb3J0IENOZXh0TWVzc2FnZXMgPSByZXF1aXJlKCcuLi9zaGFyZWQvY25leHQtbWVzc2FnZXMnKTtcbmltcG9ydCBTZWFyY2hTZXJ2aWNlID0gcmVxdWlyZShcIi4uL3NlYXJjaC9zZXJ2aWNlcy9zZWFyY2guc2VydmljZVwiKTtcbmltcG9ydCBDYW5kaWRhdGVJbmZvU2VhcmNoID0gcmVxdWlyZShcIi4uL2RhdGFhY2Nlc3MvbW9kZWwvY2FuZGlkYXRlLWluZm8tc2VhcmNoXCIpO1xuaW1wb3J0IENhbmRpZGF0ZU1vZGVsID0gcmVxdWlyZShcIi4uL2RhdGFhY2Nlc3MvbW9kZWwvY2FuZGlkYXRlLm1vZGVsXCIpO1xuaW1wb3J0IFVzZXJTZXJ2aWNlID0gcmVxdWlyZShcIi4uL3NlcnZpY2VzL3VzZXIuc2VydmljZVwiKTtcbmltcG9ydCBDYW5kaWRhdGVTZWFyY2hTZXJ2aWNlID0gcmVxdWlyZShcIi4uL3NlcnZpY2VzL2NhbmRpZGF0ZS1zZWFyY2guc2VydmljZVwiKTtcblxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICB0cnkge1xuXG4gICAgdmFyIG5ld1VzZXI6IFJlY3J1aXRlck1vZGVsID0gPFJlY3J1aXRlck1vZGVsPnJlcS5ib2R5O1xuICAgIHZhciByZWNydWl0ZXJTZXJ2aWNlID0gbmV3IFJlY3J1aXRlclNlcnZpY2UoKTtcbiAgICByZWNydWl0ZXJTZXJ2aWNlLmNyZWF0ZVVzZXIobmV3VXNlciwgKGVycm9yLCByZXN1bHQpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IgPT0gTWVzc2FnZXMuTVNHX0VSUk9SX0NIRUNLX0VNQUlMX1BSRVNFTlQpIHtcbiAgICAgICAgICBuZXh0KHtcbiAgICAgICAgICAgIHJlYXNvbjogTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9FWElTVElOR19VU0VSLFxuICAgICAgICAgICAgbWVzc2FnZTogTWVzc2FnZXMuTVNHX0VSUk9SX1ZFUklGWV9BQ0NPVU5ULFxuICAgICAgICAgICAgY29kZTogNDAzXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXJyb3IgPT0gTWVzc2FnZXMuTVNHX0VSUk9SX0NIRUNLX01PQklMRV9QUkVTRU5UKSB7XG4gICAgICAgICAgbmV4dCh7XG4gICAgICAgICAgICByZWFzb246IE1lc3NhZ2VzLk1TR19FUlJPUl9SU05fRVhJU1RJTkdfVVNFUixcbiAgICAgICAgICAgIG1lc3NhZ2U6IE1lc3NhZ2VzLk1TR19FUlJPUl9SRUdJU1RSQVRJT05fTU9CSUxFX05VTUJFUixcbiAgICAgICAgICAgIGNvZGU6IDQwM1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIG5leHQoe1xuICAgICAgICAgICAgcmVhc29uOiBNZXNzYWdlcy5NU0dfRVJST1JfUlNOX0VYSVNUSU5HX1VTRVIsXG4gICAgICAgICAgICBtZXNzYWdlOiBNZXNzYWdlcy5NU0dfRVJST1JfVVNFUl9XSVRIX0VNQUlMX1BSRVNFTlQsXG4gICAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHZhciBhdXRoOiBBdXRoSW50ZXJjZXB0b3IgPSBuZXcgQXV0aEludGVyY2VwdG9yKCk7XG4gICAgICAgIHZhciB0b2tlbiA9IGF1dGguaXNzdWVUb2tlbldpdGhVaWQocmVzdWx0KTtcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoe1xuICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcbiAgICAgICAgICAnZGF0YSc6IHtcbiAgICAgICAgICAgICdyZWFzb24nOiBNZXNzYWdlcy5NU0dfU1VDQ0VTU19SRUdJU1RSQVRJT04sXG4gICAgICAgICAgICAnX2lkJzogcmVzdWx0LnVzZXJJZCxcbiAgICAgICAgICAgICdjb21wYW55X25hbWUnOiByZXN1bHQuY29tcGFueV9uYW1lLFxuICAgICAgICAgICAgJ2N1cnJlbnRfdGhlbWUnOiByZXN1bHQuY3VycmVudF90aGVtZSxcbiAgICAgICAgICAgICdlbWFpbCc6IHJlc3VsdC5lbWFpbCxcbiAgICAgICAgICAgICdpc1JlY3J1aXRpbmdGb3JzZWxmJzogcmVzdWx0LmlzUmVjcnVpdGluZ0ZvcnNlbGYsXG4gICAgICAgICAgICAnbW9iaWxlX251bWJlcic6IHJlc3VsdC5tb2JpbGVfbnVtYmVyLFxuICAgICAgICAgICAgJ2lzQ2FuZGlkYXRlJzogcmVzdWx0LmlzY2FuZGlkYXRlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IHRva2VuXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoeydzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfRVJST1IsICdlcnJvcl9tZXNzYWdlJzogZS5tZXNzYWdlfSk7XG4gIH1cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gcG9zdEpvYihyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcbiAgdHJ5IHtcbiAgICB2YXIgbmV3Sm9iOiBKb2JQcm9maWxlTW9kZWwgPSA8Sm9iUHJvZmlsZU1vZGVsPnJlcS5ib2R5O1xuICAgIHZhciByZWNydWl0ZXJTZXJ2aWNlID0gbmV3IFJlY3J1aXRlclNlcnZpY2UoKTtcbiAgICB2YXIgdXNlcklkID0gcmVxLnBhcmFtcy5pZDtcbiAgICBpZiAobmV3Sm9iLnBvc3RlZEpvYnMuX2lkICE9PSB1bmRlZmluZWQgJiYgbmV3Sm9iLnBvc3RlZEpvYnMuX2lkICE9PSBudWxsICYmIG5ld0pvYi5wb3N0ZWRKb2JzLl9pZCAhPT0gJycpIHtcblxuICAgICAgbGV0IGN1cnJlbnREYXRlICA9IE51bWJlcihuZXcgRGF0ZSgpKTtcbiAgICAgIGxldCBleHBpcmluZ0RhdGUgID0gTnVtYmVyKG5ldyBEYXRlKG5ld0pvYi5wb3N0ZWRKb2JzLmV4cGlyaW5nRGF0ZSkpO1xuICAgICAgbGV0IGRheXNSZW1haW5pbmdGb3JFeHBpcmluZyA9IE1hdGgucm91bmQoTnVtYmVyKG5ldyBEYXRlKGV4cGlyaW5nRGF0ZSAtIGN1cnJlbnREYXRlKSkvKDEwMDAqNjAqNjAqMjQpKTtcbiAgICAgIG5ld0pvYi5wb3N0ZWRKb2JzLmRheXNSZW1haW5pbmdGb3JFeHBpcmluZz1kYXlzUmVtYWluaW5nRm9yRXhwaXJpbmc7XG4gICAgICBpZiAoZGF5c1JlbWFpbmluZ0ZvckV4cGlyaW5nIDw9IDApIHtcbiAgICAgICAgbmV3Sm9iLnBvc3RlZEpvYnMuaXNKb2JQb3N0RXhwaXJlZD10cnVlO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdKb2IucG9zdGVkSm9icy5pc0pvYlBvc3RFeHBpcmVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICByZWNydWl0ZXJTZXJ2aWNlLnVwZGF0ZUpvYih1c2VySWQsIG5ld0pvYiwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBuZXh0KHtcbiAgICAgICAgICAgIHJlYXNvbjogTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9VU0VSX05PVF9GT1VORCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IE1lc3NhZ2VzLk1TR19FUlJPUl9SU05fVVNFUl9OT1RfRk9VTkQsXG4gICAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XG4gICAgICAgICAgICAnc3RhdHVzJzogTWVzc2FnZXMuU1RBVFVTX1NVQ0NFU1MsXG4gICAgICAgICAgICAnZGF0YSc6IHJlc3VsdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZWNydWl0ZXJTZXJ2aWNlLmFkZEpvYih1c2VySWQsIG5ld0pvYiwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBuZXh0KHtcbiAgICAgICAgICAgIHJlYXNvbjogTWVzc2FnZXMuTVNHX0VSUk9SX1JTTl9VU0VSX05PVF9GT1VORCxcbiAgICAgICAgICAgIG1lc3NhZ2U6IE1lc3NhZ2VzLk1TR19FUlJPUl9SU05fVVNFUl9OT1RfRk9VTkQsXG4gICAgICAgICAgICBjb2RlOiA0MDNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XG4gICAgICAgICAgICAnc3RhdHVzJzogTWVzc2FnZXMuU1RBVFVTX1NVQ0NFU1MsXG4gICAgICAgICAgICAnZGF0YSc6IHJlc3VsdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlRGV0YWlscyhyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcbiAgdHJ5IHtcbiAgICB2YXIgbmV3UmVjcnVpdGVyOiBSZWNydWl0ZXJNb2RlbCA9IDxSZWNydWl0ZXJNb2RlbD5yZXEuYm9keTtcbiAgICB2YXIgcGFyYW1zID0gcmVxLnF1ZXJ5O1xuICAgIGRlbGV0ZSBwYXJhbXMuYWNjZXNzX3Rva2VuO1xuICAgIHZhciB1c2VySWQ6IHN0cmluZyA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgdmFyIGF1dGg6IEF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcbiAgICB2YXIgcmVjcnVpdGVyU2VydmljZSA9IG5ldyBSZWNydWl0ZXJTZXJ2aWNlKCk7XG4gICAgcmVjcnVpdGVyU2VydmljZS51cGRhdGVEZXRhaWxzKHVzZXJJZCwgbmV3UmVjcnVpdGVyLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgfWVsc2Uge1xuICAgICAgICB2YXIgdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkKG5ld1JlY3J1aXRlcik7XG4gICAgICAgIHJlcy5zZW5kKHtcbiAgICAgICAgICAnc3RhdHVzJzogJ3N1Y2Nlc3MnLFxuICAgICAgICAgICdkYXRhJzogcmVzdWx0LFxuICAgICAgICAgIGFjY2Vzc190b2tlbjogdG9rZW5cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJldHJpZXZlKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICB0cnkge1xuICAgIHZhciByZWNydWl0ZXJTZXJ2aWNlID0gbmV3IFJlY3J1aXRlclNlcnZpY2UoKTtcbiAgICBsZXQgZGF0YSA9IHtcbiAgICAgICd1c2VySWQnOiBuZXcgbW9uZ29vc2UuVHlwZXMuT2JqZWN0SWQocmVxLnBhcmFtcy5pZClcbiAgICB9O1xuICAgIHJlY3J1aXRlclNlcnZpY2UucmV0cmlldmUoZGF0YSwgKGVycm9yOiBhbnksIHJlc3VsdDogUmVjcnVpdGVyW10pID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBuZXh0KHtcbiAgICAgICAgICByZWFzb246IENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9SRVRSSUVWRV9KT0JfUFJPRklMRSxcbiAgICAgICAgICBtZXNzYWdlOiBDTmV4dE1lc3NhZ2VzLlBST0JMRU1fSU5fUkVUUklFVkVfSk9CX1BST0ZJTEUsXG4gICAgICAgICAgY29kZTogNDAxXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHJlc3VsdFswXSkge1xuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcbiAgICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcbiAgICAgICAgICAgICdkYXRhJzogcmVzdWx0LFxuICAgICAgICAgICAgJ2pvYkNvdW50TW9kZWwnOiByZXN1bHRbMF0uam9iQ291bnRNb2RlbFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgbGV0IGN1cnJlbnREYXRlID0gTnVtYmVyKG5ldyBEYXRlKCkpO1xuICAgICAgICAgIGxldCBleHBpcmluZ0RhdGUgPSBOdW1iZXIobmV3IERhdGUocmVzdWx0WzBdLnBvc3RlZEpvYnNbMF0uZXhwaXJpbmdEYXRlKSk7XG4gICAgICAgICAgbGV0IGRheXNSZW1haW5pbmdGb3JFeHBpcmluZyA9IE1hdGgucm91bmQoTnVtYmVyKG5ldyBEYXRlKGV4cGlyaW5nRGF0ZSAtIGN1cnJlbnREYXRlKSkvKDEwMDAqNjAqNjAqMjQpKTtcbiAgICAgICAgICByZXN1bHRbMF0ucG9zdGVkSm9ic1swXS5kYXlzUmVtYWluaW5nRm9yRXhwaXJpbmc9ZGF5c1JlbWFpbmluZ0ZvckV4cGlyaW5nO1xuICAgICAgICAgIGlmIChkYXlzUmVtYWluaW5nRm9yRXhwaXJpbmcgPD0gMCkge1xuICAgICAgICAgICAgcmVzdWx0WzBdLnBvc3RlZEpvYnNbMF0uaXNKb2JQb3N0RXhwaXJlZD10cnVlO1xuXG4gICAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgcmVzdWx0WzBdLnBvc3RlZEpvYnNbMF0uaXNKb2JQb3N0RXhwaXJlZD1mYWxzZTtcblxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHtcbiAgICAgICAgICAgICdzdGF0dXMnOiBNZXNzYWdlcy5TVEFUVVNfU1VDQ0VTUyxcbiAgICAgICAgICAgICdkYXRhJzogcmVzdWx0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0pO1xuXG5cbiAgfWNhdGNoIChlKSB7XG4gICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWx0ZXJMaXN0KHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgX19kaXJuYW1lID0gJy4vJztcbiAgdmFyIGZpbGVwYXRoID0gJ3JlY3J1aXRlci1maWx0ZXItbGlzdC5qc29uJztcbiAgdHJ5IHtcbiAgICByZXMuc2VuZEZpbGUoZmlsZXBhdGgsIHtyb290OiBfX2Rpcm5hbWV9KTtcbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcbiAgfVxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMaXN0KHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICB0cnkge1xuICAgIGxldCBkYXRhOiBhbnkgPSB7XG4gICAgICAnam9iUHJvZmlsZUlkJzogcmVxLnBhcmFtcy5pZCxcbiAgICAgICdsaXN0TmFtZSc6IHJlcS5wYXJhbXMubGlzdE5hbWVcbiAgICB9O1xuICAgIGxldCByZWNydWl0ZXJTZXJ2aWNlID0gbmV3IFJlY3J1aXRlclNlcnZpY2UoKTtcbiAgICByZWNydWl0ZXJTZXJ2aWNlLmdldENhbmRpZGF0ZUxpc3QoZGF0YSwgKGVycm9yOiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBuZXh0KHtcbiAgICAgICAgICByZWFzb246IE1lc3NhZ2VzLk1TR19FUlJPUl9SU05fRVhJU1RJTkdfVVNFUixcbiAgICAgICAgICBtZXNzYWdlOiBNZXNzYWdlcy5NU0dfRVJST1JfVkVSSUZZX0FDQ09VTlQsXG4gICAgICAgICAgY29kZTogNDAzXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzLnNlbmQoe1xuICAgICAgICAgICdzdGF0dXMnOiAnc3VjY2VzcycsXG4gICAgICAgICAgJ2RhdGEnOiByZXNwb25zZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBhcmVEZXRhaWxzT2ZDYW5kaWRhdGUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dDogYW55KSB7XG5cbiAgdHJ5IHtcbiAgICB2YXIgc2VhcmNoU2VydmljZSA9IG5ldyBTZWFyY2hTZXJ2aWNlKCk7XG4gICAgdmFyIHBhcmFtcyA9IHJlcS5xdWVyeTtcbiAgICBsZXQgam9iSWQgPSByZXEucGFyYW1zLmpvYklkO1xuICAgIGxldCByZWNydWl0ZXJJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgbGV0IGNhbmRpZGF0ZUlkOiBzdHJpbmdbXSA9IEpTT04ucGFyc2UocGFyYW1zLmNhbmRpZGF0ZUlkKTtcbiAgICBzZWFyY2hTZXJ2aWNlLmdldE11bHRpQ29tcGFyZVJlc3VsdChjYW5kaWRhdGVJZCwgam9iSWQscmVjcnVpdGVySWQsIGZhbHNlLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBuZXh0KHtcbiAgICAgICAgICByZWFzb246IFwiUHJvYmxlbSBpbiBTZWFyY2ggTWF0Y2hpbmcgUmVzdWx0XCIsLy9NZXNzYWdlcy5NU0dfRVJST1JfUlNOX0lOVkFMSURfQ1JFREVOVElBTFMsXG4gICAgICAgICAgbWVzc2FnZTogJ1Byb2JsZW0gaW4gU2VhcmNoIE1hdGNoaW5nIFJlc3VsdCcsLy9NZXNzYWdlcy5NU0dfRVJST1JfV1JPTkdfVE9LRU4sXG4gICAgICAgICAgY29kZTogNDAxXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmVzLnNlbmQoe1xuICAgICAgICAgIFwic3RhdHVzXCI6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgIFwiZGF0YVwiOiByZXN1bHQsXG4gICAgICAgIH0pO1xuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcbiAgfVxuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDYW5kaWRhdGVzQnlOYW1lKHJlcTpleHByZXNzLlJlcXVlc3QsIHJlczpleHByZXNzLlJlc3BvbnNlLCBuZXh0OmFueSkge1xuICB0cnkge1xuICAgIGxldCB1c2VyU2VydmljZSA9IG5ldyBVc2VyU2VydmljZSgpO1xuICAgIGxldCBjYW5kaWRhdGVTZXJ2aWNlID0gbmV3IENhbmRpZGF0ZVNlcnZpY2UoKTtcbiAgICBsZXQgY2FuZGlkYXRlU2VhcmNoU2VydmljZSA9IG5ldyBDYW5kaWRhdGVTZWFyY2hTZXJ2aWNlKCk7XG4gICAgdmFyIHVzZXJOYW1lID0gcmVxLnBhcmFtcy5zZWFyY2h2YWx1ZTtcbiAgICB2YXIgcXVlcnk6YW55O1xuICAgIHZhciBzZWFyY2hWYWx1ZUFycmF5OnN0cmluZ1tdID0gdXNlck5hbWUuc3BsaXQoXCIgXCIpO1xuICAgIGlmIChzZWFyY2hWYWx1ZUFycmF5Lmxlbmd0aCA+IDEpIHtcbiAgICAgIHZhciBleHAxID0gZXZhbCgnL14nICsgc2VhcmNoVmFsdWVBcnJheVswXSArICcvaScpO1xuICAgICAgdmFyIGV4cDIgPSBldmFsKCcvXicgKyBzZWFyY2hWYWx1ZUFycmF5WzFdICsgJy9pJyk7XG4gICAgICB2YXIgc2VhcmNoU3RyaW5nMTpzdHJpbmcgPSBleHAxLnRvU3RyaW5nKCkucmVwbGFjZSgvJy9nLCBcIlwiKTtcbiAgICAgIHZhciBzZWFyY2hTdHJpbmcyOnN0cmluZyA9IGV4cDIudG9TdHJpbmcoKS5yZXBsYWNlKC8nL2csIFwiXCIpO1xuICAgICAgcXVlcnkgPSB7XG4gICAgICAgICdpc0NhbmRpZGF0ZSc6IHRydWUsXG4gICAgICAgICRvcjogW3tcbiAgICAgICAgICAnZmlyc3RfbmFtZSc6IHskcmVnZXg6IGV2YWwoc2VhcmNoU3RyaW5nMSl9LFxuICAgICAgICAgICdsYXN0X25hbWUnOiB7JHJlZ2V4OiBldmFsKHNlYXJjaFN0cmluZzIpfVxuICAgICAgICB9LCB7J2ZpcnN0X25hbWUnOiB7JHJlZ2V4OiBldmFsKHNlYXJjaFN0cmluZzIpfSwgJ2xhc3RfbmFtZSc6IHskcmVnZXg6IGV2YWwoc2VhcmNoU3RyaW5nMSl9fV1cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBleHAgPSBldmFsKCcvXicgKyBzZWFyY2hWYWx1ZUFycmF5WzBdICsgJy9pJyk7XG4gICAgICB2YXIgc2VhcmNoU3RyaW5nOnN0cmluZyA9IGV4cC50b1N0cmluZygpLnJlcGxhY2UoLycvZywgXCJcIik7XG5cbiAgICAgIHF1ZXJ5ID0ge1xuICAgICAgICAnaXNDYW5kaWRhdGUnOiB0cnVlLFxuICAgICAgICAkb3I6IFt7J2ZpcnN0X25hbWUnOiB7JHJlZ2V4OiBldmFsKHNlYXJjaFN0cmluZyl9fSwgeydsYXN0X25hbWUnOiB7JHJlZ2V4OiBldmFsKHNlYXJjaFN0cmluZyl9fV1cbiAgICAgIH07XG4gICAgfVxuICAgIHVzZXJTZXJ2aWNlLnJldHJpZXZlKHF1ZXJ5LCAoZXJyb3I6YW55LCByZXN1bHQ6YW55KSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgbmV4dCh7XG4gICAgICAgICAgcmVhc29uOiAnUHJvYmxlbSBpbiBTZWFyY2ggdXNlciBkZXRhaWxzJyxcbiAgICAgICAgICBtZXNzYWdlOiAnUHJvYmxlbSBpbiBTZWFyY2ggdXNlciBkZXRhaWxzJyxcbiAgICAgICAgICBjb2RlOiA0MDFcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdmFyIGNhbmRpZGF0ZUlkOnN0cmluZ1tdID0gbmV3IEFycmF5KDApO1xuICAgICAgICBmb3IgKGxldCBvYmogb2YgcmVzdWx0KSB7XG4gICAgICAgICAgY2FuZGlkYXRlSWQucHVzaChvYmouX2lkKTtcbiAgICAgICAgfVxuICAgICAgICBjYW5kaWRhdGVTZWFyY2hTZXJ2aWNlLmdldENhbmRpZGF0ZUluZm8oY2FuZGlkYXRlSWQsIChlcnJvcjphbnksIGNhbmRpZGF0ZUluZm86Q2FuZGlkYXRlTW9kZWxbXSkgPT4ge1xuICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgbmV4dCh7XG4gICAgICAgICAgICAgIHJlYXNvbjogJ1Byb2JsZW0gaW4gU2VhcmNoIHVzZXIgZGV0YWlscycsXG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdQcm9ibGVtIGluIFNlYXJjaCB1c2VyIGRldGFpbHMnLFxuICAgICAgICAgICAgICBjb2RlOiA0MDFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2VhcmNoQXJyYXk6Q2FuZGlkYXRlSW5mb1NlYXJjaFtdID0gY2FuZGlkYXRlU2VhcmNoU2VydmljZS5idWlkUmVzdWx0T25DYW5kaWRhdGVTZWFyY2goY2FuZGlkYXRlSW5mbyk7XG4gICAgICAgICAgICByZXMuc2VuZCh7XG4gICAgICAgICAgICAgICdzdGF0dXMnOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICdkYXRhJzogc2VhcmNoQXJyYXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XG4gIH1cblxufVxuIl19
