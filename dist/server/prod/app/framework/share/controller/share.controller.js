"use strict";
var ShareService = require("../services/share.service");
var AuthInterceptor = require("../../interceptor/auth.interceptor");
var config = require('config');
var ShareController = (function () {
    function ShareController() {
    }
    ShareController.prototype.buildValuePortraitUrl = function (req, res, next) {
        try {
            var user_1 = req.user;
            var _host_1 = config.get('TplSeed.mail.host');
            var shareService_1 = new ShareService();
            var auth = new AuthInterceptor();
            var _token_1 = auth.issueTokenWithUidForShare(user_1);
            var query = { 'userId': user_1._id };
            shareService_1.retrieve(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    shareService_1.buildValuePortraitUrl(_host_1, _token_1, user_1, response, function (error, result) {
                        if (error) {
                            next(error);
                        }
                        else {
                            res.status(200).send(result);
                        }
                    });
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.buildShareJobUrl = function (req, res, next) {
        try {
            var user = req.user;
            var _host = config.get('TplSeed.mail.host');
            var shareService = new ShareService();
            var auth = new AuthInterceptor();
            var _token = auth.issueTokenWithUid(user, 'hiringManager');
            shareService.buildShareJobUrl(_host, _token, user, req.params.jobId, function (error, result) {
                if (error) {
                    next(error);
                }
                else {
                    res.status(200).send(result);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.getActualUrlForShare = function (req, res, next) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.retrieveUrl(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.resetActualUrlForShare = function (req, res, next) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.findOneAndUpdate(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    return ShareController;
}());
module.exports = ShareController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmUvY29udHJvbGxlci9zaGFyZS5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSx3REFBMkQ7QUFDM0Qsb0VBQXVFO0FBRXZFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQjtJQUFBO0lBb0ZBLENBQUM7SUFsRkMsK0NBQXFCLEdBQXJCLFVBQXNCLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxJQUFTO1FBQzFFLElBQUksQ0FBQztZQUNILElBQUksTUFBSSxHQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDekIsSUFBSSxPQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQzVDLElBQUksY0FBWSxHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO1lBQ3BELElBQUksSUFBSSxHQUFvQixJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQ2xELElBQUksUUFBTSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxNQUFJLENBQUMsQ0FBQztZQUNsRCxJQUFJLEtBQUssR0FBRyxFQUFDLFFBQVEsRUFBRSxNQUFJLENBQUMsR0FBRyxFQUFDLENBQUM7WUFDakMsY0FBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsVUFBQyxHQUFHLEVBQUUsUUFBUTtnQkFDekMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDUixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ1osQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixjQUFZLENBQUMscUJBQXFCLENBQUMsT0FBSyxFQUFFLFFBQU0sRUFBRSxNQUFJLEVBQUUsUUFBUSxFQUFFLFVBQUMsS0FBSyxFQUFFLE1BQU07d0JBQzlFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ1YsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNkLENBQUM7d0JB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LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3M9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuaW1wb3J0IFNoYXJlU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3NoYXJlLnNlcnZpY2UnKTtcclxuaW1wb3J0IEF1dGhJbnRlcmNlcHRvciA9IHJlcXVpcmUoJy4uLy4uL2ludGVyY2VwdG9yL2F1dGguaW50ZXJjZXB0b3InKTtcclxuLy9pbXBvcnQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbmxldCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcclxuXHJcbmNsYXNzIFNoYXJlQ29udHJvbGxlciB7XHJcblxyXG4gIGJ1aWxkVmFsdWVQb3J0cmFpdFVybChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxldCB1c2VyOiBhbnkgPSByZXEudXNlcjtcclxuICAgICAgbGV0IF9ob3N0ID0gY29uZmlnLmdldCgnVHBsU2VlZC5tYWlsLmhvc3QnKTtcclxuICAgICAgbGV0IHNoYXJlU2VydmljZTogU2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xyXG4gICAgICBsZXQgYXV0aDogQXV0aEludGVyY2VwdG9yID0gbmV3IEF1dGhJbnRlcmNlcHRvcigpO1xyXG4gICAgICBsZXQgX3Rva2VuID0gYXV0aC5pc3N1ZVRva2VuV2l0aFVpZEZvclNoYXJlKHVzZXIpO1xyXG4gICAgICBsZXQgcXVlcnkgPSB7J3VzZXJJZCc6IHVzZXIuX2lkfTtcclxuICAgICAgc2hhcmVTZXJ2aWNlLnJldHJpZXZlKHF1ZXJ5LCAoZXJyLCByZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgIG5leHQoZXJyKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2hhcmVTZXJ2aWNlLmJ1aWxkVmFsdWVQb3J0cmFpdFVybChfaG9zdCwgX3Rva2VuLCB1c2VyLCByZXNwb25zZSwgKGVycm9yLCByZXN1bHQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgbmV4dChlcnJvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIG5leHQoe3JlYXNvbjogZS5tZXNzYWdlLCBtZXNzYWdlOiBlLm1lc3NhZ2UsIHN0YWNrVHJhY2U6IG5ldyBFcnJvcigpLCBjb2RlOiA1MDB9KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBidWlsZFNoYXJlSm9iVXJsKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHVzZXI6IGFueSA9IHJlcS51c2VyO1xyXG4gICAgICBsZXQgX2hvc3QgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1haWwuaG9zdCcpO1xyXG4gICAgICBsZXQgc2hhcmVTZXJ2aWNlOiBTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBhdXRoOiBBdXRoSW50ZXJjZXB0b3IgPSBuZXcgQXV0aEludGVyY2VwdG9yKCk7XHJcbiAgICAgIGxldCBfdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIsICdoaXJpbmdNYW5hZ2VyJyk7XHJcbiAgICAgIHNoYXJlU2VydmljZS5idWlsZFNoYXJlSm9iVXJsKF9ob3N0LCBfdG9rZW4sIHVzZXIsIHJlcS5wYXJhbXMuam9iSWQsIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICBuZXh0KGVycm9yKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBuZXh0KHtyZWFzb246IGUubWVzc2FnZSwgbWVzc2FnZTogZS5tZXNzYWdlLCBzdGFja1RyYWNlOiBuZXcgRXJyb3IoKSwgY29kZTogNTAwfSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0QWN0dWFsVXJsRm9yU2hhcmUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dDogYW55KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgc2hhcmVTZXJ2aWNlOiBTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBzaG9ydFVybCA9IHJlcS5wYXJhbXMuc2hvcnRVcmw7XHJcbiAgICAgIGxldCBxdWVyeTogYW55ID0geydzaG9ydFVybCc6IHNob3J0VXJsLnRvU3RyaW5nKCl9O1xyXG4gICAgICBzaGFyZVNlcnZpY2UucmV0cmlldmVVcmwocXVlcnksIChlcnIsIHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgbmV4dChlcnIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgbmV4dCh7cmVhc29uOiBlLm1lc3NhZ2UsIG1lc3NhZ2U6IGUubWVzc2FnZSwgc3RhY2tUcmFjZTogbmV3IEVycm9yKCksIGNvZGU6IDUwMH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVzZXRBY3R1YWxVcmxGb3JTaGFyZShyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLG5leHQ6YW55KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgc2hhcmVTZXJ2aWNlOiBTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBzaG9ydFVybCA9IHJlcS5wYXJhbXMuc2hvcnRVcmw7XHJcbiAgICAgIGxldCBxdWVyeTogYW55ID0geydzaG9ydFVybCc6IHNob3J0VXJsLnRvU3RyaW5nKCl9O1xyXG4gICAgICBzaGFyZVNlcnZpY2UuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICBuZXh0KGVycik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBuZXh0KHtyZWFzb246IGUubWVzc2FnZSwgbWVzc2FnZTogZS5tZXNzYWdlLCBzdGFja1RyYWNlOiBuZXcgRXJyb3IoKSwgY29kZTogNTAwfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0ID0gU2hhcmVDb250cm9sbGVyO1xyXG4iXX0=
