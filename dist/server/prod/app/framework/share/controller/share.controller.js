"use strict";
var ShareService = require("../services/share.service");
var AuthInterceptor = require("../../interceptor/auth.interceptor");
var config = require('config');
var ShareController = (function () {
    function ShareController() {
    }
    ShareController.prototype.buildValuePortraitUrl = function (req, res, next) {
        try {
            var user_1 = req.user;
            var _host_1 = config.get('TplSeed.mail.host');
            var shareService_1 = new ShareService();
            var auth = new AuthInterceptor();
            var _token_1 = auth.issueTokenWithUidForShare(user_1);
            var query = { 'userId': user_1._id };
            shareService_1.retrieve(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    shareService_1.buildValuePortraitUrl(_host_1, _token_1, user_1, response, function (error, result) {
                        if (error) {
                            next(error);
                        }
                        else {
                            res.status(200).send(result);
                        }
                    });
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.buildShareJobUrl = function (req, res, next) {
        try {
            var user = req.user;
            var _host = config.get('TplSeed.mail.host');
            var shareService = new ShareService();
            var auth = new AuthInterceptor();
            var _token = auth.issueTokenWithUid(user, 'hiringManager');
            shareService.buildShareJobUrl(_host, _token, user, req.params.jobId, function (error, result) {
                if (error) {
                    next(error);
                }
                else {
                    res.status(200).send(result);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.getActualUrlForShare = function (req, res, next) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.retrieveUrl(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    ShareController.prototype.resetActualUrlForShare = function (req, res, next) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.findOneAndUpdate(query, function (err, response) {
                if (err) {
                    next(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            next({ reason: e.message, message: e.message, stackTrace: new Error(), code: 500 });
        }
    };
    return ShareController;
}());
module.exports = ShareController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmUvY29udHJvbGxlci9zaGFyZS5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSx3REFBMkQ7QUFDM0Qsb0VBQXVFO0FBRXZFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQjtJQUFBO0lBb0ZBLENBQUM7SUFsRkMsK0NBQXFCLEdBQXJCLFVBQXNCLEdBQW9CLEVBQUUsR0FBcUIsRUFBRSxJQUFTO1FBQzFFLElBQUksQ0FBQztZQUNILElBQUksTUFBSSxHQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDekIsSUFBSSxPQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQzVDLElBQUksY0FBWSxHQUFpQixJQUFJLFlBQVksRUFBRSxDQUFDO1lBQ3BELElBQUksSUFBSSxHQUFvQixJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQ2xELElBQUksUUFBTSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxNQUFJLENBQUMsQ0FBQztZQUNsRCxJQUFJLEtBQUssR0FBRyxFQUFDLFFBQVEsRUFBRSxNQUFJLENBQUMsR0FBRyxFQUFDLENBQUM7WUFDakMsY0FBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsVUFBQyxHQUFHLEVBQUUsUUFBUTtnQkFDekMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDUixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ1osQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixjQUFZLENBQUMscUJBQXFCLENBQUMsT0FBSyxFQUFFLFFBQU0sRUFBRSxNQUFJLEVBQUUsUUFBUSxFQUFFLFVBQUMsS0FBSyxFQUFFLE1BQU07d0JBQzlFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ1YsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNkLENBQUM7d0JB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LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3M9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmltcG9ydCBTaGFyZVNlcnZpY2UgPSByZXF1aXJlKCcuLi9zZXJ2aWNlcy9zaGFyZS5zZXJ2aWNlJyk7XG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vLi4vaW50ZXJjZXB0b3IvYXV0aC5pbnRlcmNlcHRvcicpO1xuLy9pbXBvcnQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XG5sZXQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XG5cbmNsYXNzIFNoYXJlQ29udHJvbGxlciB7XG5cbiAgYnVpbGRWYWx1ZVBvcnRyYWl0VXJsKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICAgIHRyeSB7XG4gICAgICBsZXQgdXNlcjogYW55ID0gcmVxLnVzZXI7XG4gICAgICBsZXQgX2hvc3QgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1haWwuaG9zdCcpO1xuICAgICAgbGV0IHNoYXJlU2VydmljZTogU2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xuICAgICAgbGV0IGF1dGg6IEF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcbiAgICAgIGxldCBfdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkRm9yU2hhcmUodXNlcik7XG4gICAgICBsZXQgcXVlcnkgPSB7J3VzZXJJZCc6IHVzZXIuX2lkfTtcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZShxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIG5leHQoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzaGFyZVNlcnZpY2UuYnVpbGRWYWx1ZVBvcnRyYWl0VXJsKF9ob3N0LCBfdG9rZW4sIHVzZXIsIHJlc3BvbnNlLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBuZXh0KHtyZWFzb246IGUubWVzc2FnZSwgbWVzc2FnZTogZS5tZXNzYWdlLCBzdGFja1RyYWNlOiBuZXcgRXJyb3IoKSwgY29kZTogNTAwfSk7XG4gICAgfVxuXG4gIH1cblxuICBidWlsZFNoYXJlSm9iVXJsKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UsIG5leHQ6IGFueSkge1xuICAgIHRyeSB7XG4gICAgICBsZXQgdXNlcjogYW55ID0gcmVxLnVzZXI7XG4gICAgICBsZXQgX2hvc3QgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1haWwuaG9zdCcpO1xuICAgICAgbGV0IHNoYXJlU2VydmljZTogU2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xuICAgICAgbGV0IGF1dGg6IEF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcbiAgICAgIGxldCBfdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIsICdoaXJpbmdNYW5hZ2VyJyk7XG4gICAgICBzaGFyZVNlcnZpY2UuYnVpbGRTaGFyZUpvYlVybChfaG9zdCwgX3Rva2VuLCB1c2VyLCByZXEucGFyYW1zLmpvYklkLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBuZXh0KGVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBuZXh0KHtyZWFzb246IGUubWVzc2FnZSwgbWVzc2FnZTogZS5tZXNzYWdlLCBzdGFja1RyYWNlOiBuZXcgRXJyb3IoKSwgY29kZTogNTAwfSk7XG4gICAgfVxuXG4gIH1cblxuICBnZXRBY3R1YWxVcmxGb3JTaGFyZShyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHNoYXJlU2VydmljZTogU2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xuICAgICAgbGV0IHNob3J0VXJsID0gcmVxLnBhcmFtcy5zaG9ydFVybDtcbiAgICAgIGxldCBxdWVyeTogYW55ID0geydzaG9ydFVybCc6IHNob3J0VXJsLnRvU3RyaW5nKCl9O1xuICAgICAgc2hhcmVTZXJ2aWNlLnJldHJpZXZlVXJsKHF1ZXJ5LCAoZXJyLCByZXNwb25zZSkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgbmV4dChlcnIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbmV4dCh7cmVhc29uOiBlLm1lc3NhZ2UsIG1lc3NhZ2U6IGUubWVzc2FnZSwgc3RhY2tUcmFjZTogbmV3IEVycm9yKCksIGNvZGU6IDUwMH0pO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0QWN0dWFsVXJsRm9yU2hhcmUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSxuZXh0OmFueSkge1xuICAgIHRyeSB7XG4gICAgICBsZXQgc2hhcmVTZXJ2aWNlOiBTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XG4gICAgICBsZXQgc2hvcnRVcmwgPSByZXEucGFyYW1zLnNob3J0VXJsO1xuICAgICAgbGV0IHF1ZXJ5OiBhbnkgPSB7J3Nob3J0VXJsJzogc2hvcnRVcmwudG9TdHJpbmcoKX07XG4gICAgICBzaGFyZVNlcnZpY2UuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIG5leHQoZXJyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIG5leHQoe3JlYXNvbjogZS5tZXNzYWdlLCBtZXNzYWdlOiBlLm1lc3NhZ2UsIHN0YWNrVHJhY2U6IG5ldyBFcnJvcigpLCBjb2RlOiA1MDB9KTtcbiAgICB9XG4gIH1cblxufVxuXG5leHBvcnQgPSBTaGFyZUNvbnRyb2xsZXI7XG4iXX0=
