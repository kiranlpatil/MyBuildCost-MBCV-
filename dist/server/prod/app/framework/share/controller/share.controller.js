"use strict";
var ShareService = require("../services/share.service");
var AuthInterceptor = require("../../interceptor/auth.interceptor");
var config = require('config');
var ShareController = (function () {
    function ShareController() {
    }
    ShareController.prototype.buildValuePortraitUrl = function (req, res) {
        try {
            var user = req.user;
            var _host = config.get('TplSeed.mail.host');
            var shareService = new ShareService();
            var auth = new AuthInterceptor();
            var _token = auth.issueTokenWithUidForShare(user);
            var query = { 'userId': user._id };
            shareService.retrieve(query, function (err, response) {
                if (err) {
                    res.status(304).send(err);
                }
                else {
                    shareService.buildValuePortraitUrl(_host, _token, user, response, function (error, result) {
                        if (error) {
                            res.status(304).send(error);
                        }
                        else {
                            res.status(200).send(result);
                        }
                    });
                }
            });
        }
        catch (e) {
            res.status(403).send({ message: e.message });
        }
    };
    ShareController.prototype.getActualUrlForShare = function (req, res) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.retrieveUrl(query, function (err, response) {
                if (err) {
                    res.status(304).send(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            res.status(403).send({ message: e.message });
        }
    };
    return ShareController;
}());
module.exports = ShareController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmUvY29udHJvbGxlci9zaGFyZS5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSx3REFBMkQ7QUFDM0Qsb0VBQXVFO0FBRXZFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQjtJQUFBO0lBK0NBLENBQUM7SUE3Q0MsK0NBQXFCLEdBQXJCLFVBQXNCLEdBQW1CLEVBQUUsR0FBb0I7UUFDN0QsSUFBSSxDQUFDO1lBQ0gsSUFBSSxJQUFJLEdBQU8sR0FBRyxDQUFDLElBQUksQ0FBQztZQUN4QixJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDNUMsSUFBSSxZQUFZLEdBQWdCLElBQUksWUFBWSxFQUFFLENBQUM7WUFDbkQsSUFBSSxJQUFJLEdBQW1CLElBQUksZUFBZSxFQUFFLENBQUM7WUFDakQsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xELElBQUksS0FBSyxHQUFHLEVBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUMsQ0FBQztZQUNqQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxVQUFDLEdBQUcsRUFBRSxRQUFRO2dCQUN6QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNSLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM1QixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsVUFBQyxLQUFLLEVBQUUsTUFBTTt3QkFDOUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDVixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQzt3QkFDOUIsQ0FBQzt3QkFBQyxJQUFJLENBQUMsQ0FBQzs0QkFDTixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDL0IsQ0FBQztvQkFDSCxDQUFDLENBQUMsQ0FBQztnQkFDTCxDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFTCxDQUFDO1FBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNYLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQzdDLENBQUM7SUFFSCxDQUFDO0lBRUQsOENBQW9CLEdBQXBCLFVBQXFCLEdBQW1CLEVBQUUsR0FBb0I7UUFDNUQsSUFBSSxDQUFDO1lBQ0gsSUFBSSxZQUFZLEdBQWdCLElBQUksWUFBWSxFQUFFLENBQUM7WUFDbkQsSUFBSSxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7WUFDbkMsSUFBSSxLQUFLLEdBQU8sRUFBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLFFBQVEsRUFBRSxFQUFDLENBQUM7WUFDbEQsWUFBWSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsVUFBQyxHQUFHLEVBQUUsUUFBUTtnQkFDNUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDUixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDNUIsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDakMsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUM3QyxDQUFDO0lBQ0gsQ0FBQztJQUVILHNCQUFDO0FBQUQsQ0EvQ0EsQUErQ0MsSUFBQTtBQUVELGlCQUFTLGVBQWUsQ0FBQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NoYXJlL2NvbnRyb2xsZXIvc2hhcmUuY29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzPSByZXF1aXJlKCdleHByZXNzJyk7XG5pbXBvcnQgU2hhcmVTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvc2hhcmUuc2VydmljZScpO1xuaW1wb3J0IEF1dGhJbnRlcmNlcHRvciA9IHJlcXVpcmUoJy4uLy4uL2ludGVyY2VwdG9yL2F1dGguaW50ZXJjZXB0b3InKTtcbi8vaW1wb3J0IGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xudmFyIGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xuXG5jbGFzcyBTaGFyZUNvbnRyb2xsZXIge1xuXG4gIGJ1aWxkVmFsdWVQb3J0cmFpdFVybChyZXE6ZXhwcmVzcy5SZXF1ZXN0LCByZXM6ZXhwcmVzcy5SZXNwb25zZSkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgdXNlcjphbnkgPSByZXEudXNlcjtcbiAgICAgIHZhciBfaG9zdCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5ob3N0Jyk7XG4gICAgICB2YXIgc2hhcmVTZXJ2aWNlOlNoYXJlU2VydmljZSA9IG5ldyBTaGFyZVNlcnZpY2UoKTtcbiAgICAgIHZhciBhdXRoOkF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcbiAgICAgIHZhciBfdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkRm9yU2hhcmUodXNlcik7XG4gICAgICB2YXIgcXVlcnkgPSB7J3VzZXJJZCc6IHVzZXIuX2lkfTtcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZShxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlcy5zdGF0dXMoMzA0KS5zZW5kKGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2hhcmVTZXJ2aWNlLmJ1aWxkVmFsdWVQb3J0cmFpdFVybChfaG9zdCwgX3Rva2VuLCB1c2VyLCByZXNwb25zZSwgKGVycm9yLCByZXN1bHQpPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoMzA0KS5zZW5kKGVycm9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xuICAgIH1cblxuICB9XG5cbiAgZ2V0QWN0dWFsVXJsRm9yU2hhcmUocmVxOmV4cHJlc3MuUmVxdWVzdCwgcmVzOmV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XG4gICAgICBsZXQgc2hvcnRVcmwgPSByZXEucGFyYW1zLnNob3J0VXJsO1xuICAgICAgdmFyIHF1ZXJ5OmFueSA9IHsnc2hvcnRVcmwnOiBzaG9ydFVybC50b1N0cmluZygpfTtcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZVVybChxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlcy5zdGF0dXMoMzA0KS5zZW5kKGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXMuc3RhdHVzKDQwMykuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XG4gICAgfVxuICB9XG5cbn1cblxuZXhwb3J0ID0gU2hhcmVDb250cm9sbGVyO1xuIl19
