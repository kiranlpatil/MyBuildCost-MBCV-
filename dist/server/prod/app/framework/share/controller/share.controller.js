"use strict";
var ShareService = require("../services/share.service");
var AuthInterceptor = require("../../interceptor/auth.interceptor");
var config = require('config');
var ShareController = (function () {
    function ShareController() {
    }
    ShareController.prototype.buildValuePortraitUrl = function (req, res) {
        try {
            var user_1 = req.user;
            var _host_1 = config.get('TplSeed.mail.host');
            var shareService_1 = new ShareService();
            var auth = new AuthInterceptor();
            var _token_1 = auth.issueTokenWithUidForShare(user_1);
            var query = { 'userId': user_1._id };
            shareService_1.retrieve(query, function (err, response) {
                if (err) {
                    res.status(304).send(err);
                }
                else {
                    shareService_1.buildValuePortraitUrl(_host_1, _token_1, user_1, response, function (error, result) {
                        if (error) {
                            res.status(304).send(error);
                        }
                        else {
                            res.status(200).send(result);
                        }
                    });
                }
            });
        }
        catch (e) {
            res.status(403).send({ message: e.message });
        }
    };
    ShareController.prototype.buildShareJobUrl = function (req, res) {
        try {
            var user = req.user;
            var _host = config.get('TplSeed.mail.host');
            var shareService = new ShareService();
            var auth = new AuthInterceptor();
            var _token = auth.issueTokenWithUid(user, 'hiringManager');
            shareService.buildShareJobUrl(_host, _token, user, req.params.jobId, function (error, result) {
                if (error) {
                    res.status(500).send(error);
                }
                else {
                    res.status(200).send(result);
                }
            });
        }
        catch (e) {
            res.status(500).send({ message: e.message });
        }
    };
    ShareController.prototype.getActualUrlForShare = function (req, res) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.retrieveUrl(query, function (err, response) {
                if (err) {
                    res.status(500).send(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            res.status(500).send({ message: e.message });
        }
    };
    ShareController.prototype.resetActualUrlForShare = function (req, res) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.findOneAndUpdate(query, function (err, response) {
                if (err) {
                    res.status(500).send(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            res.status(500).send({ message: e.message });
        }
    };
    return ShareController;
}());
module.exports = ShareController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmUvY29udHJvbGxlci9zaGFyZS5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSx3REFBMkQ7QUFDM0Qsb0VBQXVFO0FBRXZFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQjtJQUFBO0lBbUZBLENBQUM7SUFqRkMsK0NBQXFCLEdBQXJCLFVBQXNCLEdBQW1CLEVBQUUsR0FBb0I7UUFDN0QsSUFBSSxDQUFDO1lBQ0gsSUFBSSxNQUFJLEdBQU8sR0FBRyxDQUFDLElBQUksQ0FBQztZQUN4QixJQUFJLE9BQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDNUMsSUFBSSxjQUFZLEdBQWdCLElBQUksWUFBWSxFQUFFLENBQUM7WUFDbkQsSUFBSSxJQUFJLEdBQW1CLElBQUksZUFBZSxFQUFFLENBQUM7WUFDakQsSUFBSSxRQUFNLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLE1BQUksQ0FBQyxDQUFDO1lBQ2xELElBQUksS0FBSyxHQUFHLEVBQUMsUUFBUSxFQUFFLE1BQUksQ0FBQyxHQUFHLEVBQUMsQ0FBQztZQUNqQyxjQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxVQUFDLEdBQUcsRUFBRSxRQUFRO2dCQUN6QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNSLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM1QixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLGNBQVksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFLLEVBQUUsUUFBTSxFQUFFLE1BQUksRUFBRSxRQUFRLEVBQUUsVUFBQyxLQUFLLEVBQUUsTUFBTTt3QkFDOUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDVixHQUFHLENBQUMsTUFB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LENBQUMsRUFBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNILENBQUM7SUFFRCxnREFBc0IsR0FBdEIsVUFBdUIsR0FBbUIsRUFBRSxHQUFvQjtRQUM5RCxJQUFJLENBQUM7WUFDSCxJQUFJLFlBQVksR0FBZ0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztZQUNuRCxJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztZQUNuQyxJQUFJLEtBQUssR0FBTyxFQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQUMsQ0FBQztZQUNsRCxZQUFZLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLFVBQUMsR0FBRyxFQUFFLFFBQVE7Z0JBQ2pELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7b0JBQ1IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzVCLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ1gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNILENBQUM7SUFFSCxzQkFBQztBQUFELENBbkZBLEFBbUZDLElBQUE7QUFFRCxpQkFBUyxlQUFlLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZS9jb250cm9sbGVyL3NoYXJlLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcz0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5pbXBvcnQgU2hhcmVTZXJ2aWNlID0gcmVxdWlyZSgnLi4vc2VydmljZXMvc2hhcmUuc2VydmljZScpO1xyXG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vLi4vaW50ZXJjZXB0b3IvYXV0aC5pbnRlcmNlcHRvcicpO1xyXG4vL2ltcG9ydCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcclxubGV0IGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xyXG5cclxuY2xhc3MgU2hhcmVDb250cm9sbGVyIHtcclxuXHJcbiAgYnVpbGRWYWx1ZVBvcnRyYWl0VXJsKHJlcTpleHByZXNzLlJlcXVlc3QsIHJlczpleHByZXNzLlJlc3BvbnNlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsZXQgdXNlcjphbnkgPSByZXEudXNlcjtcclxuICAgICAgbGV0IF9ob3N0ID0gY29uZmlnLmdldCgnVHBsU2VlZC5tYWlsLmhvc3QnKTtcclxuICAgICAgbGV0IHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBhdXRoOkF1dGhJbnRlcmNlcHRvciA9IG5ldyBBdXRoSW50ZXJjZXB0b3IoKTtcclxuICAgICAgbGV0IF90b2tlbiA9IGF1dGguaXNzdWVUb2tlbldpdGhVaWRGb3JTaGFyZSh1c2VyKTtcclxuICAgICAgbGV0IHF1ZXJ5ID0geyd1c2VySWQnOiB1c2VyLl9pZH07XHJcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZShxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDMwNCkuc2VuZChlcnIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzaGFyZVNlcnZpY2UuYnVpbGRWYWx1ZVBvcnRyYWl0VXJsKF9ob3N0LCBfdG9rZW4sIHVzZXIsIHJlc3BvbnNlLCAoZXJyb3IsIHJlc3VsdCk9PiB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoMzA0KS5zZW5kKGVycm9yKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgcmVzLnN0YXR1cyg0MDMpLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbiAgYnVpbGRTaGFyZUpvYlVybChyZXE6ZXhwcmVzcy5SZXF1ZXN0LCByZXM6ZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHVzZXI6YW55ID0gcmVxLnVzZXI7XHJcbiAgICAgIGxldCBfaG9zdCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5ob3N0Jyk7XHJcbiAgICAgIGxldCBzaGFyZVNlcnZpY2U6U2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xyXG4gICAgICBsZXQgYXV0aDpBdXRoSW50ZXJjZXB0b3IgPSBuZXcgQXV0aEludGVyY2VwdG9yKCk7XHJcbiAgICAgIGxldCBfdG9rZW4gPSBhdXRoLmlzc3VlVG9rZW5XaXRoVWlkKHVzZXIsJ2hpcmluZ01hbmFnZXInKTtcclxuICAgICAgICAgIHNoYXJlU2VydmljZS5idWlsZFNoYXJlSm9iVXJsKF9ob3N0LCBfdG9rZW4sIHVzZXIscmVxLnBhcmFtcy5qb2JJZCwgKGVycm9yLCByZXN1bHQpPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnJvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBnZXRBY3R1YWxVcmxGb3JTaGFyZShyZXE6ZXhwcmVzcy5SZXF1ZXN0LCByZXM6ZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBzaG9ydFVybCA9IHJlcS5wYXJhbXMuc2hvcnRVcmw7XHJcbiAgICAgIGxldCBxdWVyeTphbnkgPSB7J3Nob3J0VXJsJzogc2hvcnRVcmwudG9TdHJpbmcoKX07XHJcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZVVybChxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcclxuICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChlcnIpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmVzZXRBY3R1YWxVcmxGb3JTaGFyZShyZXE6ZXhwcmVzcy5SZXF1ZXN0LCByZXM6ZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbGV0IHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XHJcbiAgICAgIGxldCBzaG9ydFVybCA9IHJlcS5wYXJhbXMuc2hvcnRVcmw7XHJcbiAgICAgIGxldCBxdWVyeTphbnkgPSB7J3Nob3J0VXJsJzogc2hvcnRVcmwudG9TdHJpbmcoKX07XHJcbiAgICAgIHNoYXJlU2VydmljZS5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCAoZXJyLCByZXNwb25zZSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0ID0gU2hhcmVDb250cm9sbGVyO1xyXG4iXX0=
