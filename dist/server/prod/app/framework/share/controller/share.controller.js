"use strict";
var ShareService = require("../services/share.service");
var AuthInterceptor = require("../../interceptor/auth.interceptor");
var config = require('config');
var ShareController = (function () {
    function ShareController() {
    }
    ShareController.prototype.buildValuePortraitUrl = function (req, res) {
        try {
            var user_1 = req.user;
            var _host_1 = config.get('TplSeed.mail.host');
            var shareService_1 = new ShareService();
            var auth = new AuthInterceptor();
            var _token_1 = auth.issueTokenWithUidForShare(user_1);
            var query = { 'userId': user_1._id };
            shareService_1.retrieve(query, function (err, response) {
                if (err) {
                    res.status(304).send(err);
                }
                else {
                    shareService_1.buildValuePortraitUrl(_host_1, _token_1, user_1, response, function (error, result) {
                        if (error) {
                            res.status(304).send(error);
                        }
                        else {
                            res.status(200).send(result);
                        }
                    });
                }
            });
        }
        catch (e) {
            res.status(403).send({ message: e.message });
        }
    };
    ShareController.prototype.buildShareJobUrl = function (req, res) {
        try {
            var user = req.user;
            var _host = config.get('TplSeed.mail.host');
            var shareService = new ShareService();
            var auth = new AuthInterceptor();
            var _token = auth.issueTokenWithUid(user, 'hiringManager');
            shareService.buildShareJobUrl(_host, _token, user, req.params.jobId, function (error, result) {
                if (error) {
                    res.status(500).send(error);
                }
                else {
                    res.status(200).send(result);
                }
            });
        }
        catch (e) {
            res.status(500).send({ message: e.message });
        }
    };
    ShareController.prototype.getActualUrlForShare = function (req, res) {
        try {
            var shareService = new ShareService();
            var shortUrl = req.params.shortUrl;
            var query = { 'shortUrl': shortUrl.toString() };
            shareService.retrieveUrl(query, function (err, response) {
                if (err) {
                    res.status(500).send(err);
                }
                else {
                    res.status(200).send(response);
                }
            });
        }
        catch (e) {
            res.status(500).send({ message: e.message });
        }
    };
    return ShareController;
}());
module.exports = ShareController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmUvY29udHJvbGxlci9zaGFyZS5jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSx3REFBMkQ7QUFDM0Qsb0VBQXVFO0FBRXZFLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUUvQjtJQUFBO0lBa0VBLENBQUM7SUFoRUMsK0NBQXFCLEdBQXJCLFVBQXNCLEdBQW1CLEVBQUUsR0FBb0I7UUFDN0QsSUFBSSxDQUFDO1lBQ0gsSUFBSSxNQUFJLEdBQU8sR0FBRyxDQUFDLElBQUksQ0FBQztZQUN4QixJQUFJLE9BQUssR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDNUMsSUFBSSxjQUFZLEdBQWdCLElBQUksWUFBWSxFQUFFLENBQUM7WUFDbkQsSUFBSSxJQUFJLEdBQW1CLElBQUksZUFBZSxFQUFFLENBQUM7WUFDakQsSUFBSSxRQUFNLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixDQUFDLE1BQUksQ0FBQyxDQUFDO1lBQ2xELElBQUksS0FBSyxHQUFHLEVBQUMsUUFBUSxFQUFFLE1BQUksQ0FBQyxHQUFHLEVBQUMsQ0FBQztZQUNqQyxjQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxVQUFDLEdBQUcsRUFBRSxRQUFRO2dCQUN6QyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNSLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM1QixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLGNBQVksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFLLEVBQUUsUUFBTSxFQUFFLE1BQUksRUFBRSxRQUFRLEVBQUUsVUFBQyxLQUFLLEVBQUUsTUFBTTt3QkFDOUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDVixHQUFHLENBQUMsTUFB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LENBQUMsRUFBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFDN0MsQ0FBQztJQUNILENBQUM7SUFFSCxzQkFBQztBQUFELENBbEVBLEFBa0VDLElBQUE7QUFFRCxpQkFBUyxlQUFlLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZS9jb250cm9sbGVyL3NoYXJlLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcz0gcmVxdWlyZSgnZXhwcmVzcycpO1xuaW1wb3J0IFNoYXJlU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3NoYXJlLnNlcnZpY2UnKTtcbmltcG9ydCBBdXRoSW50ZXJjZXB0b3IgPSByZXF1aXJlKCcuLi8uLi9pbnRlcmNlcHRvci9hdXRoLmludGVyY2VwdG9yJyk7XG4vL2ltcG9ydCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcbmxldCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcblxuY2xhc3MgU2hhcmVDb250cm9sbGVyIHtcblxuICBidWlsZFZhbHVlUG9ydHJhaXRVcmwocmVxOmV4cHJlc3MuUmVxdWVzdCwgcmVzOmV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHVzZXI6YW55ID0gcmVxLnVzZXI7XG4gICAgICBsZXQgX2hvc3QgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1haWwuaG9zdCcpO1xuICAgICAgbGV0IHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XG4gICAgICBsZXQgYXV0aDpBdXRoSW50ZXJjZXB0b3IgPSBuZXcgQXV0aEludGVyY2VwdG9yKCk7XG4gICAgICBsZXQgX3Rva2VuID0gYXV0aC5pc3N1ZVRva2VuV2l0aFVpZEZvclNoYXJlKHVzZXIpO1xuICAgICAgbGV0IHF1ZXJ5ID0geyd1c2VySWQnOiB1c2VyLl9pZH07XG4gICAgICBzaGFyZVNlcnZpY2UucmV0cmlldmUocXVlcnksIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXMuc3RhdHVzKDMwNCkuc2VuZChlcnIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNoYXJlU2VydmljZS5idWlsZFZhbHVlUG9ydHJhaXRVcmwoX2hvc3QsIF90b2tlbiwgdXNlciwgcmVzcG9uc2UsIChlcnJvciwgcmVzdWx0KT0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICByZXMuc3RhdHVzKDMwNCkuc2VuZChlcnJvcik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJlcy5zdGF0dXMoNDAzKS5zZW5kKHttZXNzYWdlOiBlLm1lc3NhZ2V9KTtcbiAgICB9XG5cbiAgfVxuICBidWlsZFNoYXJlSm9iVXJsKHJlcTpleHByZXNzLlJlcXVlc3QsIHJlczpleHByZXNzLlJlc3BvbnNlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCB1c2VyOmFueSA9IHJlcS51c2VyO1xuICAgICAgbGV0IF9ob3N0ID0gY29uZmlnLmdldCgnVHBsU2VlZC5tYWlsLmhvc3QnKTtcbiAgICAgIGxldCBzaGFyZVNlcnZpY2U6U2hhcmVTZXJ2aWNlID0gbmV3IFNoYXJlU2VydmljZSgpO1xuICAgICAgbGV0IGF1dGg6QXV0aEludGVyY2VwdG9yID0gbmV3IEF1dGhJbnRlcmNlcHRvcigpO1xuICAgICAgbGV0IF90b2tlbiA9IGF1dGguaXNzdWVUb2tlbldpdGhVaWQodXNlciwnaGlyaW5nTWFuYWdlcicpO1xuICAgICAgICAgIHNoYXJlU2VydmljZS5idWlsZFNoYXJlSm9iVXJsKF9ob3N0LCBfdG9rZW4sIHVzZXIscmVxLnBhcmFtcy5qb2JJZCwgKGVycm9yLCByZXN1bHQpPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycm9yKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoe21lc3NhZ2U6IGUubWVzc2FnZX0pO1xuICAgIH1cblxuICB9XG5cbiAgZ2V0QWN0dWFsVXJsRm9yU2hhcmUocmVxOmV4cHJlc3MuUmVxdWVzdCwgcmVzOmV4cHJlc3MuUmVzcG9uc2UpIHtcbiAgICB0cnkge1xuICAgICAgbGV0IHNoYXJlU2VydmljZTpTaGFyZVNlcnZpY2UgPSBuZXcgU2hhcmVTZXJ2aWNlKCk7XG4gICAgICBsZXQgc2hvcnRVcmwgPSByZXEucGFyYW1zLnNob3J0VXJsO1xuICAgICAgbGV0IHF1ZXJ5OmFueSA9IHsnc2hvcnRVcmwnOiBzaG9ydFVybC50b1N0cmluZygpfTtcbiAgICAgIHNoYXJlU2VydmljZS5yZXRyaWV2ZVVybChxdWVyeSwgKGVyciwgcmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKGVycik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogZS5tZXNzYWdlfSk7XG4gICAgfVxuICB9XG5cbn1cblxuZXhwb3J0ID0gU2hhcmVDb250cm9sbGVyO1xuIl19
