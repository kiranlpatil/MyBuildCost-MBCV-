"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var CandidateRepository = require("../dataaccess/repository/candidate.repository");
var UserRepository = require("../dataaccess/repository/user.repository");
var LoggerService = require("../shared/logger/LoggerService");
var sharedconstants_1 = require("../shared/sharedconstants");
var _loggerService = new LoggerService('MAILCHIMP_MAILER_SERVICE');
var CronJob = require('cron').CronJob;
var config = require('config');
var mailchimp = require('mailchimp-api-v3');
var mailchimpClient = new mailchimp(config.get('TplSeed.mail.MAIL_CHIMP_SERVICE_KEY'));
var md5 = require('md5');
var MailChimpMailerService = (function () {
    function MailChimpMailerService() {
    }
    MailChimpMailerService.prototype.onCandidateSignSuccess = function (user) {
        var listId = config.get('TplSeed.mail.MAILCHIMP_CANDIDATE_SIGN_IN_SUCCESS_LISTID');
        this.triggerMailChimpService(user, listId);
    };
    MailChimpMailerService.prototype.onCandidatePofileSubmitted = function (user, isSubmitted, isEditingProfile) {
        if (!isEditingProfile && isSubmitted) {
            var listId = config.get('TplSeed.mail.MAILCHIMP_CANDIDATE_PROFILE_SUBMIT_SUCCESS_LISTID');
            this.triggerMailChimpService(user, listId);
        }
    };
    MailChimpMailerService.prototype.onCronJobCandidateProfileTriggered = function (profile_update_track, listId) {
        var _this = this;
        this.candidateRepository = new CandidateRepository();
        this.userRepository = new UserRepository();
        var today = new Date();
        var yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);
        var data;
        var trackNumber = sharedconstants_1.CandidateProfileUpdateTrackServerSide.STEP_IS_ENTER_KEY_SKILLS;
        var trackNumberNotSubmitted = sharedconstants_1.CandidateProfileUpdateTrackServerSide.STEP_IS_SUBMIT_DETAILS;
        if (profile_update_track === trackNumber) {
            data = {
                'profile_update_tracking': { $gte: trackNumber, $lt: trackNumberNotSubmitted },
                'lastUpdateAt': { $lt: new Date(), $gt: new Date(yesterday) }
            };
        }
        else {
            data = {
                'profile_update_tracking': profile_update_track,
                'lastUpdateAt': { $lt: new Date(), $gt: new Date(yesterday) }
            };
        }
        this.candidateRepository.retrieveWithIncluded(data, { 'userId': 1 }, function (err, res) {
            if (err) {
                _loggerService.logError(err);
            }
            else {
                for (var _i = 0, res_1 = res; _i < res_1.length; _i++) {
                    var item = res_1[_i];
                    _this.userRepository.retrieveWithIncluded({ '_id': item.userId }, { 'email': 1, 'first_name': 1, 'last_name': 1 }, function (err, res) {
                        if (err) {
                            _loggerService.logError(err);
                        }
                        else {
                            _this.triggerMailChimpService(res[0], listId);
                        }
                    });
                }
            }
        });
    };
    MailChimpMailerService.prototype.triggerMailChimpService = function (data, listId) {
        var md5String = md5(data.email);
        mailchimpClient.put('/lists/' + listId + '/members/' + md5String, {
            email_address: data.email,
            status: 'subscribed',
            merge_fields: {
                'FNAME': data.first_name,
                'LNAME': data.last_name
            }
        }).then(function (results) {
            _loggerService.logInfo(results);
        })
            .catch(function (err) {
            _loggerService.logError(err);
        });
    };
    return MailChimpMailerService;
}());
exports.MailChimpMailerService = MailChimpMailerService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvbWFpbGNoaW1wLW1haWxlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbUZBQXNGO0FBQ3RGLHlFQUE0RTtBQUM1RSw4REFBaUU7QUFDakUsNkRBQWdGO0FBRWhGLElBQUksY0FBYyxHQUFrQixJQUFJLGFBQWEsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ2xGLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDdEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRS9CLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO0FBQzNDLElBQUksZUFBZSxHQUFHLElBQUksU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUNBQXFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZGLElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUV6QjtJQUFBO0lBNEZBLENBQUM7SUF4RkMsdURBQXNCLEdBQXRCLFVBQXVCLElBQVM7UUFDOUIsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQXFCRCwyREFBMEIsR0FBMUIsVUFBMkIsSUFBUyxFQUFFLFdBQW1CLEVBQUMsZ0JBQXlCO1FBQ2pGLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNyQyxJQUFJLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLGdFQUFnRSxDQUFDLENBQUM7WUFDMUYsSUFBSSxDQUFDLHVCQUF1QixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM3QyxDQUFDO0lBRUgsQ0FBQztJQUNELG1FQUFrQyxHQUFsQyxVQUFtQyxvQkFBMkIsRUFBQyxNQUFhO1FBQTVFLGlCQXVDQztRQXRDQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1FBQ3JELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztRQUUzQyxJQUFJLEtBQUssR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3ZCLElBQUksU0FBUyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksSUFBSSxDQUFDO1FBQ1QsSUFBSSxXQUFXLEdBQUMsdURBQXFDLENBQUMsd0JBQXdCLENBQUM7UUFDL0UsSUFBSSx1QkFBdUIsR0FBQyx1REFBcUMsQ0FBQyxzQkFBc0IsQ0FBQztRQUN6RixFQUFFLENBQUEsQ0FBQyxvQkFBb0IsS0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksR0FBRztnQkFDTix5QkFBeUIsRUFBRSxFQUFDLElBQUksRUFBQyxXQUFXLEVBQUMsR0FBRyxFQUFDLHVCQUF1QixFQUFDO2dCQUN6RSxjQUFjLEVBQUUsRUFBQyxHQUFHLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUM7YUFDNUQsQ0FBQztRQUNKLENBQUM7UUFBQSxJQUFJLENBQUMsQ0FBQztZQUNMLElBQUksR0FBRztnQkFDTCx5QkFBeUIsRUFBRSxvQkFBb0I7Z0JBQy9DLGNBQWMsRUFBRSxFQUFDLEdBQUcsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBQzthQUM1RCxDQUFDO1FBQ0osQ0FBQztRQUVELElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsRUFBQyxRQUFRLEVBQUUsQ0FBQyxFQUFDLEVBQUUsVUFBQyxHQUFPLEVBQUUsR0FBTztZQUNsRixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNSLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFL0IsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLEdBQUcsQ0FBQyxDQUFhLFVBQUcsRUFBSCxXQUFHLEVBQUgsaUJBQUcsRUFBSCxJQUFHO29CQUFmLElBQUksSUFBSSxZQUFBO29CQUNYLEtBQUksQ0FBQyxjQUFjLENBQUMsb0JBQW9CLENBQUMsRUFBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxFQUFFLEVBQUMsT0FBTyxFQUFFLENBQUMsRUFBQyxZQUFZLEVBQUMsQ0FBQyxFQUFDLFdBQVcsRUFBQyxDQUFDLEVBQUMsRUFBRSxVQUFDLEdBQU8sRUFBRSxHQUFPO3dCQUN6SCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDOzRCQUNQLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQy9CLENBQUM7d0JBQUEsSUFBSSxDQUFDLENBQUM7NEJBQ0wsS0FBSSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQzt3QkFDL0MsQ0FBQztvQkFFSCxDQUFDLENBQUMsQ0FBQztpQkFDSjtZQUNILENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx3REFBdUIsR0FBdkIsVUFBd0IsSUFBUSxFQUFDLE1BQVU7UUFDekMsSUFBSSxTQUFTLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMvQixlQUFlLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxNQUFNLEdBQUcsV0FBVyxHQUFHLFNBQVMsRUFBRTtZQUNoRSxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUs7WUFDekIsTUFBTSxFQUFFLFlBQVk7WUFDcEIsWUFBWSxFQUFFO2dCQUNkLE9BQU8sRUFBRSxJQUFJLENBQUMsVUFBVTtnQkFDdEIsT0FBTyxFQUFDLElBQUksQ0FBQyxTQUFTO2FBQ3pCO1NBQ0EsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLE9BQVk7WUFDNUIsY0FBYyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUM7YUFDQyxLQUFLLENBQUMsVUFBVSxHQUFRO1lBQ3ZCLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0lBQ0gsNkJBQUM7QUFBRCxDQTVGQSxBQTRGQyxJQUFBO0FBNUZZLHdEQUFzQiIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NlcnZpY2VzL21haWxjaGltcC1tYWlsZXIuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDYW5kaWRhdGVSZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L2NhbmRpZGF0ZS5yZXBvc2l0b3J5Jyk7XG5pbXBvcnQgVXNlclJlcG9zaXRvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvdXNlci5yZXBvc2l0b3J5Jyk7XG5pbXBvcnQgTG9nZ2VyU2VydmljZSA9IHJlcXVpcmUoJy4uL3NoYXJlZC9sb2dnZXIvTG9nZ2VyU2VydmljZScpO1xuaW1wb3J0IHtDYW5kaWRhdGVQcm9maWxlVXBkYXRlVHJhY2tTZXJ2ZXJTaWRlfSBmcm9tIFwiLi4vc2hhcmVkL3NoYXJlZGNvbnN0YW50c1wiO1xuXG5sZXQgX2xvZ2dlclNlcnZpY2U6IExvZ2dlclNlcnZpY2UgPSBuZXcgTG9nZ2VyU2VydmljZSgnTUFJTENISU1QX01BSUxFUl9TRVJWSUNFJyk7XG52YXIgQ3JvbkpvYiA9IHJlcXVpcmUoJ2Nyb24nKS5Dcm9uSm9iO1xudmFyIGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xuXG5sZXQgbWFpbGNoaW1wID0gcmVxdWlyZSgnbWFpbGNoaW1wLWFwaS12MycpXG5sZXQgbWFpbGNoaW1wQ2xpZW50ID0gbmV3IG1haWxjaGltcChjb25maWcuZ2V0KCdUcGxTZWVkLm1haWwuTUFJTF9DSElNUF9TRVJWSUNFX0tFWScpKTtcbmxldCBtZDUgPSByZXF1aXJlKCdtZDUnKTtcblxuZXhwb3J0IGNsYXNzIE1haWxDaGltcE1haWxlclNlcnZpY2Uge1xuICBwcml2YXRlIGNhbmRpZGF0ZVJlcG9zaXRvcnk6IENhbmRpZGF0ZVJlcG9zaXRvcnk7XG4gIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xuXG4gIG9uQ2FuZGlkYXRlU2lnblN1Y2Nlc3ModXNlcjogYW55KSB7XG4gICAgbGV0IGxpc3RJZCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5NQUlMQ0hJTVBfQ0FORElEQVRFX1NJR05fSU5fU1VDQ0VTU19MSVNUSUQnKTtcbiAgICB0aGlzLnRyaWdnZXJNYWlsQ2hpbXBTZXJ2aWNlKHVzZXIsIGxpc3RJZCk7XG4gIH1cbiAvKiBvblJlY3J1aXRlclNpZ25VcFN1Y2Nlc3ModXNlcjogYW55KSB7XG4gICAgbGV0IGxpc3RJZCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5NQUlMQ0hJTVBfUkVDUlVJVEVSX1NJR05fSU5fU1VDQ0VTU19MSVNUSUQnKTtcbiAgICBsZXQgbWQ1U3RyaW5nID0gbWQ1KGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5BRE1JTl9NQUlMJykpXG4gICAgbWFpbGNoaW1wQ2xpZW50LnB1dCgnL2xpc3RzLycgKyBsaXN0SWQgKyAnL21lbWJlcnMvJyArIG1kNVN0cmluZywge1xuICAgICAgZW1haWxfYWRkcmVzczogY29uZmlnLmdldCgnVHBsU2VlZC5tYWlsLkFETUlOX01BSUwnKSxcbiAgICAgIHN0YXR1czogJ3N1YnNjcmliZWQnLFxuICAgICAgbWVyZ2VfZmllbGRzOiB7XG4gICAgICAgICdDTkFNRSc6IHVzZXIuY29tcGFueV9uYW1lLFxuICAgICAgICAnQ0VNQUlMJzp1c2VyLmVtYWlsXG4gICAgICB9XG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0czogYW55KSB7XG4gICAgICBfbG9nZ2VyU2VydmljZS5sb2dJbmZvKHJlc3VsdHMpO1xuICAgIH0pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycjogYW55KSB7XG4gICAgICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKGVycik7XG4gICAgICB9KVxuXG4gICAgdGhpcy50cmlnZ2VyTWFpbENoaW1wU2VydmljZSh1c2VyLCBsaXN0SWQpO1xuICB9Ki9cblxuICBvbkNhbmRpZGF0ZVBvZmlsZVN1Ym1pdHRlZCh1c2VyOiBhbnksIGlzU3VibWl0dGVkOmJvb2xlYW4saXNFZGl0aW5nUHJvZmlsZTogYm9vbGVhbikge1xuICAgIGlmICghaXNFZGl0aW5nUHJvZmlsZSAmJiBpc1N1Ym1pdHRlZCkge1xuICAgICAgbGV0IGxpc3RJZCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWFpbC5NQUlMQ0hJTVBfQ0FORElEQVRFX1BST0ZJTEVfU1VCTUlUX1NVQ0NFU1NfTElTVElEJyk7XG4gICAgICB0aGlzLnRyaWdnZXJNYWlsQ2hpbXBTZXJ2aWNlKHVzZXIsIGxpc3RJZCk7XG4gICAgfVxuXG4gIH1cbiAgb25Dcm9uSm9iQ2FuZGlkYXRlUHJvZmlsZVRyaWdnZXJlZChwcm9maWxlX3VwZGF0ZV90cmFjazpudW1iZXIsbGlzdElkOnN0cmluZykge1xuICAgIHRoaXMuY2FuZGlkYXRlUmVwb3NpdG9yeSA9IG5ldyBDYW5kaWRhdGVSZXBvc2l0b3J5KCk7XG4gICAgdGhpcy51c2VyUmVwb3NpdG9yeSA9IG5ldyBVc2VyUmVwb3NpdG9yeSgpO1xuXG4gICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICB2YXIgeWVzdGVyZGF5ID0gbmV3IERhdGUodG9kYXkpO1xuICAgIHllc3RlcmRheS5zZXREYXRlKHRvZGF5LmdldERhdGUoKSAtIDEpO1xuICAgIHZhciBkYXRhO1xuICAgIGxldCB0cmFja051bWJlcj1DYW5kaWRhdGVQcm9maWxlVXBkYXRlVHJhY2tTZXJ2ZXJTaWRlLlNURVBfSVNfRU5URVJfS0VZX1NLSUxMUztcbiAgICBsZXQgdHJhY2tOdW1iZXJOb3RTdWJtaXR0ZWQ9Q2FuZGlkYXRlUHJvZmlsZVVwZGF0ZVRyYWNrU2VydmVyU2lkZS5TVEVQX0lTX1NVQk1JVF9ERVRBSUxTO1xuICAgIGlmKHByb2ZpbGVfdXBkYXRlX3RyYWNrPT09dHJhY2tOdW1iZXIpIHtcbiAgICAgICBkYXRhID0ge1xuICAgICAgICAncHJvZmlsZV91cGRhdGVfdHJhY2tpbmcnOiB7JGd0ZTp0cmFja051bWJlciwkbHQ6dHJhY2tOdW1iZXJOb3RTdWJtaXR0ZWR9LFxuICAgICAgICAnbGFzdFVwZGF0ZUF0JzogeyRsdDogbmV3IERhdGUoKSwgJGd0OiBuZXcgRGF0ZSh5ZXN0ZXJkYXkpfVxuICAgICAgfTtcbiAgICB9ZWxzZSB7XG4gICAgICBkYXRhID0ge1xuICAgICAgICAncHJvZmlsZV91cGRhdGVfdHJhY2tpbmcnOiBwcm9maWxlX3VwZGF0ZV90cmFjayxcbiAgICAgICAgJ2xhc3RVcGRhdGVBdCc6IHskbHQ6IG5ldyBEYXRlKCksICRndDogbmV3IERhdGUoeWVzdGVyZGF5KX1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5jYW5kaWRhdGVSZXBvc2l0b3J5LnJldHJpZXZlV2l0aEluY2x1ZGVkKGRhdGEsIHsndXNlcklkJzogMX0sIChlcnI6YW55LCByZXM6YW55KSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKGVycik7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAobGV0IGl0ZW0gb2YgcmVzKSB7XG4gICAgICAgICAgdGhpcy51c2VyUmVwb3NpdG9yeS5yZXRyaWV2ZVdpdGhJbmNsdWRlZCh7J19pZCc6IGl0ZW0udXNlcklkfSwgeydlbWFpbCc6IDEsJ2ZpcnN0X25hbWUnOjEsJ2xhc3RfbmFtZSc6MX0sIChlcnI6YW55LCByZXM6YW55KSA9PiB7XG4gICAgICAgICAgICBpZihlcnIpIHtcbiAgICAgICAgICAgICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyTWFpbENoaW1wU2VydmljZShyZXNbMF0sIGxpc3RJZCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgdHJpZ2dlck1haWxDaGltcFNlcnZpY2UoZGF0YTphbnksbGlzdElkOmFueSkge1xuICAgIGxldCBtZDVTdHJpbmcgPSBtZDUoZGF0YS5lbWFpbClcbiAgICBtYWlsY2hpbXBDbGllbnQucHV0KCcvbGlzdHMvJyArIGxpc3RJZCArICcvbWVtYmVycy8nICsgbWQ1U3RyaW5nLCB7XG4gICAgICBlbWFpbF9hZGRyZXNzOiBkYXRhLmVtYWlsLFxuICAgICAgc3RhdHVzOiAnc3Vic2NyaWJlZCcsXG4gICAgICBtZXJnZV9maWVsZHM6IHtcbiAgICAgICdGTkFNRSc6IGRhdGEuZmlyc3RfbmFtZSxcbiAgICAgICAgJ0xOQU1FJzpkYXRhLmxhc3RfbmFtZVxuICAgIH1cbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHRzOiBhbnkpIHtcbiAgICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0luZm8ocmVzdWx0cyk7XG4gICAgfSlcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyOiBhbnkpIHtcbiAgICAgICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoZXJyKTtcbiAgICAgIH0pXG4gIH1cbn1cbiJdfQ==
