"use strict";
var IndustryRepository = require("../dataaccess/repository/import-industries.repository");
var xlsxj = require('xlsx-to-json');
var CNextMessages = require("../shared/cnext-messages");
var ProjectAsset = require("../shared/projectasset");
var ImportIndustriesModel = require("../dataaccess/model/industry-class.model");
var IndustryService = require("./industry.service");
var RoleService = require("./role.service");
var CapabilityService = require("./capability.service");
var ComplexityService = require("./complexity.service");
var Messages = require("../shared/messages");
var RolesService = new RoleService();
var CapabilitiesService = new CapabilityService();
var ComplexitiesService = new ComplexityService();
var ImportIndustryService = (function () {
    function ImportIndustryService() {
        this.importIndustriesRepository = new IndustryRepository();
        this.APP_NAME = ProjectAsset.APP_NAME;
    }
    ImportIndustryService.prototype.create = function (item, callback) {
        var industryService;
        industryService = new IndustryService();
        industryService.create(item, function (errinCreate, response) {
            if (errinCreate) {
                callback(new Error(CNextMessages.PROBLEM_IN_CREATING_INDUSTRY), null);
            }
            else {
                if (response.length === 0) {
                    callback('Empty Response', null);
                }
                else {
                    callback(null, response);
                }
            }
        });
    };
    ImportIndustryService.prototype.readXlsx = function (filePath, callback) {
        xlsxj({
            input: filePath,
            output: null
        }, function (err, result) {
            var isSend = false;
            if (err) {
                console.error(err);
                callback(err, null);
            }
            else {
                var rolesArray = [];
                for (var i = 0; i < result.length - 1; i++) {
                    if (result[i].area_of_work_code === '') {
                        if (result[i].area_of_work_code === '' && result[i].capability === '' && result[i].complexity === '') {
                        }
                        else {
                            if (!isSend) {
                                isSend = true;
                                callback(new Error(Messages.MSG_ERROR_AREA_OF_WORK_CODE_MISSING + ' - ' + result[i].area_of_work), null);
                            }
                        }
                    }
                    if (result[i].area_of_work_code === '99999' && result[i].capability === '' && result[i].complexity === '') {
                        rolesArray = RolesService.addRole(result[i], rolesArray);
                    }
                    rolesArray = RolesService.addRole(result[i], rolesArray);
                }
                for (var i = 0; i < rolesArray.length; i++) {
                    var capabilities = [];
                    for (var j = 1; j < result.length; j++) {
                        var currentRow = result[j];
                        if (rolesArray[i].name === currentRow.area_of_work) {
                            if (result[j].capability_code === '') {
                                if (result[j].area_of_work === '' && result[j].capability === '' && result[j].complexity === '') {
                                }
                                else if (result[j].area_of_work === 'Others' && result[j].capability === '' && result[j].complexity === '') {
                                }
                                else {
                                    if (!isSend) {
                                        isSend = true;
                                        callback(new Error(Messages.MSG_ERROR_CAPABILITY_CODE_MISSING + ' - ' + result[j].capability), null);
                                    }
                                }
                            }
                            capabilities = CapabilitiesService.addCapabilities(result[j], capabilities);
                        }
                        else {
                            rolesArray[i].capabilities = capabilities;
                        }
                    }
                }
                for (var i = 0; i < rolesArray.length; i++) {
                    for (var capIndex = 0; capIndex < rolesArray[i].capabilities.length; capIndex++) {
                        var complexities = [];
                        for (var j = 0; j < result.length; j++) {
                            var currentRow_1 = result[j];
                            if (rolesArray[i].name === currentRow_1.area_of_work) {
                                if (rolesArray[i].capabilities[capIndex].name === currentRow_1.capability) {
                                    if (result[j].complexity_code === '') {
                                        if (result[j].area_of_work === '' && result[j].capability === '' && result[j].complexity === '') {
                                        }
                                        else if (result[j].area_of_work === 'Others' && result[j].capability === '' && result[j].complexity === '') {
                                        }
                                        else {
                                            if (!isSend) {
                                                isSend = true;
                                                callback(new Error(Messages.MSG_ERROR_COMPLEXITY_CODE_MISSING + ' - ' + result[j].complexity), null);
                                            }
                                        }
                                    }
                                    complexities = ComplexitiesService.addComplexities(result[j], complexities);
                                }
                            }
                        }
                        rolesArray[i].capabilities[capIndex].complexities = complexities;
                    }
                }
                for (var i = 0; i < rolesArray.length; i++) {
                    rolesArray[i].default_complexities = new Array(0);
                    var temp = new Array(0);
                    for (var c in rolesArray[i].capabilities) {
                        if (rolesArray[i].capabilities[c].code.startsWith('d')) {
                            var tempCode = rolesArray[i].capabilities[c].code.split("d")[1];
                            rolesArray[i].capabilities[c].code = tempCode;
                            rolesArray[i].default_complexities.push(rolesArray[i].capabilities[c]);
                            temp.push(c);
                        }
                    }
                    if (temp.length > 0) {
                        for (var t = temp.length - 1; t >= 0; t--) {
                            rolesArray[i].capabilities.splice(temp[t], 1);
                        }
                    }
                    if (rolesArray[i].name === '') {
                        rolesArray.splice(i, 1);
                    }
                }
                var industry = new ImportIndustriesModel(result[0].industry, result[0].code, result[0].sort_order, rolesArray);
                if (!isSend) {
                    if (result[0].code === '' || result[0].sort_order === '' || result[0].code === undefined || result[0].sort_order === undefined) {
                        callback(new Error(Messages.MSG_ERROR_INDUSTRY_CODE_OR_SORT_NUMBER_MISSING + ' - ' + result[0].industry), null);
                    }
                    callback(null, industry);
                }
            }
        });
    };
    return ImportIndustryService;
}());
Object.seal(ImportIndustryService);
module.exports = ImportIndustryService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvaW1wb3J0LWluZHVzdHJpZXMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsMEZBQTZGO0FBSTdGLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUNwQyx3REFBMkQ7QUFDM0QscURBQXdEO0FBQ3hELGdGQUFtRjtBQUNuRixvREFBdUQ7QUFDdkQsNENBQStDO0FBQy9DLHdEQUEyRDtBQUMzRCx3REFBMkQ7QUFDM0QsNkNBQWdEO0FBRWhELElBQUksWUFBWSxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7QUFDckMsSUFBSSxtQkFBbUIsR0FBRyxJQUFJLGlCQUFpQixFQUFFLENBQUM7QUFDbEQsSUFBSSxtQkFBbUIsR0FBRyxJQUFJLGlCQUFpQixFQUFFLENBQUM7QUFFbEQ7SUFJRTtRQUNFLElBQUksQ0FBQywwQkFBMEIsR0FBRyxJQUFJLGtCQUFrQixFQUFFLENBQUM7UUFDM0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDO0lBQ3hDLENBQUM7SUFFRCxzQ0FBTSxHQUFOLFVBQU8sSUFBUyxFQUFFLFFBQTJDO1FBRTNELElBQUksZUFBaUMsQ0FBQztRQUN0QyxlQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUUsQ0FBQztRQUN4QyxlQUFlLENBQUMsTUFBTSxDQUFDLElBQUksRUFBQyxVQUFDLFdBQWdCLEVBQUUsUUFBYTtZQUMxRCxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNoQixRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLDRCQUE0QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEUsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDMUIsUUFBUSxDQUFDLGdCQUFnQixFQUFF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QUM7Z0JBYUQsSUFBSSxRQUFRLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBQyxVQUFVLENBQUMsQ0FBQztnQkFDN0csRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUNYLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUcsRUFBRSxJQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEtBQUcsRUFBRSxJQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUcsU0FBUyxJQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLEtBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQzt3QkFDaEgsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyw4Q0FBOEMsR0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO29CQUNoSCxDQUFDO29CQUNELFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQzNCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0gsNEJBQUM7QUFBRCxDQXhKQSxBQXdKQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ25DLGlCQUFTLHFCQUFxQixDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmsvc2VydmljZXMvaW1wb3J0LWluZHVzdHJpZXMuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBJbmR1c3RyeVJlcG9zaXRvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvaW1wb3J0LWluZHVzdHJpZXMucmVwb3NpdG9yeScpO1xyXG4vKipcclxuICogQ3JlYXRlZCBieSB0ZWNocHJpbWUwMDIgb24gNy8xMS8yMDE3LlxyXG4gKi9cclxudmFyIHhsc3hqID0gcmVxdWlyZSgneGxzeC10by1qc29uJyk7XHJcbmltcG9ydCBDTmV4dE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vc2hhcmVkL2NuZXh0LW1lc3NhZ2VzJyk7XHJcbmltcG9ydCBQcm9qZWN0QXNzZXQgPSByZXF1aXJlKCcuLi9zaGFyZWQvcHJvamVjdGFzc2V0Jyk7XHJcbmltcG9ydCBJbXBvcnRJbmR1c3RyaWVzTW9kZWwgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL2luZHVzdHJ5LWNsYXNzLm1vZGVsJyk7XHJcbmltcG9ydCBJbmR1c3RyeVNlcnZpY2UgPSByZXF1aXJlKCcuL2luZHVzdHJ5LnNlcnZpY2UnKTtcclxuaW1wb3J0IFJvbGVTZXJ2aWNlID0gcmVxdWlyZSgnLi9yb2xlLnNlcnZpY2UnKTtcclxuaW1wb3J0IENhcGFiaWxpdHlTZXJ2aWNlID0gcmVxdWlyZSgnLi9jYXBhYmlsaXR5LnNlcnZpY2UnKTtcclxuaW1wb3J0IENvbXBsZXhpdHlTZXJ2aWNlID0gcmVxdWlyZSgnLi9jb21wbGV4aXR5LnNlcnZpY2UnKTtcclxuaW1wb3J0IE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vc2hhcmVkL21lc3NhZ2VzJyk7XHJcblxyXG5sZXQgUm9sZXNTZXJ2aWNlID0gbmV3IFJvbGVTZXJ2aWNlKCk7XHJcbmxldCBDYXBhYmlsaXRpZXNTZXJ2aWNlID0gbmV3IENhcGFiaWxpdHlTZXJ2aWNlKCk7XHJcbmxldCBDb21wbGV4aXRpZXNTZXJ2aWNlID0gbmV3IENvbXBsZXhpdHlTZXJ2aWNlKCk7XHJcblxyXG5jbGFzcyBJbXBvcnRJbmR1c3RyeVNlcnZpY2Uge1xyXG4gIEFQUF9OQU1FOiBzdHJpbmc7XHJcbiAgcHJpdmF0ZSBpbXBvcnRJbmR1c3RyaWVzUmVwb3NpdG9yeTogSW5kdXN0cnlSZXBvc2l0b3J5O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuaW1wb3J0SW5kdXN0cmllc1JlcG9zaXRvcnkgPSBuZXcgSW5kdXN0cnlSZXBvc2l0b3J5KCk7XHJcbiAgICB0aGlzLkFQUF9OQU1FID0gUHJvamVjdEFzc2V0LkFQUF9OQU1FO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlKGl0ZW06IGFueSwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG5cclxuICAgIGxldCBpbmR1c3RyeVNlcnZpY2UgOiBJbmR1c3RyeVNlcnZpY2U7XHJcbiAgICBpbmR1c3RyeVNlcnZpY2UgPSBuZXcgSW5kdXN0cnlTZXJ2aWNlKCk7XHJcbiAgICBpbmR1c3RyeVNlcnZpY2UuY3JlYXRlKGl0ZW0sKGVycmluQ3JlYXRlOiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHtcclxuICAgICAgaWYgKGVycmluQ3JlYXRlKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKENOZXh0TWVzc2FnZXMuUFJPQkxFTV9JTl9DUkVBVElOR19JTkRVU1RSWSksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIGNhbGxiYWNrKCdFbXB0eSBSZXNwb25zZScsIG51bGwpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgICAgICAvL3RoaXMuaW1wb3J0SW5kdXN0cmllc1JlcG9zaXRvcnkuZmluZE9uZUFuZFVwZGF0ZSh7J19pZCc6IHJlc3BvbnNlWzBdLl9pZH0sIGl0ZW0sIHtuZXc6IHRydWV9LCBjYWxsYmFjayk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlYWRYbHN4KGZpbGVQYXRoOnN0cmluZywgY2FsbGJhY2s6KGVycm9yOmFueSwgcmVzdWx0OmFueSkgPT4gdm9pZCkge1xyXG4gICAgeGxzeGooe1xyXG4gICAgICBpbnB1dDogZmlsZVBhdGgsXHJcbiAgICAgIG91dHB1dDogbnVsbFxyXG4gICAgfSwgZnVuY3Rpb24gKGVycjphbnksIHJlc3VsdDphbnkpIHtcclxuICAgICAgbGV0IGlzU2VuZCA6IGJvb2xlYW4gPWZhbHNlO1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgIGNhbGxiYWNrKGVyciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIHJvbGVzQXJyYXk6YW55ID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lmxlbmd0aC0xOyBpKyspIHtcclxuICAgICAgICAgIGlmKHJlc3VsdFtpXS5hcmVhX29mX3dvcmtfY29kZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgaWYocmVzdWx0W2ldLmFyZWFfb2Zfd29ya19jb2RlID09PSAnJyAmJiByZXN1bHRbaV0uY2FwYWJpbGl0eSA9PT0nJyAmJiByZXN1bHRbaV0uY29tcGxleGl0eT09PScnKSB7XHJcbiAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICBpZighaXNTZW5kKSB7XHJcbiAgICAgICAgICAgICAgICBpc1NlbmQ9dHJ1ZTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihNZXNzYWdlcy5NU0dfRVJST1JfQVJFQV9PRl9XT1JLX0NPREVfTUlTU0lORysnIC0gJytyZXN1bHRbaV0uYXJlYV9vZl93b3JrKSxudWxsKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gaWYgKHJlc3VsdFtpXS5hcmVhX29mX3dvcmtfY29kZSA9PT0gJzk5OTk5JyAmJiByZXN1bHRbaV0uY2FwYWJpbGl0eSA9PT0nJyAmJiByZXN1bHRbaV0uY29tcGxleGl0eT09PScnKSB7XHJcbiAgICAgICAgICAgIHJvbGVzQXJyYXkgPSBSb2xlc1NlcnZpY2UuYWRkUm9sZShyZXN1bHRbaV0sIHJvbGVzQXJyYXkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcm9sZXNBcnJheSA9IFJvbGVzU2VydmljZS5hZGRSb2xlKHJlc3VsdFtpXSwgcm9sZXNBcnJheSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvbGVzQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIHZhciBjYXBhYmlsaXRpZXM6IGFueSA9IFtdO1xyXG4gICAgICAgICAgZm9yIChsZXQgaiA9IDE7IGogPCByZXN1bHQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3cgPSByZXN1bHRbal07XHJcbiAgICAgICAgICAgIGlmIChyb2xlc0FycmF5W2ldLm5hbWUgPT09IGN1cnJlbnRSb3cuYXJlYV9vZl93b3JrKSB7XHJcbiAgICAgICAgICAgICAgaWYocmVzdWx0W2pdLmNhcGFiaWxpdHlfY29kZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3VsdFtqXS5hcmVhX29mX3dvcmsgPT09ICcnICYmIHJlc3VsdFtqXS5jYXBhYmlsaXR5ID09PScnICYmIHJlc3VsdFtqXS5jb21wbGV4aXR5PT09JycpIHtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYocmVzdWx0W2pdLmFyZWFfb2Zfd29yayA9PT0gJ090aGVycycgJiYgcmVzdWx0W2pdLmNhcGFiaWxpdHkgPT09JycgJiYgcmVzdWx0W2pdLmNvbXBsZXhpdHk9PT0nJykge1xyXG4gICAgICAgICAgICAgICAgIC8vIGNhcGFiaWxpdGllcyA9IENhcGFiaWxpdGllc1NlcnZpY2UuYWRkQ2FwYWJpbGl0aWVzKHJlc3VsdFtqXSxjYXBhYmlsaXRpZXMpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBpZighaXNTZW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXNTZW5kPXRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9DQVBBQklMSVRZX0NPREVfTUlTU0lORysnIC0gJytyZXN1bHRbal0uY2FwYWJpbGl0eSksbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgY2FwYWJpbGl0aWVzID0gQ2FwYWJpbGl0aWVzU2VydmljZS5hZGRDYXBhYmlsaXRpZXMocmVzdWx0W2pdLCBjYXBhYmlsaXRpZXMpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHJvbGVzQXJyYXlbaV0uY2FwYWJpbGl0aWVzID0gY2FwYWJpbGl0aWVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJvbGVzQXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGZvciAobGV0IGNhcEluZGV4ID0gMDsgY2FwSW5kZXggPCByb2xlc0FycmF5W2ldLmNhcGFiaWxpdGllcy5sZW5ndGg7IGNhcEluZGV4KyspIHtcclxuICAgICAgICAgICAgbGV0IGNvbXBsZXhpdGllczphbnkgPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCByZXN1bHQubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICBsZXQgY3VycmVudFJvdyA9IHJlc3VsdFtqXTtcclxuICAgICAgICAgICAgICBpZiAocm9sZXNBcnJheVtpXS5uYW1lID09PSBjdXJyZW50Um93LmFyZWFfb2Zfd29yaykge1xyXG4gICAgICAgICAgICAgIGlmIChyb2xlc0FycmF5W2ldLmNhcGFiaWxpdGllc1tjYXBJbmRleF0ubmFtZSA9PT0gY3VycmVudFJvdy5jYXBhYmlsaXR5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0W2pdLmNvbXBsZXhpdHlfY29kZSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdFtqXS5hcmVhX29mX3dvcmsgPT09ICcnICYmIHJlc3VsdFtqXS5jYXBhYmlsaXR5ID09PSAnJyAmJiByZXN1bHRbal0uY29tcGxleGl0eSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICBlbHNlIGlmKHJlc3VsdFtqXS5hcmVhX29mX3dvcmsgPT09ICdPdGhlcnMnICYmIHJlc3VsdFtqXS5jYXBhYmlsaXR5ID09PSAnJyAmJiByZXN1bHRbal0uY29tcGxleGl0eSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbXBsZXhpdGllcyA9IENvbXBsZXhpdGllc1NlcnZpY2UuYWRkQ29tcGxleGl0aWVzKHJlc3VsdFtqXSwgY29tcGxleGl0aWVzKTtcclxuICAgICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNTZW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpc1NlbmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9DT01QTEVYSVRZX0NPREVfTUlTU0lORysnIC0gJyArIHJlc3VsdFtqXS5jb21wbGV4aXR5KSwgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb21wbGV4aXRpZXMgPSBDb21wbGV4aXRpZXNTZXJ2aWNlLmFkZENvbXBsZXhpdGllcyhyZXN1bHRbal0sIGNvbXBsZXhpdGllcyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcm9sZXNBcnJheVtpXS5jYXBhYmlsaXRpZXNbY2FwSW5kZXhdLmNvbXBsZXhpdGllcyA9IGNvbXBsZXhpdGllcztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9sZXNBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgcm9sZXNBcnJheVtpXS5kZWZhdWx0X2NvbXBsZXhpdGllcyA9IG5ldyBBcnJheSgwKTtcclxuICAgICAgICAgIGxldCB0ZW1wID0gbmV3IEFycmF5KDApO1xyXG4gICAgICAgICAgZm9yIChsZXQgYyBpbiByb2xlc0FycmF5W2ldLmNhcGFiaWxpdGllcykge1xyXG4gICAgICAgICAgICAvL2lmKHJvbGVzQXJyYXlbaV0ubmFtZSA9PSAnSVQgU3VwcG9ydCcpe1xyXG4gICAgICAgICAgICBpZiAocm9sZXNBcnJheVtpXS5jYXBhYmlsaXRpZXNbY10uY29kZS5zdGFydHNXaXRoKCdkJykpIHtcclxuICAgICAgICAgICAgICBsZXQgdGVtcENvZGUgPSByb2xlc0FycmF5W2ldLmNhcGFiaWxpdGllc1tjXS5jb2RlLnNwbGl0KFwiZFwiKVsxXTtcclxuICAgICAgICAgICAgICByb2xlc0FycmF5W2ldLmNhcGFiaWxpdGllc1tjXS5jb2RlID0gdGVtcENvZGU7XHJcbiAgICAgICAgICAgICAgcm9sZXNBcnJheVtpXS5kZWZhdWx0X2NvbXBsZXhpdGllcy5wdXNoKHJvbGVzQXJyYXlbaV0uY2FwYWJpbGl0aWVzW2NdKTtcclxuICAgICAgICAgICAgICB0ZW1wLnB1c2goYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKHRlbXAubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCB0ID0gdGVtcC5sZW5ndGggLSAxOyB0ID49IDA7IHQtLSkge1xyXG4gICAgICAgICAgICAgIHJvbGVzQXJyYXlbaV0uY2FwYWJpbGl0aWVzLnNwbGljZSh0ZW1wW3RdLCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICBpZiAocm9sZXNBcnJheVtpXS5uYW1lID09PSAnJykge1xyXG4gICAgICAgICAgICByb2xlc0FycmF5LnNwbGljZShpLCAxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8qZm9yIChsZXQgaSA9IDA7IGkgPCByb2xlc0FycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgIHJvbGVzQXJyYXlbaV0uZGVmYXVsdF9jb21wbGV4aXRpZXMgPSBuZXcgQXJyYXkoMCk7XHJcbiAgICAgICAgICBpZiAocm9sZXNBcnJheVtpXS5jYXBhYmlsaXRpZXNbMF0ubmFtZS5zdGFydHNXaXRoKCdEZWZhdWx0JykpIHtcclxuICAgICAgICAgICAgcm9sZXNBcnJheVtpXS5kZWZhdWx0X2NvbXBsZXhpdGllcy5wdXNoKHJvbGVzQXJyYXlbaV0uY2FwYWJpbGl0aWVzWzBdKTtcclxuICAgICAgICAgICAgcm9sZXNBcnJheVtpXS5jYXBhYmlsaXRpZXMuc2hpZnQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChyb2xlc0FycmF5W2ldLm5hbWUgPT09ICcnKSB7XHJcbiAgICAgICAgICAgIHJvbGVzQXJyYXkuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICB9Ki9cclxuXHJcbiAgICAgICAgbGV0IGluZHVzdHJ5ID0gbmV3IEltcG9ydEluZHVzdHJpZXNNb2RlbChyZXN1bHRbMF0uaW5kdXN0cnksIHJlc3VsdFswXS5jb2RlLHJlc3VsdFswXS5zb3J0X29yZGVyLHJvbGVzQXJyYXkpO1xyXG4gICAgICAgIGlmKCFpc1NlbmQpIHtcclxuICAgICAgICAgIGlmKHJlc3VsdFswXS5jb2RlPT09Jyd8fHJlc3VsdFswXS5zb3J0X29yZGVyPT09Jyd8fHJlc3VsdFswXS5jb2RlPT09dW5kZWZpbmVkfHxyZXN1bHRbMF0uc29ydF9vcmRlcj09PXVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX0lORFVTVFJZX0NPREVfT1JfU09SVF9OVU1CRVJfTUlTU0lORysnIC0gJyArIHJlc3VsdFswXS5pbmR1c3RyeSksIG51bGwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgaW5kdXN0cnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5PYmplY3Quc2VhbChJbXBvcnRJbmR1c3RyeVNlcnZpY2UpO1xyXG5leHBvcnQgPSBJbXBvcnRJbmR1c3RyeVNlcnZpY2U7XHJcbiJdfQ==
