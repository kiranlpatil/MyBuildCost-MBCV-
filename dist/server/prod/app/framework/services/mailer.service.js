"use strict";
var nodemailer = require("nodemailer");
var MailAttachments = require("../shared/sharedarray");
var LoggerService = require("../shared/logger/LoggerService");
var fs = require("fs");
var path = require("path");
var config = require('config');
var loggerService = new LoggerService('MAILCHIMP_MAILER_SERVICE');
var SendMailService = (function () {
    function SendMailService() {
    }
    SendMailService.prototype.send = function (sendmailTo, subject, templateName, data, callback, carbonCopy, attachment) {
        var content = fs.readFileSync(path.resolve() + config.get('application.publicPath') + 'templates/' + templateName).toString();
        data.forEach(function (value, key) {
            content = content.replace(key, value);
        });
        var mailOptions = {
            from: config.get('application.mail.MAIL_SENDER'),
            to: sendmailTo,
            cc: carbonCopy,
            subject: subject,
            html: content,
            attachments: attachment ? attachment : MailAttachments.AttachmentArray
        };
        SendMailService.smtpTransport.sendMail(mailOptions, function (error, response) {
            if (error) {
                loggerService.logError(' Error in mail send ' + error);
            }
            callback(error, response);
        });
    };
    SendMailService.smtpTransport = nodemailer.createTransport({
        service: config.get('application.mail.MAIL_SERVICE'),
        auth: {
            user: config.get('application.mail.MAIL_SENDER'),
            pass: config.get('application.mail.MAIL_SENDER_PASSWORD')
        }
    });
    return SendMailService;
}());
Object.seal(SendMailService);
module.exports = SendMailService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvbWFpbGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHVDQUF5QztBQUN6Qyx1REFBMEQ7QUFDMUQsOERBQWlFO0FBQ2pFLHVCQUF5QjtBQUN6QiwyQkFBNkI7QUFHN0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksYUFBYSxHQUFHLElBQUksYUFBYSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFFbEU7SUFBQTtJQWlDQSxDQUFDO0lBeEJDLDhCQUFJLEdBQUosVUFBSyxVQUFrQixFQUFFLE9BQWUsRUFBRSxZQUFvQixFQUN6RCxJQUF5QixFQUN6QixRQUF5RCxFQUFFLFVBQW1CLEVBQUMsVUFBZTtRQUVqRyxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLEdBQUcsWUFBWSxHQUFHLFlBQVksQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlILElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQyxLQUFhLEVBQUUsR0FBVztZQUN0QyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLFdBQVcsR0FBRztZQUNoQixJQUFJLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQztZQUNoRCxFQUFFLEVBQUUsVUFBVTtZQUNkLEVBQUUsRUFBRSxVQUFVO1lBQ2QsT0FBTyxFQUFFLE9BQU87WUFDaEIsSUFBSSxFQUFFLE9BQU87WUFDYixXQUFXLEVBQUMsVUFBVSxHQUFDLFVBQVUsR0FBRSxlQUFlLENBQUMsZUFBZTtTQUNuRSxDQUFDO1FBQ0YsZUFBZSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLFVBQVUsS0FBWSxFQUFFLFFBQXlCO1lBQ25HLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsYUFBYSxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsR0FBRyxLQUFLLENBQUMsQ0FBQztZQUN6RCxDQUFDO1lBQ0QsUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUEvQk0sNkJBQWEsR0FBRyxVQUFVLENBQUMsZUFBZSxDQUFDO1FBQ2hELE9BQU8sRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLCtCQUErQixDQUFDO1FBQ3BELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDO1lBQ2hELElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLHVDQUF1QyxDQUFDO1NBQzFEO0tBQ0YsQ0FBQyxDQUFDO0lBMEJMLHNCQUFDO0NBakNELEFBaUNDLElBQUE7QUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzdCLGlCQUFTLGVBQWUsQ0FBQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NlcnZpY2VzL21haWxlci5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbm9kZW1haWxlciBmcm9tICdub2RlbWFpbGVyJztcclxuaW1wb3J0IE1haWxBdHRhY2htZW50cyA9IHJlcXVpcmUoJy4uL3NoYXJlZC9zaGFyZWRhcnJheScpO1xyXG5pbXBvcnQgTG9nZ2VyU2VydmljZSA9IHJlcXVpcmUoJy4uL3NoYXJlZC9sb2dnZXIvTG9nZ2VyU2VydmljZScpO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IFNlbnRNZXNzYWdlSW5mbyB9IGZyb20gJ25vZGVtYWlsZXInO1xyXG5cclxubGV0IGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xyXG5sZXQgbG9nZ2VyU2VydmljZSA9IG5ldyBMb2dnZXJTZXJ2aWNlKCdNQUlMQ0hJTVBfTUFJTEVSX1NFUlZJQ0UnKTtcclxuXHJcbmNsYXNzIFNlbmRNYWlsU2VydmljZSB7XHJcbiAgc3RhdGljIHNtdHBUcmFuc3BvcnQgPSBub2RlbWFpbGVyLmNyZWF0ZVRyYW5zcG9ydCh7XHJcbiAgICBzZXJ2aWNlOiBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5tYWlsLk1BSUxfU0VSVklDRScpLFxyXG4gICAgYXV0aDoge1xyXG4gICAgICB1c2VyOiBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5tYWlsLk1BSUxfU0VOREVSJyksXHJcbiAgICAgIHBhc3M6IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuTUFJTF9TRU5ERVJfUEFTU1dPUkQnKVxyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBzZW5kKHNlbmRtYWlsVG86IHN0cmluZywgc3ViamVjdDogc3RyaW5nLCB0ZW1wbGF0ZU5hbWU6IHN0cmluZyxcclxuICAgICAgIGRhdGE6IE1hcDxzdHJpbmcsIHN0cmluZz4sXHJcbiAgICAgICBjYWxsYmFjazogKGVycm9yOiBFcnJvciwgcmVzdWx0OiBTZW50TWVzc2FnZUluZm8pID0+IHZvaWQsIGNhcmJvbkNvcHk/OiBzdHJpbmcsYXR0YWNobWVudD86YW55KSB7XHJcblxyXG4gICAgbGV0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5yZXNvbHZlKCkgKyBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5wdWJsaWNQYXRoJykgKyAndGVtcGxhdGVzLycgKyB0ZW1wbGF0ZU5hbWUpLnRvU3RyaW5nKCk7XHJcbiAgICBkYXRhLmZvckVhY2goKHZhbHVlOiBzdHJpbmcsIGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2Uoa2V5LCB2YWx1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgbWFpbE9wdGlvbnMgPSB7XHJcbiAgICAgIGZyb206IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuTUFJTF9TRU5ERVInKSxcclxuICAgICAgdG86IHNlbmRtYWlsVG8sXHJcbiAgICAgIGNjOiBjYXJib25Db3B5LFxyXG4gICAgICBzdWJqZWN0OiBzdWJqZWN0LFxyXG4gICAgICBodG1sOiBjb250ZW50LFxyXG4gICAgICBhdHRhY2htZW50czphdHRhY2htZW50P2F0dGFjaG1lbnQ6IE1haWxBdHRhY2htZW50cy5BdHRhY2htZW50QXJyYXlcclxuICAgIH07XHJcbiAgICBTZW5kTWFpbFNlcnZpY2Uuc210cFRyYW5zcG9ydC5zZW5kTWFpbChtYWlsT3B0aW9ucywgZnVuY3Rpb24gKGVycm9yOiBFcnJvciwgcmVzcG9uc2U6IFNlbnRNZXNzYWdlSW5mbykge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBsb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKCcgRXJyb3IgaW4gbWFpbCBzZW5kICcgKyBlcnJvcik7XHJcbiAgICAgIH1cclxuICAgICAgY2FsbGJhY2soZXJyb3IsIHJlc3BvbnNlKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoU2VuZE1haWxTZXJ2aWNlKTtcclxuZXhwb3J0ID0gU2VuZE1haWxTZXJ2aWNlO1xyXG4iXX0=
