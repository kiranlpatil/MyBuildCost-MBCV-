"use strict";
var nodemailer = require("nodemailer");
var LoggerService = require("../shared/logger/LoggerService");
var fs = require("fs");
var path = require("path");
var config = require('config');
var loggerService = new LoggerService('MAILCHIMP_MAILER_SERVICE');
var SendMailService = (function () {
    function SendMailService() {
    }
    SendMailService.prototype.send = function (sendmailTo, subject, templateName, data, attachment, callback, carbonCopy) {
        var content = fs.readFileSync(path.resolve() + config.get('application.publicPath') + 'templates/' + templateName).toString();
        data.forEach(function (value, key) {
            content = content.replace(key, value);
        });
        loggerService.logDebug('Sending mail from mail service.');
        var mailOptions = {
            from: config.get('application.mail.MAIL_SENDER'),
            to: sendmailTo,
            cc: carbonCopy,
            subject: subject,
            html: content,
            attachments: attachment
        };
        SendMailService.smtpTransport.sendMail(mailOptions, function (error, response) {
            if (error) {
                loggerService.logError(' Error in mail send ' + error);
            }
            loggerService.logDebug(' response in mail send ' + response);
            callback(error, response);
        });
    };
    SendMailService.smtpTransport = nodemailer.createTransport({
        service: config.get('application.mail.MAIL_SERVICE'),
        auth: {
            user: config.get('application.mail.MAIL_SENDER'),
            pass: config.get('application.mail.MAIL_SENDER_PASSWORD')
        },
        tls: { rejectUnauthorized: false }
    });
    return SendMailService;
}());
Object.seal(SendMailService);
module.exports = SendMailService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvbWFpbGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHVDQUF5QztBQUV6Qyw4REFBaUU7QUFDakUsdUJBQXlCO0FBQ3pCLDJCQUE2QjtBQUc3QixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxhQUFhLEdBQUcsSUFBSSxhQUFhLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUVsRTtJQUFBO0lBc0NBLENBQUM7SUEzQkMsOEJBQUksR0FBSixVQUFLLFVBQWtCLEVBQUUsT0FBZSxFQUFFLFlBQW9CLEVBQ3pELElBQXlCLEVBQUUsVUFBaUIsRUFDNUMsUUFBeUQsRUFBRSxVQUFtQjtRQUVqRixJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLEdBQUcsWUFBWSxHQUFHLFlBQVksQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzlILElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQyxLQUFhLEVBQUUsR0FBVztZQUN0QyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxhQUFhLENBQUMsUUFBUSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFFMUQsSUFBSSxXQUFXLEdBQUc7WUFDaEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsOEJBQThCLENBQUM7WUFDaEQsRUFBRSxFQUFFLFVBQVU7WUFDZCxFQUFFLEVBQUUsVUFBVTtZQUNkLE9BQU8sRUFBRSxPQUFPO1lBQ2hCLElBQUksRUFBRSxPQUFPO1lBQ2IsV0FBVyxFQUFDLFVBQVU7U0FFdkIsQ0FBQztRQUNGLGVBQWUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxVQUFVLEtBQVksRUFBRSxRQUF5QjtZQUNuRyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNWLGFBQWEsQ0FBQyxRQUFRLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDLENBQUM7WUFDekQsQ0FBQztZQUNELGFBQWEsQ0FBQyxRQUFRLENBQUMseUJBQXlCLEdBQUcsUUFBUSxDQUFDLENBQUM7WUFDN0QsUUFBUSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFuQ00sNkJBQWEsR0FBRyxVQUFVLENBQUMsZUFBZSxDQUFDO1FBQ2hELE9BQU8sRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLCtCQUErQixDQUFDO1FBQ3BELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDO1lBQ2hELElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLHVDQUF1QyxDQUFDO1NBQzFEO1FBQ0QsR0FBRyxFQUFFLEVBQUUsa0JBQWtCLEVBQUUsS0FBSyxFQUFFO0tBQ25DLENBQUMsQ0FBQztJQTZCTCxzQkFBQztDQXRDRCxBQXNDQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUM3QixpQkFBUyxlQUFlLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zZXJ2aWNlcy9tYWlsZXIuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIG5vZGVtYWlsZXIgZnJvbSAnbm9kZW1haWxlcic7XHJcbmltcG9ydCBNYWlsQXR0YWNobWVudHMgPSByZXF1aXJlKCcuLi9zaGFyZWQvc2hhcmVkYXJyYXknKTtcclxuaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKCcuLi9zaGFyZWQvbG9nZ2VyL0xvZ2dlclNlcnZpY2UnKTtcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xyXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyBTZW50TWVzc2FnZUluZm8gfSBmcm9tICdub2RlbWFpbGVyJztcclxuXHJcbmxldCBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcclxubGV0IGxvZ2dlclNlcnZpY2UgPSBuZXcgTG9nZ2VyU2VydmljZSgnTUFJTENISU1QX01BSUxFUl9TRVJWSUNFJyk7XHJcblxyXG5jbGFzcyBTZW5kTWFpbFNlcnZpY2Uge1xyXG4gIC8vcHJvY2Vzcy5lbnYuTk9ERV9UTFNfUkVKRUNUX1VOQVVUSE9SSVpFRCA6IGFueSA9ICcwJztcclxuICBzdGF0aWMgc210cFRyYW5zcG9ydCA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcclxuICAgIHNlcnZpY2U6IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuTUFJTF9TRVJWSUNFJyksXHJcbiAgICBhdXRoOiB7XHJcbiAgICAgIHVzZXI6IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuTUFJTF9TRU5ERVInKSxcclxuICAgICAgcGFzczogY29uZmlnLmdldCgnYXBwbGljYXRpb24ubWFpbC5NQUlMX1NFTkRFUl9QQVNTV09SRCcpXHJcbiAgICB9LFxyXG4gICAgdGxzOiB7IHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UgfVxyXG4gIH0pO1xyXG5cclxuICBzZW5kKHNlbmRtYWlsVG86IHN0cmluZywgc3ViamVjdDogc3RyaW5nLCB0ZW1wbGF0ZU5hbWU6IHN0cmluZyxcclxuICAgICAgIGRhdGE6IE1hcDxzdHJpbmcsIHN0cmluZz4sIGF0dGFjaG1lbnQ/OmFueVtdLFxyXG4gICAgICAgY2FsbGJhY2s6IChlcnJvcjogRXJyb3IsIHJlc3VsdDogU2VudE1lc3NhZ2VJbmZvKSA9PiB2b2lkLCBjYXJib25Db3B5Pzogc3RyaW5nKSB7XHJcblxyXG4gICAgbGV0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5yZXNvbHZlKCkgKyBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5wdWJsaWNQYXRoJykgKyAndGVtcGxhdGVzLycgKyB0ZW1wbGF0ZU5hbWUpLnRvU3RyaW5nKCk7XHJcbiAgICBkYXRhLmZvckVhY2goKHZhbHVlOiBzdHJpbmcsIGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2Uoa2V5LCB2YWx1ZSk7XHJcbiAgICB9KTtcclxuICAgIGxvZ2dlclNlcnZpY2UubG9nRGVidWcoJ1NlbmRpbmcgbWFpbCBmcm9tIG1haWwgc2VydmljZS4nKTtcclxuXHJcbiAgICBsZXQgbWFpbE9wdGlvbnMgPSB7XHJcbiAgICAgIGZyb206IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuTUFJTF9TRU5ERVInKSxcclxuICAgICAgdG86IHNlbmRtYWlsVG8sXHJcbiAgICAgIGNjOiBjYXJib25Db3B5LFxyXG4gICAgICBzdWJqZWN0OiBzdWJqZWN0LFxyXG4gICAgICBodG1sOiBjb250ZW50LFxyXG4gICAgICBhdHRhY2htZW50czphdHRhY2htZW50XHJcbiAgICAgIC8qYXR0YWNobWVudD9hdHRhY2htZW50OiBNYWlsQXR0YWNobWVudHMuV2VsY29tZUFib2FyZEF0dGFjaG1lbnRBcnJheSovXHJcbiAgICB9O1xyXG4gICAgU2VuZE1haWxTZXJ2aWNlLnNtdHBUcmFuc3BvcnQuc2VuZE1haWwobWFpbE9wdGlvbnMsIGZ1bmN0aW9uIChlcnJvcjogRXJyb3IsIHJlc3BvbnNlOiBTZW50TWVzc2FnZUluZm8pIHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgbG9nZ2VyU2VydmljZS5sb2dFcnJvcignIEVycm9yIGluIG1haWwgc2VuZCAnICsgZXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICAgIGxvZ2dlclNlcnZpY2UubG9nRGVidWcoJyByZXNwb25zZSBpbiBtYWlsIHNlbmQgJyArIHJlc3BvbnNlKTtcclxuICAgICAgY2FsbGJhY2soZXJyb3IsIHJlc3BvbnNlKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoU2VuZE1haWxTZXJ2aWNlKTtcclxuZXhwb3J0ID0gU2VuZE1haWxTZXJ2aWNlO1xyXG4iXX0=
