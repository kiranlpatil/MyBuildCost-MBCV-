"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/user.repository");
var config = require('config');
var authKey = config.get('TplSeed.messaging.authKey');
var senderId = config.get('TplSeed.messaging.senderId');
var routerNumber = config.get('TplSeed.messaging.routerNumber');
var msg91 = require("msg91")(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.app_name = ProjectAsset.APP_NAME;
        this.userRepository = new UserRepository();
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        var otp = Math.floor((Math.random() * 99999) + 100000);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + otp + " " + ".Use this OTP to verify your account. ";
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        var message = 'The One Time Password(OTP) to change your number from ' + Data.current_mobile_number + ' to ' + Data.mobileNo + ' of your ' + this.app_name + ' account is ' + Data.otp + '.Use this OTP to complete verification.';
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx5RUFBNEU7QUFDNUUsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2hFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFDdEMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLHdDQUF3QyxDQUFDO1FBQ3hKLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxVQUFVLEdBQVEsRUFBRSxRQUFhO1lBQzdELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDSixRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCw4Q0FBaUIsR0FBakIsVUFBa0IsSUFBUyxFQUFFLFFBQWE7UUFFeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTFDLElBQUksT0FBTyxHQUFHLGlDQUFpQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsR0FBRyxZQUFZLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLHdDQUF3QyxDQUFDO1FBQzdKLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxVQUFVLEdBQVEsRUFBRSxRQUFhO1lBQ2xFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDSixRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxvREFBdUIsR0FBdkIsVUFBd0IsSUFBUyxFQUFFLFFBQWE7UUFFOUMsSUFBSSxPQUFPLEdBQUcsd0RBQXdELEdBQUUsSUFBSSxDQUFDLHFCQUFxQixHQUFFLE1BQU0sR0FBRSxJQUFJLENBQUMsUUFBUSxHQUFFLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFFLGNBQWMsR0FBRSxJQUFJLENBQUMsR0FBRyxHQUFHLHlDQUF5QyxDQUFDO1FBQzdOLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxHQUFRLEVBQUUsUUFBYTtZQUNsRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNSLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMseUJBQXlCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMzQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgseUJBQUM7QUFBRCxDQWxEQSxBQWtEQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hDLGlCQUFTLGtCQUFrQixDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3NoYXJlZC9wcm9qZWN0YXNzZXQudHNcIi8+XG5pbXBvcnQgTWVzc2FnZXM9cmVxdWlyZShcIi4uL3NoYXJlZC9tZXNzYWdlc1wiKTtcbmltcG9ydCBQcm9qZWN0QXNzZXQgPSByZXF1aXJlKFwiLi4vc2hhcmVkL3Byb2plY3Rhc3NldFwiKTtcbmltcG9ydCBVc2VyUmVwb3NpdG9yeSA9IHJlcXVpcmUoXCIuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvdXNlci5yZXBvc2l0b3J5XCIpO1xudmFyIGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xudmFyIGF1dGhLZXkgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5hdXRoS2V5Jyk7XG52YXIgc2VuZGVySWQgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5zZW5kZXJJZCcpO1xudmFyIHJvdXRlck51bWJlciA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWVzc2FnaW5nLnJvdXRlck51bWJlcicpO1xudmFyIG1zZzkxID0gcmVxdWlyZShcIm1zZzkxXCIpKGF1dGhLZXksIHNlbmRlcklkLCByb3V0ZXJOdW1iZXIpO1xuXG5cbmNsYXNzIFNlbmRNZXNzYWdlU2VydmljZSB7XG4gIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xuICBhcHBfbmFtZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYXBwX25hbWUgPSBQcm9qZWN0QXNzZXQuQVBQX05BTUU7XG4gICAgdGhpcy51c2VyUmVwb3NpdG9yeSA9IG5ldyBVc2VyUmVwb3NpdG9yeSgpO1xuICB9XG5cbiAgc2VuZE1lc3NhZ2UobW9iaWxlTm86IGFueSwgY2FsbGJhY2s6IGFueSkge1xuICAgIHZhciBvdHAgPSBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogOTk5OTkpICsgMTAwMDAwKTtcbiAgICB2YXIgbWVzc2FnZSA9IFwiVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgZm9yIFwiICsgXCIgXCIgKyB0aGlzLmFwcF9uYW1lICsgXCIgXCIgKyBcImFjY291bnQgaXNcIiArIFwiIFwiICsgb3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4gXCI7XG4gICAgbXNnOTEuc2VuZChtb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihNZXNzYWdlcy5NU0dfRVJST1JfTUVTU0FHRV9TRU5ESU5HKSwgbnVsbCk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc2VuZE1lc3NhZ2VEaXJlY3QoRGF0YTogYW55LCBjYWxsYmFjazogYW55KSB7XG5cbiAgICBjb25zb2xlLmxvZyhcIlNlbmQgc21zIG9uXCIsIERhdGEubW9iaWxlTm8pO1xuXG4gICAgdmFyIG1lc3NhZ2UgPSBcIlRoZSBPbmUgVGltZSBQYXNzd29yZChPVFApIGZvciBcIiArIFwiIFwiICsgdGhpcy5hcHBfbmFtZSArIFwiIFwiICsgXCJhY2NvdW50IGlzXCIgKyBcIiBcIiArIERhdGEub3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4gXCI7XG4gICAgY29uc29sZS5sb2coXCJtc2cgc2VudCB0byB1c2VyOlwiLCBtZXNzYWdlKTtcbiAgICBtc2c5MS5zZW5kKERhdGEubW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHNlbmRDaGFuZ2VNb2JpbGVNZXNzYWdlKERhdGE6IGFueSwgY2FsbGJhY2s6IGFueSkge1xuXG4gICAgbGV0IG1lc3NhZ2UgPSAnVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgdG8gY2hhbmdlIHlvdXIgbnVtYmVyIGZyb20gJysgRGF0YS5jdXJyZW50X21vYmlsZV9udW1iZXIgKycgdG8gJysgRGF0YS5tb2JpbGVObyArJyBvZiB5b3VyICcgKyB0aGlzLmFwcF9uYW1lICsnIGFjY291bnQgaXMgJysgRGF0YS5vdHAgKyAnLlVzZSB0aGlzIE9UUCB0byBjb21wbGV0ZSB2ZXJpZmljYXRpb24uJztcbiAgICBtc2c5MS5zZW5kKERhdGEubW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xuICAgICAgfWVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxufVxuXG5PYmplY3Quc2VhbChTZW5kTWVzc2FnZVNlcnZpY2UpO1xuZXhwb3J0ID0gU2VuZE1lc3NhZ2VTZXJ2aWNlO1xuIl19
