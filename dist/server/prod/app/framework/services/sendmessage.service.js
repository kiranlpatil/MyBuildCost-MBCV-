"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/user.repository");
var config = require('config');
var authKey = config.get('TplSeed.messaging.authKey');
var senderId = config.get('TplSeed.messaging.senderId');
var routerNumber = config.get('TplSeed.messaging.routerNumber');
var msg91 = require("msg91")(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.app_name = ProjectAsset.APP_NAME;
        this.userRepository = new UserRepository();
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        var otp = Math.floor((Math.random() * 99999) + 100000);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + otp + " " + ".Use this OTP to verify your account. ";
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        var message = 'The One Time Password(OTP) to change your number from ' + Data.current_mobile_number + ' to ' + Data.mobileNo + ' of your ' + this.app_name + ' account is ' + Data.otp + '.Use this OTP to complete verification.';
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx5RUFBNEU7QUFDNUUsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2hFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFDdEMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLHdDQUF3QyxDQUFDO1FBQ3hKLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxVQUFVLEdBQVEsRUFBRSxRQUFhO1lBQzdELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDSixRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCw4Q0FBaUIsR0FBakIsVUFBa0IsSUFBUyxFQUFFLFFBQWE7UUFFeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTFDLElBQUksT0FBTyxHQUFHLGlDQUFpQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsR0FBRyxZQUFZLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLHdDQUF3QyxDQUFDO1FBQzdKLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxVQUFVLEdBQVEsRUFBRSxRQUFhO1lBQ2xFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDSixRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzNCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxvREFBdUIsR0FBdkIsVUFBd0IsSUFBUyxFQUFFLFFBQWE7UUFFOUMsSUFBSSxPQUFPLEdBQUcsd0RBQXdELEdBQUUsSUFBSSxDQUFDLHFCQUFxQixHQUFFLE1BQU0sR0FBRSxJQUFJLENBQUMsUUFBUSxHQUFFLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFFLGNBQWMsR0FBRSxJQUFJLENBQUMsR0FBRyxHQUFHLHlDQUF5QyxDQUFDO1FBQzdOLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxHQUFRLEVBQUUsUUFBYTtZQUNsRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNSLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMseUJBQXlCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQUEsSUFBSSxDQUFDLENBQUM7Z0JBQ0wsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMzQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgseUJBQUM7QUFBRCxDQWxEQSxBQWtEQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hDLGlCQUFTLGtCQUFrQixDQUFDIiwiZmlsZSI6ImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL3NoYXJlZC9wcm9qZWN0YXNzZXQudHNcIi8+XHJcbmltcG9ydCBNZXNzYWdlcz1yZXF1aXJlKFwiLi4vc2hhcmVkL21lc3NhZ2VzXCIpO1xyXG5pbXBvcnQgUHJvamVjdEFzc2V0ID0gcmVxdWlyZShcIi4uL3NoYXJlZC9wcm9qZWN0YXNzZXRcIik7XHJcbmltcG9ydCBVc2VyUmVwb3NpdG9yeSA9IHJlcXVpcmUoXCIuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvdXNlci5yZXBvc2l0b3J5XCIpO1xyXG52YXIgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbnZhciBhdXRoS2V5ID0gY29uZmlnLmdldCgnVHBsU2VlZC5tZXNzYWdpbmcuYXV0aEtleScpO1xyXG52YXIgc2VuZGVySWQgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5zZW5kZXJJZCcpO1xyXG52YXIgcm91dGVyTnVtYmVyID0gY29uZmlnLmdldCgnVHBsU2VlZC5tZXNzYWdpbmcucm91dGVyTnVtYmVyJyk7XHJcbnZhciBtc2c5MSA9IHJlcXVpcmUoXCJtc2c5MVwiKShhdXRoS2V5LCBzZW5kZXJJZCwgcm91dGVyTnVtYmVyKTtcclxuXHJcblxyXG5jbGFzcyBTZW5kTWVzc2FnZVNlcnZpY2Uge1xyXG4gIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xyXG4gIGFwcF9uYW1lOiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5hcHBfbmFtZSA9IFByb2plY3RBc3NldC5BUFBfTkFNRTtcclxuICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSBuZXcgVXNlclJlcG9zaXRvcnkoKTtcclxuICB9XHJcblxyXG4gIHNlbmRNZXNzYWdlKG1vYmlsZU5vOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcclxuICAgIHZhciBvdHAgPSBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogOTk5OTkpICsgMTAwMDAwKTtcclxuICAgIHZhciBtZXNzYWdlID0gXCJUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSBmb3IgXCIgKyBcIiBcIiArIHRoaXMuYXBwX25hbWUgKyBcIiBcIiArIFwiYWNjb3VudCBpc1wiICsgXCIgXCIgKyBvdHAgKyBcIiBcIiArIFwiLlVzZSB0aGlzIE9UUCB0byB2ZXJpZnkgeW91ciBhY2NvdW50LiBcIjtcclxuICAgIG1zZzkxLnNlbmQobW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZE1lc3NhZ2VEaXJlY3QoRGF0YTogYW55LCBjYWxsYmFjazogYW55KSB7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJTZW5kIHNtcyBvblwiLCBEYXRhLm1vYmlsZU5vKTtcclxuXHJcbiAgICB2YXIgbWVzc2FnZSA9IFwiVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgZm9yIFwiICsgXCIgXCIgKyB0aGlzLmFwcF9uYW1lICsgXCIgXCIgKyBcImFjY291bnQgaXNcIiArIFwiIFwiICsgRGF0YS5vdHAgKyBcIiBcIiArIFwiLlVzZSB0aGlzIE9UUCB0byB2ZXJpZnkgeW91ciBhY2NvdW50LiBcIjtcclxuICAgIGNvbnNvbGUubG9nKFwibXNnIHNlbnQgdG8gdXNlcjpcIiwgbWVzc2FnZSk7XHJcbiAgICBtc2c5MS5zZW5kKERhdGEubW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZENoYW5nZU1vYmlsZU1lc3NhZ2UoRGF0YTogYW55LCBjYWxsYmFjazogYW55KSB7XHJcblxyXG4gICAgbGV0IG1lc3NhZ2UgPSAnVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgdG8gY2hhbmdlIHlvdXIgbnVtYmVyIGZyb20gJysgRGF0YS5jdXJyZW50X21vYmlsZV9udW1iZXIgKycgdG8gJysgRGF0YS5tb2JpbGVObyArJyBvZiB5b3VyICcgKyB0aGlzLmFwcF9uYW1lICsnIGFjY291bnQgaXMgJysgRGF0YS5vdHAgKyAnLlVzZSB0aGlzIE9UUCB0byBjb21wbGV0ZSB2ZXJpZmljYXRpb24uJztcclxuICAgIG1zZzkxLnNlbmQoRGF0YS5tb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9ZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzcG9uc2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5PYmplY3Quc2VhbChTZW5kTWVzc2FnZVNlcnZpY2UpO1xyXG5leHBvcnQgPSBTZW5kTWVzc2FnZVNlcnZpY2U7XHJcbiJdfQ==
