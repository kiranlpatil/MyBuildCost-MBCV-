"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/user.repository");
var config = require('config');
var authKey = config.get('TplSeed.messaging.authKey');
var senderId = config.get('TplSeed.messaging.senderId');
var routerNumber = config.get('TplSeed.messaging.routerNumber');
var msg91 = require("msg91")(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.app_name = ProjectAsset.APP_NAME;
        this.userRepository = new UserRepository();
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        console.log("Send sms on", mobileNo);
        var otp = Math.floor((Math.random() * 99999) + 100000);
        console.log("otp is", otp);
        console.log('sender id', senderId);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
                console.log(response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                console.log("message sent error", err);
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) to change your number from" + " " + Data.current_mobile_number + " " + "to" + " " + Data.mobileNo + " " + "of" + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to complete verification.";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx5RUFBNEU7QUFDNUUsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2hFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFFdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDckMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVuQyxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FB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O0FBQUQsQ0E3REEsQUE2REMsSUFBQTtBQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNoQyxpQkFBUyxrQkFBa0IsQ0FBQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NlcnZpY2VzL3NlbmRtZXNzYWdlLnNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9zaGFyZWQvcHJvamVjdGFzc2V0LnRzXCIvPlxuaW1wb3J0IE1lc3NhZ2VzPXJlcXVpcmUoXCIuLi9zaGFyZWQvbWVzc2FnZXNcIik7XG5pbXBvcnQgUHJvamVjdEFzc2V0ID0gcmVxdWlyZShcIi4uL3NoYXJlZC9wcm9qZWN0YXNzZXRcIik7XG5pbXBvcnQgVXNlclJlcG9zaXRvcnkgPSByZXF1aXJlKFwiLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L3VzZXIucmVwb3NpdG9yeVwiKTtcbnZhciBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcbnZhciBhdXRoS2V5ID0gY29uZmlnLmdldCgnVHBsU2VlZC5tZXNzYWdpbmcuYXV0aEtleScpO1xudmFyIHNlbmRlcklkID0gY29uZmlnLmdldCgnVHBsU2VlZC5tZXNzYWdpbmcuc2VuZGVySWQnKTtcbnZhciByb3V0ZXJOdW1iZXIgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5yb3V0ZXJOdW1iZXInKTtcbnZhciBtc2c5MSA9IHJlcXVpcmUoXCJtc2c5MVwiKShhdXRoS2V5LCBzZW5kZXJJZCwgcm91dGVyTnVtYmVyKTtcblxuXG5jbGFzcyBTZW5kTWVzc2FnZVNlcnZpY2Uge1xuICBwcml2YXRlIHVzZXJSZXBvc2l0b3J5OiBVc2VyUmVwb3NpdG9yeTtcbiAgYXBwX25hbWU6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFwcF9uYW1lID0gUHJvamVjdEFzc2V0LkFQUF9OQU1FO1xuICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSBuZXcgVXNlclJlcG9zaXRvcnkoKTtcbiAgfVxuXG4gIHNlbmRNZXNzYWdlKG1vYmlsZU5vOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcblxuICAgIGNvbnNvbGUubG9nKFwiU2VuZCBzbXMgb25cIiwgbW9iaWxlTm8pO1xuICAgIHZhciBvdHAgPSBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogOTk5OTkpICsgMTAwMDAwKTtcbiAgICBjb25zb2xlLmxvZyhcIm90cCBpc1wiLCBvdHApO1xuICAgIGNvbnNvbGUubG9nKCdzZW5kZXIgaWQnLCBzZW5kZXJJZCk7XG5cbiAgICB2YXIgbWVzc2FnZSA9IFwiVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgZm9yIFwiICsgXCIgXCIgKyB0aGlzLmFwcF9uYW1lICsgXCIgXCIgKyBcImFjY291bnQgaXNcIiArIFwiIFwiICsgb3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4gXCI7XG4gICAgY29uc29sZS5sb2coXCJtc2cgc2VudCB0byB1c2VyOlwiLCBtZXNzYWdlKTtcbiAgICBtc2c5MS5zZW5kKG1vYmlsZU5vLCBtZXNzYWdlLCBmdW5jdGlvbiAoZXJyOiBhbnksIHJlc3BvbnNlOiBhbnkpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHNlbmRNZXNzYWdlRGlyZWN0KERhdGE6IGFueSwgY2FsbGJhY2s6IGFueSkge1xuXG4gICAgY29uc29sZS5sb2coXCJTZW5kIHNtcyBvblwiLCBEYXRhLm1vYmlsZU5vKTtcblxuICAgIHZhciBtZXNzYWdlID0gXCJUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSBmb3IgXCIgKyBcIiBcIiArIHRoaXMuYXBwX25hbWUgKyBcIiBcIiArIFwiYWNjb3VudCBpc1wiICsgXCIgXCIgKyBEYXRhLm90cCArIFwiIFwiICsgXCIuVXNlIHRoaXMgT1RQIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuIFwiO1xuICAgIGNvbnNvbGUubG9nKFwibXNnIHNlbnQgdG8gdXNlcjpcIiwgbWVzc2FnZSk7XG4gICAgbXNnOTEuc2VuZChEYXRhLm1vYmlsZU5vLCBtZXNzYWdlLCBmdW5jdGlvbiAoZXJyOiBhbnksIHJlc3BvbnNlOiBhbnkpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJtZXNzYWdlIHNlbnQgZXJyb3JcIiwgZXJyKTtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBzZW5kQ2hhbmdlTW9iaWxlTWVzc2FnZShEYXRhOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcblxuICAgIGNvbnNvbGUubG9nKFwiU2VuZCBzbXMgb25cIiwgRGF0YS5tb2JpbGVObyk7XG4gICAgdmFyIG1lc3NhZ2UgPSBcIlRoZSBPbmUgVGltZSBQYXNzd29yZChPVFApIHRvIGNoYW5nZSB5b3VyIG51bWJlciBmcm9tXCIgKyBcIiBcIiArIERhdGEuY3VycmVudF9tb2JpbGVfbnVtYmVyICsgXCIgXCIgKyBcInRvXCIgKyBcIiBcIiArIERhdGEubW9iaWxlTm8gKyBcIiBcIiArIFwib2ZcIiArIFwiIFwiICsgdGhpcy5hcHBfbmFtZSArIFwiIFwiICsgXCJhY2NvdW50IGlzXCIgKyBcIiBcIiArIERhdGEub3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gY29tcGxldGUgdmVyaWZpY2F0aW9uLlwiO1xuICAgIGNvbnNvbGUubG9nKFwibXNnIHNlbnQgdG8gdXNlcjpcIiwgbWVzc2FnZSk7XG4gICAgbXNnOTEuc2VuZChEYXRhLm1vYmlsZU5vLCBtZXNzYWdlLCBmdW5jdGlvbiAoZXJyOiBhbnksIHJlc3BvbnNlOiBhbnkpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxufVxuXG5PYmplY3Quc2VhbChTZW5kTWVzc2FnZVNlcnZpY2UpO1xuZXhwb3J0ID0gU2VuZE1lc3NhZ2VTZXJ2aWNlO1xuIl19
