"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/user.repository");
var config = require('config');
var authKey = config.get('TplSeed.messaging.authKey');
var senderId = config.get('TplSeed.messaging.senderId');
var routerNumber = config.get('TplSeed.messaging.routerNumber');
var msg91 = require("msg91")(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.app_name = ProjectAsset.APP_NAME;
        this.userRepository = new UserRepository();
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        console.log("Send sms on", mobileNo);
        var otp = Math.floor((Math.random() * 99999) + 100000);
        console.log("otp is", otp);
        console.log('sender id', senderId);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
                console.log(response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                console.log("message sent error", err);
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        console.log('Send sms on', Data.mobileNo);
        var message = 'The One Time Password(OTP) to change your number from ' + Data.current_mobile_number + ' to ' + Data.mobileNo + ' of your ' + this.app_name + ' account is ' + Data.otp + '.Use this OTP to complete verification.';
        console.log('msg sent to user:', message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx5RUFBNEU7QUFDNUUsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2hFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFFdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDckMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVuQyxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FB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QWtCLENBQUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zZXJ2aWNlcy9zZW5kbWVzc2FnZS5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vc2hhcmVkL3Byb2plY3Rhc3NldC50c1wiLz5cclxuaW1wb3J0IE1lc3NhZ2VzPXJlcXVpcmUoXCIuLi9zaGFyZWQvbWVzc2FnZXNcIik7XHJcbmltcG9ydCBQcm9qZWN0QXNzZXQgPSByZXF1aXJlKFwiLi4vc2hhcmVkL3Byb2plY3Rhc3NldFwiKTtcclxuaW1wb3J0IFVzZXJSZXBvc2l0b3J5ID0gcmVxdWlyZShcIi4uL2RhdGFhY2Nlc3MvcmVwb3NpdG9yeS91c2VyLnJlcG9zaXRvcnlcIik7XHJcbnZhciBjb25maWcgPSByZXF1aXJlKCdjb25maWcnKTtcclxudmFyIGF1dGhLZXkgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5hdXRoS2V5Jyk7XHJcbnZhciBzZW5kZXJJZCA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWVzc2FnaW5nLnNlbmRlcklkJyk7XHJcbnZhciByb3V0ZXJOdW1iZXIgPSBjb25maWcuZ2V0KCdUcGxTZWVkLm1lc3NhZ2luZy5yb3V0ZXJOdW1iZXInKTtcclxudmFyIG1zZzkxID0gcmVxdWlyZShcIm1zZzkxXCIpKGF1dGhLZXksIHNlbmRlcklkLCByb3V0ZXJOdW1iZXIpO1xyXG5cclxuXHJcbmNsYXNzIFNlbmRNZXNzYWdlU2VydmljZSB7XHJcbiAgcHJpdmF0ZSB1c2VyUmVwb3NpdG9yeTogVXNlclJlcG9zaXRvcnk7XHJcbiAgYXBwX25hbWU6IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmFwcF9uYW1lID0gUHJvamVjdEFzc2V0LkFQUF9OQU1FO1xyXG4gICAgdGhpcy51c2VyUmVwb3NpdG9yeSA9IG5ldyBVc2VyUmVwb3NpdG9yeSgpO1xyXG4gIH1cclxuXHJcbiAgc2VuZE1lc3NhZ2UobW9iaWxlTm86IGFueSwgY2FsbGJhY2s6IGFueSkge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiU2VuZCBzbXMgb25cIiwgbW9iaWxlTm8pO1xyXG4gICAgdmFyIG90cCA9IE1hdGguZmxvb3IoKE1hdGgucmFuZG9tKCkgKiA5OTk5OSkgKyAxMDAwMDApO1xyXG4gICAgY29uc29sZS5sb2coXCJvdHAgaXNcIiwgb3RwKTtcclxuICAgIGNvbnNvbGUubG9nKCdzZW5kZXIgaWQnLCBzZW5kZXJJZCk7XHJcblxyXG4gICAgdmFyIG1lc3NhZ2UgPSBcIlRoZSBPbmUgVGltZSBQYXNzd29yZChPVFApIGZvciBcIiArIFwiIFwiICsgdGhpcy5hcHBfbmFtZSArIFwiIFwiICsgXCJhY2NvdW50IGlzXCIgKyBcIiBcIiArIG90cCArIFwiIFwiICsgXCIuVXNlIHRoaXMgT1RQIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuIFwiO1xyXG4gICAgY29uc29sZS5sb2coXCJtc2cgc2VudCB0byB1c2VyOlwiLCBtZXNzYWdlKTtcclxuICAgIG1zZzkxLnNlbmQobW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHNlbmRNZXNzYWdlRGlyZWN0KERhdGE6IGFueSwgY2FsbGJhY2s6IGFueSkge1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwiU2VuZCBzbXMgb25cIiwgRGF0YS5tb2JpbGVObyk7XHJcblxyXG4gICAgdmFyIG1lc3NhZ2UgPSBcIlRoZSBPbmUgVGltZSBQYXNzd29yZChPVFApIGZvciBcIiArIFwiIFwiICsgdGhpcy5hcHBfbmFtZSArIFwiIFwiICsgXCJhY2NvdW50IGlzXCIgKyBcIiBcIiArIERhdGEub3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4gXCI7XHJcbiAgICBjb25zb2xlLmxvZyhcIm1zZyBzZW50IHRvIHVzZXI6XCIsIG1lc3NhZ2UpO1xyXG4gICAgbXNnOTEuc2VuZChEYXRhLm1vYmlsZU5vLCBtZXNzYWdlLCBmdW5jdGlvbiAoZXJyOiBhbnksIHJlc3BvbnNlOiBhbnkpIHtcclxuICAgICAgaWYgKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwibWVzc2FnZSBzZW50IGVycm9yXCIsIGVycik7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZENoYW5nZU1vYmlsZU1lc3NhZ2UoRGF0YTogYW55LCBjYWxsYmFjazogYW55KSB7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ1NlbmQgc21zIG9uJywgRGF0YS5tb2JpbGVObyk7XHJcbiAgICBsZXQgbWVzc2FnZSA9ICdUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSB0byBjaGFuZ2UgeW91ciBudW1iZXIgZnJvbSAnKyBEYXRhLmN1cnJlbnRfbW9iaWxlX251bWJlciArJyB0byAnKyBEYXRhLm1vYmlsZU5vICsnIG9mIHlvdXIgJyArIHRoaXMuYXBwX25hbWUgKycgYWNjb3VudCBpcyAnKyBEYXRhLm90cCArICcuVXNlIHRoaXMgT1RQIHRvIGNvbXBsZXRlIHZlcmlmaWNhdGlvbi4nO1xyXG4gICAgY29uc29sZS5sb2coJ21zZyBzZW50IHRvIHVzZXI6JywgbWVzc2FnZSk7XHJcbiAgICBtc2c5MS5zZW5kKERhdGEubW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKE1lc3NhZ2VzLk1TR19FUlJPUl9NRVNTQUdFX1NFTkRJTkcpLCBudWxsKTtcclxuICAgICAgfWVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoU2VuZE1lc3NhZ2VTZXJ2aWNlKTtcclxuZXhwb3J0ID0gU2VuZE1lc3NhZ2VTZXJ2aWNlO1xyXG4iXX0=
