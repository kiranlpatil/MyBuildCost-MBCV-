"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/user.repository");
var config = require('config');
var authKey = config.get('TplSeed.messaging.authKey');
var senderId = config.get('TplSeed.messaging.senderId');
var routerNumber = config.get('TplSeed.messaging.routerNumber');
var msg91 = require("msg91")(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.app_name = ProjectAsset.APP_NAME;
        this.userRepository = new UserRepository();
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        console.log("Send sms on", mobileNo);
        var otp = Math.floor((Math.random() * 99999) + 100000);
        console.log("otp is", otp);
        console.log('sender id', senderId);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
                console.log(response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) for " + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to verify your account. ";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                console.log("message sent error", err);
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        console.log("Send sms on", Data.mobileNo);
        var message = "The One Time Password(OTP) to change your number from" + " " + Data.current_mobile_number + " " + "to" + " " + Data.mobileNo + " " + "of" + " " + this.app_name + " " + "account is" + " " + Data.otp + " " + ".Use this OTP to complete verification.";
        console.log("msg sent to user:", message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx5RUFBNEU7QUFDNUUsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUN0RCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2hFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUM7UUFDdEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFFdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDckMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUVuQyxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FB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O0FBQUQsQ0E3REEsQUE2REMsSUFBQTtBQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNoQyxpQkFBUyxrQkFBa0IsQ0FBQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NlcnZpY2VzL3NlbmRtZXNzYWdlLnNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9zaGFyZWQvcHJvamVjdGFzc2V0LnRzXCIvPlxyXG5pbXBvcnQgTWVzc2FnZXM9cmVxdWlyZShcIi4uL3NoYXJlZC9tZXNzYWdlc1wiKTtcclxuaW1wb3J0IFByb2plY3RBc3NldCA9IHJlcXVpcmUoXCIuLi9zaGFyZWQvcHJvamVjdGFzc2V0XCIpO1xyXG5pbXBvcnQgVXNlclJlcG9zaXRvcnkgPSByZXF1aXJlKFwiLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L3VzZXIucmVwb3NpdG9yeVwiKTtcclxudmFyIGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xyXG52YXIgYXV0aEtleSA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWVzc2FnaW5nLmF1dGhLZXknKTtcclxudmFyIHNlbmRlcklkID0gY29uZmlnLmdldCgnVHBsU2VlZC5tZXNzYWdpbmcuc2VuZGVySWQnKTtcclxudmFyIHJvdXRlck51bWJlciA9IGNvbmZpZy5nZXQoJ1RwbFNlZWQubWVzc2FnaW5nLnJvdXRlck51bWJlcicpO1xyXG52YXIgbXNnOTEgPSByZXF1aXJlKFwibXNnOTFcIikoYXV0aEtleSwgc2VuZGVySWQsIHJvdXRlck51bWJlcik7XHJcblxyXG5cclxuY2xhc3MgU2VuZE1lc3NhZ2VTZXJ2aWNlIHtcclxuICBwcml2YXRlIHVzZXJSZXBvc2l0b3J5OiBVc2VyUmVwb3NpdG9yeTtcclxuICBhcHBfbmFtZTogc3RyaW5nO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuYXBwX25hbWUgPSBQcm9qZWN0QXNzZXQuQVBQX05BTUU7XHJcbiAgICB0aGlzLnVzZXJSZXBvc2l0b3J5ID0gbmV3IFVzZXJSZXBvc2l0b3J5KCk7XHJcbiAgfVxyXG5cclxuICBzZW5kTWVzc2FnZShtb2JpbGVObzogYW55LCBjYWxsYmFjazogYW55KSB7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJTZW5kIHNtcyBvblwiLCBtb2JpbGVObyk7XHJcbiAgICB2YXIgb3RwID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDk5OTk5KSArIDEwMDAwMCk7XHJcbiAgICBjb25zb2xlLmxvZyhcIm90cCBpc1wiLCBvdHApO1xyXG4gICAgY29uc29sZS5sb2coJ3NlbmRlciBpZCcsIHNlbmRlcklkKTtcclxuXHJcbiAgICB2YXIgbWVzc2FnZSA9IFwiVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgZm9yIFwiICsgXCIgXCIgKyB0aGlzLmFwcF9uYW1lICsgXCIgXCIgKyBcImFjY291bnQgaXNcIiArIFwiIFwiICsgb3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4gXCI7XHJcbiAgICBjb25zb2xlLmxvZyhcIm1zZyBzZW50IHRvIHVzZXI6XCIsIG1lc3NhZ2UpO1xyXG4gICAgbXNnOTEuc2VuZChtb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZE1lc3NhZ2VEaXJlY3QoRGF0YTogYW55LCBjYWxsYmFjazogYW55KSB7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJTZW5kIHNtcyBvblwiLCBEYXRhLm1vYmlsZU5vKTtcclxuXHJcbiAgICB2YXIgbWVzc2FnZSA9IFwiVGhlIE9uZSBUaW1lIFBhc3N3b3JkKE9UUCkgZm9yIFwiICsgXCIgXCIgKyB0aGlzLmFwcF9uYW1lICsgXCIgXCIgKyBcImFjY291bnQgaXNcIiArIFwiIFwiICsgRGF0YS5vdHAgKyBcIiBcIiArIFwiLlVzZSB0aGlzIE9UUCB0byB2ZXJpZnkgeW91ciBhY2NvdW50LiBcIjtcclxuICAgIGNvbnNvbGUubG9nKFwibXNnIHNlbnQgdG8gdXNlcjpcIiwgbWVzc2FnZSk7XHJcbiAgICBtc2c5MS5zZW5kKERhdGEubW9iaWxlTm8sIG1lc3NhZ2UsIGZ1bmN0aW9uIChlcnI6IGFueSwgcmVzcG9uc2U6IGFueSkge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJtZXNzYWdlIHNlbnQgZXJyb3JcIiwgZXJyKTtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZW5kQ2hhbmdlTW9iaWxlTWVzc2FnZShEYXRhOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhcIlNlbmQgc21zIG9uXCIsIERhdGEubW9iaWxlTm8pO1xyXG4gICAgdmFyIG1lc3NhZ2UgPSBcIlRoZSBPbmUgVGltZSBQYXNzd29yZChPVFApIHRvIGNoYW5nZSB5b3VyIG51bWJlciBmcm9tXCIgKyBcIiBcIiArIERhdGEuY3VycmVudF9tb2JpbGVfbnVtYmVyICsgXCIgXCIgKyBcInRvXCIgKyBcIiBcIiArIERhdGEubW9iaWxlTm8gKyBcIiBcIiArIFwib2ZcIiArIFwiIFwiICsgdGhpcy5hcHBfbmFtZSArIFwiIFwiICsgXCJhY2NvdW50IGlzXCIgKyBcIiBcIiArIERhdGEub3RwICsgXCIgXCIgKyBcIi5Vc2UgdGhpcyBPVFAgdG8gY29tcGxldGUgdmVyaWZpY2F0aW9uLlwiO1xyXG4gICAgY29uc29sZS5sb2coXCJtc2cgc2VudCB0byB1c2VyOlwiLCBtZXNzYWdlKTtcclxuICAgIG1zZzkxLnNlbmQoRGF0YS5tb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoU2VuZE1lc3NhZ2VTZXJ2aWNlKTtcclxuZXhwb3J0ID0gU2VuZE1lc3NhZ2VTZXJ2aWNlO1xyXG4iXX0=
