"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var LoggerService = require("./LoggerService");
var Messages = require('../messages');
var logger = require('./logger');
var UserService = require("../../services/user.service");
function errorHandler(err, req, res, next) {
    var _loggerService = new LoggerService('errorHandler');
    if (err.code) {
        var errObject = {
            status: Messages.STATUS_ERROR,
            error: err
        };
        var responseObject = JSON.stringify(errObject);
        _loggerService.logError(err);
        if (err.code !== 400) {
            mailToAdmin(err);
        }
        res.status(err.code).send(responseObject);
    }
    else {
        var errorObject = {
            'status': Messages.STATUS_ERROR,
            'error': {
                'reason': 'Internal Server ',
                'message': 'Internal Server ',
                'code': 500
            }
        };
        mailToAdmin(err);
        var responseObject = JSON.stringify(errorObject);
        _loggerService.logError(err);
        res.status(500).send(responseObject);
    }
}
exports.errorHandler = errorHandler;
function mailToAdmin(errorInfo) {
    var userService = new UserService();
    userService.sendMailOnError(errorInfo, function (error, result) {
        if (error) {
            logger.error(Messages.MSG_ERROR_WHILE_CONTACTING);
        }
    });
}
exports.mailToAdmin = mailToAdmin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmVkL2xvZ2dlci9zaGFyZWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUFrRDtBQUVsRCxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2pDLHlEQUE0RDtBQUc1RCxzQkFBNkIsR0FBUSxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsSUFBUztJQUNsRSxJQUFJLGNBQWMsR0FBa0IsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDdEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDYixJQUFJLFNBQVMsR0FBRztZQUNkLE1BQU0sRUFBRSxRQUFRLENBQUMsWUFBWTtZQUM3QixLQUFLLEVBQUUsR0FBRztTQUNYLENBQUM7UUFDRixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9DLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDO1FBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksV0FBVyxHQUFPO1lBQ3BCLFFBQVEsRUFBRSxRQUFRLENBQUMsWUFBWTtZQUMvQixPQUFPLEVBQUU7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsU0FBUyxFQUFFLGtCQUFrQjtnQkFDN0IsTUFBTSxFQUFFLEdBQUc7YUFDWjtTQUNGLENBQUM7UUFDRixXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7QUFDSCxDQUFDO0FBM0JELG9DQTJCQztBQUdELHFCQUE0QixTQUFhO0lBQ3ZDLElBQUksV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7SUFDcEMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsVUFBQyxLQUFTLEVBQUUsTUFBVTtRQUMzRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNyRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDO0FBUkQsa0NBUUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZWQvbG9nZ2VyL3NoYXJlZC5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKFwiLi9Mb2dnZXJTZXJ2aWNlXCIpO1xuXG52YXIgTWVzc2FnZXMgPSByZXF1aXJlKCcuLi9tZXNzYWdlcycpO1xudmFyIGxvZ2dlciA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XG5pbXBvcnQgVXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLi8uLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnKTtcblxuXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGVycjogYW55LCByZXE6IGFueSwgcmVzOiBhbnksIG5leHQ6IGFueSkge1xuICBsZXQgX2xvZ2dlclNlcnZpY2U6IExvZ2dlclNlcnZpY2UgPSBuZXcgTG9nZ2VyU2VydmljZSgnZXJyb3JIYW5kbGVyJyk7XG4gIGlmIChlcnIuY29kZSkge1xuICAgIHZhciBlcnJPYmplY3QgPSB7XG4gICAgICBzdGF0dXM6IE1lc3NhZ2VzLlNUQVRVU19FUlJPUixcbiAgICAgIGVycm9yOiBlcnJcbiAgICB9O1xuICAgIHZhciByZXNwb25zZU9iamVjdCA9IEpTT04uc3RyaW5naWZ5KGVyck9iamVjdCk7XG4gICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoZXJyKTtcbiAgICBpZihlcnIuY29kZSAhPT0gNDAwKSB7XG4gICAgICBtYWlsVG9BZG1pbihlcnIpO1xuICAgIH1cbiAgICByZXMuc3RhdHVzKGVyci5jb2RlKS5zZW5kKHJlc3BvbnNlT2JqZWN0KTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgZXJyb3JPYmplY3Q6YW55ID0ge1xuICAgICAgJ3N0YXR1cyc6IE1lc3NhZ2VzLlNUQVRVU19FUlJPUixcbiAgICAgICdlcnJvcic6IHtcbiAgICAgICAgJ3JlYXNvbic6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcbiAgICAgICAgJ21lc3NhZ2UnOiAnSW50ZXJuYWwgU2VydmVyICcsXG4gICAgICAgICdjb2RlJzogNTAwXG4gICAgICB9XG4gICAgfTtcbiAgICBtYWlsVG9BZG1pbihlcnIpO1xuICAgIHZhciByZXNwb25zZU9iamVjdCA9IEpTT04uc3RyaW5naWZ5KGVycm9yT2JqZWN0KTtcbiAgICBfbG9nZ2VyU2VydmljZS5sb2dFcnJvcihlcnIpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHJlc3BvbnNlT2JqZWN0KTtcbiAgfVxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBtYWlsVG9BZG1pbihlcnJvckluZm86YW55KSB7XG4gIHZhciB1c2VyU2VydmljZSA9IG5ldyBVc2VyU2VydmljZSgpO1xuICB1c2VyU2VydmljZS5zZW5kTWFpbE9uRXJyb3IoZXJyb3JJbmZvLCAoZXJyb3I6YW55LCByZXN1bHQ6YW55KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoIE1lc3NhZ2VzLk1TR19FUlJPUl9XSElMRV9DT05UQUNUSU5HKTtcbiAgICB9XG4gIH0pO1xuXG59XG4iXX0=
