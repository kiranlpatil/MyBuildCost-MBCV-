"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var LoggerService = require("./LoggerService");
var Messages = require('../messages');
var logger = require('./logger');
var UserService = require("../../services/user.service");
function errorHandler(err, req, res, next) {
    var _loggerService = new LoggerService('errorHandler');
    if (err.code) {
        var errObject = {
            status: Messages.STATUS_ERROR,
            error: err
        };
        var responseObject = JSON.stringify(errObject);
        _loggerService.logError(err);
        if (err.code !== 400) {
            mailToAdmin(err);
        }
        res.status(err.code).send(responseObject);
    }
    else {
        var errorObject = {
            'status': Messages.STATUS_ERROR,
            'error': {
                'reason': 'Internal Server ',
                'message': 'Internal Server ',
                'code': 500
            }
        };
        mailToAdmin(err);
        var responseObject = JSON.stringify(errorObject);
        _loggerService.logError(err);
        res.status(500).send(responseObject);
    }
}
exports.errorHandler = errorHandler;
function mailToAdmin(errorInfo) {
    var userService = new UserService();
    userService.sendMailOnError(errorInfo, function (error, result) {
        if (error) {
            logger.error(Messages.MSG_ERROR_WHILE_CONTACTING);
        }
    });
}
exports.mailToAdmin = mailToAdmin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmVkL2xvZ2dlci9zaGFyZWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUFrRDtBQUVsRCxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2pDLHlEQUE0RDtBQUc1RCxzQkFBNkIsR0FBUSxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsSUFBUztJQUNsRSxJQUFJLGNBQWMsR0FBa0IsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDdEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDYixJQUFJLFNBQVMsR0FBRztZQUNkLE1BQU0sRUFBRSxRQUFRLENBQUMsWUFBWTtZQUM3QixLQUFLLEVBQUUsR0FBRztTQUNYLENBQUM7UUFDRixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9DLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDO1FBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksV0FBVyxHQUFPO1lBQ3BCLFFBQVEsRUFBRSxRQUFRLENBQUMsWUFBWTtZQUMvQixPQUFPLEVBQUU7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsU0FBUyxFQUFFLGtCQUFrQjtnQkFDN0IsTUFBTSxFQUFFLEdBQUc7YUFDWjtTQUNGLENBQUM7UUFDRixXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7QUFDSCxDQUFDO0FBM0JELG9DQTJCQztBQUdELHFCQUE0QixTQUFhO0lBQ3ZDLElBQUksV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7SUFDcEMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsVUFBQyxLQUFTLEVBQUUsTUFBVTtRQUMzRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNyRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDO0FBUkQsa0NBUUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZWQvbG9nZ2VyL3NoYXJlZC5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKFwiLi9Mb2dnZXJTZXJ2aWNlXCIpO1xyXG5cclxudmFyIE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vbWVzc2FnZXMnKTtcclxudmFyIGxvZ2dlciA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XHJcbmltcG9ydCBVc2VyU2VydmljZSA9IHJlcXVpcmUoJy4uLy4uL3NlcnZpY2VzL3VzZXIuc2VydmljZScpO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyOiBhbnksIHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSB7XHJcbiAgbGV0IF9sb2dnZXJTZXJ2aWNlOiBMb2dnZXJTZXJ2aWNlID0gbmV3IExvZ2dlclNlcnZpY2UoJ2Vycm9ySGFuZGxlcicpO1xyXG4gIGlmIChlcnIuY29kZSkge1xyXG4gICAgdmFyIGVyck9iamVjdCA9IHtcclxuICAgICAgc3RhdHVzOiBNZXNzYWdlcy5TVEFUVVNfRVJST1IsXHJcbiAgICAgIGVycm9yOiBlcnJcclxuICAgIH07XHJcbiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSBKU09OLnN0cmluZ2lmeShlcnJPYmplY3QpO1xyXG4gICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoZXJyKTtcclxuICAgIGlmKGVyci5jb2RlICE9PSA0MDApIHtcclxuICAgICAgbWFpbFRvQWRtaW4oZXJyKTtcclxuICAgIH1cclxuICAgIHJlcy5zdGF0dXMoZXJyLmNvZGUpLnNlbmQocmVzcG9uc2VPYmplY3QpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICB2YXIgZXJyb3JPYmplY3Q6YW55ID0ge1xyXG4gICAgICAnc3RhdHVzJzogTWVzc2FnZXMuU1RBVFVTX0VSUk9SLFxyXG4gICAgICAnZXJyb3InOiB7XHJcbiAgICAgICAgJ3JlYXNvbic6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnbWVzc2FnZSc6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnY29kZSc6IDUwMFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbWFpbFRvQWRtaW4oZXJyKTtcclxuICAgIHZhciByZXNwb25zZU9iamVjdCA9IEpTT04uc3RyaW5naWZ5KGVycm9yT2JqZWN0KTtcclxuICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKGVycik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChyZXNwb25zZU9iamVjdCk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1haWxUb0FkbWluKGVycm9ySW5mbzphbnkpIHtcclxuICB2YXIgdXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuICB1c2VyU2VydmljZS5zZW5kTWFpbE9uRXJyb3IoZXJyb3JJbmZvLCAoZXJyb3I6YW55LCByZXN1bHQ6YW55KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCBNZXNzYWdlcy5NU0dfRVJST1JfV0hJTEVfQ09OVEFDVElORyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG59XHJcbiJdfQ==
