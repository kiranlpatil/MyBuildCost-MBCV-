"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var LoggerService = require("./LoggerService");
var Messages = require('../messages');
var logger = require('./logger');
var UserService = require("../../services/user.service");
function errorHandler(err, req, res, next) {
    var _loggerService = new LoggerService('errorHandler');
    if (err.code) {
        var errObject = {
            status: Messages.STATUS_ERROR,
            error: err
        };
        var responseObject = JSON.stringify(errObject);
        _loggerService.logError(err);
        mailToAdmin(err);
        console.log('responseObject in client errorHandler:', responseObject);
        res.status(err.code).send(responseObject);
    }
    else {
        var errorObject = {
            'status': Messages.STATUS_ERROR,
            'error': {
                'reason': 'Internal Server ',
                'message': 'Internal Server ',
                'code': 500
            }
        };
        mailToAdmin(err);
        var responseObject = JSON.stringify(errorObject);
        _loggerService.logError(err);
        res.status(500).send(responseObject);
    }
}
exports.errorHandler = errorHandler;
function mailToAdmin(errorInfo) {
    var userService = new UserService();
    userService.sendMailOnError(errorInfo, function (error, result) {
        if (error) {
            logger.error(Messages.MSG_ERROR_WHILE_CONTACTING);
        }
    });
}
exports.mailToAdmin = mailToAdmin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmVkL2xvZ2dlci9zaGFyZWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUFrRDtBQUVsRCxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2pDLHlEQUE0RDtBQUc1RCxzQkFBNkIsR0FBUSxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsSUFBUztJQUNsRSxJQUFJLGNBQWMsR0FBa0IsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDdEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDYixJQUFJLFNBQVMsR0FBRztZQUNkLE1BQU0sRUFBRSxRQUFRLENBQUMsWUFBWTtZQUM3QixLQUFLLEVBQUUsR0FBRztTQUNYLENBQUM7UUFDRixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQy9DLGNBQWMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQXdDLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDdEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksV0FBVyxHQUFPO1lBQ3BCLFFBQVEsRUFBRSxRQUFRLENBQUMsWUFBWTtZQUMvQixPQUFPLEVBQUU7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsU0FBUyxFQUFFLGtCQUFrQjtnQkFDN0IsTUFBTSxFQUFFLEdBQUc7YUFDWjtTQUNGLENBQUM7UUFDRixXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7QUFDSCxDQUFDO0FBMUJELG9DQTBCQztBQUdELHFCQUE0QixTQUFhO0lBQ3ZDLElBQUksV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7SUFDcEMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsVUFBQyxLQUFTLEVBQUUsTUFBVTtRQUMzRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNyRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDO0FBUkQsa0NBUUMiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZWQvbG9nZ2VyL3NoYXJlZC5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKFwiLi9Mb2dnZXJTZXJ2aWNlXCIpO1xyXG5cclxudmFyIE1lc3NhZ2VzID0gcmVxdWlyZSgnLi4vbWVzc2FnZXMnKTtcclxudmFyIGxvZ2dlciA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XHJcbmltcG9ydCBVc2VyU2VydmljZSA9IHJlcXVpcmUoJy4uLy4uL3NlcnZpY2VzL3VzZXIuc2VydmljZScpO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyOiBhbnksIHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSB7XHJcbiAgbGV0IF9sb2dnZXJTZXJ2aWNlOiBMb2dnZXJTZXJ2aWNlID0gbmV3IExvZ2dlclNlcnZpY2UoJ2Vycm9ySGFuZGxlcicpO1xyXG4gIGlmIChlcnIuY29kZSkge1xyXG4gICAgdmFyIGVyck9iamVjdCA9IHtcclxuICAgICAgc3RhdHVzOiBNZXNzYWdlcy5TVEFUVVNfRVJST1IsXHJcbiAgICAgIGVycm9yOiBlcnJcclxuICAgIH07XHJcbiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSBKU09OLnN0cmluZ2lmeShlcnJPYmplY3QpO1xyXG4gICAgX2xvZ2dlclNlcnZpY2UubG9nRXJyb3IoZXJyKTtcclxuICAgIG1haWxUb0FkbWluKGVycik7XHJcbiAgICBjb25zb2xlLmxvZygncmVzcG9uc2VPYmplY3QgaW4gY2xpZW50IGVycm9ySGFuZGxlcjonLCByZXNwb25zZU9iamVjdCk7XHJcbiAgICByZXMuc3RhdHVzKGVyci5jb2RlKS5zZW5kKHJlc3BvbnNlT2JqZWN0KTtcclxuICB9IGVsc2Uge1xyXG4gICAgdmFyIGVycm9yT2JqZWN0OmFueSA9IHtcclxuICAgICAgJ3N0YXR1cyc6IE1lc3NhZ2VzLlNUQVRVU19FUlJPUixcclxuICAgICAgJ2Vycm9yJzoge1xyXG4gICAgICAgICdyZWFzb24nOiAnSW50ZXJuYWwgU2VydmVyICcsXHJcbiAgICAgICAgJ21lc3NhZ2UnOiAnSW50ZXJuYWwgU2VydmVyICcsXHJcbiAgICAgICAgJ2NvZGUnOiA1MDBcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIG1haWxUb0FkbWluKGVycik7XHJcbiAgICB2YXIgcmVzcG9uc2VPYmplY3QgPSBKU09OLnN0cmluZ2lmeShlcnJvck9iamVjdCk7XHJcbiAgICBfbG9nZ2VyU2VydmljZS5sb2dFcnJvcihlcnIpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQocmVzcG9uc2VPYmplY3QpO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtYWlsVG9BZG1pbihlcnJvckluZm86YW55KSB7XHJcbiAgdmFyIHVzZXJTZXJ2aWNlID0gbmV3IFVzZXJTZXJ2aWNlKCk7XHJcbiAgdXNlclNlcnZpY2Uuc2VuZE1haWxPbkVycm9yKGVycm9ySW5mbywgKGVycm9yOmFueSwgcmVzdWx0OmFueSkgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvciggTWVzc2FnZXMuTVNHX0VSUk9SX1dISUxFX0NPTlRBQ1RJTkcpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxufVxyXG4iXX0=
