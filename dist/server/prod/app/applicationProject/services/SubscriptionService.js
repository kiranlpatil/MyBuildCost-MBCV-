"use strict";
var SubscriptionRepository = require("../dataaccess/repository/SubscriptionRepository");
var messages = require("../../applicationProject/shared/messages");
var PayUMoneyModel_1 = require("../../framework/dataaccess/model/PayUMoneyModel");
var payumoney = require('payumoney-node');
var config = require('config');
var log4js = require('log4js');
var logger = log4js.getLogger('subscription Service');
var SubscriptionService = (function () {
    function SubscriptionService() {
        this.subscriptionRepository = new SubscriptionRepository();
        this.subscriptionRepository = new SubscriptionRepository();
    }
    SubscriptionService.prototype.addSubscriptionPackage = function (subscriptionPackage, callback) {
        this.subscriptionRepository.create(subscriptionPackage, function (err, res) {
            if (err) {
                callback(err, null);
            }
            else {
                logger.info('subscription service, create has been hit');
                var projectId = res._id;
                callback(null, res);
            }
        });
    };
    SubscriptionService.prototype.getBaseSubscriptionPackageList = function (callback) {
        var query = [
            { $unwind: '$basePackage' },
            { $project: { 'basePackage': 1, _id: 0 } }
        ];
        this.subscriptionRepository.aggregate(query, function (error, subscriptionPackageList) {
            if (error) {
                callback(error, null);
            }
            else {
                if (subscriptionPackageList.length > 0) {
                    callback(error, subscriptionPackageList);
                }
                else {
                    var error_1 = new Error();
                    error_1.message = messages.MSG_ERROR_SUBSCRIPTION_PACKAGES_DETAILS_ARE_NOT_DEFINED;
                    callback(error_1, null);
                }
            }
        });
    };
    SubscriptionService.prototype.getSubscriptionPackageByName = function (packageName, packageType, callback) {
        var query;
        if (packageType === 'BasePackage') {
            query = { 'basePackage.name': packageName };
        }
        else {
            query = { 'addOnPackage.name': packageName };
        }
        this.subscriptionRepository.retrieve(query, callback);
    };
    SubscriptionService.prototype.makePayUMoneyPayment = function (paymentBody, callback) {
        var MERCHANT_KEY = config.get('payUMoney.merchentKey');
        var MERCHANT_SALT = config.get('payUMoney.saltKey');
        var AUTHORIZATION_HEADER = config.get('payUMoney.authHeader');
        var IS_PROD_MODE = config.get('payUMoney.isProdMode');
        payumoney.setKeys(MERCHANT_KEY, MERCHANT_SALT, AUTHORIZATION_HEADER);
        payumoney.isProdMode(IS_PROD_MODE);
        var payUMoneyModel = new PayUMoneyModel_1.PayUMoneyModel();
        payUMoneyModel.firstname = paymentBody.firstname;
        payUMoneyModel.lastname = paymentBody.lastname;
        payUMoneyModel.email = paymentBody.email;
        payUMoneyModel.phone = paymentBody.phone;
        payUMoneyModel.productinfo = paymentBody.productinfo;
        payUMoneyModel.amount = paymentBody.amount;
        payUMoneyModel.txnid = this.generateTransactionId(30);
        payUMoneyModel.surl = 'http://9f79c8c5.ngrok.io/api/subscription/pay/success';
        payUMoneyModel.furl = 'http://9f79c8c5.ngrok.io/api/subscription/pay/failure';
        payumoney.makePayment(payUMoneyModel, function (error, response) {
            if (error) {
                console.log(response);
                callback(error, null);
            }
            else {
                console.log(response);
                callback(null, { 'data': response });
            }
        });
    };
    SubscriptionService.prototype.generateTransactionId = function (length) {
        var text = '';
        var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        for (var i = 0; i < length; i++) {
            text += possible.charAt(Math.floor(Math.random() * possible.length));
        }
        return text;
    };
    return SubscriptionService;
}());
module.exports = SubscriptionService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvU3Vic2NyaXB0aW9uU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsd0ZBQTJGO0FBRTNGLG1FQUF1RTtBQUV2RSxrRkFBaUY7QUFFakYsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDMUMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQixJQUFJLE1BQU0sR0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFFcEQ7SUFHRTtRQUZRLDJCQUFzQixHQUFHLElBQUksc0JBQXNCLEVBQUUsQ0FBQztRQUc1RCxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxzQkFBc0IsRUFBRSxDQUFDO0lBQzdELENBQUM7SUFDRCxvREFBc0IsR0FBdEIsVUFBdUIsbUJBQXdCLEVBQUcsUUFBMkM7UUFDM0YsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQy9ELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN0QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sTUFBTSxDQUFDLElBQUksQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO2dCQUN6RCxJQUFJLFNBQVMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO2dCQUN4QixRQUFRLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCw0REFBOEIsR0FBOUIsVUFBK0IsUUFBdUY7UUFDcEgsSUFBSSxLQUFLLEdBQUc7WUFD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LFdBQVcsQ0FBQyxjQUFjLEVBQUUsVUFBUyxLQUFTLEVBQUUsUUFBWTtZQUNwRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUVWLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3RCLFFBQVEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUVOLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3RCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUcsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUN4QyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsbURBQXFCLEdBQXJCLFVBQXNCLE1BQWU7UUFDbkMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxRQUFRLEdBQUcsZ0VBQWdFLENBQUM7UUFDaEYsR0FBRyxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMvQixJQUFJLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN2RSxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFSCwwQkFBQztBQUFELENBOUZBLEFBOEZDLElBQUE7QUFFRCxpQkFBUyxtQkFBbUIsQ0FBQyIsImZpbGUiOiJhcHAvYXBwbGljYXRpb25Qcm9qZWN0L3NlcnZpY2VzL1N1YnNjcmlwdGlvblNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU3Vic2NyaXB0aW9uUmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvcmVwb3NpdG9yeS9TdWJzY3JpcHRpb25SZXBvc2l0b3J5Jyk7XHJcbmltcG9ydCBCYXNlU3Vic2NyaXB0aW9uUGFja2FnZSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9TdWJzY3JpcHRpb24vQmFzZVN1YnNjcmlwdGlvblBhY2thZ2UnKTtcclxuaW1wb3J0IG1lc3NhZ2VzICA9IHJlcXVpcmUoJy4uLy4uL2FwcGxpY2F0aW9uUHJvamVjdC9zaGFyZWQvbWVzc2FnZXMnKTtcclxuaW1wb3J0IENvbnN0YW50cyA9IHJlcXVpcmUoJy4uL3NoYXJlZC9jb25zdGFudHMnKTtcclxuaW1wb3J0IHsgUGF5VU1vbmV5TW9kZWwgfSBmcm9tICcuLi8uLi9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9tb2RlbC9QYXlVTW9uZXlNb2RlbCc7XHJcblxyXG5sZXQgcGF5dW1vbmV5ID0gcmVxdWlyZSgncGF5dW1vbmV5LW5vZGUnKTtcclxubGV0IGNvbmZpZyA9IHJlcXVpcmUoJ2NvbmZpZycpO1xyXG52YXIgbG9nNGpzID0gcmVxdWlyZSgnbG9nNGpzJyk7XHJcbnZhciBsb2dnZXI9bG9nNGpzLmdldExvZ2dlcignc3Vic2NyaXB0aW9uIFNlcnZpY2UnKTtcclxuXHJcbmNsYXNzIFN1YnNjcmlwdGlvblNlcnZpY2Uge1xyXG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uUmVwb3NpdG9yeSA9IG5ldyBTdWJzY3JpcHRpb25SZXBvc2l0b3J5KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25SZXBvc2l0b3J5ID0gbmV3IFN1YnNjcmlwdGlvblJlcG9zaXRvcnkoKTtcclxuICB9XHJcbiAgYWRkU3Vic2NyaXB0aW9uUGFja2FnZShzdWJzY3JpcHRpb25QYWNrYWdlOiBhbnksICBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvblJlcG9zaXRvcnkuY3JlYXRlKHN1YnNjcmlwdGlvblBhY2thZ2UsIChlcnIsIHJlcykgPT4ge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsb2dnZXIuaW5mbygnc3Vic2NyaXB0aW9uIHNlcnZpY2UsIGNyZWF0ZSBoYXMgYmVlbiBoaXQnKTtcclxuICAgICAgICBsZXQgcHJvamVjdElkID0gcmVzLl9pZDtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEJhc2VTdWJzY3JpcHRpb25QYWNrYWdlTGlzdChjYWxsYmFjazogKGVycm9yOiBhbnksIHN1YnNjcmlwdGlvblBhY2thZ2VMaXN0OiBBcnJheTxCYXNlU3Vic2NyaXB0aW9uUGFja2FnZT4pID0+IHZvaWQpIHtcclxuICAgIGxldCBxdWVyeSA9IFtcclxuICAgICAgeyR1bndpbmQ6ICckYmFzZVBhY2thZ2UnfSxcclxuICAgICAgeyRwcm9qZWN0OiB7J2Jhc2VQYWNrYWdlJzogMSwgX2lkOjB9fVxyXG4gICAgXTtcclxuXHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvblJlcG9zaXRvcnkuYWdncmVnYXRlKHF1ZXJ5LCAoZXJyb3IsIHN1YnNjcmlwdGlvblBhY2thZ2VMaXN0KSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uUGFja2FnZUxpc3QubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIHN1YnNjcmlwdGlvblBhY2thZ2VMaXN0KTtcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICBsZXQgZXJyb3IgPSBuZXcgRXJyb3IoKTtcclxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgPSBtZXNzYWdlcy5NU0dfRVJST1JfU1VCU0NSSVBUSU9OX1BBQ0tBR0VTX0RFVEFJTFNfQVJFX05PVF9ERUZJTkVEO1xyXG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRTdWJzY3JpcHRpb25QYWNrYWdlQnlOYW1lKHBhY2thZ2VOYW1lIDogc3RyaW5nLCBwYWNrYWdlVHlwZTpzdHJpbmcsIGNhbGxiYWNrOihlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgbGV0IHF1ZXJ5IDogYW55O1xyXG4gICAgaWYocGFja2FnZVR5cGUgPT09ICdCYXNlUGFja2FnZScpIHtcclxuICAgICAgcXVlcnkgPSB7ICdiYXNlUGFja2FnZS5uYW1lJzogcGFja2FnZU5hbWV9O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcXVlcnkgPSB7ICdhZGRPblBhY2thZ2UubmFtZSc6IHBhY2thZ2VOYW1lfTtcclxuICAgIH1cclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uUmVwb3NpdG9yeS5yZXRyaWV2ZShxdWVyeSwgY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgbWFrZVBheVVNb25leVBheW1lbnQocGF5bWVudEJvZHkgOiBQYXlVTW9uZXlNb2RlbCwgY2FsbGJhY2s6KGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcblxyXG4gICAgbGV0IE1FUkNIQU5UX0tFWSA9IGNvbmZpZy5nZXQoJ3BheVVNb25leS5tZXJjaGVudEtleScpO1xyXG4gICAgbGV0IE1FUkNIQU5UX1NBTFQgPSBjb25maWcuZ2V0KCdwYXlVTW9uZXkuc2FsdEtleScpO1xyXG4gICAgbGV0IEFVVEhPUklaQVRJT05fSEVBREVSID0gY29uZmlnLmdldCgncGF5VU1vbmV5LmF1dGhIZWFkZXInKTtcclxuICAgIGxldCBJU19QUk9EX01PREUgPSBjb25maWcuZ2V0KCdwYXlVTW9uZXkuaXNQcm9kTW9kZScpO1xyXG5cclxuICAgIHBheXVtb25leS5zZXRLZXlzKE1FUkNIQU5UX0tFWSwgTUVSQ0hBTlRfU0FMVCwgQVVUSE9SSVpBVElPTl9IRUFERVIpO1xyXG4gICAgcGF5dW1vbmV5LmlzUHJvZE1vZGUoSVNfUFJPRF9NT0RFKTtcclxuXHJcbiAgICBsZXQgcGF5VU1vbmV5TW9kZWwgPSBuZXcgUGF5VU1vbmV5TW9kZWwoKTtcclxuXHJcbiAgICBwYXlVTW9uZXlNb2RlbC5maXJzdG5hbWUgPSBwYXltZW50Qm9keS5maXJzdG5hbWU7XHJcbiAgICBwYXlVTW9uZXlNb2RlbC5sYXN0bmFtZSA9IHBheW1lbnRCb2R5Lmxhc3RuYW1lO1xyXG4gICAgcGF5VU1vbmV5TW9kZWwuZW1haWwgPSBwYXltZW50Qm9keS5lbWFpbDtcclxuICAgIHBheVVNb25leU1vZGVsLnBob25lID0gcGF5bWVudEJvZHkucGhvbmU7XHJcbiAgICBwYXlVTW9uZXlNb2RlbC5wcm9kdWN0aW5mbyA9IHBheW1lbnRCb2R5LnByb2R1Y3RpbmZvO1xyXG4gICAgcGF5VU1vbmV5TW9kZWwuYW1vdW50ID0gcGF5bWVudEJvZHkuYW1vdW50O1xyXG4gICAgcGF5VU1vbmV5TW9kZWwudHhuaWQgPSB0aGlzLmdlbmVyYXRlVHJhbnNhY3Rpb25JZCgzMCk7XHJcbiAgICBwYXlVTW9uZXlNb2RlbC5zdXJsID0gJ2h0dHA6Ly85Zjc5YzhjNS5uZ3Jvay5pby9hcGkvc3Vic2NyaXB0aW9uL3BheS9zdWNjZXNzJztcclxuICAgIHBheVVNb25leU1vZGVsLmZ1cmwgPSAnaHR0cDovLzlmNzljOGM1Lm5ncm9rLmlvL2FwaS9zdWJzY3JpcHRpb24vcGF5L2ZhaWx1cmUnO1xyXG5cclxuXHJcbiAgICBwYXl1bW9uZXkubWFrZVBheW1lbnQocGF5VU1vbmV5TW9kZWwsIGZ1bmN0aW9uKGVycm9yOmFueSwgcmVzcG9uc2U6YW55KSB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIC8vIFNvbWUgZXJyb3JcclxuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIFBheW1lbnQgcmVkaXJlY3Rpb24gbGlua1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB7ICdkYXRhJyA6IHJlc3BvbnNlIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdlbmVyYXRlVHJhbnNhY3Rpb25JZChsZW5ndGggOiBudW1iZXIpIHtcclxuICAgIGxldCB0ZXh0ID0gJyc7XHJcbiAgICBsZXQgcG9zc2libGUgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODknO1xyXG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHRleHQgKz0gcG9zc2libGUuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBvc3NpYmxlLmxlbmd0aCkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRleHQ7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuZXhwb3J0ID0gU3Vic2NyaXB0aW9uU2VydmljZTtcclxuIl19
