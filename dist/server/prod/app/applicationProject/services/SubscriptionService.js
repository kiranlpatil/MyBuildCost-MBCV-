"use strict";
var SubscriptionRepository = require("../dataaccess/repository/SubscriptionRepository");
var messages = require("../../applicationProject/shared/messages");
var PayUMoneyModel_1 = require("../../framework/dataaccess/model/PayUMoneyModel");
var payumoney = require('payumoney-node');
var config = require('config');
var log4js = require('log4js');
var logger = log4js.getLogger('subscription Service');
var SubscriptionService = (function () {
    function SubscriptionService() {
        this.subscriptionRepository = new SubscriptionRepository();
        this.subscriptionRepository = new SubscriptionRepository();
    }
    SubscriptionService.prototype.addSubscriptionPackage = function (subscriptionPackage, callback) {
        this.subscriptionRepository.create(subscriptionPackage, function (err, res) {
            if (err) {
                callback(err, null);
            }
            else {
                logger.info('subscription service, create has been hit');
                var projectId = res._id;
                callback(null, res);
            }
        });
    };
    SubscriptionService.prototype.getBaseSubscriptionPackageList = function (callback) {
        var query = [
            { $unwind: '$basePackage' },
            { $project: { 'basePackage': 1, _id: 0 } }
        ];
        this.subscriptionRepository.aggregate(query, function (error, subscriptionPackageList) {
            if (error) {
                callback(error, null);
            }
            else {
                if (subscriptionPackageList.length > 0) {
                    callback(error, subscriptionPackageList);
                }
                else {
                    var error_1 = new Error();
                    error_1.message = messages.MSG_ERROR_SUBSCRIPTION_PACKAGES_DETAILS_ARE_NOT_DEFINED;
                    callback(error_1, null);
                }
            }
        });
    };
    SubscriptionService.prototype.getSubscriptionPackageByName = function (packageName, packageType, callback) {
        var query;
        if (packageType === 'BasePackage') {
            query = { 'basePackage.name': packageName };
        }
        else {
            query = { 'addOnPackage.name': packageName };
        }
        this.subscriptionRepository.retrieve(query, callback);
    };
    SubscriptionService.prototype.makePayUMoneyPayment = function (paymentBody, callback) {
        var MERCHANT_KEY = config.get('payUMoney.merchentKey');
        var MERCHANT_SALT = config.get('payUMoney.saltKey');
        var AUTHORIZATION_HEADER = config.get('payUMoney.authHeader');
        var IS_PROD_MODE = config.get('payUMoney.isProdMode');
        payumoney.setKeys(MERCHANT_KEY, MERCHANT_SALT, AUTHORIZATION_HEADER);
        payumoney.isProdMode(IS_PROD_MODE);
        var payUMoneyModel = new PayUMoneyModel_1.PayUMoneyModel();
        payUMoneyModel.firstname = paymentBody.firstname;
        payUMoneyModel.lastname = paymentBody.lastname;
        payUMoneyModel.email = paymentBody.email;
        payUMoneyModel.phone = paymentBody.phone;
        payUMoneyModel.productinfo = paymentBody.productinfo;
        payUMoneyModel.amount = paymentBody.amount;
        payUMoneyModel.txnid = this.generateTransactionId(30);
        payUMoneyModel.furl = config.get('application.mail.host') + 'api/subscription/payment/failure';
        payUMoneyModel.surl = config.get('application.mail.host') + 'api/subscription/payment/success';
        payumoney.makePayment(payUMoneyModel, function (error, response) {
            if (error) {
                console.log(response);
                callback(error, null);
            }
            else {
                console.log(response);
                callback(null, { 'data': response });
            }
        });
    };
    SubscriptionService.prototype.generateTransactionId = function (length) {
        var text = '';
        var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        for (var i = 0; i < length; i++) {
            text += possible.charAt(Math.floor(Math.random() * possible.length));
        }
        return text;
    };
    return SubscriptionService;
}());
module.exports = SubscriptionService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvU3Vic2NyaXB0aW9uU2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsd0ZBQTJGO0FBRTNGLG1FQUF1RTtBQUV2RSxrRkFBaUY7QUFFakYsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDMUMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQixJQUFJLE1BQU0sR0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFFcEQ7SUFHRTtRQUZRLDJCQUFzQixHQUFHLElBQUksc0JBQXNCLEVBQUUsQ0FBQztRQUc1RCxJQUFJLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxzQkFBc0IsRUFBRSxDQUFDO0lBQzdELENBQUM7SUFDRCxvREFBc0IsR0FBdEIsVUFBdUIsbUJBQXdCLEVBQUcsUUFBMkM7UUFDM0YsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRSxVQUFDLEdBQUcsRUFBRSxHQUFHO1lBQy9ELEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN0QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sTUFBTSxDQUFDLElBQUksQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO2dCQUN6RCxJQUFJLFNBQVMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO2dCQUN4QixRQUFRLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCw0REFBOEIsR0FBOUIsVUFBK0IsUUFBdUY7UUFDcEgsSUFBSSxLQUFLLEdBQUc7WUFD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SUFBSSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsR0FBQyxrQ0FBa0MsQ0FBQztRQUc3RixTQUFTLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRSxVQUFTLEtBQVMsRUFBRSxRQUFZO1lBQ3BFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBRVYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDdEIsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRU4sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDdEIsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxtREFBcUIsR0FBckIsVUFBc0IsTUFBZTtRQUNuQyxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZCxJQUFJLFFBQVEsR0FBRyxnRUFBZ0UsQ0FBQztRQUNoRixHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQy9CLElBQUksSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVILDBCQUFDO0FBQUQsQ0E5RkEsQUE4RkMsSUFBQTtBQUVELGlCQUFTLG1CQUFtQixDQUFDIiwiZmlsZSI6ImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvU3Vic2NyaXB0aW9uU2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdWJzY3JpcHRpb25SZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L1N1YnNjcmlwdGlvblJlcG9zaXRvcnknKTtcclxuaW1wb3J0IEJhc2VTdWJzY3JpcHRpb25QYWNrYWdlID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L1N1YnNjcmlwdGlvbi9CYXNlU3Vic2NyaXB0aW9uUGFja2FnZScpO1xyXG5pbXBvcnQgbWVzc2FnZXMgID0gcmVxdWlyZSgnLi4vLi4vYXBwbGljYXRpb25Qcm9qZWN0L3NoYXJlZC9tZXNzYWdlcycpO1xyXG5pbXBvcnQgQ29uc3RhbnRzID0gcmVxdWlyZSgnLi4vc2hhcmVkL2NvbnN0YW50cycpO1xyXG5pbXBvcnQgeyBQYXlVTW9uZXlNb2RlbCB9IGZyb20gJy4uLy4uL2ZyYW1ld29yay9kYXRhYWNjZXNzL21vZGVsL1BheVVNb25leU1vZGVsJztcclxuXHJcbmxldCBwYXl1bW9uZXkgPSByZXF1aXJlKCdwYXl1bW9uZXktbm9kZScpO1xyXG5sZXQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbnZhciBsb2c0anMgPSByZXF1aXJlKCdsb2c0anMnKTtcclxudmFyIGxvZ2dlcj1sb2c0anMuZ2V0TG9nZ2VyKCdzdWJzY3JpcHRpb24gU2VydmljZScpO1xyXG5cclxuY2xhc3MgU3Vic2NyaXB0aW9uU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBzdWJzY3JpcHRpb25SZXBvc2l0b3J5ID0gbmV3IFN1YnNjcmlwdGlvblJlcG9zaXRvcnkoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLnN1YnNjcmlwdGlvblJlcG9zaXRvcnkgPSBuZXcgU3Vic2NyaXB0aW9uUmVwb3NpdG9yeSgpO1xyXG4gIH1cclxuICBhZGRTdWJzY3JpcHRpb25QYWNrYWdlKHN1YnNjcmlwdGlvblBhY2thZ2U6IGFueSwgIGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uUmVwb3NpdG9yeS5jcmVhdGUoc3Vic2NyaXB0aW9uUGFja2FnZSwgKGVyciwgcmVzKSA9PiB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnIsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxvZ2dlci5pbmZvKCdzdWJzY3JpcHRpb24gc2VydmljZSwgY3JlYXRlIGhhcyBiZWVuIGhpdCcpO1xyXG4gICAgICAgIGxldCBwcm9qZWN0SWQgPSByZXMuX2lkO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0QmFzZVN1YnNjcmlwdGlvblBhY2thZ2VMaXN0KGNhbGxiYWNrOiAoZXJyb3I6IGFueSwgc3Vic2NyaXB0aW9uUGFja2FnZUxpc3Q6IEFycmF5PEJhc2VTdWJzY3JpcHRpb25QYWNrYWdlPikgPT4gdm9pZCkge1xyXG4gICAgbGV0IHF1ZXJ5ID0gW1xyXG4gICAgICB7JHVud2luZDogJyRiYXNlUGFja2FnZSd9LFxyXG4gICAgICB7JHByb2plY3Q6IHsnYmFzZVBhY2thZ2UnOiAxLCBfaWQ6MH19XHJcbiAgICBdO1xyXG5cclxuICAgIHRoaXMuc3Vic2NyaXB0aW9uUmVwb3NpdG9yeS5hZ2dyZWdhdGUocXVlcnksIChlcnJvciwgc3Vic2NyaXB0aW9uUGFja2FnZUxpc3QpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChzdWJzY3JpcHRpb25QYWNrYWdlTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgc3Vic2NyaXB0aW9uUGFja2FnZUxpc3QpO1xyXG4gICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgIGxldCBlcnJvciA9IG5ldyBFcnJvcigpO1xyXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSA9IG1lc3NhZ2VzLk1TR19FUlJPUl9TVUJTQ1JJUFRJT05fUEFDS0FHRVNfREVUQUlMU19BUkVfTk9UX0RFRklORUQ7XHJcbiAgICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFN1YnNjcmlwdGlvblBhY2thZ2VCeU5hbWUocGFja2FnZU5hbWUgOiBzdHJpbmcsIHBhY2thZ2VUeXBlOnN0cmluZywgY2FsbGJhY2s6KGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcbiAgICBsZXQgcXVlcnkgOiBhbnk7XHJcbiAgICBpZihwYWNrYWdlVHlwZSA9PT0gJ0Jhc2VQYWNrYWdlJykge1xyXG4gICAgICBxdWVyeSA9IHsgJ2Jhc2VQYWNrYWdlLm5hbWUnOiBwYWNrYWdlTmFtZX07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBxdWVyeSA9IHsgJ2FkZE9uUGFja2FnZS5uYW1lJzogcGFja2FnZU5hbWV9O1xyXG4gICAgfVxyXG4gICAgdGhpcy5zdWJzY3JpcHRpb25SZXBvc2l0b3J5LnJldHJpZXZlKHF1ZXJ5LCBjYWxsYmFjayk7XHJcbiAgfVxyXG5cclxuICBtYWtlUGF5VU1vbmV5UGF5bWVudChwYXltZW50Qm9keSA6IFBheVVNb25leU1vZGVsLCBjYWxsYmFjazooZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHZvaWQpIHtcclxuXHJcbiAgICBsZXQgTUVSQ0hBTlRfS0VZID0gY29uZmlnLmdldCgncGF5VU1vbmV5Lm1lcmNoZW50S2V5Jyk7XHJcbiAgICBsZXQgTUVSQ0hBTlRfU0FMVCA9IGNvbmZpZy5nZXQoJ3BheVVNb25leS5zYWx0S2V5Jyk7XHJcbiAgICBsZXQgQVVUSE9SSVpBVElPTl9IRUFERVIgPSBjb25maWcuZ2V0KCdwYXlVTW9uZXkuYXV0aEhlYWRlcicpO1xyXG4gICAgbGV0IElTX1BST0RfTU9ERSA9IGNvbmZpZy5nZXQoJ3BheVVNb25leS5pc1Byb2RNb2RlJyk7XHJcblxyXG4gICAgcGF5dW1vbmV5LnNldEtleXMoTUVSQ0hBTlRfS0VZLCBNRVJDSEFOVF9TQUxULCBBVVRIT1JJWkFUSU9OX0hFQURFUik7XHJcbiAgICBwYXl1bW9uZXkuaXNQcm9kTW9kZShJU19QUk9EX01PREUpO1xyXG5cclxuICAgIGxldCBwYXlVTW9uZXlNb2RlbCA9IG5ldyBQYXlVTW9uZXlNb2RlbCgpO1xyXG5cclxuICAgIHBheVVNb25leU1vZGVsLmZpcnN0bmFtZSA9IHBheW1lbnRCb2R5LmZpcnN0bmFtZTtcclxuICAgIHBheVVNb25leU1vZGVsLmxhc3RuYW1lID0gcGF5bWVudEJvZHkubGFzdG5hbWU7XHJcbiAgICBwYXlVTW9uZXlNb2RlbC5lbWFpbCA9IHBheW1lbnRCb2R5LmVtYWlsO1xyXG4gICAgcGF5VU1vbmV5TW9kZWwucGhvbmUgPSBwYXltZW50Qm9keS5waG9uZTtcclxuICAgIHBheVVNb25leU1vZGVsLnByb2R1Y3RpbmZvID0gcGF5bWVudEJvZHkucHJvZHVjdGluZm87XHJcbiAgICBwYXlVTW9uZXlNb2RlbC5hbW91bnQgPSBwYXltZW50Qm9keS5hbW91bnQ7XHJcbiAgICBwYXlVTW9uZXlNb2RlbC50eG5pZCA9IHRoaXMuZ2VuZXJhdGVUcmFuc2FjdGlvbklkKDMwKTtcclxuICAgIHBheVVNb25leU1vZGVsLmZ1cmwgPSBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5tYWlsLmhvc3QnKSsnYXBpL3N1YnNjcmlwdGlvbi9wYXltZW50L2ZhaWx1cmUnO1xyXG4gICAgcGF5VU1vbmV5TW9kZWwuc3VybCA9IGNvbmZpZy5nZXQoJ2FwcGxpY2F0aW9uLm1haWwuaG9zdCcpKydhcGkvc3Vic2NyaXB0aW9uL3BheW1lbnQvc3VjY2Vzcyc7XHJcblxyXG5cclxuICAgIHBheXVtb25leS5tYWtlUGF5bWVudChwYXlVTW9uZXlNb2RlbCwgZnVuY3Rpb24oZXJyb3I6YW55LCByZXNwb25zZTphbnkpIHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgLy8gU29tZSBlcnJvclxyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gUGF5bWVudCByZWRpcmVjdGlvbiBsaW5rXHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHsgJ2RhdGEnIDogcmVzcG9uc2UgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVUcmFuc2FjdGlvbklkKGxlbmd0aCA6IG51bWJlcikge1xyXG4gICAgbGV0IHRleHQgPSAnJztcclxuICAgIGxldCBwb3NzaWJsZSA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSc7XHJcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgdGV4dCArPSBwb3NzaWJsZS5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogcG9zc2libGUubGVuZ3RoKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGV4dDtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgPSBTdWJzY3JpcHRpb25TZXJ2aWNlO1xyXG4iXX0=
