"use strict";
var ProjectRepository = require("../dataaccess/repository/ProjectRepository");
var BuildingRepository = require("../dataaccess/repository/BuildingRepository");
var UserService = require("./../../framework/services/UserService");
var ProjectAsset = require("../../framework/shared/projectasset");
var BuildingReport = require("../dataaccess/model/project/reports/BuildingReport");
var ThumbRuleReport = require("../dataaccess/model/project/reports/ThumbRuleReport");
var AuthInterceptor = require("../../framework/interceptor/auth.interceptor");
var EstimateReport = require("../dataaccess/model/project/reports/EstimateReport");
var ProjectReport = require("../dataaccess/model/project/reports/ProjectReport");
var ThumbRule = require("../dataaccess/model/project/building/ThumbRule");
var Estimate = require("../dataaccess/model/project/building/Estimate");
var RateAnalysisService = require("./RateAnalysisService");
var alasql = require("alasql");
var Constants = require("../shared/constants");
var config = require('config');
var log4js = require('log4js');
var logger = log4js.getLogger('Report Service');
var ReportService = (function () {
    function ReportService() {
        this.category = [];
        this.reportThumbrule = [];
        this.projectRepository = new ProjectRepository();
        this.buildingRepository = new BuildingRepository();
        this.APP_NAME = ProjectAsset.APP_NAME;
        this.authInterceptor = new AuthInterceptor();
        this.userService = new UserService();
        this.rateAnalysisService = new RateAnalysisService();
    }
    ReportService.prototype.getReport = function (projectId, reportType, rateUnit, areaType, user, callback) {
        var _this = this;
        logger.info('Report Service, getReport has been hit');
        var query = { _id: projectId };
        var populate = { path: 'buildings' };
        this.projectRepository.findAndPopulate(query, populate, function (error, result) {
            logger.info('Report Service, findAndPopulate has been hit');
            if (error) {
                callback(error, null);
            }
            else {
                var buildings = result[0].buildings;
                if (areaType === 'slabArea') {
                    var typeOfArea = 'totalSlabArea';
                }
                else if (areaType === 'saleableArea') {
                    typeOfArea = 'totalSaleableAreaOfUnit';
                }
                else if (areaType === 'carpetArea') {
                    typeOfArea = 'totalCarpetAreaOfUnit';
                }
                var totalArea = alasql('VALUE OF SELECT SUM(' + typeOfArea + ') FROM ?', [buildings]);
                var projectCostHeads = result[0].projectCostHeads;
                var projectReport = new ProjectReport();
                var buildingReport = new Array();
                _this.generateReportByCostHeads('buildingReport', buildings, areaType, rateUnit, buildingReport);
                projectReport.buildings = buildingReport;
                var commonAmenitiesReport = new Array();
                _this.generateReportForProjectCostHeads('commonAmenitiesReport', projectCostHeads, totalArea, areaType, rateUnit, commonAmenitiesReport);
                projectReport.commonAmenities = commonAmenitiesReport;
                callback(null, { data: projectReport, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.generateReportByCostHeads = function (reportType, buildings, areaType, rateUnit, report) {
        for (var index = 0; index < buildings.length; index++) {
            var buildingReport = new BuildingReport;
            var thumbRuleReport = new ThumbRule();
            var estimatedReport = new Estimate();
            buildingReport.name = buildings[index].name;
            buildingReport._id = buildings[index]._id;
            if (areaType === 'slabArea') {
                if (rateUnit === 'sqmt') {
                    buildingReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                }
                else {
                    buildingReport.area = parseFloat((buildings[index].totalSlabArea).toFixed(2));
                }
            }
            else {
                if (rateUnit === 'sqmt') {
                    buildingReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                }
                else {
                    buildingReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit).toFixed(2));
                }
            }
            var costHeadArray = buildings[index].costHeads;
            for (var costHeadIndex = 0; costHeadIndex < costHeadArray.length; costHeadIndex++) {
                if (costHeadArray[costHeadIndex].active === true) {
                    var thumbRule = new ThumbRuleReport();
                    var estimateReport = new EstimateReport();
                    thumbRule.name = costHeadArray[costHeadIndex].name;
                    estimateReport.name = costHeadArray[costHeadIndex].name;
                    thumbRule.rateAnalysisId = costHeadArray[costHeadIndex].rateAnalysisId;
                    estimateReport.rateAnalysisId = costHeadArray[costHeadIndex].rateAnalysisId;
                    if (areaType === 'slabArea') {
                        thumbRuleReport.area = buildings[index].totalSlabArea;
                        estimatedReport.area = buildings[index].totalSlabArea;
                        if (rateUnit === 'sqft') {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.slabArea.sqft).toFixed(2));
                        }
                        else {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.slabArea.sqmt).toFixed(2));
                            thumbRuleReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                            estimatedReport.area = parseFloat((buildings[index].totalSlabArea * config.get('SqureMeter')).toFixed(2));
                        }
                    }
                    else {
                        thumbRuleReport.area = buildings[index].totalSaleableAreaOfUnit;
                        estimatedReport.area = buildings[index].totalSaleableAreaOfUnit;
                        if (rateUnit === 'sqft') {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.saleableArea.sqft).toFixed(2));
                        }
                        else {
                            thumbRule.rate = parseFloat((costHeadArray[costHeadIndex].thumbRuleRate.saleableArea.sqmt).toFixed(2));
                            thumbRuleReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                            estimatedReport.area = parseFloat((buildings[index].totalSaleableAreaOfUnit * config.get('SqureMeter')).toFixed(2));
                        }
                    }
                    var category = costHeadArray[costHeadIndex].categories;
                    if (category.length !== 0) {
                        for (var categoryKey in category) {
                            var workItem = category[categoryKey].workItems;
                            if (workItem.length !== 0) {
                                for (var key in workItem) {
                                    if (workItem[key].quantity.total !== null && workItem[key].rate.total !== null
                                        && workItem[key].quantity.total !== 0 && workItem[key].rate.total !== 0) {
                                        estimateReport.total = parseFloat((workItem[key].quantity.total * workItem[key].rate.total
                                            + estimateReport.total).toFixed(2));
                                        estimateReport.rate = parseFloat((estimateReport.total / buildingReport.area).toFixed(2));
                                    }
                                    else {
                                    }
                                }
                            }
                            else {
                            }
                        }
                    }
                    estimatedReport.totalEstimatedCost = parseFloat((estimateReport.total + estimatedReport.totalEstimatedCost).toFixed(2));
                    estimatedReport.totalRate = parseFloat((estimatedReport.totalRate + estimateReport.rate).toFixed(2));
                    estimatedReport.estimatedCosts.push(estimateReport);
                    if (costHeadArray[costHeadIndex].budgetedCostAmount === 0 ||
                        costHeadArray[costHeadIndex].budgetedCostAmount === undefined) {
                        thumbRule.amount = parseFloat((thumbRuleReport.area * thumbRule.rate).toFixed(2));
                    }
                    else {
                        thumbRule.amount = parseFloat((costHeadArray[costHeadIndex].budgetedCostAmount).toFixed(2));
                    }
                    thumbRule.costHeadActive = costHeadArray[costHeadIndex].active;
                    thumbRuleReport.thumbRuleReports.push(thumbRule);
                    thumbRuleReport.totalRate = parseFloat((thumbRuleReport.totalRate + thumbRule.rate).toFixed(2));
                    thumbRuleReport.totalBudgetedCost = parseFloat((thumbRuleReport.totalBudgetedCost + thumbRule.amount).toFixed(2));
                    buildingReport.estimate = estimatedReport;
                    buildingReport.thumbRule = thumbRuleReport;
                }
            }
            report.push(buildingReport);
        }
    };
    ReportService.prototype.generateReportForProjectCostHeads = function (reportType, projectCostHeads, totalArea, areaType, rateUnit, report) {
        var projectCostHeadArray = projectCostHeads;
        var projectReport = new BuildingReport;
        var thumbRuleReport = new ThumbRule();
        var estimatedReport = new Estimate();
        for (var projectCostHeadIndex in projectCostHeadArray) {
            if (projectCostHeadArray[projectCostHeadIndex].active === true) {
                var thumbRule = new ThumbRuleReport();
                var estimateReport = new EstimateReport();
                estimateReport.name = projectCostHeadArray[projectCostHeadIndex].name;
                estimateReport.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                var categoryArray = projectCostHeadArray[projectCostHeadIndex].categories;
                for (var categoryIndex in categoryArray) {
                    var workItemArray = categoryArray[categoryIndex].workItems;
                    if (workItemArray.length !== 0) {
                        for (var workItemIndex in workItemArray) {
                            if (workItemArray[workItemIndex].quantity.total !== null && workItemArray[workItemIndex].rate.total !== null
                                && workItemArray[workItemIndex].quantity.total !== 0 && workItemArray[workItemIndex].rate.total !== 0) {
                                estimateReport.total = parseFloat((workItemArray[workItemIndex].quantity.total * workItemArray[workItemIndex].rate.total
                                    + estimateReport.total).toFixed(2));
                                estimateReport.rate = parseFloat((estimateReport.total / totalArea).toFixed(2));
                            }
                            else {
                                estimateReport.total = 0.0;
                                estimateReport.rate = 0.0;
                                break;
                            }
                        }
                    }
                }
                estimatedReport.totalEstimatedCost = parseFloat((estimateReport.total + estimatedReport.totalEstimatedCost).toFixed(2));
                estimatedReport.totalRate = parseFloat((estimatedReport.totalRate + estimateReport.rate).toFixed(2));
                estimatedReport.estimatedCosts.push(estimateReport);
                thumbRule.name = projectCostHeadArray[projectCostHeadIndex].name;
                thumbRule.rateAnalysisId = projectCostHeadArray[projectCostHeadIndex].rateAnalysisId;
                thumbRule.amount = parseFloat((projectCostHeadArray[projectCostHeadIndex].budgetedCostAmount).toFixed(2));
                if (rateUnit === Constants.WORKITEM_UNIT) {
                    thumbRule.rate = parseFloat((thumbRule.amount / totalArea).toFixed(2));
                }
                else {
                    thumbRuleReport.area = thumbRule.amount * config.get(Constants.SQUARE_METER);
                    thumbRule.rate = parseFloat((thumbRule.amount / thumbRuleReport.area).toFixed(2));
                }
                thumbRuleReport.totalRate = parseFloat((thumbRuleReport.totalRate + thumbRule.rate).toFixed(2));
                thumbRuleReport.totalBudgetedCost = parseFloat((thumbRuleReport.totalBudgetedCost + thumbRule.amount).toFixed(2));
                thumbRuleReport.thumbRuleReports.push(thumbRule);
                projectReport.thumbRule = thumbRuleReport;
                projectReport.estimate = estimatedReport;
            }
        }
        report.push(projectReport);
    };
    ReportService.prototype.getCostHeads = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getCostHeads has been hit');
        this.rateAnalysisService.getCostHeads(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    ReportService.prototype.getWorkItems = function (url, user, callback) {
        var _this = this;
        logger.info('Report Service, getWorkItems has been hit');
        this.rateAnalysisService.getWorkItems(url, user, function (error, result) {
            if (error) {
                console.log('error : ' + JSON.stringify(error));
                callback(error, null);
            }
            else {
                callback(null, { data: result, access_token: _this.authInterceptor.issueTokenWithUid(user) });
            }
        });
    };
    return ReportService;
}());
Object.seal(ReportService);
module.exports = ReportService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9hcHBsaWNhdGlvblByb2plY3Qvc2VydmljZXMvUmVwb3J0U2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEVBQWlGO0FBQ2pGLGdGQUFtRjtBQUVuRixvRUFBdUU7QUFDdkUsa0VBQXFFO0FBSXJFLG1GQUFzRjtBQUN0RixxRkFBd0Y7QUFDeEYsOEVBQWlGO0FBR2pGLG1GQUFzRjtBQUN0RixpRkFBb0Y7QUFFcEYsMEVBQTZFO0FBQzdFLHdFQUEyRTtBQUMzRSwyREFBOEQ7QUFFOUQsK0JBQWtDO0FBQ2xDLCtDQUFrRDtBQUNsRCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksTUFBTSxHQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUU5QztJQVlFO1FBSFEsYUFBUSxHQUFLLEVBQUUsQ0FBQztRQUNoQixvQkFBZSxHQUFPLEVBQUUsQ0FBQztRQUcvQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1FBQ2pELElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLGtCQUFrQixFQUFFLENBQUM7UUFDbkQsSUFBSSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUUsQ0FBQztRQUM3QyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztJQUV2RCxDQUFDO0lBRUQsaUNBQVMsR0FBVCxVQUFXLFNBQWUsRUFBRSxVQUFtQixFQUFFLFFBQWlCLEVBQUUsUUFBaUIsRUFBRyxJQUFVLEVBQ3ZGLFFBQTJDO1FBRHRELGlCQWdDQztRQTdCQyxNQUFNLENB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SyxFQUFFLE1BQU07WUFDN0QsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDeEIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUM3RixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUgsb0JBQUM7QUFBRCxDQWpQQSxBQWlQQyxJQUFBO0FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUMzQixpQkFBUyxhQUFhLENBQUMiLCJmaWxlIjoiYXBwL2FwcGxpY2F0aW9uUHJvamVjdC9zZXJ2aWNlcy9SZXBvcnRTZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb2plY3RSZXBvc2l0b3J5ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9yZXBvc2l0b3J5L1Byb2plY3RSZXBvc2l0b3J5Jyk7XHJcbmltcG9ydCBCdWlsZGluZ1JlcG9zaXRvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL3JlcG9zaXRvcnkvQnVpbGRpbmdSZXBvc2l0b3J5Jyk7XHJcbmltcG9ydCBNZXNzYWdlcyA9IHJlcXVpcmUoJy4uL3NoYXJlZC9tZXNzYWdlcycpO1xyXG5pbXBvcnQgVXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLy4uLy4uL2ZyYW1ld29yay9zZXJ2aWNlcy9Vc2VyU2VydmljZScpO1xyXG5pbXBvcnQgUHJvamVjdEFzc2V0ID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL3NoYXJlZC9wcm9qZWN0YXNzZXQnKTtcclxuaW1wb3J0IFVzZXIgPSByZXF1aXJlKCcuLi8uLi9mcmFtZXdvcmsvZGF0YWFjY2Vzcy9tb25nb29zZS91c2VyJyk7XHJcbmltcG9ydCBQcm9qZWN0ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb25nb29zZS9Qcm9qZWN0Jyk7XHJcbmltcG9ydCBCdWlsZGluZyA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9uZ29vc2UvQnVpbGRpbmcnKTtcclxuaW1wb3J0IEJ1aWxkaW5nUmVwb3J0ID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L3JlcG9ydHMvQnVpbGRpbmdSZXBvcnQnKTtcclxuaW1wb3J0IFRodW1iUnVsZVJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1RodW1iUnVsZVJlcG9ydCcpO1xyXG5pbXBvcnQgQXV0aEludGVyY2VwdG9yID0gcmVxdWlyZSgnLi4vLi4vZnJhbWV3b3JrL2ludGVyY2VwdG9yL2F1dGguaW50ZXJjZXB0b3InKTtcclxuaW1wb3J0IENvc3RDb250cm9sbEV4Y2VwdGlvbiA9IHJlcXVpcmUoJy4uL2V4Y2VwdGlvbi9Db3N0Q29udHJvbGxFeGNlcHRpb24nKTtcclxuaW1wb3J0IENvc3RIZWFkID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb25nb29zZS9Db3N0SGVhZCcpO1xyXG5pbXBvcnQgRXN0aW1hdGVSZXBvcnQgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvcmVwb3J0cy9Fc3RpbWF0ZVJlcG9ydCcpO1xyXG5pbXBvcnQgUHJvamVjdFJlcG9ydCA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9yZXBvcnRzL1Byb2plY3RSZXBvcnQnKTtcclxuaW1wb3J0IFdvcmtJdGVtID0gcmVxdWlyZSgnLi4vZGF0YWFjY2Vzcy9tb2RlbC9wcm9qZWN0L2J1aWxkaW5nL1dvcmtJdGVtJyk7XHJcbmltcG9ydCBUaHVtYlJ1bGUgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvYnVpbGRpbmcvVGh1bWJSdWxlJyk7XHJcbmltcG9ydCBFc3RpbWF0ZSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvbW9kZWwvcHJvamVjdC9idWlsZGluZy9Fc3RpbWF0ZScpO1xyXG5pbXBvcnQgUmF0ZUFuYWx5c2lzU2VydmljZSA9IHJlcXVpcmUoJy4vUmF0ZUFuYWx5c2lzU2VydmljZScpO1xyXG5pbXBvcnQgQ2F0ZWdvcnkgPSByZXF1aXJlKCcuLi9kYXRhYWNjZXNzL21vZGVsL3Byb2plY3QvYnVpbGRpbmcvQ2F0ZWdvcnknKTtcclxuaW1wb3J0IGFsYXNxbCA9IHJlcXVpcmUoJ2FsYXNxbCcpO1xyXG5pbXBvcnQgQ29uc3RhbnRzID0gcmVxdWlyZSgnLi4vc2hhcmVkL2NvbnN0YW50cycpO1xyXG5sZXQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbnZhciBsb2c0anMgPSByZXF1aXJlKCdsb2c0anMnKTtcclxudmFyIGxvZ2dlcj1sb2c0anMuZ2V0TG9nZ2VyKCdSZXBvcnQgU2VydmljZScpO1xyXG5cclxuY2xhc3MgUmVwb3J0U2VydmljZSB7XHJcbiAgQVBQX05BTUU6IHN0cmluZztcclxuICBjb21wYW55X25hbWU6IHN0cmluZztcclxuICBwcml2YXRlIHByb2plY3RSZXBvc2l0b3J5OiBQcm9qZWN0UmVwb3NpdG9yeTtcclxuICBwcml2YXRlIGJ1aWxkaW5nUmVwb3NpdG9yeTogQnVpbGRpbmdSZXBvc2l0b3J5O1xyXG4gIHByaXZhdGUgYXV0aEludGVyY2VwdG9yOiBBdXRoSW50ZXJjZXB0b3I7XHJcbiAgcHJpdmF0ZSB1c2VyU2VydmljZSA6IFVzZXJTZXJ2aWNlO1xyXG4gIHByaXZhdGUgcmF0ZUFuYWx5c2lzU2VydmljZSA6IFJhdGVBbmFseXNpc1NlcnZpY2U7XHJcblxyXG4gIHByaXZhdGUgY2F0ZWdvcnk6YW55PVtdO1xyXG4gIHByaXZhdGUgcmVwb3J0VGh1bWJydWxlOmFueSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMucHJvamVjdFJlcG9zaXRvcnkgPSBuZXcgUHJvamVjdFJlcG9zaXRvcnkoKTtcclxuICAgIHRoaXMuYnVpbGRpbmdSZXBvc2l0b3J5ID0gbmV3IEJ1aWxkaW5nUmVwb3NpdG9yeSgpO1xyXG4gICAgdGhpcy5BUFBfTkFNRSA9IFByb2plY3RBc3NldC5BUFBfTkFNRTtcclxuICAgIHRoaXMuYXV0aEludGVyY2VwdG9yID0gbmV3IEF1dGhJbnRlcmNlcHRvcigpO1xyXG4gICAgdGhpcy51c2VyU2VydmljZSA9IG5ldyBVc2VyU2VydmljZSgpO1xyXG4gICAgdGhpcy5yYXRlQW5hbHlzaXNTZXJ2aWNlID0gbmV3IFJhdGVBbmFseXNpc1NlcnZpY2UoKTtcclxuICAgIC8vdGhpcy5jYXRlZ29yeURldGFpbHMgPSBuZXcgY2F0ZWdvcnlEZXRhaWxzKCk7XHJcbiAgfVxyXG5cclxuICBnZXRSZXBvcnQoIHByb2plY3RJZCA6IGFueSwgcmVwb3J0VHlwZSA6IHN0cmluZywgcmF0ZVVuaXQgOiBzdHJpbmcsIGFyZWFUeXBlIDogc3RyaW5nLOKAguKAgnVzZXI6IFVzZXIsXHJcbiAgICAgICAgICAgICBjYWxsYmFjazogKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB2b2lkKSB7XHJcblxyXG4gICAgbG9nZ2VyLmluZm8oJ1JlcG9ydCBTZXJ2aWNlLCBnZXRSZXBvcnQgaGFzIGJlZW4gaGl0Jyk7XHJcbiAgICBsZXQgcXVlcnkgPSB7IF9pZDogcHJvamVjdElkfTtcclxuICAgIGxldCBwb3B1bGF0ZSA9IHtwYXRoIDogJ2J1aWxkaW5ncyd9O1xyXG4gICAgdGhpcy5wcm9qZWN0UmVwb3NpdG9yeS5maW5kQW5kUG9wdWxhdGUocXVlcnksIHBvcHVsYXRlLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xyXG4gICAgICBsb2dnZXIuaW5mbygnUmVwb3J0IFNlcnZpY2UsIGZpbmRBbmRQb3B1bGF0ZSBoYXMgYmVlbiBoaXQnKTtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IGJ1aWxkaW5ncyA9IHJlc3VsdFswXS5idWlsZGluZ3M7XHJcbiAgICAgICAgaWYgKGFyZWFUeXBlID09PSAnc2xhYkFyZWEnKSB7XHJcbiAgICAgICAgICAgIHZhciB0eXBlT2ZBcmVhID0gJ3RvdGFsU2xhYkFyZWEnO1xyXG4gICAgICAgICAgfSBlbHNlIGlmIChhcmVhVHlwZSA9PT0gJ3NhbGVhYmxlQXJlYScpIHtcclxuICAgICAgICAgICAgdHlwZU9mQXJlYSA9ICd0b3RhbFNhbGVhYmxlQXJlYU9mVW5pdCc7XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGFyZWFUeXBlID09PSAnY2FycGV0QXJlYScpIHtcclxuICAgICAgICAgICAgdHlwZU9mQXJlYSA9ICd0b3RhbENhcnBldEFyZWFPZlVuaXQnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIGxldCB0b3RhbEFyZWEgPSBhbGFzcWwoJ1ZBTFVFIE9GIFNFTEVDVCBTVU0oJyt0eXBlT2ZBcmVhKycpIEZST00gPycsW2J1aWxkaW5nc10pO1xyXG4gICAgICAgIGxldCBwcm9qZWN0Q29zdEhlYWRzID0gcmVzdWx0WzBdLnByb2plY3RDb3N0SGVhZHM7XHJcbiAgICAgICAgbGV0IHByb2plY3RSZXBvcnQgOiBQcm9qZWN0UmVwb3J0ID0gbmV3IFByb2plY3RSZXBvcnQoKTtcclxuICAgICAgICBsZXQgYnVpbGRpbmdSZXBvcnQgOiBBcnJheTxCdWlsZGluZ1JlcG9ydD4gPSBuZXcgQXJyYXk8QnVpbGRpbmdSZXBvcnQ+KCk7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZVJlcG9ydEJ5Q29zdEhlYWRzKCAnYnVpbGRpbmdSZXBvcnQnLCBidWlsZGluZ3MsIGFyZWFUeXBlLCByYXRlVW5pdCwgYnVpbGRpbmdSZXBvcnQpO1xyXG4gICAgICAgIHByb2plY3RSZXBvcnQuYnVpbGRpbmdzID0gYnVpbGRpbmdSZXBvcnQ7XHJcbiAgICAgICAgbGV0IGNvbW1vbkFtZW5pdGllc1JlcG9ydCA6IEFycmF5PEJ1aWxkaW5nUmVwb3J0PiA9IG5ldyBBcnJheTxCdWlsZGluZ1JlcG9ydD4oKTtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlUmVwb3J0Rm9yUHJvamVjdENvc3RIZWFkcygnY29tbW9uQW1lbml0aWVzUmVwb3J0Jyxwcm9qZWN0Q29zdEhlYWRzICx0b3RhbEFyZWEsXHJcbiAgICAgICAgICBhcmVhVHlwZSwgcmF0ZVVuaXQsIGNvbW1vbkFtZW5pdGllc1JlcG9ydCk7XHJcbiAgICAgICAgcHJvamVjdFJlcG9ydC5jb21tb25BbWVuaXRpZXMgPSBjb21tb25BbWVuaXRpZXNSZXBvcnQ7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCx7IGRhdGE6IHByb2plY3RSZXBvcnQsIGFjY2Vzc190b2tlbjogdGhpcy5hdXRoSW50ZXJjZXB0b3IuaXNzdWVUb2tlbldpdGhVaWQodXNlcil9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZVJlcG9ydEJ5Q29zdEhlYWRzKCByZXBvcnRUeXBlIDogc3RyaW5nLCBidWlsZGluZ3M6ICBBcnJheTxCdWlsZGluZz4gLCBhcmVhVHlwZTogc3RyaW5nLCByYXRlVW5pdDogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydDogQXJyYXk8QnVpbGRpbmdSZXBvcnQ+KSB7XHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYnVpbGRpbmdzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBsZXQgYnVpbGRpbmdSZXBvcnQgPSBuZXcgQnVpbGRpbmdSZXBvcnQ7XHJcbiAgICAgIGxldCB0aHVtYlJ1bGVSZXBvcnQ6IFRodW1iUnVsZSA9IG5ldyBUaHVtYlJ1bGUoKTtcclxuICAgICAgbGV0IGVzdGltYXRlZFJlcG9ydDogRXN0aW1hdGUgPSBuZXcgRXN0aW1hdGUoKTtcclxuICAgICAgYnVpbGRpbmdSZXBvcnQubmFtZSA9IGJ1aWxkaW5nc1tpbmRleF0ubmFtZTtcclxuICAgICAgYnVpbGRpbmdSZXBvcnQuX2lkID0gYnVpbGRpbmdzW2luZGV4XS5faWQ7XHJcbiAgICAgIGlmIChhcmVhVHlwZSA9PT0gJ3NsYWJBcmVhJykge1xyXG4gICAgICAgIGlmIChyYXRlVW5pdCA9PT0gJ3NxbXQnKSB7XHJcbiAgICAgICAgICBidWlsZGluZ1JlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNsYWJBcmVhICogY29uZmlnLmdldCgnU3F1cmVNZXRlcicpKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYnVpbGRpbmdSZXBvcnQuYXJlYSA9IHBhcnNlRmxvYXQoKGJ1aWxkaW5nc1tpbmRleF0udG90YWxTbGFiQXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChyYXRlVW5pdCA9PT0gJ3NxbXQnKSB7XHJcbiAgICAgICAgICBidWlsZGluZ1JlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNhbGVhYmxlQXJlYU9mVW5pdCAqIGNvbmZpZy5nZXQoJ1NxdXJlTWV0ZXInKSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGJ1aWxkaW5nUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2FsZWFibGVBcmVhT2ZVbml0KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGNvc3RIZWFkQXJyYXk6IGFueSA9IGJ1aWxkaW5nc1tpbmRleF0uY29zdEhlYWRzO1xyXG4gICAgICBmb3IgKGxldCBjb3N0SGVhZEluZGV4ID0gMDsgY29zdEhlYWRJbmRleCA8IGNvc3RIZWFkQXJyYXkubGVuZ3RoOyBjb3N0SGVhZEluZGV4KyspIHtcclxuXHJcbiAgICAgICAgaWYgKGNvc3RIZWFkQXJyYXlbY29zdEhlYWRJbmRleF0uYWN0aXZlID09PSB0cnVlKSB7XHJcblxyXG4gICAgICAgICAgbGV0IHRodW1iUnVsZTogVGh1bWJSdWxlUmVwb3J0ID0gbmV3IFRodW1iUnVsZVJlcG9ydCgpO1xyXG4gICAgICAgICAgbGV0IGVzdGltYXRlUmVwb3J0OiBFc3RpbWF0ZVJlcG9ydCA9IG5ldyBFc3RpbWF0ZVJlcG9ydCgpO1xyXG4gICAgICAgICAgdGh1bWJSdWxlLm5hbWUgPSBjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLm5hbWU7XHJcbiAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5uYW1lID0gY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5uYW1lO1xyXG4gICAgICAgICAgdGh1bWJSdWxlLnJhdGVBbmFseXNpc0lkID0gY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5yYXRlQW5hbHlzaXNJZDtcclxuICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnJhdGVBbmFseXNpc0lkID0gY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5yYXRlQW5hbHlzaXNJZDtcclxuICAgICAgICAgIGlmIChhcmVhVHlwZSA9PT0gJ3NsYWJBcmVhJykge1xyXG4gICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuYXJlYSA9IGJ1aWxkaW5nc1tpbmRleF0udG90YWxTbGFiQXJlYTtcclxuICAgICAgICAgICAgZXN0aW1hdGVkUmVwb3J0LmFyZWEgPSBidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2xhYkFyZWE7XHJcbiAgICAgICAgICAgIGlmIChyYXRlVW5pdCA9PT0gJ3NxZnQnKSB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLnJhdGUgPSBwYXJzZUZsb2F0KChjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnRodW1iUnVsZVJhdGUuc2xhYkFyZWEuc3FmdCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLnJhdGUgPSBwYXJzZUZsb2F0KChjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnRodW1iUnVsZVJhdGUuc2xhYkFyZWEuc3FtdCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LmFyZWEgPSBwYXJzZUZsb2F0KChidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2xhYkFyZWEgKiBjb25maWcuZ2V0KCdTcXVyZU1ldGVyJykpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgIGVzdGltYXRlZFJlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNsYWJBcmVhICogY29uZmlnLmdldCgnU3F1cmVNZXRlcicpKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LmFyZWEgPSBidWlsZGluZ3NbaW5kZXhdLnRvdGFsU2FsZWFibGVBcmVhT2ZVbml0O1xyXG4gICAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQuYXJlYSA9IGJ1aWxkaW5nc1tpbmRleF0udG90YWxTYWxlYWJsZUFyZWFPZlVuaXQ7XHJcbiAgICAgICAgICAgIGlmIChyYXRlVW5pdCA9PT0gJ3NxZnQnKSB7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLnJhdGUgPSBwYXJzZUZsb2F0KChjb3N0SGVhZEFycmF5W2Nvc3RIZWFkSW5kZXhdLnRodW1iUnVsZVJhdGUuc2FsZWFibGVBcmVhLnNxZnQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIHRodW1iUnVsZS5yYXRlID0gcGFyc2VGbG9hdCgoY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS50aHVtYlJ1bGVSYXRlLnNhbGVhYmxlQXJlYS5zcW10KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQuYXJlYSA9IHBhcnNlRmxvYXQoKGJ1aWxkaW5nc1tpbmRleF0udG90YWxTYWxlYWJsZUFyZWFPZlVuaXQgKiBjb25maWcuZ2V0KCdTcXVyZU1ldGVyJykpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgIGVzdGltYXRlZFJlcG9ydC5hcmVhID0gcGFyc2VGbG9hdCgoYnVpbGRpbmdzW2luZGV4XS50b3RhbFNhbGVhYmxlQXJlYU9mVW5pdCAqIGNvbmZpZy5nZXQoJ1NxdXJlTWV0ZXInKSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGxldCBjYXRlZ29yeTogQXJyYXk8Q2F0ZWdvcnk+ID0gY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5jYXRlZ29yaWVzO1xyXG4gICAgICAgICAgaWYgKGNhdGVnb3J5Lmxlbmd0aCAhPT0gMCkge1xyXG5cclxuICAgICAgICAgICAgZm9yIChsZXQgY2F0ZWdvcnlLZXkgaW4gY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgICBsZXQgd29ya0l0ZW0gPSBjYXRlZ29yeVtjYXRlZ29yeUtleV0ud29ya0l0ZW1zO1xyXG4gICAgICAgICAgICAgIGlmICh3b3JrSXRlbS5sZW5ndGggIT09IDApIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiB3b3JrSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICBpZiAod29ya0l0ZW1ba2V5XS5xdWFudGl0eS50b3RhbCAhPT0gbnVsbCAmJiB3b3JrSXRlbVtrZXldLnJhdGUudG90YWwgIT09IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAmJiB3b3JrSXRlbVtrZXldLnF1YW50aXR5LnRvdGFsICE9PSAwICYmIHdvcmtJdGVtW2tleV0ucmF0ZS50b3RhbCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnRvdGFsID0gcGFyc2VGbG9hdCgod29ya0l0ZW1ba2V5XS5xdWFudGl0eS50b3RhbCAqIHdvcmtJdGVtW2tleV0ucmF0ZS50b3RhbFxyXG4gICAgICAgICAgICAgICAgICAgICAgKyBlc3RpbWF0ZVJlcG9ydC50b3RhbCkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IHBhcnNlRmxvYXQoKGVzdGltYXRlUmVwb3J0LnRvdGFsIC8gYnVpbGRpbmdSZXBvcnQuYXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLyplc3RpbWF0ZVJlcG9ydC50b3RhbCA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvKmVzdGltYXRlUmVwb3J0LnRvdGFsID0gMC4wO1xyXG4gICAgICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnJhdGUgPSAwLjA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7Ki9cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQudG90YWxFc3RpbWF0ZWRDb3N0ID0gcGFyc2VGbG9hdCgoZXN0aW1hdGVSZXBvcnQudG90YWwgKyBlc3RpbWF0ZWRSZXBvcnQudG90YWxFc3RpbWF0ZWRDb3N0KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIGVzdGltYXRlZFJlcG9ydC50b3RhbFJhdGUgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZWRSZXBvcnQudG90YWxSYXRlICsgZXN0aW1hdGVSZXBvcnQucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQuZXN0aW1hdGVkQ29zdHMucHVzaChlc3RpbWF0ZVJlcG9ydCk7XHJcbiAgICAgICAgICBpZiAoY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5idWRnZXRlZENvc3RBbW91bnQgPT09IDAgfHxcclxuICAgICAgICAgICAgY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5idWRnZXRlZENvc3RBbW91bnQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHVtYlJ1bGUuYW1vdW50ID0gcGFyc2VGbG9hdCgodGh1bWJSdWxlUmVwb3J0LmFyZWEgKiB0aHVtYlJ1bGUucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHVtYlJ1bGUuYW1vdW50ID0gcGFyc2VGbG9hdCgoY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5idWRnZXRlZENvc3RBbW91bnQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdGh1bWJSdWxlLmNvc3RIZWFkQWN0aXZlID0gY29zdEhlYWRBcnJheVtjb3N0SGVhZEluZGV4XS5hY3RpdmU7XHJcbiAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQudGh1bWJSdWxlUmVwb3J0cy5wdXNoKHRodW1iUnVsZSk7XHJcbiAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQudG90YWxSYXRlID0gcGFyc2VGbG9hdCgodGh1bWJSdWxlUmVwb3J0LnRvdGFsUmF0ZSArIHRodW1iUnVsZS5yYXRlKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC50b3RhbEJ1ZGdldGVkQ29zdCA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC50b3RhbEJ1ZGdldGVkQ29zdCArIHRodW1iUnVsZS5hbW91bnQpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgYnVpbGRpbmdSZXBvcnQuZXN0aW1hdGUgPSBlc3RpbWF0ZWRSZXBvcnQ7XHJcbiAgICAgICAgICBidWlsZGluZ1JlcG9ydC50aHVtYlJ1bGUgPSB0aHVtYlJ1bGVSZXBvcnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHJlcG9ydC5wdXNoKGJ1aWxkaW5nUmVwb3J0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuZ2VuZXJhdGVSZXBvcnRGb3JQcm9qZWN0Q29zdEhlYWRzKCByZXBvcnRUeXBlIDogc3RyaW5nLCBwcm9qZWN0Q29zdEhlYWRzOiAgQXJyYXk8Q29zdEhlYWQ+LCB0b3RhbEFyZWE6IG51bWJlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmVhVHlwZTogc3RyaW5nLCByYXRlVW5pdDogc3RyaW5nLCByZXBvcnQ6IEFycmF5PEJ1aWxkaW5nUmVwb3J0Pikge1xyXG5cclxuICAgICAgbGV0IHByb2plY3RDb3N0SGVhZEFycmF5OiBBcnJheTxDb3N0SGVhZD4gPSBwcm9qZWN0Q29zdEhlYWRzO1xyXG4gICAgICBsZXQgcHJvamVjdFJlcG9ydCA9IG5ldyBCdWlsZGluZ1JlcG9ydDtcclxuICAgICAgbGV0IHRodW1iUnVsZVJlcG9ydDogVGh1bWJSdWxlID0gbmV3IFRodW1iUnVsZSgpO1xyXG4gICAgICBsZXQgZXN0aW1hdGVkUmVwb3J0IDogRXN0aW1hdGUgPSBuZXcgRXN0aW1hdGUoKTtcclxuXHJcbiAgICAgICBmb3IgKGxldCBwcm9qZWN0Q29zdEhlYWRJbmRleCBpbiBwcm9qZWN0Q29zdEhlYWRBcnJheSkge1xyXG5cclxuICAgICAgICAgaWYgKHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5hY3RpdmUgPT09IHRydWUpIHtcclxuXHJcbiAgICAgICAgICBsZXQgdGh1bWJSdWxlOiBUaHVtYlJ1bGVSZXBvcnQgPSBuZXcgVGh1bWJSdWxlUmVwb3J0KCk7XHJcbiAgICAgICAgICBsZXQgZXN0aW1hdGVSZXBvcnQ6IEVzdGltYXRlUmVwb3J0ID0gbmV3IEVzdGltYXRlUmVwb3J0KCk7XHJcblxyXG4gICAgICAgICAgIGVzdGltYXRlUmVwb3J0Lm5hbWUgPSBwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0ubmFtZTtcclxuICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5yYXRlQW5hbHlzaXNJZCA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5yYXRlQW5hbHlzaXNJZDtcclxuXHJcbiAgICAgICAgICBsZXQgY2F0ZWdvcnlBcnJheSA6IEFycmF5PENhdGVnb3J5PiA9IHByb2plY3RDb3N0SGVhZEFycmF5W3Byb2plY3RDb3N0SGVhZEluZGV4XS5jYXRlZ29yaWVzO1xyXG4gICAgICAgICAgZm9yIChsZXQgY2F0ZWdvcnlJbmRleCBpbiBjYXRlZ29yeUFycmF5KSB7XHJcbiAgICAgICAgICAgIGxldCB3b3JrSXRlbUFycmF5ID0gY2F0ZWdvcnlBcnJheVtjYXRlZ29yeUluZGV4XS53b3JrSXRlbXM7XHJcbiAgICAgICAgICAgIGlmICh3b3JrSXRlbUFycmF5Lmxlbmd0aCAhPT0gMCkge1xyXG4gICAgICAgICAgICAgIGZvciAobGV0IHdvcmtJdGVtSW5kZXggaW4gd29ya0l0ZW1BcnJheSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucXVhbnRpdHkudG90YWwgIT09IG51bGwgJiYgd29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5yYXRlLnRvdGFsICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICYmIHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucXVhbnRpdHkudG90YWwgIT09IDAgJiYgd29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5yYXRlLnRvdGFsICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgIGVzdGltYXRlUmVwb3J0LnRvdGFsID0gcGFyc2VGbG9hdCgod29ya0l0ZW1BcnJheVt3b3JrSXRlbUluZGV4XS5xdWFudGl0eS50b3RhbCAqIHdvcmtJdGVtQXJyYXlbd29ya0l0ZW1JbmRleF0ucmF0ZS50b3RhbFxyXG4gICAgICAgICAgICAgICAgICAgICsgZXN0aW1hdGVSZXBvcnQudG90YWwpLnRvRml4ZWQoMikpO1xyXG4gICAgICAgICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC5yYXRlID0gcGFyc2VGbG9hdCgoZXN0aW1hdGVSZXBvcnQudG90YWwgL3RvdGFsQXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBlc3RpbWF0ZVJlcG9ydC50b3RhbCA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgZXN0aW1hdGVSZXBvcnQucmF0ZSA9IDAuMDtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQudG90YWxFc3RpbWF0ZWRDb3N0ID0gcGFyc2VGbG9hdCgoZXN0aW1hdGVSZXBvcnQudG90YWwgKyBlc3RpbWF0ZWRSZXBvcnQudG90YWxFc3RpbWF0ZWRDb3N0KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIGVzdGltYXRlZFJlcG9ydC50b3RhbFJhdGUgPSBwYXJzZUZsb2F0KChlc3RpbWF0ZWRSZXBvcnQudG90YWxSYXRlICsgZXN0aW1hdGVSZXBvcnQucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICBlc3RpbWF0ZWRSZXBvcnQuZXN0aW1hdGVkQ29zdHMucHVzaChlc3RpbWF0ZVJlcG9ydCk7XHJcblxyXG4gICAgICAgICAgIHRodW1iUnVsZS5uYW1lID0gcHJvamVjdENvc3RIZWFkQXJyYXlbcHJvamVjdENvc3RIZWFkSW5kZXhdLm5hbWU7XHJcbiAgICAgICAgICAgdGh1bWJSdWxlLnJhdGVBbmFseXNpc0lkID0gcHJvamVjdENvc3RIZWFkQXJyYXlbcHJvamVjdENvc3RIZWFkSW5kZXhdLnJhdGVBbmFseXNpc0lkO1xyXG4gICAgICAgICAgIHRodW1iUnVsZS5hbW91bnQgPSBwYXJzZUZsb2F0KChwcm9qZWN0Q29zdEhlYWRBcnJheVtwcm9qZWN0Q29zdEhlYWRJbmRleF0uYnVkZ2V0ZWRDb3N0QW1vdW50KS50b0ZpeGVkKDIpKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChyYXRlVW5pdCA9PT0gQ29uc3RhbnRzLldPUktJVEVNX1VOSVQpIHtcclxuICAgICAgICAgICAgICB0aHVtYlJ1bGUucmF0ZSA9ICBwYXJzZUZsb2F0KCh0aHVtYlJ1bGUuYW1vdW50L3RvdGFsQXJlYSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSAge1xyXG4gICAgICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC5hcmVhID0gdGh1bWJSdWxlLmFtb3VudCAqIGNvbmZpZy5nZXQoQ29uc3RhbnRzLlNRVUFSRV9NRVRFUik7XHJcbiAgICAgICAgICAgICAgdGh1bWJSdWxlLnJhdGUgPSBwYXJzZUZsb2F0KCh0aHVtYlJ1bGUuYW1vdW50L3RodW1iUnVsZVJlcG9ydC5hcmVhKS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgdGh1bWJSdWxlUmVwb3J0LnRvdGFsUmF0ZSA9IHBhcnNlRmxvYXQoKHRodW1iUnVsZVJlcG9ydC50b3RhbFJhdGUgKyB0aHVtYlJ1bGUucmF0ZSkudG9GaXhlZCgyKSk7XHJcbiAgICAgICAgICB0aHVtYlJ1bGVSZXBvcnQudG90YWxCdWRnZXRlZENvc3QgPSBwYXJzZUZsb2F0KCh0aHVtYlJ1bGVSZXBvcnQudG90YWxCdWRnZXRlZENvc3QgKyB0aHVtYlJ1bGUuYW1vdW50KS50b0ZpeGVkKDIpKTtcclxuICAgICAgICAgIHRodW1iUnVsZVJlcG9ydC50aHVtYlJ1bGVSZXBvcnRzLnB1c2godGh1bWJSdWxlKTtcclxuICAgICAgICAgIHByb2plY3RSZXBvcnQudGh1bWJSdWxlID0gdGh1bWJSdWxlUmVwb3J0O1xyXG4gICAgICAgICAgcHJvamVjdFJlcG9ydC5lc3RpbWF0ZSA9IGVzdGltYXRlZFJlcG9ydDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgcmVwb3J0LnB1c2gocHJvamVjdFJlcG9ydCk7XHJcbiAgfVxyXG5cclxuICBnZXRDb3N0SGVhZHMoICB1cmw6IHN0cmluZyAsIHVzZXI6IFVzZXIsY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgbG9nZ2VyLmluZm8oJ1JlcG9ydCBTZXJ2aWNlLCBnZXRDb3N0SGVhZHMgaGFzIGJlZW4gaGl0Jyk7XHJcbiAgICB0aGlzLnJhdGVBbmFseXNpc1NlcnZpY2UuZ2V0Q29zdEhlYWRzKCB1cmwsIHVzZXIsKGVycm9yLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgOiAnK0pTT04uc3RyaW5naWZ5KGVycm9yKSk7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwseyBkYXRhOiByZXN1bHQsIGFjY2Vzc190b2tlbjogdGhpcy5hdXRoSW50ZXJjZXB0b3IuaXNzdWVUb2tlbldpdGhVaWQodXNlcil9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRXb3JrSXRlbXMoIHVybDogc3RyaW5nICwgdXNlcjogVXNlciwgY2FsbGJhY2s6IChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4gdm9pZCkge1xyXG4gICAgbG9nZ2VyLmluZm8oJ1JlcG9ydCBTZXJ2aWNlLCBnZXRXb3JrSXRlbXMgaGFzIGJlZW4gaGl0Jyk7XHJcbiAgICB0aGlzLnJhdGVBbmFseXNpc1NlcnZpY2UuZ2V0V29ya0l0ZW1zKCB1cmwsIHVzZXIsKGVycm9yLCByZXN1bHQpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgOiAnK0pTT04uc3RyaW5naWZ5KGVycm9yKSk7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwseyBkYXRhOiByZXN1bHQsIGFjY2Vzc190b2tlbjogdGhpcy5hdXRoSW50ZXJjZXB0b3IuaXNzdWVUb2tlbldpdGhVaWQodXNlcil9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoUmVwb3J0U2VydmljZSk7XHJcbmV4cG9ydCA9IFJlcG9ydFNlcnZpY2U7XHJcblxyXG4iXX0=
