"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var LoggerService = require("./LoggerService");
var Messages = require('../messages');
var logger = require('./logger');
var UserService = require("../../services/UserService");
function errorHandler(err, req, res, next) {
    var _loggerService = new LoggerService('errorHandler');
    if (err.code && err.code !== 'ECONNABORTED') {
        var errObject = {
            status: Messages.STATUS_ERROR,
            error: err
        };
        var responseObject = JSON.stringify(errObject);
        _loggerService.logError(err);
        if (err.code !== 400) {
            mailToAdmin(err);
        }
        res.status(err.code).send(responseObject);
    }
    else if (err.code === 'ECONNABORTED') {
        var errorObject = {
            'status': Messages.STATUS_ERROR,
            'error': {
                'reason': 'Internal Server ',
                'message': 'Internal Server ',
                'code': 500
            }
        };
        err.reason = 'Request is aborted by user';
        mailToAdmin(err);
        var responseObject = JSON.stringify(errorObject);
        _loggerService.logError(err);
        res.status(500).send(responseObject);
    }
    else {
        var errorObject = {
            'status': Messages.STATUS_ERROR,
            'error': {
                'reason': 'Internal Server ',
                'message': 'Internal Server ',
                'code': 500
            }
        };
        mailToAdmin(err);
        var responseObject = JSON.stringify(errorObject);
        _loggerService.logError(err);
        res.status(500).send(responseObject);
    }
}
exports.errorHandler = errorHandler;
function mailToAdmin(errorInfo) {
    var userService = new UserService();
    userService.sendMailOnError(errorInfo, function (error, result) {
        if (error) {
            logger.error(Messages.MSG_ERROR_WHILE_CONTACTING);
        }
    });
}
exports.mailToAdmin = mailToAdmin;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2hhcmVkL2xvZ2dlci9zaGFyZWQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUFrRDtBQUVsRCxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2pDLHdEQUEyRDtBQUczRCxzQkFBNkIsR0FBUSxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsSUFBUztJQUNsRSxJQUFJLGNBQWMsR0FBa0IsSUFBSSxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDdEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGNBQWMsQ0FBQyxDQUFDLENBQUM7UUFDNUMsSUFBSSxTQUFTLEdBQUc7WUFDZCxNQUFNLEVBQUUsUUFBUSxDQUFDLFlBQVk7WUFDN0IsS0FBSyxFQUFFLEdBQUc7U0FDWCxDQUFDO1FBQ0YsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQyxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNwQixXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkIsQ0FBQztRQUNELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssY0FBYyxDQUFDLENBQUMsQ0FBQztRQUN0QyxJQUFJLFdBQVcsR0FBTztZQUNwQixRQUFRLEVBQUUsUUFBUSxDQUFDLFlBQVk7WUFDL0IsT0FBTyxFQUFFO2dCQUNQLFFBQVEsRUFBRSxrQkFBa0I7Z0JBQzVCLFNBQVMsRUFBRSxrQkFBa0I7Z0JBQzdCLE1BQU0sRUFBRSxHQUFHO2FBQ1o7U0FBQyxDQUFDO1FBQ0wsR0FBRyxDQUFDLE1BQU0sR0FBQyw0QkFBNEIsQ0FBQztRQUN4QyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksV0FBVyxHQUFPO1lBQ3BCLFFBQVEsRUFBRSxRQUFRLENBQUMsWUFBWTtZQUMvQixPQUFPLEVBQUU7Z0JBQ1AsUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsU0FBUyxFQUFFLGtCQUFrQjtnQkFDN0IsTUFBTSxFQUFFLEdBQUc7YUFDWjtTQUNGLENBQUM7UUFDRixXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNqRCxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7QUFDSCxDQUFDO0FBeENELG9DQXdDQztBQUdELHFCQUE0QixTQUFhO0lBQ3ZDLElBQUksV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7SUFDcEMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsVUFBQyxLQUFTLEVBQUUsTUFBVTtRQUMzRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBRSxRQUFRLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNyRCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBUEQsa0NBT0MiLCJmaWxlIjoiYXBwL2ZyYW1ld29yay9zaGFyZWQvbG9nZ2VyL3NoYXJlZC5zZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvZ2dlclNlcnZpY2UgPSByZXF1aXJlKCcuL0xvZ2dlclNlcnZpY2UnKTtcclxuXHJcbmxldCBNZXNzYWdlcyA9IHJlcXVpcmUoJy4uL21lc3NhZ2VzJyk7XHJcbmxldCBsb2dnZXIgPSByZXF1aXJlKCcuL2xvZ2dlcicpO1xyXG5pbXBvcnQgVXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLi8uLi9zZXJ2aWNlcy9Vc2VyU2VydmljZScpO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyOiBhbnksIHJlcTogYW55LCByZXM6IGFueSwgbmV4dDogYW55KSB7XHJcbiAgbGV0IF9sb2dnZXJTZXJ2aWNlOiBMb2dnZXJTZXJ2aWNlID0gbmV3IExvZ2dlclNlcnZpY2UoJ2Vycm9ySGFuZGxlcicpO1xyXG4gIGlmIChlcnIuY29kZSAmJiBlcnIuY29kZSAhPT0gJ0VDT05OQUJPUlRFRCcpIHtcclxuICAgIGxldCBlcnJPYmplY3QgPSB7XHJcbiAgICAgIHN0YXR1czogTWVzc2FnZXMuU1RBVFVTX0VSUk9SLFxyXG4gICAgICBlcnJvcjogZXJyXHJcbiAgICB9O1xyXG4gICAgbGV0IHJlc3BvbnNlT2JqZWN0ID0gSlNPTi5zdHJpbmdpZnkoZXJyT2JqZWN0KTtcclxuICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKGVycik7XHJcbiAgICBpZihlcnIuY29kZSAhPT0gNDAwKSB7XHJcbiAgICAgIG1haWxUb0FkbWluKGVycik7XHJcbiAgICB9XHJcbiAgICByZXMuc3RhdHVzKGVyci5jb2RlKS5zZW5kKHJlc3BvbnNlT2JqZWN0KTtcclxuICB9IGVsc2UgaWYoZXJyLmNvZGUgPT09ICdFQ09OTkFCT1JURUQnKSB7XHJcbiAgICBsZXQgZXJyb3JPYmplY3Q6YW55ID0ge1xyXG4gICAgICAnc3RhdHVzJzogTWVzc2FnZXMuU1RBVFVTX0VSUk9SLFxyXG4gICAgICAnZXJyb3InOiB7XHJcbiAgICAgICAgJ3JlYXNvbic6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnbWVzc2FnZSc6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnY29kZSc6IDUwMFxyXG4gICAgICB9fTtcclxuICAgIGVyci5yZWFzb249J1JlcXVlc3QgaXMgYWJvcnRlZCBieSB1c2VyJztcclxuICAgIG1haWxUb0FkbWluKGVycik7XHJcbiAgICBsZXQgcmVzcG9uc2VPYmplY3QgPSBKU09OLnN0cmluZ2lmeShlcnJvck9iamVjdCk7XHJcbiAgICBfbG9nZ2VyU2VydmljZS5sb2dFcnJvcihlcnIpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQocmVzcG9uc2VPYmplY3QpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBsZXQgZXJyb3JPYmplY3Q6YW55ID0ge1xyXG4gICAgICAnc3RhdHVzJzogTWVzc2FnZXMuU1RBVFVTX0VSUk9SLFxyXG4gICAgICAnZXJyb3InOiB7XHJcbiAgICAgICAgJ3JlYXNvbic6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnbWVzc2FnZSc6ICdJbnRlcm5hbCBTZXJ2ZXIgJyxcclxuICAgICAgICAnY29kZSc6IDUwMFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgbWFpbFRvQWRtaW4oZXJyKTtcclxuICAgIGxldCByZXNwb25zZU9iamVjdCA9IEpTT04uc3RyaW5naWZ5KGVycm9yT2JqZWN0KTtcclxuICAgIF9sb2dnZXJTZXJ2aWNlLmxvZ0Vycm9yKGVycik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChyZXNwb25zZU9iamVjdCk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1haWxUb0FkbWluKGVycm9ySW5mbzphbnkpIHtcclxuICBsZXQgdXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuICB1c2VyU2VydmljZS5zZW5kTWFpbE9uRXJyb3IoZXJyb3JJbmZvLCAoZXJyb3I6YW55LCByZXN1bHQ6YW55KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCBNZXNzYWdlcy5NU0dfRVJST1JfV0hJTEVfQ09OVEFDVElORyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuIl19
