"use strict";
var Messages = require("../shared/messages");
var ProjectAsset = require("../shared/projectasset");
var UserRepository = require("../dataaccess/repository/UserRepository");
var config = require('config');
var authKey = config.get('application.messaging.authKey');
var senderId = config.get('application.messaging.senderId');
var routerNumber = config.get('application.messaging.routerNumber');
var msg91 = require('msg91')(authKey, senderId, routerNumber);
var SendMessageService = (function () {
    function SendMessageService() {
        this.userRepository = new UserRepository();
        this.app_name = ProjectAsset.APP_NAME;
    }
    SendMessageService.prototype.sendMessage = function (mobileNo, callback) {
        var otp = Math.floor((Math.random() * 99999) + 100000);
        var message = 'The One Time Password(OTP) for ' + ' ' + this.app_name + ' ' + 'account is' + ' ' + otp
            + ' ' + '.Use this OTP to verify your account.';
        msg91.send(mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendMessageDirect = function (Data, callback) {
        console.log('Send sms on', Data.mobileNo);
        var message = 'The One Time Password(OTP) for ' + ' ' + this.app_name + ' ' + 'account is' + ' ' + Data.otp + ' '
            + '.Use this OTP to verify your account.';
        console.log('msg sent to user :', message);
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    SendMessageService.prototype.sendChangeMobileMessage = function (Data, callback) {
        var message = 'The One Time Password(OTP) to change your number from ' + Data.current_mobile_number
            + ' to ' + Data.mobileNo + ' of your ' + this.app_name + ' account is ' + Data.otp
            + '.Use this OTP to complete verification.';
        msg91.send(Data.mobileNo, message, function (err, response) {
            if (err) {
                callback(new Error(Messages.MSG_ERROR_MESSAGE_SENDING), null);
            }
            else {
                callback(null, response);
            }
        });
    };
    return SendMessageService;
}());
Object.seal(SendMessageService);
module.exports = SendMessageService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9mcmFtZXdvcmsvc2VydmljZXMvc2VuZG1lc3NhZ2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsNkNBQThDO0FBQzlDLHFEQUF3RDtBQUN4RCx3RUFBMkU7QUFDM0UsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUMxRCxJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDNUQsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO0FBQ3BFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBRzlEO0lBSUU7UUFDRSxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksY0FBYyxFQUFFLENBQUM7UUFDM0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUMsUUFBUSxDQUFDO0lBQ3hDLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksUUFBYSxFQUFFLFFBQWE7UUFDdEMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN2RCxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLEdBQUcsR0FBRyxHQUFHO2NBQ3BHLEdBQUcsR0FBRyx1Q0FBdUMsQ0FBQztRQUNoRCxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsVUFBVSxHQUFRLEVBQUUsUUFBYTtZQUM3RCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNSLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMseUJBQXlCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMzQixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsOENBQWlCLEdBQWpCLFVBQWtCLElBQVMsRUFBRSxRQUFhO1FBRXhDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUUxQyxJQUFJLE9BQU8sR0FBRyxpQ0FBaUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUc7Y0FDN0csdUNBQXVDLENBQUM7UUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMzQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFVBQVUsR0FBUSxFQUFFLFFBQWE7WUFDbEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUixRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDaEUsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDM0IsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELG9EQUF1QixHQUF2QixVQUF3QixJQUFTLEVBQUUsUUFBYTtRQUU5QyxJQUFJLE9BQU8sR0FBRyx3REFBd0QsR0FBRSxJQUFJLENBQUMscUJBQXFCO2NBQy9GLE1BQU0sR0FBRSxJQUFJLENBQUMsUUFBUSxHQUFFLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFFLGNBQWMsR0FBRSxJQUFJLENBQUMsR0FBRztjQUMzRSx5Q0FBeUMsQ0FBQztRQUU5QyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFVBQVUsR0FBUSxFQUFFLFFBQWE7WUFDbEUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUixRQUFRLENBQUMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDaEUsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDM0IsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVILHlCQUFDO0FBQUQsQ0FyREEsQUFxREMsSUFBQTtBQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztBQUNoQyxpQkFBUyxrQkFBa0IsQ0FBQyIsImZpbGUiOiJhcHAvZnJhbWV3b3JrL3NlcnZpY2VzL3NlbmRtZXNzYWdlLnNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9zaGFyZWQvcHJvamVjdGFzc2V0LnRzXCIvPlxyXG5pbXBvcnQgTWVzc2FnZXM9cmVxdWlyZSgnLi4vc2hhcmVkL21lc3NhZ2VzJyk7XHJcbmltcG9ydCBQcm9qZWN0QXNzZXQgPSByZXF1aXJlKCcuLi9zaGFyZWQvcHJvamVjdGFzc2V0Jyk7XHJcbmltcG9ydCBVc2VyUmVwb3NpdG9yeSA9IHJlcXVpcmUoJy4uL2RhdGFhY2Nlc3MvcmVwb3NpdG9yeS9Vc2VyUmVwb3NpdG9yeScpO1xyXG5sZXQgY29uZmlnID0gcmVxdWlyZSgnY29uZmlnJyk7XHJcbmxldCBhdXRoS2V5ID0gY29uZmlnLmdldCgnYXBwbGljYXRpb24ubWVzc2FnaW5nLmF1dGhLZXknKTtcclxubGV0IHNlbmRlcklkID0gY29uZmlnLmdldCgnYXBwbGljYXRpb24ubWVzc2FnaW5nLnNlbmRlcklkJyk7XHJcbmxldCByb3V0ZXJOdW1iZXIgPSBjb25maWcuZ2V0KCdhcHBsaWNhdGlvbi5tZXNzYWdpbmcucm91dGVyTnVtYmVyJyk7XHJcbmxldCBtc2c5MSA9IHJlcXVpcmUoJ21zZzkxJykoYXV0aEtleSwgc2VuZGVySWQsIHJvdXRlck51bWJlcik7XHJcblxyXG5cclxuY2xhc3MgU2VuZE1lc3NhZ2VTZXJ2aWNlIHtcclxuICBhcHBfbmFtZTogc3RyaW5nO1xyXG4gIHByaXZhdGUgdXNlclJlcG9zaXRvcnk6IFVzZXJSZXBvc2l0b3J5O1xyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudXNlclJlcG9zaXRvcnkgPSBuZXcgVXNlclJlcG9zaXRvcnkoKTtcclxuICAgIHRoaXMuYXBwX25hbWUgPSBQcm9qZWN0QXNzZXQuQVBQX05BTUU7XHJcbiAgfVxyXG5cclxuICBzZW5kTWVzc2FnZShtb2JpbGVObzogYW55LCBjYWxsYmFjazogYW55KSB7XHJcbiAgICBsZXQgb3RwID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDk5OTk5KSArIDEwMDAwMCk7XHJcbiAgICBsZXQgbWVzc2FnZSA9ICdUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSBmb3IgJyArICcgJyArIHRoaXMuYXBwX25hbWUgKyAnICcgKyAnYWNjb3VudCBpcycgKyAnICcgKyBvdHBcclxuICAgICsgJyAnICsgJy5Vc2UgdGhpcyBPVFAgdG8gdmVyaWZ5IHlvdXIgYWNjb3VudC4nO1xyXG4gICAgbXNnOTEuc2VuZChtb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZW5kTWVzc2FnZURpcmVjdChEYXRhOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnU2VuZCBzbXMgb24nLCBEYXRhLm1vYmlsZU5vKTtcclxuXHJcbiAgICBsZXQgbWVzc2FnZSA9ICdUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSBmb3IgJyArICcgJyArIHRoaXMuYXBwX25hbWUgKyAnICcgKyAnYWNjb3VudCBpcycgKyAnICcgKyBEYXRhLm90cCArICcgJ1xyXG4gICAgICArICcuVXNlIHRoaXMgT1RQIHRvIHZlcmlmeSB5b3VyIGFjY291bnQuJztcclxuICAgIGNvbnNvbGUubG9nKCdtc2cgc2VudCB0byB1c2VyIDonLCBtZXNzYWdlKTtcclxuICAgIG1zZzkxLnNlbmQoRGF0YS5tb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzZW5kQ2hhbmdlTW9iaWxlTWVzc2FnZShEYXRhOiBhbnksIGNhbGxiYWNrOiBhbnkpIHtcclxuXHJcbiAgICBsZXQgbWVzc2FnZSA9ICdUaGUgT25lIFRpbWUgUGFzc3dvcmQoT1RQKSB0byBjaGFuZ2UgeW91ciBudW1iZXIgZnJvbSAnKyBEYXRhLmN1cnJlbnRfbW9iaWxlX251bWJlclxyXG4gICAgICArJyB0byAnKyBEYXRhLm1vYmlsZU5vICsnIG9mIHlvdXIgJyArIHRoaXMuYXBwX25hbWUgKycgYWNjb3VudCBpcyAnKyBEYXRhLm90cFxyXG4gICAgICArICcuVXNlIHRoaXMgT1RQIHRvIGNvbXBsZXRlIHZlcmlmaWNhdGlvbi4nO1xyXG5cclxuICAgIG1zZzkxLnNlbmQoRGF0YS5tb2JpbGVObywgbWVzc2FnZSwgZnVuY3Rpb24gKGVycjogYW55LCByZXNwb25zZTogYW55KSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoTWVzc2FnZXMuTVNHX0VSUk9SX01FU1NBR0VfU0VORElORyksIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3BvbnNlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuT2JqZWN0LnNlYWwoU2VuZE1lc3NhZ2VTZXJ2aWNlKTtcclxuZXhwb3J0ID0gU2VuZE1lc3NhZ2VTZXJ2aWNlO1xyXG4iXX0=
