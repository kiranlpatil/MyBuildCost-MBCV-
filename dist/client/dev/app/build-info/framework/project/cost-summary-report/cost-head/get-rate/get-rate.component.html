<!--Edit enabled-->
<div *ngIf="rate!==undefined" [ngClass]="(rateView == 'rate') ? 'get-rate-section' : ((rateView == 'cost') ? 'get-cost-section' : 'get-systemRA-section')">
  <button class="close" (click)="closeRateTab()"><img src="assets/framework/images/close/close-black.svg" /></button>
  <div class="pull-left">
    <div class="pull-left" *ngIf="rate!==undefined">
      <div class="pull-left quantity-label">
        {{ getHeadings().ITEM }} {{ getHeadings().QUANTITY }}{{ getHeadings().COLON }}
      </div>
      <div class="pull-left">
        <input [(ngModel)]="rate.quantity" id="rateQuantity" type="number" class="form-control quantity-count"
               (change)="onTotalQuantityChange(rate.quantity)"
               (focus)="getPreviousQuantity(rate.quantity)"
               [disabled]="disableRateField"/>
      </div>
      <div class="pull-left">
        <span class="quantity-sqft">
          {{ rate.unit }}
        </span>
      </div>
    </div>
  </div>
  <div class="col-sm-12 no-padding">
    <table class="get-rate-table">
      <thead>
        <tr>
          <th>{{ getTableHeadings().DESCRIPTION }}</th>
          <th>{{ getTableHeadings().QUANTITY }}</th>
          <th>{{ getTableHeadings().UNIT }}</th>
          <th>{{ getTableHeadings().RATE_PER_UNIT }}</th>
          <th>{{ getTableHeadings().COST }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rateItem of rate.rateItems | groupBy:'type';">
          <td class="rate-item" colspan="5">
            <table>
              <thead>
                <tr>
                  <th colspan="5">{{ (rateItem.key === 'M') ? 'A. Material' : ((rateItem.key === "L") ? "B. Labour" : "C. Material + Labour") }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of rateItem.value; let i=index">
                  <td class="datalist-input" *ngIf="rateView === getLabel().WORKITEM_RATE_TAB">
                    <input id="itemDescription" class="form-control remark-input" (mouseover)="getRateItemsByOriginalName(item, rateItem.key, i)"
                           list="RateItems" [(ngModel)]="item.itemName"  (mousedown)="getItemName($event)" (blur)="setItemName($event); getRateItemsByOriginalName(item, rateItem.key, i)"/>
                      <datalist id="RateItems" >
                        <option *ngFor="let rateItem of arrayOfRateItems" value="{{rateItem.itemName}}"></option>    
                     </datalist>
                  </td>
                  <td *ngIf="rateView !== getLabel().WORKITEM_RATE_TAB">
                    <input id="itemDescription" class="form-control remark-input" [(ngModel)]="item.itemName" [disabled]="disableRateField"/>
                  </td>
                  <!--<td>
                    <span class="glyphicon glyphicon-chevron-down" (click)="getRateItemsByOriginalName(item, i)"></span>
                     <select id="RateItemsDropDown" *ngIf="i === selectedRateItemIndex">
                       <option *ngFor="let rateItem of arrayOfRateItems" value="{{rateItem.itemName}}">{{rateItem.itemName}}</option>
                    </select>
                  </td>-->
                  <td>
                    <input type="number" [(ngModel)]="item.quantity" id="itemQuantity" class="form-control text-right"
                           (change)="calculateTotal()" [disabled]="disableRateField"/>
                  </td>
                  <td>
                    <input [(ngModel)]="item.unit" id="itemUnit" class="form-control text-left" [disabled]="disableRateField"/>
                  </td>
                  <td>
                    <input type="number" [(ngModel)]="item.rate" id="itemRate" class="form-control text-right"
                           (change)="calculateTotal()" [disabled]="disableRateField"/>
                  </td>
                  <td class="text-right">
                    <!--<input type="number" [(ngModel)]="item.totalAmount" id="totalAmount get-total-amount text-right" class="form-control clear" readonly/>-->
                    {{item.totalAmount|number : '1.2-2'}}
                  </td>
                </tr>
               </tbody>
              <tfoot>
              <tr>
                <td colspan="3">
                </td>
                <td class="total-amount text-left">
                  <label>{{ getLabel().TOTAL }}{{(rateItem.key === 'M') ? '(A):' : ((rateItem.key === "L") ? "(B):" : "(C):")}}</label>
                </td>
                <td class="text-right">
                  <div *ngIf="(rateItem.key === 'M')">{{ totalAmountOfMaterial|number : '1.2-2'}} </div>
                  <div *ngIf="(rateItem.key === 'L')">{{ totalAmountOfLabour|number : '1.2-2'}} </div>
                  <div *ngIf="(rateItem.key === 'M + L')">{{ totalAmountOfMaterialAndLabour|number : '1.2-2'}} </div>
                </td>
              </tr>
              </tfoot>
            </table>
          </td>
        </tr>
      </tbody>
      <tfoot>
      <tr>
        <td class="total-amount text-left" >
          <label *ngIf="totalAmountOfMaterial && totalAmountOfLabour && !totalAmountOfMaterialAndLabour">{{ getLabel().TOTAL_A_B}}</label>
          <label *ngIf="totalAmountOfMaterial && totalAmountOfLabour && totalAmountOfMaterialAndLabour ">{{ getLabel().TOTAL_A_B_C}}</label>
          <label *ngIf="totalAmountOfMaterial && !totalAmountOfLabour && !totalAmountOfMaterialAndLabour ">{{ getLabel().TOTAL_A}}</label>
        </td>
        <td class="total-amount" colspan="3">
        </td>
        <td class="total-amount">
          {{ totalAmount|number: '1.2-2'}}
        </td>
      </tr>
      <tr>
        <td class="total-amount text-left">
          <label>Rate per unit</label>
        </td>
        <td class="total-amount" colspan="3">
        </td>
        <td class="total-amount">
          {{ ratePerUnitAmount|number: '1.2-2'}}
        </td>
      </tr>
      </tfoot>
    </table>
  </div>
  <table class="notes-table">
    <thead>
      <th>{{ getLabel().NOTES }}</th>
      <th></th>
    </thead>
    <tbody>
      <tr>
        <td class="alignment-top">
          <textarea rows="4" cols="80" [(ngModel)]="rate.notes" id="rateNotes" [disabled]="disableRateField">
            </textarea>
        </td>
        <td>
          <img id="rateImageURL" src="{{rate.imageURL}}">
        </td>
      </tr>
    </tbody>
  </table>
  <button type="button" *ngIf="!disableRateField" class="save-btn" (click)="updateRate(rate)">{{ getButton().SAVE }}</button>

</div>


