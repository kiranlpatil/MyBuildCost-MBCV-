"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var material_takeoff_service_1 = require("./material-takeoff.service");
var constants_1 = require("../../../../shared/constants");
var material_take_off_filters_1 = require("../../model/material-take-off-filters");
var material_take_off_element_1 = require("../../model/material-take-off-element");
var index_1 = require("../../../../shared/index");
var MaterialTakeoffComponent = (function () {
    function MaterialTakeoffComponent(activatedRoute, _router, materialTakeoffService, messageService) {
        this.activatedRoute = activatedRoute;
        this._router = _router;
        this.materialTakeoffService = materialTakeoffService;
        this.messageService = messageService;
        this.elementWiseReports = new Array();
        var costHeadElement = new material_take_off_element_1.MaterialTakeOffElement();
        costHeadElement.elementKey = constants_1.MaterialTakeOffElements.ELEMENT_WISE_REPORT_COST_HEAD;
        costHeadElement.elementValue = constants_1.MaterialTakeOffElements.COST_HEAD_WISE;
        var materialElement = new material_take_off_element_1.MaterialTakeOffElement();
        materialElement.elementKey = constants_1.MaterialTakeOffElements.ELEMENT_WISE_REPORT_MATERIAL;
        materialElement.elementValue = constants_1.MaterialTakeOffElements.MATERIAL_WISE;
        this.elementWiseReports.push(costHeadElement);
        this.elementWiseReports.push(materialElement);
    }
    MaterialTakeoffComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.activatedRoute.params.subscribe(function (params) {
            _this.projectId = params['projectId'];
        });
        this.getMaterialFiltersList(this.projectId);
    };
    MaterialTakeoffComponent.prototype.getMaterialFiltersList = function (projectId) {
        var _this = this;
        this.materialTakeoffService.getMaterialFiltersList(projectId).subscribe(function (materialFiltersList) { return _this.onGetMaterialFiltersListSuccess(materialFiltersList); }, function (error) { return _this.onGetMaterialFiltersListFailure(error); });
    };
    MaterialTakeoffComponent.prototype.onGetMaterialFiltersListSuccess = function (materialFiltersList) {
        this.extractList(materialFiltersList);
        this.getMaterialTakeOffReport(constants_1.MaterialTakeOffElements.ELEMENT_WISE_REPORT_COST_HEAD, this.selectedElement, this.building);
    };
    MaterialTakeoffComponent.prototype.onGetMaterialFiltersListFailure = function (error) {
        console.log(error);
    };
    MaterialTakeoffComponent.prototype.extractList = function (list) {
        this.elementWiseReport = constants_1.MaterialTakeOffElements.ELEMENT_WISE_REPORT_COST_HEAD;
        this.costHeads = list.costHeadList;
        this.materials = list.materialList;
        this.elementHeading = constants_1.MaterialTakeOffElements.COST_HEAD;
        this.elements = this.costHeads;
        this.selectedElement = this.costHeads[0];
        this.buildings = list.buildingList;
        this.building = this.buildings[0];
    };
    MaterialTakeoffComponent.prototype.onChangeGroupBy = function (groupBy) {
        this.elementWiseReport = groupBy;
        if (this.elementWiseReport === constants_1.MaterialTakeOffElements.ELEMENT_WISE_REPORT_COST_HEAD) {
            this.elements = this.costHeads;
            this.elementHeading = constants_1.MaterialTakeOffElements.COST_HEAD;
        }
        else {
            this.elements = this.materials;
            this.elementHeading = constants_1.MaterialTakeOffElements.MATERIAL;
        }
        this.selectedElement = this.elements[0];
        this.getMaterialTakeOffReport(this.elementWiseReport, this.selectedElement, this.building);
    };
    MaterialTakeoffComponent.prototype.onChangeSecondFilter = function (selectedElement) {
        this.selectedElement = selectedElement;
        this.getMaterialTakeOffReport(this.elementWiseReport, this.selectedElement, this.building);
    };
    MaterialTakeoffComponent.prototype.onChangeBuilding = function (building) {
        this.building = building;
        this.getMaterialTakeOffReport(this.elementWiseReport, this.selectedElement, this.building);
    };
    MaterialTakeoffComponent.prototype.getMaterialTakeOffElements = function () {
        return constants_1.MaterialTakeOffElements;
    };
    MaterialTakeoffComponent.prototype.getMaterialTakeOffReport = function (elementWiseReport, selectedElement, building) {
        var _this = this;
        var materialTakeOffFilters = new material_take_off_filters_1.MaterialTakeOffFilters(elementWiseReport, selectedElement, building);
        this.materialTakeoffService.getMaterialTakeOffReport(this.projectId, materialTakeOffFilters).subscribe(function (materialTakeOffReport) { return _this.onGetMaterialTakeOffReportSuccess(materialTakeOffReport); }, function (error) { return _this.onGetMaterialTakeOffReportFailure(error); });
    };
    MaterialTakeoffComponent.prototype.onGetMaterialTakeOffReportSuccess = function (materialTakeOffReport) {
        this.materialTakeOffReport = materialTakeOffReport;
        this.elementFound = true;
    };
    MaterialTakeoffComponent.prototype.onGetMaterialTakeOffReportFailure = function (error) {
        this.elementFound = false;
        var message = new index_1.Message();
        message.isError = true;
        message.custom_message = error.err_msg;
        message.error_msg = error.err_msg;
        this.messageService.message(message);
    };
    MaterialTakeoffComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'bi-material-takeoff-report',
            templateUrl: 'material-takeoff.component.html'
        }),
        __metadata("design:paramtypes", [router_1.ActivatedRoute, router_1.Router, material_takeoff_service_1.MaterialTakeOffService,
            index_1.MessageService])
    ], MaterialTakeoffComponent);
    return MaterialTakeoffComponent;
}());
exports.MaterialTakeoffComponent = MaterialTakeoffComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9idWlsZC1pbmZvL2ZyYW1ld29yay9wcm9qZWN0L21hdGVyaWFsLXRha2VvZmYvbWF0ZXJpYWwtdGFrZW9mZi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxzQ0FBa0Q7QUFDbEQsMENBQXlEO0FBQ3pELHVFQUFvRTtBQUNwRSwwREFBdUU7QUFDdkUsbUZBQStFO0FBQy9FLG1GQUErRTtBQUMvRSxrREFBbUU7QUFRbkU7SUFpQkUsa0NBQXFCLGNBQTZCLEVBQVcsT0FBZ0IsRUFBVSxzQkFBK0MsRUFDakgsY0FBK0I7UUFEL0IsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFBVyxZQUFPLEdBQVAsT0FBTyxDQUFTO1FBQVUsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF5QjtRQUNqSCxtQkFBYyxHQUFkLGNBQWMsQ0FBaUI7UUFQcEQsdUJBQWtCLEdBQWtDLElBQUksS0FBSyxFQUEwQixDQUFDO1FBU3RGLElBQUksZUFBZSxHQUFHLElBQUksa0RBQXNCLEVBQUUsQ0FBQztRQUNuRCxlQUFlLENBQUMsVUFBVSxHQUFHLG1DQUF1QixDQUFDLDZCQUE2QixDQUFDO1FBQ25GLGVBQWUsQ0FBQyxZQUFZLEdBQUcsbUNBQXVCLENBQUMsY0FBYyxDQUFDO1FBRXRFLElBQUksZUFBZSxHQUFHLElBQUksa0RBQXNCLEVBQUUsQ0FBQztRQUNuRCxlQUFlLENBQUMsVUFBVSxHQUFHLG1DQUF1QixDQUFDLDRCQUE0QixDQUFDO1FBQ2hGLGVBQWUsQ0FBQyxZQUFZLEdBQUcsbUNBQXVCLENBQUMsYUFBYSxDQUFDO1FBRXZFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsMkNBQVEsR0FBUjtRQUFBLGlCQUtDO1FBSkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENB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TyxHQUFHLElBQUksQ0FBQztRQUN2QixPQUFPLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDdkMsT0FBTyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUEzSFUsd0JBQXdCO1FBTnBDLGdCQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsUUFBUSxFQUFFLDRCQUE0QjtZQUN0QyxXQUFXLEVBQUUsaUNBQWlDO1NBQy9DLENBQUM7eUNBbUJvQyx1QkFBYyxFQUFxQixlQUFNLEVBQW1DLGlEQUFzQjtZQUNoRyxzQkFBYztPQWxCekMsd0JBQXdCLENBNEhwQztJQUFELCtCQUFDO0NBNUhELEFBNEhDLElBQUE7QUE1SFksNERBQXdCIiwiZmlsZSI6ImFwcC9idWlsZC1pbmZvL2ZyYW1ld29yay9wcm9qZWN0L21hdGVyaWFsLXRha2VvZmYvbWF0ZXJpYWwtdGFrZW9mZi5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBY3RpdmF0ZWRSb3V0ZSwgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcclxuaW1wb3J0IHsgTWF0ZXJpYWxUYWtlT2ZmU2VydmljZSB9IGZyb20gJy4vbWF0ZXJpYWwtdGFrZW9mZi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvY29uc3RhbnRzJztcclxuaW1wb3J0IHsgTWF0ZXJpYWxUYWtlT2ZmRmlsdGVycyB9IGZyb20gJy4uLy4uL21vZGVsL21hdGVyaWFsLXRha2Utb2ZmLWZpbHRlcnMnO1xyXG5pbXBvcnQgeyBNYXRlcmlhbFRha2VPZmZFbGVtZW50IH0gZnJvbSAnLi4vLi4vbW9kZWwvbWF0ZXJpYWwtdGFrZS1vZmYtZWxlbWVudCc7XHJcbmltcG9ydCB7IE1lc3NhZ2UsIE1lc3NhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc2hhcmVkL2luZGV4JztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIG1vZHVsZUlkOiBtb2R1bGUuaWQsXHJcbiAgc2VsZWN0b3I6ICdiaS1tYXRlcmlhbC10YWtlb2ZmLXJlcG9ydCcsXHJcbiAgdGVtcGxhdGVVcmw6ICdtYXRlcmlhbC10YWtlb2ZmLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIE1hdGVyaWFsVGFrZW9mZkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcblxyXG4gIHByb2plY3RJZCA6IHN0cmluZztcclxuICBlbGVtZW50V2lzZVJlcG9ydCA6IHN0cmluZztcclxuICBzZWxlY3RlZEVsZW1lbnQgOiBzdHJpbmc7XHJcbiAgZWxlbWVudEhlYWRpbmcgOiBzdHJpbmc7XHJcbiAgYnVpbGRpbmcgOiBzdHJpbmc7XHJcblxyXG4gIGNvc3RIZWFkczogQXJyYXk8c3RyaW5nPjtcclxuICBtYXRlcmlhbHM6IEFycmF5PHN0cmluZz47XHJcbiAgYnVpbGRpbmdzOiBBcnJheTxzdHJpbmc+O1xyXG4gIGVsZW1lbnRXaXNlUmVwb3J0czogQXJyYXk8TWF0ZXJpYWxUYWtlT2ZmRWxlbWVudD4gPSBuZXcgQXJyYXk8TWF0ZXJpYWxUYWtlT2ZmRWxlbWVudD4oKTtcclxuICBlbGVtZW50cyA6IEFycmF5PHN0cmluZz47XHJcbiAgZWxlbWVudEZvdW5kIDogYm9vbGVhbjtcclxuXHJcbiAgbWF0ZXJpYWxUYWtlT2ZmUmVwb3J0IDphbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCBwcml2YXRlIGFjdGl2YXRlZFJvdXRlOkFjdGl2YXRlZFJvdXRlLCAgcHJpdmF0ZSBfcm91dGVyIDogUm91dGVyLCBwcml2YXRlIG1hdGVyaWFsVGFrZW9mZlNlcnZpY2UgOiBNYXRlcmlhbFRha2VPZmZTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICBwcml2YXRlIG1lc3NhZ2VTZXJ2aWNlIDogTWVzc2FnZVNlcnZpY2UpIHtcclxuXHJcbiAgICBsZXQgY29zdEhlYWRFbGVtZW50ID0gbmV3IE1hdGVyaWFsVGFrZU9mZkVsZW1lbnQoKTtcclxuICAgIGNvc3RIZWFkRWxlbWVudC5lbGVtZW50S2V5ID0gTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMuRUxFTUVOVF9XSVNFX1JFUE9SVF9DT1NUX0hFQUQ7XHJcbiAgICBjb3N0SGVhZEVsZW1lbnQuZWxlbWVudFZhbHVlID0gTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMuQ09TVF9IRUFEX1dJU0U7XHJcblxyXG4gICAgbGV0IG1hdGVyaWFsRWxlbWVudCA9IG5ldyBNYXRlcmlhbFRha2VPZmZFbGVtZW50KCk7XHJcbiAgICBtYXRlcmlhbEVsZW1lbnQuZWxlbWVudEtleSA9IE1hdGVyaWFsVGFrZU9mZkVsZW1lbnRzLkVMRU1FTlRfV0lTRV9SRVBPUlRfTUFURVJJQUw7XHJcbiAgICAgIG1hdGVyaWFsRWxlbWVudC5lbGVtZW50VmFsdWUgPSBNYXRlcmlhbFRha2VPZmZFbGVtZW50cy5NQVRFUklBTF9XSVNFO1xyXG5cclxuICAgIHRoaXMuZWxlbWVudFdpc2VSZXBvcnRzLnB1c2goY29zdEhlYWRFbGVtZW50KTtcclxuICAgIHRoaXMuZWxlbWVudFdpc2VSZXBvcnRzLnB1c2gobWF0ZXJpYWxFbGVtZW50KTtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5wYXJhbXMuc3Vic2NyaWJlKHBhcmFtcyA9PiB7XHJcbiAgICAgIHRoaXMucHJvamVjdElkID0gcGFyYW1zWydwcm9qZWN0SWQnXTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5nZXRNYXRlcmlhbEZpbHRlcnNMaXN0KHRoaXMucHJvamVjdElkKTtcclxuICB9XHJcblxyXG4gIGdldE1hdGVyaWFsRmlsdGVyc0xpc3QocHJvamVjdElkIDogc3RyaW5nKSB7XHJcbiAgICB0aGlzLm1hdGVyaWFsVGFrZW9mZlNlcnZpY2UuZ2V0TWF0ZXJpYWxGaWx0ZXJzTGlzdChwcm9qZWN0SWQpLnN1YnNjcmliZShcclxuICAgICAgbWF0ZXJpYWxGaWx0ZXJzTGlzdCA9PiB0aGlzLm9uR2V0TWF0ZXJpYWxGaWx0ZXJzTGlzdFN1Y2Nlc3MobWF0ZXJpYWxGaWx0ZXJzTGlzdCksXHJcbiAgICAgIGVycm9yID0+IHRoaXMub25HZXRNYXRlcmlhbEZpbHRlcnNMaXN0RmFpbHVyZShlcnJvcilcclxuICAgICk7XHJcbiAgfVxyXG5cclxuXHJcbiAgb25HZXRNYXRlcmlhbEZpbHRlcnNMaXN0U3VjY2VzcyhtYXRlcmlhbEZpbHRlcnNMaXN0IDogQXJyYXk8c3RyaW5nPikge1xyXG4gICAgdGhpcy5leHRyYWN0TGlzdChtYXRlcmlhbEZpbHRlcnNMaXN0KTtcclxuICAgIHRoaXMuZ2V0TWF0ZXJpYWxUYWtlT2ZmUmVwb3J0KCBNYXRlcmlhbFRha2VPZmZFbGVtZW50cy5FTEVNRU5UX1dJU0VfUkVQT1JUX0NPU1RfSEVBRCxcclxuICAgICAgdGhpcy5zZWxlY3RlZEVsZW1lbnQsIHRoaXMuYnVpbGRpbmcpO1xyXG4gIH1cclxuXHJcbiAgb25HZXRNYXRlcmlhbEZpbHRlcnNMaXN0RmFpbHVyZShlcnJvciA6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gIH1cclxuXHJcbiAgZXh0cmFjdExpc3QobGlzdCA6IGFueSkge1xyXG4gICAgdGhpcy5lbGVtZW50V2lzZVJlcG9ydCA9IE1hdGVyaWFsVGFrZU9mZkVsZW1lbnRzLkVMRU1FTlRfV0lTRV9SRVBPUlRfQ09TVF9IRUFEO1xyXG5cclxuICAgIHRoaXMuY29zdEhlYWRzID0gbGlzdC5jb3N0SGVhZExpc3Q7XHJcbiAgICB0aGlzLm1hdGVyaWFscyA9IGxpc3QubWF0ZXJpYWxMaXN0O1xyXG4gICAgdGhpcy5lbGVtZW50SGVhZGluZyA9IE1hdGVyaWFsVGFrZU9mZkVsZW1lbnRzLkNPU1RfSEVBRDtcclxuICAgIHRoaXMuZWxlbWVudHMgPSB0aGlzLmNvc3RIZWFkcztcclxuICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50ID0gdGhpcy5jb3N0SGVhZHNbMF07XHJcblxyXG4gICAgdGhpcy5idWlsZGluZ3MgPSBsaXN0LmJ1aWxkaW5nTGlzdDtcclxuICAgIHRoaXMuYnVpbGRpbmcgPSB0aGlzLmJ1aWxkaW5nc1swXTtcclxuXHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZUdyb3VwQnkoZ3JvdXBCeSA6IHN0cmluZykge1xyXG5cclxuICAgIHRoaXMuZWxlbWVudFdpc2VSZXBvcnQgPSBncm91cEJ5O1xyXG4gICAgaWYodGhpcy5lbGVtZW50V2lzZVJlcG9ydCA9PT0gTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMuRUxFTUVOVF9XSVNFX1JFUE9SVF9DT1NUX0hFQUQpIHtcclxuICAgICAgdGhpcy5lbGVtZW50cyA9IHRoaXMuY29zdEhlYWRzO1xyXG4gICAgICB0aGlzLmVsZW1lbnRIZWFkaW5nID0gTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMuQ09TVF9IRUFEO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5lbGVtZW50cyA9IHRoaXMubWF0ZXJpYWxzO1xyXG4gICAgICB0aGlzLmVsZW1lbnRIZWFkaW5nID0gTWF0ZXJpYWxUYWtlT2ZmRWxlbWVudHMuTUFURVJJQUw7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlbGVjdGVkRWxlbWVudCA9IHRoaXMuZWxlbWVudHNbMF07XHJcblxyXG4gICAgdGhpcy5nZXRNYXRlcmlhbFRha2VPZmZSZXBvcnQoIHRoaXMuZWxlbWVudFdpc2VSZXBvcnQsIHRoaXMuc2VsZWN0ZWRFbGVtZW50LCB0aGlzLmJ1aWxkaW5nKTtcclxuXHJcbiAgfVxyXG5cclxuICBvbkNoYW5nZVNlY29uZEZpbHRlcihzZWxlY3RlZEVsZW1lbnQgOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRFbGVtZW50ID0gc2VsZWN0ZWRFbGVtZW50O1xyXG4gICAgdGhpcy5nZXRNYXRlcmlhbFRha2VPZmZSZXBvcnQoIHRoaXMuZWxlbWVudFdpc2VSZXBvcnQsIHRoaXMuc2VsZWN0ZWRFbGVtZW50LCB0aGlzLmJ1aWxkaW5nKTtcclxuICB9XHJcblxyXG4gIG9uQ2hhbmdlQnVpbGRpbmcoYnVpbGRpbmcgOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuYnVpbGRpbmcgPSBidWlsZGluZztcclxuICAgIHRoaXMuZ2V0TWF0ZXJpYWxUYWtlT2ZmUmVwb3J0KCB0aGlzLmVsZW1lbnRXaXNlUmVwb3J0LCB0aGlzLnNlbGVjdGVkRWxlbWVudCwgdGhpcy5idWlsZGluZyk7XHJcbiAgfVxyXG5cclxuICBnZXRNYXRlcmlhbFRha2VPZmZFbGVtZW50cygpIHtcclxuICAgIHJldHVybiBNYXRlcmlhbFRha2VPZmZFbGVtZW50cztcclxuICB9XHJcblxyXG4gIGdldE1hdGVyaWFsVGFrZU9mZlJlcG9ydChlbGVtZW50V2lzZVJlcG9ydCA6IHN0cmluZywgc2VsZWN0ZWRFbGVtZW50IDogc3RyaW5nLCBidWlsZGluZyA6IHN0cmluZykge1xyXG4gICAgbGV0IG1hdGVyaWFsVGFrZU9mZkZpbHRlcnMgPSBuZXcgTWF0ZXJpYWxUYWtlT2ZmRmlsdGVycyhlbGVtZW50V2lzZVJlcG9ydCwgc2VsZWN0ZWRFbGVtZW50LCBidWlsZGluZyk7XHJcbiAgICB0aGlzLm1hdGVyaWFsVGFrZW9mZlNlcnZpY2UuZ2V0TWF0ZXJpYWxUYWtlT2ZmUmVwb3J0KHRoaXMucHJvamVjdElkLCBtYXRlcmlhbFRha2VPZmZGaWx0ZXJzKS5zdWJzY3JpYmUoXHJcbiAgICAgIG1hdGVyaWFsVGFrZU9mZlJlcG9ydCA9PiB0aGlzLm9uR2V0TWF0ZXJpYWxUYWtlT2ZmUmVwb3J0U3VjY2VzcyhtYXRlcmlhbFRha2VPZmZSZXBvcnQpLFxyXG4gICAgICBlcnJvciA9PiB0aGlzLm9uR2V0TWF0ZXJpYWxUYWtlT2ZmUmVwb3J0RmFpbHVyZShlcnJvcilcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBvbkdldE1hdGVyaWFsVGFrZU9mZlJlcG9ydFN1Y2Nlc3MobWF0ZXJpYWxUYWtlT2ZmUmVwb3J0IDogYW55KSB7XHJcbiAgICB0aGlzLm1hdGVyaWFsVGFrZU9mZlJlcG9ydCA9IG1hdGVyaWFsVGFrZU9mZlJlcG9ydDtcclxuICAgIHRoaXMuZWxlbWVudEZvdW5kID0gdHJ1ZTtcclxuXHJcbiAgfVxyXG5cclxuICBvbkdldE1hdGVyaWFsVGFrZU9mZlJlcG9ydEZhaWx1cmUoZXJyb3IgOiBhbnkpIHtcclxuICAgIHRoaXMuZWxlbWVudEZvdW5kID0gZmFsc2U7XHJcblxyXG4gICAgdmFyIG1lc3NhZ2UgPSBuZXcgTWVzc2FnZSgpO1xyXG4gICAgbWVzc2FnZS5pc0Vycm9yID0gdHJ1ZTtcclxuICAgIG1lc3NhZ2UuY3VzdG9tX21lc3NhZ2UgPSBlcnJvci5lcnJfbXNnO1xyXG4gICAgbWVzc2FnZS5lcnJvcl9tc2cgPSBlcnJvci5lcnJfbXNnO1xyXG4gICAgdGhpcy5tZXNzYWdlU2VydmljZS5tZXNzYWdlKG1lc3NhZ2UpO1xyXG4gIH1cclxufVxyXG4iXX0=
