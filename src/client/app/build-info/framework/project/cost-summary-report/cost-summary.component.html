<section class="wrapper">

  <div class="container">
    <div class="col-sm-8 col-xs-12 no-padding">
      <div class="col-sm-5">
        <h5>{{getHeadings().CONSTRUCTION_COST}}</h5>
      </div>
      <div class="col-sm-7 text-right padding-top-7">
        <label>{{getLabel().COSTING_BY_UNIT}}</label>
        <select class="select-costing" (change)="onChangeCostingByUnit($event.target.value)">
          <option *ngFor="let cIn of costIn" [value]="cIn.costInId">{{cIn.costInId}}</option>
        </select>
        <label>{{getLabel().COSTING_PER_AREA}}</label>
        <select class="select-costing" (change)="onChangeCostingByArea($event.target.value)">
          <option *ngFor="let cPer of costPer" [value]="cPer.costPerId">{{cPer.costPerId}}</option>
        </select>
      </div>
    </div>
    <div class="col-sm-8 col-xs-12">
      <div class="panel-group" *ngFor="let building of projectBuildings; let i = index">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a (click)="setBuildingId(i,building._id)" data-toggle="collapse" href="#collapse{{i}}">
                  {{building.name}} <span class="slab-area"> {{getLabel().TOTAL}} {{defaultCostingByArea}} : {{building.area}} {{defaultCostingByUnit}}
                  <span *ngIf="compareIndex !== i"> {{getLabel().BUDGETED_COST}} : {{building.thumbRule.totalBudgetedCost|number}}</span></span>
                </a>
              </h4>
              <div class="dropdown menu-items">
                <a class="dropdown-toggle" data-toggle="dropdown"><img src="assets/build-info/dashboard/dots.png" /></a>
                <ul class = "dropdown-menu">
                  <li><p  data-toggle="modal" data-target="#myModal" (click)="cloneBuilding(building._id)">{{getMenus().CLONE}}</p></li>
                  <li><p (click)="goToEditBuilding(building._id)">{{getMenus().EDIT}}</p></li>
                  <li><p data-toggle="modal" data-target="#deleteBuilding" (click)="setIdForDeleteBuilding(building._id)">{{getMenus().DELETE}}</p></li>
                  <li><p (click)="goToCreateBuilding()">{{getMenus().ADD_BUILDING}}</p></li>
                </ul>
              </div>
            </div>
            <div id="collapse{{i}}" class="panel-collapse collapse" [class.in]="i===0">
              <div class="panel-body">
                <table class="table table-row-spacing table-dashboard">
                  <thead>
                    <tr>
                      <th rowspan="2" class="border-left">{{getLabel().COST_HEAD}}</th>
                      <th colspan="2" class="border-left">{{getLabel().REPORT_BY_THUMBRULE}}</th>
                      <th colspan="2" class="border-left">{{getLabel().ESTIMATED}} <span class="sub-heading">{{getLabel().AS_PER_PROJECT}}</span></th>
                      <th>&nbsp;<div class="white-bg"></div></th>
                    </tr>
                    <tr>
                      <th><span class="sub-heading">{{getLabel().BUDGETED_COST}} </span></th>
                      <th class="border-left"><span class="sub-heading">{{defaultCostingByUnit}}<br/>{{defaultCostingByArea}}</span></th>
                      <th><span class="sub-heading">{{getLabel().ESTIMATED_COST}} </span></th>
                      <th class="border-left" ><span class="sub-heading">{{defaultCostingByUnit}}<br/>{{defaultCostingByArea}}</span></th>
                      <th>&nbsp;</th>
                    </tr>
                  </thead>
                  <tbody *ngIf="(building.thumbRule && building.estimate)" >
                    <tr *ngFor="let thumbRuleItem of building.thumbRule.thumbRuleReports; let i = index">
                      <td class="border-left">{{thumbRuleItem.name}}</td>
                      <td>
                        <div class="edit-field">
                          <input type="number"
                                 [(ngModel)]="thumbRuleItem.amount"
                                 id="thumbRuleItem.amount"
                                 (blur)="changeRateOfThumbRule(building._id, thumbRuleItem.name, thumbRuleItem.amount , building.area)"
                                 class="form-control clear"/>
                        </div>
                      </td>
                      <td class="border-left">{{thumbRuleItem.rate}}</td>
                      <td>
                        <div class="edit-field" *ngIf="building.estimate.estimatedCosts[i].total != 0"
                             (click)="goToCostHeadView(building._id,building.name, building.estimate.estimatedCosts[i])">
                          <input [(ngModel)]="building.estimate.estimatedCosts[i].total"
                                 id="estimatedItem.total"
                                 class="form-control clear"/>
                        </div>
                        <button *ngIf="building.estimate.estimatedCosts[i].total == 0"
                                  type="button" class="btn-get-amount"
                                  (click)="goToCostHeadView(building._id,building.name, building.estimate.estimatedCosts[i])">Get Amount</button>
                      </td>
                      <td class="border-left">{{building.estimate.estimatedCosts[i].rate}}</td>
                      <td>
                        <div data-toggle="modal"
                             data-target="#deleteCosthead"
                             (click)="setIdsToInactiveCostHead(building._id, building.estimate.estimatedCosts[i].rateAnalysisId)"
                             class="delete-cost-head">
                          <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete.png" />
                        </div>
                      </td>
                    </tr>
                    <tr *ngIf="showCostHeadList===true && buildingId===building._id">
                      <td class="border-left">
                        <select class="select-item" (change)="onChangeActiveSelectedCostHead($event.target.value)">
                          <option>Select Item</option>
                          <option *ngFor="let costHeadItem of inActiveCostHeadArray" [value]="costHeadItem.rateAnalysisId">
                            {{costHeadItem.name}}
                          </option>
                        </select>
                      </td>
                      <td colspan="5">&nbsp;</td>
                    </tr>
                    <tr>
                      <td colspan="6" class="add-items">
                        <button type="button" class="btn btn-add-item"
                                (click)="getAllInactiveCostHeads(building._id)">
                          <span class="glyphicon glyphicon-plus"></span>{{getButton().ADD}} {{getButton().COSTHEAD}}
                        </button>
                      </td>
                    </tr>
                  <tr class="total" *ngIf="(building.thumbRule && building.estimate)">
                    <td>{{getLabel().TOTAL}}</td>
                    <td>{{building.thumbRule.totalBudgetedCost|number}}</td>
                    <td>{{building.thumbRule.totalRate|number}}</td>
                    <td>{{building.estimate.totalEstimatedCost|number}}</td>
                    <td>{{building.estimate.totalRate|number}}</td>
                    <td></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      <!--TODO: make separate component for Common Amminities-->
      <div class="panel-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#collapseCommonDevelopment">
                {{getHeadings().COMMON_DEVELOPMENT}} <span class="slab-area"> {{getLabel().TOTAL}} {{defaultCostingByArea}} : 12,130 Sqmt </span>
              </a>
            </h4>
          </div>
          <div id="collapseCommonDevelopment" class="panel-collapse collapse">
            <div class="panel-body">

              <table class="table table-row-spacing table-dashboard">
                <thead>
                <tr>
                  <th rowspan="2" class="border-left">{{getLabel().COST_HEAD}}</th>
                  <th colspan="2" class="border-left">{{getLabel().REPORT_BY_THUMBRULE}}</th>
                  <th colspan="2" class="border-left">
                    {{getLabel().ESTIMATED}} <span class="sub-heading">{{getLabel().AS_PER_PROJECT}}</span>
                  </th>
                  <th>&nbsp;</th>
                </tr>
                <tr>
                  <th><span class="sub-heading">{{getLabel().BUDGETED_COST}}</span></th>
                  <th class="border-left"><span class="sub-heading">{{defaultCostingByUnit}}<br/>{{defaultCostingByArea}}</span></th>
                  <th><span class="sub-heading">{{getLabel().ESTIMATED_COST}}</span></th>
                  <th class="border-left" ><span class="sub-heading">{{defaultCostingByUnit}}<br/>{{defaultCostingByArea}}</span></th>
                  <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td class="border-left">Electric Infrastructure</td>
                  <td>3,26,790</td>
                  <td class="border-left">990</td>
                  <td>19,95,000</td>
                  <td class="border-left">18</td>
                  <td>
                    <div class="delete-cost-head">
                      <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete.png" />
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="6" class="add-items">
                    <button type="button" class="btn btn-add-item"><span class="glyphicon glyphicon-plus"></span>Add Item</button>
                  </td>
                </tr>
                <tr class="total">
                  <td class="border-left">Total</td>
                  <td>3,26,790</td>
                  <td class="border-left">990</td>
                  <td>19,95,000</td>
                  <td class="border-left">18</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>


      <div class="panel-group no-border">
        <div class="panel panel-default" (click)="toggleShowGrandTotalPanelBody()">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a>
                {{getLabel().GRAND_TOTAL}} <span class="slab-area">{{getLabel().TOTAL_PROJECT}} {{defaultCostingByArea}} : {{grandTotalofArea}} {{defaultCostingByUnit}}</span>
              </a>
            </h4>
          </div>
          <div *ngIf="showGrandTotalPanelBody===true">
            <div class="panel-body total-body" (click)="toggleShowGrandTotalPanelBody()">
              <table class="table table-row-spacing table-dashboard">
                <tbody>
                <tr class="grand-total">
                  <td class="border-left">{{getLabel().TOTAL}}</td>
                  <td>{{grandTotalofBudgetedCost|number}}</td>
                  <td class="border-left">{{grandTotalofTotalRate|number}}</td>
                  <td>{{grandTotalofEstimatedCost|number}}</td>
                  <td class="border-left">{{grandTotalofEstimatedRate|number}}</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-4">
      <img src="./assets/build-info/dashboard/ads.png" />
    </div>
  </div>

  <!--Delete modals-->
  <div class="modal fade default-modal" id="deleteCosthead" role="dialog">
    <bi-delete-confirmation-modal [elementType]="deleteConfirmationCostHead" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
  </div>

  <div class="modal fade default-modal" id="deleteBuilding" role="dialog">
    <bi-delete-confirmation-modal [elementType]="deleteConfirmationBuilding" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
  </div>

  <!--Clone Modal -->
  <div class="modal fade dashboard-modal clone-modal" id="myModal" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{cloneBuildingModel.name}} Building</h2>
        </div>
        <form [formGroup]="cloneBuildingForm" class="profile-form clearfix">
          <div class="modal-body">
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.name" [submitStatus] = "submitStatus"></control-messages>
              <label>Building Name</label>
              <input type="text" [(ngModel)]="cloneBuildingModel.name" formControlName="name" size="45" class="form-control" required/>
            </div>
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalSlabArea" [submitStatus] = "submitStatus"></control-messages>
              <label>Slab Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalSlabArea" formControlName="totalSlabArea" size="45" class="form-control" required/>
            </div>
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalCarpetAreaOfUnit" [submitStatus] = "submitStatus"></control-messages>
              <label>Carpet area including Balconies/attached terraces <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalCarpetAreaOfUnit" formControlName="totalCarpetAreaOfUnit" class="form-control" size="45" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalSaleableAreaOfUnit" [submitStatus] = "submitStatus"></control-messages>
              <label>Saleable Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalSaleableAreaOfUnit" formControlName="totalSaleableAreaOfUnit" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.plinthArea" [submitStatus] = "submitStatus"></control-messages>
              <label>Plinth Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.plinthArea" formControlName="plinthArea" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalNumOfFloors" [submitStatus] = "submitStatus"></control-messages>
              <label>No. of floors<small> (Excluding parking floors)</small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalNumOfFloors" formControlName="totalNumOfFloors" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.numOfParkingFloors" [submitStatus] = "submitStatus"></control-messages>
              <label>No. of parking floors</label>
              <input type="text" [(ngModel)]="cloneBuildingModel.numOfParkingFloors" formControlName="numOfParkingFloors" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.carpetAreaOfParking" [submitStatus] = "submitStatus"></control-messages>
              <label>Carpet area of parking <small> (In sft)</small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.carpetAreaOfParking" formControlName="carpetAreaOfParking" size="45" class="form-control" required/>
            </div>

            <h2 class="apartment-configuration-title">Apartment Configuration</h2>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 1 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfOneBHK" formControlName="numOfOneBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 2 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfTwoBHK" formControlName="numOfTwoBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 3 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfThreeBHK" formControlName="numOfThreeBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 4 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfFourBHK" formControlName="numOfFourBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 5 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfFiveBHK" formControlName="numOfFiveBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of Lifts</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfLifts" formControlName="numOfLifts" size="45" class="form-control">
              </div>
            </div>
            </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary next-btn" type="submit"  (click)="cloneBuildingBasicDetails()" data-toggle="modal" data-target="#new" data-dismiss="modal">Next</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade dashboard-modal clone-modal" id="new" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{cloneBuildingModel.name}} Building Details</h2>
        </div>
        <div class="modal-body">
          <h2 class="following-items-title"> Include following items </h2>
          <div class="collapse-items" *ngFor="let costHead of clonedBuildingDetails; let i = index">
            <input type="checkbox" [checked]="costHead.active" (change)="costHead.active = !costHead.active"/>

            <a class="" href="#category{{i}}" data-toggle="collapse">
              {{costHead.name}}
              <img class="down-arrow" src="./assets/build-info/dashboard/down.png" />
              <img class="up-arrow" src="./assets/build-info/dashboard/up.png" />
            </a>

            <div id="category{{i}}" class="collapse">
              <div *ngFor="let category of costHead.category">
                <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && category.active)" (change)="category.active = !category.active" />
                <div class="col-xs-10 no-padding">
                  {{category.name}}
                </div>
                <div class="inner-items sub-inner-items" *ngFor="let workitem of category.workitem">
                  <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && category.active && workitem.active)" (change)="workitem.active = !workitem.active" />
                  <div class="col-xs-10 no-padding">
                    {{workitem.name}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button class="btn btn-primary clone-btn" type="button" (click)="cloneBuildingCostHeads(clonedBuildingDetails, clonedBuildingDetails._id)" data-toggle="modal" data-dismiss="modal">Clone</button>
        </div>
      </div>
    </div>
  </div>

</section>
