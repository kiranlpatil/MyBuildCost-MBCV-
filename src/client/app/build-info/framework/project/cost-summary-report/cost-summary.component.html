<section class="wrapper">

  <div class="container">
    <div class="col-sm-8 col-xs-12 no-padding">
      <div class="col-sm-5">
        <h5>Construction Cost (Material + Labour)</h5>
      </div>
      <div class="col-sm-7 text-right padding-top-7">
        <label>Costing in</label>
        <select class="select-costing" (change)="onChangeCostingIn($event.target.value)">
          <option *ngFor="let cIn of costIn" [value]="cIn.costInId">{{cIn.costInId}}</option>
        </select>
        <label>Costing per</label>
        <select class="select-costing" (change)="onChangeCostingPer($event.target.value)">
          <option *ngFor="let cPer of costPer" [value]="cPer.costPerId">{{cPer.costPerId}}</option>
        </select>
      </div>
    </div>
    <div class="col-sm-8 col-xs-12">
      <div class="panel-group" *ngFor="let building of projectBuildings; let i = index">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a (click)="setBuildingId(building._id)" data-toggle="collapse" href="#collapse{{i}}">
                  {{building.name}} <span class="slab-area"> Total {{defaultCostPer}} : {{building.area}} {{defaultCostIn}}</span>
                </a>
              </h4>
              <div class="dropdown menu-items">
                <a class="dropdown-toggle" data-toggle="dropdown"><img src="assets/build-info/dashboard/dots.png" /></a>
                <ul class = "dropdown-menu">
                  <li><p  data-toggle="modal" data-target="#myModal" (click)="cloneBuilding(building._id)">Clone</p></li>
                  <li><p (click)="editBuildingDetails(building._id)">Edit</p></li>
                  <li><p data-toggle="modal" data-target="#delete" (click)="deleteBuildingFunction(building._id)">Delete</p></li>
                  <li><p (click)="addBuilding()">Add Building</p></li>
                </ul>
              </div>
            </div>
            <div id="collapse{{i}}" class="panel-collapse collapse">
              <div class="panel-body">
                <table class="table table-row-spacing table-dashboard" style="position: relative">
                  <thead>
                    <tr>
                      <th rowspan="2" class="border-left">Cost Head</th>
                      <th colspan="2" class="border-left">By Thumbrule</th>
                      <th colspan="2" class="border-left">Estimated <span class="sub-heading">(as per project quantities & rates)</span></th>
                      <th>&nbsp;<div class="white-bg"></div></th>
                    </tr>
                    <tr>
                      <th><span class="sub-heading">Budgeted Cost</span></th>
                      <th class="border-left"><span class="sub-heading">{{defaultCostIn}}<br/>{{defaultCostPer}}</span></th>
                      <th><span class="sub-heading">Estimated Cost</span></th>
                      <th class="border-left" ><span class="sub-heading">{{defaultCostIn}}<br/>{{defaultCostPer}}</span></th>
                      <th>&nbsp;</th>
                    </tr>
                  </thead>
                  <tbody *ngIf="(building.thumbRule && building.estimated)" >
                    <tr *ngFor="let thumbRuleItem of building.thumbRule.thumbRuleReport; let i = index">
                      <td class="border-left">{{thumbRuleItem.name}}</td>
                      <td>
                        <div class="edit-field">
                          <input type="number"
                                 [(ngModel)]="thumbRuleItem.amount"
                                 id="thumbRuleItem.amount"
                                 (blur)="changeBudgetedCost(building._id, thumbRuleItem.name, thumbRuleItem.amount , building.area)"
                                 class="form-control clear"/>
                        </div>
                      </td>
                      <td class="border-left">{{thumbRuleItem.rate}}</td>
                      <td>
                        <div class="edit-field" *ngIf="building.estimated.estimatedCost[i].total != 0"
                             (click)="getAmount(building.name, building.estimated.estimatedCost[i])">
                          <input [(ngModel)]="building.estimated.estimatedCost[i].total"
                                 id="estimatedItem.total"
                                 class="form-control clear"/>
                        </div>
                        <button *ngIf="building.estimated.estimatedCost[i].total == 0"
                                  type="button" class="btn-get-amount"
                                  (click)="getAmount(building.name, building.estimated.estimatedCost[i])">Get Amount</button>
                      </td>
                      <td class="border-left">{{building.estimated.estimatedCost[i].rate}}</td>
                      <td>
                        <div data-toggle="modal"
                             data-target="#deleteCosthead"
                             (click)="deleteCostHeadDetailsfun(building._id, building.estimated.estimatedCost[i].name)"
                             class="delete-cost-head">
                          <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete.png" />
                        </div>
                      </td>
                    </tr>
                    <tr *ngIf="showCostHeadList===true && buildingId===building._id">
                      <td class="border-left">
                        <select class="select-item" (change)="inactiveCostHeadSelected($event.target.value)">
                          <option>Select Item</option>
                          <option *ngFor="let costHeadItem of inActiveCostHeadArray" [value]="costHeadItem.name">
                            {{costHeadItem.name}}
                          </option>
                        </select>
                      </td>
                      <td colspan="5">&nbsp;</td>
                    </tr>
                    <tr>
                      <td colspan="6" class="add-items">
                        <button type="button" class="btn btn-add-item"
                                (click)="showInactiveCostHeadsOnDropDown(building._id)">
                          <span class="glyphicon glyphicon-plus"></span>Add Item
                        </button>
                      </td>
                    </tr>
                  <tr class="total" *ngIf="(building.thumbRule && building.estimated)">
                    <td>Total</td>
                    <td>{{building.thumbRule.totalBudgetedCost|number}}</td>
                    <td>{{building.thumbRule.totalRate|number}}</td>
                    <td>{{building.estimated.totalEstimatedCost|number}}</td>
                    <td>{{building.estimated.totalRate|number}}</td>
                    <td></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      <div class="panel-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" href="#collapseCommonDevelopment">
                Common Development <span class="slab-area"> Total {{defaultCostPer}} : 12,130 Sqmt </span>
              </a>
            </h4>
          </div>
          <div id="collapseCommonDevelopment" class="panel-collapse collapse">
            <div class="panel-body">

              <table class="table table-row-spacing table-dashboard">
                <thead>
                <tr>
                  <th rowspan="2" class="border-left">Cost Head</th>
                  <th colspan="2" class="border-left">By Thumbrule</th>
                  <th colspan="2" class="border-left">
                    Estimated <span class="sub-heading">(as per project quantities & rates)</span>
                  </th>
                  <th>&nbsp;</th>
                </tr>
                <tr>
                  <th><span class="sub-heading">Budgeted Cost</span></th>
                  <th class="border-left"><span class="sub-heading">{{defaultCostIn}}<br/>{{defaultCostPer}}</span></th>
                  <th><span class="sub-heading">Estimated Cost</span></th>
                  <th class="border-left" ><span class="sub-heading">{{defaultCostIn}}<br/>{{defaultCostPer}}</span></th>
                  <th>&nbsp;</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td class="border-left">Electric Infrastructure</td>
                  <td>3,26,790</td>
                  <td class="border-left">990</td>
                  <td>19,95,000</td>
                  <td class="border-left">18</td>
                  <td>
                    <div class="delete-cost-head">
                      <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete.png" />
                    </div>
                  </td>
                </tr>
                <tr>
                  <td colspan="6" class="add-items">
                    <button type="button" class="btn btn-add-item"><span class="glyphicon glyphicon-plus"></span>Add Item</button>
                  </td>
                </tr>
                <tr class="total">
                  <td class="border-left">Total</td>
                  <td>3,26,790</td>
                  <td class="border-left">990</td>
                  <td>19,95,000</td>
                  <td class="border-left">18</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>


      <div class="panel-group no-border">
        <div class="panel panel-default" (click)="toggleShowGrandTotalPanelBody()">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a>
                Grand Total <span class="slab-area"> Total {{defaultCostPer}} : {{grandTotalofArea}} {{defaultCostIn}}</span>
              </a>
            </h4>
          </div>
          <div *ngIf="showGrandTotalPanelBody===true">
            <div class="panel-body total-body" (click)="showGrandTotalBody()">
              <table class="table table-row-spacing table-dashboard">
                <tbody>
                <tr class="grand-total">
                  <td class="border-left">Total</td>
                  <td>{{grandTotalofBudgetedCost}}</td>
                  <td class="border-left">{{grandTotalofTotalRate}}</td>
                  <td>-</td>
                  <td class="border-left">-</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-4">
      <img src="./assets/build-info/dashboard/ads.png" />
    </div>
  </div>

  <!--Delete modal-->
  <div class="modal fade default-modal" id="deleteCosthead" role="dialog">
    <div class="modal-dialog modal-md">
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Delete Cost Head</h2>
        </div>
        <div class="modal-body">
          <p class="font-16">Do you want to delete a CostHead ?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary bi-btn" type="button" (click)="deleteCostHeadDetails()" data-dismiss="modal">Yes</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!--Clone Modal -->
  <div class="modal fade dashboard-modal clone-modal" id="myModal" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{model.name}} Building</h2>
        </div>
        <form [formGroup]="cloneBuildingForm" class="profile-form clearfix">
          <div class="modal-body">
            <div class="form-group">
              <label>Enter Password</label>
              <input type="text" [(ngModel)]="model.name" formControlName="name" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>Total Slab area<small>(in sqm)</small></label>
              <input type="text" [(ngModel)]="model.totalSlabArea" formControlName="totalSlabArea" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>Total Carper area<small>(in sqm)</small></label>
              <input type="text" [(ngModel)]="model.totalCarperAreaOfUnit" formControlName="totalCarperAreaOfUnit" class="form-control" size="45">
            </div>
            <div class="form-group">
              <label>Total Saleable area<small>(in sqm)</small></label>
              <input type="text" [(ngModel)]="model.totalSaleableAreaOfUnit" formControlName="totalSaleableAreaOfUnit" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>Plinth Area<small>(in sqm)</small></label>
              <input type="text" [(ngModel)]="model.plinthArea" formControlName="plinthArea" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>Total No Of Floors</label>
              <input type="text" [(ngModel)]="model.totalNoOfFloors" formControlName="totalNoOfFloors" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>No Of Parking Floors</label>
              <input type="text" [(ngModel)]="model.noOfParkingFloors" formControlName="noOfParkingFloors" size="45" class="form-control">
            </div>
            <div class="form-group">
              <label>Carpet Area Of Parking <small> (In sqft)</small></label>
              <input type="text" [(ngModel)]="model.carpetAreaOfParking" formControlName="carpetAreaOfParking" size="45" class="form-control">
            </div>

            <h2 class="apartment-configuration-title">Apartment Configuration</h2>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of 1 BHKs</label>
                <input type="text" [(ngModel)]="model.noOfOneBHK" formControlName="noOfOneBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of 2 BHKs</label>
                <input type="text" [(ngModel)]="model.noOfTwoBHK" formControlName="noOfTwoBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of 3 BHKs</label>
                <input type="text" [(ngModel)]="model.noOfThreeBHK" formControlName="noOfThreeBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of 4 BHKs</label>
                <input type="text" [(ngModel)]="model.noOfFourBHK" formControlName="noOfFourBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of 5 BHKs</label>
                <input type="text" [(ngModel)]="model.noOfFiveBHK" formControlName="noOfFiveBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No of lifts</label>
                <input type="text" [(ngModel)]="model.noOfLift" formControlName="noOfLift" size="45" class="form-control">
              </div>
            </div>
            </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary next-btn" type="submit" (click)="cloneBuildingBasicDetails()" data-toggle="modal" data-target="#new" data-dismiss="modal">Next</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade dashboard-modal clone-modal" id="new" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{model.name}} Building Details</h2>
        </div>
        <div class="modal-body">
          <h2 class="following-items-title"> Include following items </h2>
          <div class="collapse-items" *ngFor="let costHead of clonedBuildingDetails; let i = index">
            <input type="checkbox" [checked]="costHead.active" (change)="costHead.active = !costHead.active"/>

            <a class="" href="#subCategory{{i}}" data-toggle="collapse">
              {{costHead.name}}
              <img class="down-arrow" src="./assets/build-info/dashboard/down.png" />
              <img class="up-arrow" src="./assets/build-info/dashboard/up.png" />
            </a>

            <div id="subCategory{{i}}" class="collapse">
              <div *ngFor="let subcategory of costHead.subCategory">
                <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && subcategory.active)" (change)="subcategory.active = !subcategory.active" />
                <div class="col-xs-10 no-padding">
                  {{subcategory.name}}
                </div>
                <div class="inner-items sub-inner-items" *ngFor="let workitem of subcategory.workitem">
                  <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && subcategory.active && workitem.active)" (change)="workitem.active = !workitem.active" />
                  <div class="col-xs-10 no-padding">
                    {{workitem.name}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button class="btn btn-primary clone-btn" type="button" (click)="updateThisBuilding(clonedBuildingDetails, clonedBuildingDetails._id)" data-toggle="modal" data-dismiss="modal">Clone</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade default-modal" id="delete" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Delete Building</h2>
        </div>
        <div class="modal-body">
          <p class="font-16">Do you want to delete a Building ?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary bi-btn" type="button"  (click)="deleteThisBuilding()" data-dismiss="modal">Yes</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</section>
