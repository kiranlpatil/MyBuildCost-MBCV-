<bi-project-header></bi-project-header>
<section class="wrapper">

  <div class="container">
    <div class="col-sm-9 col-xs-12 padding-right30 left-content">
      <div class="col-sm-5 padding-left0">
        <h5>{{ getHeadings().CONSTRUCTION_COST }}</h5>
      </div>
      <div class="col-sm-7 text-right padding-top-7">
        <label>{{ getLabel().COSTING_BY_UNIT }}</label>
        <select class="select-costing" (change)="onChangeCostingByUnit($event.target.value)">
          <option *ngFor="let cIn of costIn" [value]="cIn.costInId">{{ cIn.costInId }}</option>
        </select>
        <label>{{ getLabel().COSTING_PER_AREA }}</label>
        <select class="select-costing no-margin" (change)="onChangeCostingByArea($event.target.value)">
          <option *ngFor="let cPer of costPer" [value]="cPer.costPerId">{{(cPer.costPerId === getProjectElements().SLAB_AREA) ? getProjectElements().SLAB_AREA : ((cPer.costPerId === getProjectElements().SALEABLE_AREA) ? getProjectElements().SALEABLE_AREA : getProjectElements().CARPET_AREA)}}</option>
        </select>
      </div>
    </div>
    <div class="col-sm-9 col-xs-12 padding-right30 left-content">
      <div class="panel panel-default">
      <div class="panel-group" *ngFor="let building of buildingsReport; let i = index">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a (click)="setBuildingId(i,building._id)" data-toggle="collapse" href="#collapse{{i}}" [class.collapsed]="i!=0">
                  {{ building.name }}
                  <span class="slab-area">
                    {{ getLabel().TOTAL }} {{(defaultCostingByArea === getProjectElements().SLAB_AREA) ? 'Slab Area' : ((defaultCostingByArea === getProjectElements().SALEABLE_AREA) ? 'Saleable Area' : 'Carpet Area')}} : {{ building.area }} {{ (defaultCostingByUnit === getProjectElements().RS_PER_SQFT) ? getProjectElements().SQUAREFEET : getProjectElements().SQUAREMETER }}
                  </span>
                  <!--<span class="slab-area" *ngIf="compareIndex !== i">
                    {{ getLabel().BUDGETED_COST }} : {{ building.thumbRule.totalBudgetedCost|number }}
                  </span>-->
                  <span class="caret"></span>
                </a>
              </h4>
              <div class="dropdown menu-items">
                <a class="dropdown-toggle" data-toggle="dropdown"><img src="assets/build-info/dashboard/dots.png" /></a>
                <ul class = "dropdown-menu">
                  <li><p  data-toggle="modal" data-target="#myModal" (click)="cloneBuilding(building._id)">{{getMenus().CLONE}}</p></li>
                  <li><p (click)="goToEditBuilding(building._id)">{{getMenus().EDIT}}</p></li>
                  <li><p data-toggle="modal" data-target="#deleteBuilding" (click)="setIdForDeleteBuilding(building._id)">{{getMenus().DELETE}}</p></li>
                  <li><p (click)="downloadToPdf()">Print PDF</p></li>
                </ul>
              </div>
            </div>
            <div id="collapse{{i}}" class="panel-collapse collapse" [class.in]="i===0">
              <div class="panel-body">
                <table class="table table-row-spacing table-dashboard">
                  <thead>
                    <tr>
                      <th rowspan="2" class="border-left">{{ getLabel().COST_HEAD }}</th>
                      <th colspan="2" class="border-left table-heading">
                        {{ getLabel().REPORT_BY_THUMBRULE }}
                        <div class="white-bg"></div>
                      </th>
                      <th colspan="2" class="border-left table-heading">
                        {{ getLabel().ESTIMATED }} <span class="sub-heading">{{ getLabel().AS_PER_PROJECT }}</span>
                        <div class="white-bg"></div>
                      </th>
                    </tr>
                    <tr class="cost-summary-row-list">
                      <th class="text-center"><span class="sub-heading">{{ defaultCostingByUnit }}<br/>{{ defaultCostingByArea }}</span></th>
                      <th class="border-left"><span class="sub-heading">{{ getLabel().BUDGETED_COST }} </span></th>
                      <th><span class="sub-heading">{{ defaultCostingByUnit }}<br/>{{(defaultCostingByArea === getProjectElements().SLAB_AREA) ? 'Slab Area' : ((defaultCostingByArea === getProjectElements().SALEABLE_AREA) ? 'Saleable Area' : 'Carpet Area')}}</span></th>
                      <th><span class="sub-heading">{{ getLabel().ESTIMATED_COST }} </span></th>
                    </tr>
                  </thead>
                  <tbody *ngIf="(building.thumbRule && building.estimate)" >
                    <tr *ngFor="let thumbRuleItem of building.thumbRule.thumbRuleReports; let i = index" class="delete-cost-head-cell">
                      <td class="border-left">{{ thumbRuleItem.name }}</td>
                      <td class="border-left">{{ thumbRuleItem.rate | number }}</td>
                      <td class="border-left">
                        <div class="edit-field">
                          <input type="number"
                                 [(ngModel)]="thumbRuleItem.amount"
                                 id="thumbRuleItem.amount"
                                 (blur)="changeBudgetedCostAmountOfBuildingCostHead(building._id, thumbRuleItem.name, thumbRuleItem.amount)"
                                 class="form-control clear"/>
                        </div>
                      </td>
                      <td class="border-left">
                        {{ building.estimate.estimatedCosts[i].rate | number }}
                      </td>
                      <td>
                        <div *ngIf="building.estimate.estimatedCosts[i].total != 0"
                             (click)="goToCostHeadView(building._id,building.name, building.estimate.estimatedCosts[i])">
                          <span class="estimated-cost"
                            [class.above-cost]="building.estimate.estimatedCosts[i].total > thumbRuleItem.amount"
                            [class.below-cost]="building.estimate.estimatedCosts[i].total < thumbRuleItem.amount">
                            {{ building.estimate.estimatedCosts[i].total | number }}
                          </span>
                        </div>
                        <button *ngIf="building.estimate.estimatedCosts[i].total == 0"
                                type="button" class="btn-get-amount"
                                (click)="goToCostHeadView(building._id,building.name, building.estimate.estimatedCosts[i])">Estimate Cost</button>
                      </td>
                      <td class="delete-cost-head" >
                        <div title="Delete Cost Head" data-toggle="modal"
                             data-target="#deleteCosthead"
                             (click)="setIdsToInActiveCostHead(building._id, building.estimate.estimatedCosts[i].rateAnalysisId)">
                          <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete.png" />
                        </div>
                      </td>
                    </tr>
                    <tr *ngIf="showCostHeadList===true && buildingId===building._id" class="add-cost-head">
                      <td class="border-left">
                        <select class="select-item" (change)="onChangeActiveSelectedCostHead($event.target.value)">
                          <option>Select Item</option>
                          <option *ngFor="let costHeadItem of inActiveCostHeadArray" [value]="costHeadItem.rateAnalysisId">
                            {{ costHeadItem.name }}
                          </option>
                        </select>
                      </td>
                      <td colspan="5">&nbsp;</td>
                    </tr>
                    <tr class="add-item-row">
                      <td colspan="5" class="add-items">
                        <button type="button" class="btn btn-add-item"
                                (click)="getAllInActiveCostHeads(building._id)">
                          <span class="glyphicon glyphicon-plus"></span>{{ getButton().ADD }} {{ getButton().COSTHEAD }}
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <table class="table table-row-spacing table-dashboard total-table">
              <tbody>
                <tr *ngIf="(building.thumbRule && building.estimate)">
                  <td class="border-left">{{ getLabel().TOTAL }}</td>
                  <td class="border-left">{{ building.thumbRule.totalRate|number }}</td>
                  <td class="border-left"><span class="estimated-cost">{{ building.thumbRule.totalBudgetedCost|number }}</span></td>
                  <td class="border-left">{{ building.estimate.totalRate|number }}</td>
                  <td class="border-left"><span class="estimated-cost">{{ building.estimate.totalEstimatedCost|number }}</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      <!--Common Amenity-->
      <bi-common-amenities
        [amenitiesReport]="amenitiesReport"
        [costingByUnit]="defaultCostingByUnit"
        [costingByArea]="defaultCostingByArea"
        (getReportDetails)="getCostSummaryReport($event)">
      </bi-common-amenities>


      <div class="panel-group no-border grand-total-table">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <table class="table">
                <tbody>
                <tr>
                  <td>{{ getLabel().GRAND_TOTAL }}</td>
                  <td>{{ grandTotalOfTotalRate|number }}</td>
                  <td><span class="estimated-cost">{{ grandTotalOfBudgetedCost|number }}</span></td>
                  <td>{{ grandTotalOfEstimatedRate|number }}</td>
                  <td><span class="estimated-cost">{{ grandTotalOfEstimatedCost|number }}</span></td>
                </tr>
                </tbody>
              </table>
            </h4>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-3 no-padding right-content">
      <img src="./assets/build-info/dashboard/ads.png" style="width: 100%; margin-top: 20px;" />
    </div>
  </div>

  <!--Delete modals-->
  <div class="modal fade default-modal" id="deleteCosthead" role="dialog">
    <bi-delete-confirmation-modal [elementType]="deleteConfirmationCostHead" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
  </div>

  <div class="modal fade default-modal" id="deleteBuilding" role="dialog">
    <bi-delete-confirmation-modal [elementType]="deleteConfirmationBuilding" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
  </div>

  <!--Clone Modal -->
  <div class="modal fade dashboard-modal clone-modal" id="myModal" role="dialog">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{ cloneBuildingModel.name }} Building</h2>
        </div>
        <form [formGroup]="cloneBuildingForm" class="profile-form clearfix">
          <div class="modal-body">
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.name" [submitStatus] = "submitStatus"></control-messages>
              <label>Building Name</label>
              <input type="text" [(ngModel)]="cloneBuildingModel.name" formControlName="name" size="45" class="form-control" required/>
            </div>
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalSlabArea" [submitStatus] = "submitStatus"></control-messages>
              <label>Slab Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalSlabArea" formControlName="totalSlabArea" size="45" class="form-control" required/>
            </div>
            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalCarpetAreaOfUnit" [submitStatus] = "submitStatus"></control-messages>
              <label>Carpet area including Balconies/attached terraces <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalCarpetAreaOfUnit" formControlName="totalCarpetAreaOfUnit" class="form-control" size="45" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalSaleableAreaOfUnit" [submitStatus] = "submitStatus"></control-messages>
              <label>Saleable Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalSaleableAreaOfUnit" formControlName="totalSaleableAreaOfUnit" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.plinthArea" [submitStatus] = "submitStatus"></control-messages>
              <label>Plinth Area <small> (In sqft) </small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.plinthArea" formControlName="plinthArea" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.totalNumOfFloors" [submitStatus] = "submitStatus"></control-messages>
              <label>No. of floors<small> (Excluding parking floors)</small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.totalNumOfFloors" formControlName="totalNumOfFloors" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.numOfParkingFloors" [submitStatus] = "submitStatus"></control-messages>
              <label>No. of parking floors</label>
              <input type="text" [(ngModel)]="cloneBuildingModel.numOfParkingFloors" formControlName="numOfParkingFloors" size="45" class="form-control" required/>
            </div>

            <div class="form-group">
              <control-messages [control]="cloneBuildingForm.controls.carpetAreaOfParking" [submitStatus] = "submitStatus"></control-messages>
              <label>Carpet area of parking <small> (In sft)</small></label>
              <input type="text" [(ngModel)]="cloneBuildingModel.carpetAreaOfParking" formControlName="carpetAreaOfParking" size="45" class="form-control" required/>
            </div>

            <h2 class="apartment-configuration-title">Apartment Configuration</h2>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 1 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfOneBHK" formControlName="numOfOneBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 2 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfTwoBHK" formControlName="numOfTwoBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 3 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfThreeBHK" formControlName="numOfThreeBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 4 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfFourBHK" formControlName="numOfFourBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of 5 BHKs</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfFiveBHK" formControlName="numOfFiveBHK" size="20" class="form-control">
              </div>
            </div>
            <div class="col-xs-4">
              <div class="form-group">
                <label>No. of Lifts</label>
                <input type="text" [(ngModel)]="cloneBuildingModel.numOfLifts" formControlName="numOfLifts" size="45" class="form-control">
              </div>
            </div>
            </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button class="btn btn-primary next-btn" type="submit"  (click)="cloneBuildingBasicDetails()" data-toggle="modal" data-target="#new" data-dismiss="modal">Next</button>
<!--
<button class="btn btn-primary next-btn" type="submit"  (click)="cloneBuildingBasicDetails()"data-dismiss="modal">{{ getButton().CLONE_BUTTON }}</button>
-->
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade dashboard-modal clone-modal" id="new" role="dialog">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Clone {{ cloneBuildingModel.name }} Building Details</h2>
        </div>
        <div class="modal-body">
          <h2 class="following-items-title"> Include following items </h2>
          <div class="collapse-items" *ngFor="let costHead of clonedBuildingDetails; let thumbRuleItemIndex = index">
            <input type="checkbox" [checked]="costHead.active" (change)="costHead.active = !costHead.active"/>

            <a class="" href="#category{{thumbRuleItemIndex}}" data-toggle="collapse">
              {{ costHead.name }}
              <img class="down-arrow" src="./assets/build-info/dashboard/down.png" />
              <img class="up-arrow" src="./assets/build-info/dashboard/up.png" />
            </a>

            <div id="category{{thumbRuleItemIndex}}" class="collapse">
              <div *ngFor="let category of costHead.category">
                <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && category.active)" (change)="category.active = !category.active" />
                <div class="col-xs-10 no-padding">
                  {{ category.name }}
                </div>
                <div class="inner-items sub-inner-items" *ngFor="let workitem of category.workitem">
                  <input class="col-xs-1" type="checkbox" [checked]="(costHead.active && category.active && workitem.active)" (change)="workitem.active = !workitem.active" />
                  <div class="col-xs-10 no-padding">
                    {{ workitem.name }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button class="btn btn-primary clone-btn" type="button" (click)="cloneBuildingCostHeads(clonedBuildingDetails, clonedBuildingDetails._id)" data-toggle="modal" data-dismiss="modal">Clone</button>
        </div>
      </div>
    </div>
  </div>

</section>

<div id="content" #content style="display: none">
  <h2 style="font-family:'Arial, Helvetica, sans-serif';font-size:16px; border-bottom: 1px solid #000;">
    Budgeted & Estimated Cost Report for Mont Vert Belbrook </h2>
  <div style="font-family:'Arial, Helvetica, sans-serif';font-size:12px;">
    <div style="padding-bottom: 5px;">
      <strong>Company Name:</strong>
      <span>Royal Properties LTD</span>
    </div>
    <div style="padding-bottom: 5px;">
      <strong>Project Name:</strong>
      <span>Mont Vert Belbrook</span>
    </div>
    <div style="padding-bottom: 5px;">
      <strong>Building Name:</strong>
      <span>Dwarka</span>
    </div>
    <div style="padding-bottom: 5px;">
      <strong>Generated on:</strong>
      <span>4th April 2018</span>
    </div>
  </div>

<!--  <table bgcolor="#fff" width="2500" style="font-size:8px;font-family:'Arial, Helvetica, sans-serif';">
    <tr>
      <td bgcolor="#fff" width="">Cost Head</td>
      <td width="">By Thumbrule</td>
      <td width="">Estimated (as per project quantities and rates)</td>
    </tr>
  </table>-->
  <table width="2500" style="font-size:8px;font-family:'Arial, Helvetica, sans-serif';">
    <tr>
      <th width="400">Cost Head</th>
      <th width="400" style="word-wrap: break-word"> By Thumbrule - Rate/sqft Slab Area</th>
      <th width="400"> By Thumbrule - <hr>Budgeted Cost</th>
      <th width="400"> Estimated - <hr>Rate/sqft Slab Area </th>
      <th width="400">Estimated - Budgeted Cost </th>
    </tr>
    <tr>
      <td>External plaster</td>
      <td align="right">12.4</td>
      <td align="right">9787.5</td>
      <td align="right">44.55</td>
      <td align="right">35,147.2</td>
    </tr>
    <tr>
      <td>Fabrication</td>
      <td>5.95</td>
      <td>4698</td>
      <td>2,185.58</td>
      <td>1,724,418.72</td>
    </tr>
    <tr>
      <td>Gypsum / POP plaster (punning)</td>
      <td>4.96</td>
      <td>3915</td>
      <td>2.86</td>
      <td>2,254</td>
    </tr>
    <tr>
      <td>Internal plaster</td>
      <td>7.72</td>
      <td>6090</td>
      <td>1.11</td>
      <td>872.5</td>
    </tr>
    <tr>
      <td>Kitchen otta</td>
      <td>3,165.4</td>
      <td>24,97,500</td>
      <td>11,263.7</td>
      <td>8,887,060</td>
    </tr>
    <tr>
      <td>Masonry</td>
      <td>12.35</td>
      <td>9744</td>
      <td>1.77</td>
      <td>1,395</td>
    </tr>
    <tr>
      <td>Pointing</td>
      <td>8.19</td>
      <td>6459.75</td>
      <td>5.53</td>
      <td>4,362.75</td>
    </tr>
    <tr>
      <td>RCC band / patli</td>
      <td>1.9</td>
      <td>1500</td>
      <td>27.49</td>
      <td>21,687.36</td>
    </tr>
    <tr>
      <td>Safety measures</td>
      <td>3,165.4</td>
      <td>24,97,500</td>
      <td>11,263.7</td>
      <td>8,887,060</td>
    <tr>
      <td>Boards & Signages in common areas</td>
      <td>3,165.4</td>
      <td>24,97,500</td>
      <td>11,263.7</td>
      <td>8,887,060</td>
    </tr>
    <tr>
      <td>Total</td>
      <td>2,539,694.25</td>
      <td>13,532.59</td>
      <td>13,532.59</td>
      <td>10,677,197.53</td>
    </tr>
  </table>
</div>

<!--<cost-summary-report-pdf [buildingsReport]="buildingsReport"></cost-summary-report-pdf>

<button (click)="downloadToPdf()">Export PDF</button>-->
