<!--Edit enabled-->
<div *ngIf="rate!==undefined" [ngClass]="(rateView == 'rate') ? 'get-rate-section' : ((rateView == 'cost' || innerView == getLabel().GET_RATE_BY_QUANTITY) ? 'get-cost-section' : 'get-systemRA-section')">
  <button *ngIf="innerView !== getLabel().GET_RATE_BY_QUANTITY" title="close" class="close" (click)="closeRateTab()">
    <img src="assets/framework/images/close/close-black.svg" />
  </button>
  <button *ngIf="innerView === getLabel().GET_RATE_BY_QUANTITY" title="close" class="close" (click)="closeInnerViewTab()">
    <img src="assets/framework/images/close/close-black.svg" />
  </button>
  <div class="pull-left">
    <div class="pull-left" *ngIf="rate!==undefined">
      <div class="pull-left quantity-label">
        {{ getHeadings().ITEM }} {{ getHeadings().QUANTITY }}{{ getHeadings().COLON }}
      </div>
      <div class="pull-left">
        <input [(ngModel)]="rate.quantity" id="rateQuantity" type="number" class="form-control quantity-count"
               (change)="onTotalQuantityChange(rate.quantity)"
               (focus)="getPreviousQuantity(rate.quantity)"
               [disabled]="true"/>
      </div>
      <div class="pull-left">
        <span class="quantity-sqft">
          {{ rate.unit }}
        </span>
      </div>
    </div>
  </div>
  <div class="col-sm-12 no-padding">
    <table class="get-rate-table">
      <tbody>
        <tr *ngFor="let rateItem of rate.rateItems | groupBy:'type';">
          <td class="rate-item" colspan="5">
            <table>
              <thead>
                <tr>
                  <th colspan="5">{{ (rateItem.key === 'M') ? 'A. Material' : ((rateItem.key === "L") ? "B. Labour" : "C. Material + Labour") }}</th>
                </tr>
                <tr class="table-headings">
                  <th>{{ getTableHeadings().DESCRIPTION }}</th>
                  <th>{{ getTableHeadings().QUANTITY }}</th>
                  <th class="hidden-xs">{{ getTableHeadings().UNIT }}</th>
                  <th>{{ getTableHeadings().BASIC_RATE_PER_UNIT }}</th>
                  <th>{{ getTableHeadings().GST }}</th>
                  <th>{{ getTableHeadings().TOTAL_RATE }}</th>
                  <th>{{ getTableHeadings().COST }}</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of rateItem.value; let i=index">
                  <td class="datalist-input" *ngIf="rateView === getLabel().WORKITEM_RATE_TAB">
                    <input id="itemDescription" class="form-control remark-input"
                           (mouseover)="getRateItemsByOriginalName(item, i)" [title]="item.itemName"
                           list="RateItems" [(ngModel)]="item.itemName"  (focus)="getItemName($event)" (input)="setItemName($event, 'changeEvent')" (blur)="setItemName($event)" />
                      <datalist id="RateItems">
                        <option *ngFor="let rateItem of arrayOfRateItems" value="{{rateItem.itemName}}"></option>    
                     </datalist>
                  </td>
                  <td *ngIf="rateView !== getLabel().WORKITEM_RATE_TAB">
                    <input id="itemDescription" class="form-control remark-input"
                           [(ngModel)]="item.itemName" [disabled]="disableRateField" [title]="item.itemName" />
                  </td>
                  <!--<td>
                    <span class="glyphicon glyphicon-chevron-down" (click)="getRateItemsByOriginalName(item, i)"></span>
                     <select id="RateItemsDropDown" *ngIf="i === selectedRateItemIndex">
                       <option *ngFor="let rateItem of arrayOfRateItems" value="{{rateItem.itemName}}">{{rateItem.itemName}}</option>
                    </select>
                  </td>-->
                  <td>
                    <input type="number" amountValidate="true"
                           [class.validate-amount] = 'item?.quantity?.toString().split(".")[0]?.length>7 ||
                                                     item?.quantity?.toString().split(".")[1]?.length>4'
                           [(ngModel)]="item.quantity" id="itemQuantity" class="form-control text-right hidden-xs"
                           (change)="calculateTotal()" [disabled]="disableRateField"/>
                    <span class="visible-xs mobile-quantity-value" [class.disable-mobile-quantity-value]="disableRateField">{{item.quantity}} {{item.unit}}</span>
                  </td>
                  <td class="hidden-xs">
                    <input [(ngModel)]="item.unit" id="itemUnit" class="form-control text-left" [disabled]="disableRateField" readonly/>
                  </td>
                  <td>
                    <input *ngIf="anySubscriptionAvailable; else elseBlock" type="number" amountValidate="true"
                           [class.validate-amount] = 'item?.rate?.toString().split(".")[0]?.length>7 ||
                                                     item?.rate?.toString().split(".")[1]?.length>4'
                    [(ngModel)]="item.rate" id="itemRate" class="form-control text-right"
                           (change)="calculateTotal()" [disabled]="disableRateField"/>
                  </td>
                  <td >
                    <div class="gst-comp">
                    <select  class="select-item" [(ngModel)]="item.gst" (change)="calculateTotal()" [disabled]="disableRateField">
                      <option>{{item.gst}} %</option>
                      <option *ngFor="let gst of gstval" [value]="gst">{{gst}} %</option>
                    </select>
                    <div class="Gst-Component">
                      {{item.rateWithGst| number :'.1-2'}}
                    </div>
                    </div>
                  </td>
                  <td >
                    <div class="total-rate">
                     {{item.totalRate | number :'.1-2'}}
                    </div>
                  </td>
                  <td>
                    <!--<input type="number" [(ngModel)]="item.totalAmount" id="totalAmount get-total-amount text-right" class="form-control clear" readonly/>-->
                    <span *ngIf="anySubscriptionAvailable; else elseBlock"> {{item.totalAmount|number : '1.2-2'}}</span>
                  </td>
                </tr>
               </tbody>
              <tfoot>
              <tr>
                <!--colspan="5"-->
                <td  class="total-amount">
                  <label class="visible-xs">{{ getLabel().TOTAL }}{{(rateItem.key === 'M') ? '(A):' : ((rateItem.key === "L") ? "(B):" : "(C):")}}</label>
                </td>
                <td class="hidden-xs total-amount" colspan="5">
                  <label>{{ getLabel().TOTAL }}{{(rateItem.key === 'M') ? '(A):' : ((rateItem.key === "L") ? "(B):" : "(C):")}}</label>
                </td>
                <td *ngIf="anySubscriptionAvailable">
                  <div *ngIf="(rateItem.key === 'M')">{{ totalAmountOfMaterial|number : '1.2-2'}} </div>
                  <div *ngIf="(rateItem.key === 'L')">{{ totalAmountOfLabour|number : '1.2-2'}} </div>
                  <div *ngIf="(rateItem.key === 'M + L')">{{ totalAmountOfMaterialAndLabour|number : '1.2-2'}} </div>
                </td>
                <td *ngIf="!anySubscriptionAvailable">
                <div>-</div>
              </td>
              </tr>
              </tfoot>
            </table>
          </td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td>
            <!--rowspan="2"-->
            <button title="Cancel" *ngIf="innerView !== getLabel().GET_RATE_BY_QUANTITY" class="cancel hidden-xs" (click)="closeRateTab()">{{getButton().CANCEL_BUTTON}}</button>
            <button title="Cancel" *ngIf="innerView === getLabel().GET_RATE_BY_QUANTITY" class="cancel hidden-xs" (click)="closeInnerViewTab()">{{getButton().CANCEL_BUTTON}}</button>

            <button title="Save" type="button" *ngIf="!disableRateField" class="save-btn hidden-xs" (click)="updateRate(rate)">{{ getButton().SAVE }}</button>
          </td>
          <td class="grand-total-amount" colspan="1">
            <!--colspan="4"-->
            <label *ngIf="totalAmountOfMaterial && totalAmountOfLabour && !totalAmountOfMaterialAndLabour">{{ getLabel().TOTAL_A_B}}:</label>
            <label *ngIf="totalAmountOfMaterial && totalAmountOfLabour && totalAmountOfMaterialAndLabour ">{{ getLabel().TOTAL_A_B_C}}:</label>
            <label *ngIf="totalAmountOfMaterial && !totalAmountOfLabour && !totalAmountOfMaterialAndLabour ">{{ getLabel().TOTAL_A}}:</label>
            <span *ngIf="anySubscriptionAvailable; else elseBlock">{{ totalAmount|number: '1.2-2'}}</span>
          </td>
        </tr>
        <tr>
          <td class="grand-total-gst--amount" rowspan="3">
            <!--colspan="4"-->
            <label *ngIf="TotalGstOfMaterial && TotalGstOfLabour && !TotalGstOfMaterialAndLabour">{{ getLabel().TOTAL_GST_A_B}}:</label>
            <label *ngIf="TotalGstOfMaterial && TotalGstOfLabour && TotalGstOfMaterialAndLabour ">{{ getLabel().TOTAL_GST_A_B_C}}:</label>
            <label *ngIf="TotalGstOfMaterial && !TotalGstOfLabour && !TotalGstOfMaterialAndLabour ">{{ getLabel().TOTAL_GST_A}}:</label>
            <span *ngIf="anySubscriptionAvailable; else elseBlock">{{totalGstAmount|number: '1.2-2'}}</span>
          </td>
        </tr>
        <tr>
          <td class="grand-total-amount" colspan="2">
            <label>Rate per {{rate.unit}}:</label>
            <span *ngIf="anySubscriptionAvailable; else elseBlock">{{ ratePerUnitAmount|number: '1.2-2'}}</span>
          </td>
        </tr>
        <tr *ngIf="totalByUnit !== 0">
          <td class="grand-total-amount" colspan="4">
            <label>Rate per {{workItemUnit}}:</label>
            <span *ngIf="anySubscriptionAvailable; else elseBlock">{{ totalByUnit|number: '1.2-2'}}</span>
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
  <table class="notes-table">
    <thead>
    <th>
      <ul class="nav nav-tabs">
        <li class="active" *ngIf="rate.notes != ''"><a data-toggle="tab" href="#notes">{{ getLabel().NOTES }}</a></li>
        <li [class.active]= "(rate.notes === '')" *ngIf="rateView === getLabel().WORKITEM_SYSTEM_RATE_TAB"><a data-toggle="tab" href="#disclaimer">{{getButton().STANDARD_NOTE}}</a></li>
      </ul>
    </th>
    <th></th>
    </thead>
    <tbody>
    <tr>
      <td class="alignment-top notes-col">
        <div class="tab-content">
          <div id="notes" *ngIf="rate.notes != ''" class="tab-pane fade in active" >
            <table>
              <tr>
                <td>
                  <p>{{rate.notes}}</p>
                </td>
                <td class="alignment-top" *ngIf="rate.imageURL != ''">
                  <img *ngIf="rate.imageURL != ''" id="rateImageURL" src="{{rate.imageURL}}">
                </td>
              </tr>
            </table>

          </div>
          <div id="disclaimer" class="tab-pane fade" [class.active]="(rate.notes === '')" [class.in]="(rate.notes === '')" *ngIf="rateView === getLabel().WORKITEM_SYSTEM_RATE_TAB" >
            <bi-disclaimer-component [note]="getStandardNotes().Notes"></bi-disclaimer-component>
          </div>
        </div>
      </td>
      <!--<td class="alignment-top">
        <img *ngIf="rate.imageURL != ''" id="rateImageURL" src="{{rate.imageURL}}">
      </td>-->
    </tr>
    </tbody>
  </table>
</div>

<ng-template #elseBlock><span>-</span></ng-template>
