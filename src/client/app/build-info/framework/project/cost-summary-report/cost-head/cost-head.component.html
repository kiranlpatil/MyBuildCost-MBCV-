<section class="settings main-form-wrapper" style="margin-top: 120px">

  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"></div>
  <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
    <h4 align="center"> {{buildingName}} : {{costHead }}</h4>
    <br>

    <div *ngFor=" let subCategory of subCategoryDetails | keys; let i= index ">
        <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="panel-title">
                  <a *ngIf="subCategoryDetails[subCategory].rateAnalysisId !== 0" data-toggle="collapse" href="#collapse{{i}}">
                      {{subCategoryDetails[subCategory].name}}
                  </a>
                  <a *ngIf="subCategoryDetails[subCategory].rateAnalysisId === 0" data-toggle="collapse" href="#collapse{{i}}">
                    Workitems
                  </a>
                {{subCategoryDetails[subCategory].amount}}
                <span *ngIf="subCategoryDetails[subCategory].rateAnalysisId !== 0"  data-toggle="modal" data-target="#deleteSubcategory"  class="glyphicon glyphicon-trash"></span>
              </div>
            </div>
            <div id="collapse{{i}}" class="panel-collapse collapse">
              <div class="panel-body">
                <table class="table table-striped">
                  <thead>
                  <tr>
                    <th width="20%">Item</th>
                    <th width="20%">Qty.</th>
                    <th width="20%">Unit</th>
                    <th width="20%">Rate</th>
                    <th width="10%">Amount</th>
                    <th width="10%"></th>
                  </tr>
                  <tr *ngFor="let workitemObj of subCategoryDetails[subCategory].workitem">
                    {{workitemObj.name}}
                    <td>
                      <input *ngIf="workitemObj.quantity.total" [(ngModel)]="workitemObj.quantity.total" id="quantity"  size="10" class="form-control clear">
                      <span *ngIf="workitemObj.quantity.total != 0" class="glyphicon glyphicon-pencil" (click)="getQuantity(i, workitemObj.quantity.item, workitemObj.name, workitemObj.rateAnalysisId)"></span>
                      <button *ngIf="workitemObj.quantity.total == 0" type="button"  id="getQuantity{{i}}" (click)="getQuantity(i, workitemObj.quantity.item, workitemObj.name, workitemObj.rateAnalysisId)">Get Quanity</button>
                    </td>
                    <td>
                      {{workitemObj.unit}}
                    </td>
                    <td>
                      <input *ngIf="workitemObj.rate.total!= 0" [(ngModel)]="workitemObj.rate.total" id="rate"  size="10" class="form-control clear">
                      <span *ngIf="workitemObj.rate.total != 0" class="glyphicon glyphicon-pencil" (click)="getRateFromDatabase(i,workitemObj.rate,workitemObj.rateAnalysisId)"></span>
                      <button *ngIf="workitemObj.rate.total == 0" type="button"   (click)="getRate(i,workitemObj.rateAnalysisId)">Get Rate</button>
                    </td>
                    <td>
                      {{workitemObj.amount}}
                    </td>
                    <td><input [(ngModel)]="workitemObj.rate.quantity" id="rateQuantity" class="form-control clear" (change)="onTotalQuantityChange(workitemObj.rate.quantity)" (focus)="getPreviousQuantity(workitemObj.rate.quantity)"/>{{workitemObj.rate.unit}}</td>
                  </tr>

                  <!--Add workitem...-->

                  <button type="button" class="btn btn-primary" (click)="showWorkItem(subCategoryDetails[subCategory].rateAnalysisId)"><span class="glyphicon glyphicon-plus"></span>Add Workitem</button>


                  <!--<select  *ngIf="showWorkItemList===true" (change)="onChangeWorkItem($event.target.value)">
                    <option *ngFor="let cIn of costIn" [value]="cIn.costInId">{{cIn.costInId}}</option>
                  </select>-->

                  <div *ngIf="showWorkItemList==true">
                    <select  (change)="onChangeWorkItem($event.target.value)">
                      <option [value]="selectItem">Select Work Item</option>
                      <option *ngFor="let workItems of workItemListArray" [value]="workItems.name">{{workItems.name}}</option>

                    </select>
                  </div>
                 <!-- getQty Code-->
                  <tr [ngStyle]="(toggleQty==true && compareIndex==i) ? {'display': 'table-row'}:{'display': 'none'}" style="display: none;">
                    <td colspan="5">
                      <table class="table ">
                        <thead>
                        <th>Item</th>
                        <th>Nos.</th>
                        <th>Length</th>
                        <th>Breadth</th>
                        <th>Height</th>
                        <th>Qty.</th>
                        <th>Unit</th>
                        </thead>
                        <tbody>
                        <tr *ngFor="let quantityItem of quantityItemsArray">
                          <td>
                            <input [(ngModel)]="quantityItem.item" id="costitem"  class="form-control clear"/>
                          </td>
                          <td>
                            <input type="number" [(ngModel)]="quantityItem.nos" id="numbers" (change)="getNo(quantityItemsArray)" class="form-control clear" required/>
                          </td>
                          <td>
                            <input type="number" [(ngModel)]="quantityItem.length" id="length" (change)="getLength(quantityItemsArray)" class="form-control clear" required/>
                          </td>
                          <td>
                            <input  type="number" [(ngModel)]="quantityItem.breadth" id="breadth" (change)="getBreadth(quantityItemsArray)" class="form-control clear" required/>
                          </td>
                          <td>
                            <input type="number" [(ngModel)]="quantityItem.height" id="height" (change)="getHeight(quantityItemsArray)" class="form-control clear" required/>
                          </td>
                          <td>
                            <input  type="number" [(ngModel)]= "quantityItem.quantity"  id="qty" class="form-control clear" required/>
                          </td>
                          <td>
                            <input [(ngModel)]="quantityItem.unit" id="unit" class="form-control clear" required/>
                          </td>
                          <td><span data-toggle="modal" data-target="#delete" (click)="deleteQuantityItem(subCategoryDetails[subCategory].rateAnalysisId, quantityItemsArray,quantityItem.item)" class="glyphicon glyphicon-trash"></span></td>
                        </tr>
                        <tr>
                          <td>
                            <label>Total</label>
                          </td>
                          <td>{{quanitytNumbersTotal}}
                          </td>
                          <td>{{lengthTotal}}
                          </td>
                          <td>{{breadthTotal}}
                          </td>
                          <td>{{heightTotal}}
                          </td>
                          <td>{{quantityTotal}}
                          </td>
                          <td>
                            sqft
                          </td>
                          <td>

                          </td>
                        </tr>
                        <tr>
                          <td>
                            <button type="button" class="btn btn-primary" (click)="addItem()">+ Add Item</button>
                          <td>
                          <td>
                            <button type="submit" class="btn btn-primary" (click)="updateCostHeadWorkItem(subCategoryDetails[subCategory].rateAnalysisId, quantityItemsArray)">Save</button>
                          </td>
                        </tr>
                        </tbody>
                      </table>
         </td>
                  </tr>


                <!--get rate-->

                <tr [ngStyle]="(toggleRate==true && compareIndex==i) ? {'display': 'table-row'}:{'display': 'none'}" style="display: none;">
                  <td colspan="5">
                    <table class="table">
                      <thead>
                      <th>Description</th>
                      <th>Remarks</th>
                      <th>Qty.</th>
                      <th>Unit</th>
                      <th>Rate/Unit</th>
                      <th>Amount</th>
                      </thead>
                      <tbody>
                      <tr *ngFor="let rateItem of rateItemsArray;let k = index">
                        <td>
                          <input [(ngModel)]="rateItem.item" id="itemdescription" class="form-control clear"/>
                        </td>
                        <td>
                          <input [(ngModel)]="rateItem.remarks" id="itemquantity" class="form-control clear"/>
                        </td>
                        <td>
                          <input [(ngModel)]="rateItem.quantity" id="itemunit" class="form-control clear" (change)="changeQuantity(rateItem.quantity,k)"/>
                        </td>
                        <td>
                          <input [(ngModel)]="rateItem.unit" id="itemrate" class="form-control clear" readonly/>
                        </td>
                        <td>
                          <input [(ngModel)]="rateItem.rate" id="itemamount" class="form-control clear" (change)="changeRate(rateItem.rate,k)"/>
                        </td>
                        <td>
                          <input [(ngModel)]="rateItem.quantity*rateItem.rate" id="totalAmount" class="form-control clear" readonly/>
                        </td>
                      </tr>

                      <tr>
                        <td>
                          <label>Total</label>
                        </td>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>
                          {{totalRate}}
                        </td>
                        <td>
                          {{totalAmount}}
                        </td>
                      </tr>

                      <tr>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>

                        </td>
                        <td>
                          <button type="button" class="btn btn-primary" (click)="updateRate(i)">Save</button>
                        </td>
                      </tr>

                      </tbody>
                    </table>
                  </td>
                </tr>
                <!--get rate end-->

                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="deleteSubcategory" role="dialog">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h2 class="modal-title">Delete</h2>
            </div>
            <div class="modal-body">
              <p><small>You Want to Delete Subcategory</small></p>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" (click)="deleteSubcategory(subCategoryDetails[subCategory])"data-dismiss="modal">Yes</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="col-md-12" *ngIf="showSubcategoryListvar">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
          <select (change)="onSelectedAddSubCategory($event.target.value)">
            <option [value]="selectItem">Select Subcategory</option>
            <option *ngFor="let subCategoryObj of subcategoryArray" [value]="subCategoryObj.rateAnalysisId">{{subCategoryObj.subCategory}}</option>
          </select>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-primary" (click)="showSubcategoryList()"><span class="glyphicon glyphicon-plus"></span>Add Subcategory</button>
    </div>

  <div class="modal fade" id="delete" role="dialog">
    <div class="modal-dialog modal-sm">
      &lt;!&ndash; Modal content&ndash;&gt;
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Delete</h2>
        </div>
        <div class="modal-body">
          <p><small>You Want to Delete Quantity Item</small></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="button" (click)="deleteQuantityItemfun()"data-dismiss="modal">Yes</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

</section>

<tpl-footer></tpl-footer>
