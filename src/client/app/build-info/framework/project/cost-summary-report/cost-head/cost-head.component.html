<section class="wrapper">
  <header class="create-new-header">
    <button class="btn-back" (click)="goBack()"><img src="../../../../../../assets/build-info/create-new-project/back.png" /><span>{{getButton().GO_BACK}}</span></button>
    <button class="btn-close" (click)="goBack()"><img src="../../../../../../assets/build-info/create-new-project/close.png" /><span>{{getButton().CLOSE_BUTTON}}</span></button>
  </header>
  <div class="container">
    <div class="col-xs-12 no-padding">
      <h4 class="building-name">
        <span class="building-label"> {{ currentParamName }} </span>
        <span class="text-left"> ( {{ costHeadName }} ) </span>
        <div class="col-md-6 text-right pull-right">
          <span class="text-left total-amount-work"> {{categoryDetailsTotalAmount|number}} </span>
        </div>
      </h4>
      <div class="panel-group" *ngFor=" let category of categoryDetails; let categoryIndex= index ">
        <div class="panel panel-default">
          <div class="panel-heading">
            <div class="panel-title clearfix" (click)="setSelectedWorkItems(categoryDetails[categoryIndex].workItems)">
              <div class="col-sm-12">
                <a *ngIf="category.rateAnalysisId !== 0" data-toggle="collapse"
                   href="#collapse{{categoryIndex}}" [class.collapsed]="categoryIndex!=0">
                  <span class="caret"></span>
                  <span class="">{{ category.name }}</span>
                  <span class="text-right pull-right">{{ category.amount|number }}</span>
                </a>
                <a *ngIf="category.rateAnalysisId === 0" data-toggle="collapse"
                   href="#collapse{{categoryIndex}}" [class.collapsed]="categoryIndex!=0">
                  <span class="caret"></span>
                  <span  class="pull-left">{{getLabel().WORKITEMS}}</span>
                  <span  class="pull-right">{{ category.amount|number }}</span>
                </a>
              </div>
             <!-- <div class="col-sm-1">
                <div class="delete-workitems">
                  <img *ngIf="category.rateAnalysisId !== 0"
                       src="assets/build-info/dashboard/delete.png"
                       alt="Delete Workitems"
                       data-toggle="modal"
                       data-target="#deleteCategory"
                       (click)="setCategoryIdForDeactivate(category.rateAnalysisId)"/>
                </div>
              </div>-->
            </div>
          </div>
          <div id="collapse{{categoryIndex}}" class="panel-collapse collapse" [class.in]="categoryIndex===0">
            <div class="panel-body">
              <div class="bg-white"  *ngFor="let workitemObj of category.workItems; let workItemIndex = index">
                <table class="table table-dashboard table-categories">
                  <thead *ngIf="workItemIndex === 0">
                  <tr>
                    <th>{{getTableHeadings().ITEM}}</th>
                    <th>Details</th>
                    <th>{{getTableHeadings().QUANTITY}}</th>
                    <th>{{getTableHeadings().UNIT}}</th>
                    <th>{{getTableHeadings().RATE_PER_UNIT}}</th>
                    <th>{{getTableHeadings().COST}}</th>
                    <th>{{getTableHeadings().RATEANALYSIS}}</th>
                    <!--<th></th>-->
                  </tr>
                  </thead>
                  <tbody>
                  <tr [class.hide-hover]="rateView==='systemRA' || rateView==='rate' || rateView==='cost' || rateView==='quantity'">
                    <td> {{ workitemObj.name }}</td>
                    <td>
                      <button class="add-more-details-btn"> Add more details </button>
                    </td>
                    <td>
                      <div class="edit-field" [class.active]="rateView==='quantity'"
                           *ngIf="workitemObj.quantity.total"
                           (click)="getQuantity(category.rateAnalysisId, workitemObj.rateAnalysisId, workitemObj.name, workitemObj.quantity.quantityItems)">
                        <input  [(ngModel)]="workitemObj.quantity.total" id="quantity"  size="10" class="form-control clear">
                      </div>
                      <button *ngIf="workitemObj.quantity.total == 0"
                              type="button"
                              id="getQuantity{{categoryIndex}}"
                              class="btn-get-amount" [class.active]="rateView==='quantity'"
                              (click)="getQuantity(category.rateAnalysisId,workitemObj.rateAnalysisId, workitemObj.name, workitemObj.quantity.quantityItems)">
                        Get Qty.
                      </button>
                    </td>
                    <td>{{ workitemObj.unit }}</td>
                    <td>
                      <div class="edit-field" [class.active]="rateView==='rate'"
                           *ngIf="workitemObj.rate.total!= 0"
                           (click)="getRate( getLabel().GET_RATE, category.rateAnalysisId, workitemObj.rateAnalysisId, workitemObj, false)">
                        <input  [(ngModel)]="workitemObj.rate.total" id="rate"  size="10" class="form-control clear">
                      </div>
                      <button class="btn-get-amount" [class.active]="rateView==='rate'"
                              *ngIf="workitemObj.rate.total == 0"
                              type="button"
                              (click)="getRate( getLabel().GET_RATE, category.rateAnalysisId, workitemObj.rateAnalysisId, workitemObj, false)">{{getButton().GET_RATE}}</button>
                    </td>

                    <!--Cost-->
                    <td>
                      <div class="edit-cost" *ngIf="workitemObj.amount == 0">
                        -
                      </div>
                      <div class="edit-cost" [class.active]="rateView==='cost'"
                           *ngIf="workitemObj.amount != 0"
                           (click)="getRateByQuantity( getLabel().GET_RATE_BY_QUANTITY, category.rateAnalysisId, workitemObj.rateAnalysisId, workitemObj, true)">
                        {{ (workitemObj.amount)|number}}
                      </div>
                    </td>

                    <!--RateAnalysis-->
                    <td>
                      <button class="btn-get-amount" [class.active]="rateView==='systemRA'"
                              type="button"
                              (click)="getSystemRate( getLabel().GET_SYSTEM_RATE, category.rateAnalysisId, workitemObj.rateAnalysisId, workitemObj, true)">{{getButton().SYSTEM_RA}}</button>
                    </td>
                    <td>
                      <div data-toggle="modal" data-target="#deleteWorkItem" class="delete-cost-head"
                           (click)="setIdsForDeleteWorkItem(category.rateAnalysisId,workitemObj.rateAnalysisId,workItemIndex )">
                        <img alt="Delete Cost Head" src="assets/build-info/dashboard/delete-blue.png" />
                      </div>
                    </td>
                    <td class="show-embedded-table">
                      <div *ngIf="showWorkItemTab == getLabel().WORKITEM_RATE_TAB">
                        <div class="get-rate-component" *ngIf="compareWorkItemId == workitemObj.rateAnalysisId && compareCategoryId === category.rateAnalysisId">
                          <bi-get-rate [rateItemsArray]="rateItemsArray"
                                       [rateView]="rateView"
                                       [categoryRateAnalysisId]="category.rateAnalysisId"
                                       [totalAmount]="totalAmount"
                                       [baseUrl] = "baseUrl"
                                       [disableRateField]="disableRateField"
                                       (refreshCategoryList)="refreshCategoryList()">
                          </bi-get-rate>
                        </div>
                      </div>

                      <div *ngIf="showWorkItemTab == getLabel().WORKITEM_QUANTITY_TAB">
                        <div *ngIf="compareWorkItemId == workitemObj.rateAnalysisId && compareCategoryId === category.rateAnalysisId">
                          <bi-get-quantity [quantityItems]="quantityItemsArray"
                                           [categoryRateAnalysisId]="category.rateAnalysisId"
                                           [baseUrl] = "baseUrl"
                                           (refreshCategoryList)="refreshCategoryList()">
                          </bi-get-quantity>
                        </div>
                      </div>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="bg-white">
                <table class="table table-dashboard add-item-table">
                  <tbody>
                  <tr *ngIf="showWorkItemList==true && compareWorkItemRateAnalysisId==categoryIndex">
                    <td>
                      <select  class="select-item" (change)="onChangeActivateSelectedWorkItem($event.target.value)">
                        <option [value]="selectItem">Select Work Items</option>
                        <option *ngFor="let workItems of workItemListArray" [value]="workItems.name">{{ workItems.name }}</option>
                      </select>
                    </td>
                    <td colspan="6">&nbsp;</td>
                  </tr>
                  <tr>
                    <td  class="add-items" colspan="7">
                      <button type="button" class="btn-add-item"
                              (click)="getInActiveWorkItems(category.rateAnalysisId,categoryIndex)">
                        <span class="glyphicon glyphicon-plus"></span> {{getButton().ADD}} {{getButton().ITEM}}</button>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="modal fade default-modal" id="deleteCategory" role="dialog">
  <bi-delete-confirmation-modal [elementType]="deleteConfirmationCategory" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
</div>

<div class="modal fade default-modal" id="deleteWorkItem" role="dialog">
  <bi-delete-confirmation-modal [elementType]="deleteConfirmationWorkItem" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
</div>

