<section *ngIf="status" class="wrapper">
  <header class="create-new-header">
    <button class="btn-back" (click)="goBack()"><img src="../../../../../../assets/build-info/create-new-project/back.png" /><span>{{getButton().GO_BACK}}</span></button>
  </header>
  <div class="container">
    <div class="col-xs-12 no-padding">
      <h4 class="building-name clearfix costhead-building-name">
        <div class="col-sm-8 padding-left0">
          <span class="building-label"> {{ costHeadName }} </span>
          <span class="text-left"> ( {{ viewTypeValue }} ) </span>
        </div>
        <div class="col-sm-4 text-right padding-right5">
          <span class="text-left total-amount-work total-cost"> {{categoryDetailsTotalAmount|number : '1.0-0'}} </span>
        </div>
        <bi-cost-head-report-pdf [categoryDetails]="categoryDetails" [categoryDetailsTotalAmount]="categoryDetailsTotalAmount" [viewType]="viewType"></bi-cost-head-report-pdf>
      </h4>
      <div class="panel-group animated-list" id="cost-head-panels">
        <div class="panel panel-default animate-item" *ngFor=" let category of categoryDetails| sortByCategoryAmount; let categoryIndex = index "
             [ngStyle]="animateView ? getListItemAnimation(secondaryViewDataIndex) : null">
          <div class="panel-heading">
            <div class="panel-title clearfix" (click)="getActiveWorkItemsOfCategory(category.rateAnalysisId); getInActiveWorkItems(category.rateAnalysisId,categoryIndex);">
              <a data-parent="#cost-head-panels" class="collapsed cost-head-lists">
                <span class="caret"></span>
                <span class="category-name">{{ category.name }}</span>
                <span class="text-right pull-right total-cost">{{ category.amount|number :'1.0-0'}}</span>
              </a>
            </div>
          </div>
          <div *ngIf="category.rateAnalysisId == categoryId" id="collapse{{category.rateAnalysisId}}" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="bg-white"  *ngFor="let workItem of workItemsList; let workItemIndex = index">
                <table class="table table-dashboard table-categories">
                  <thead *ngIf="workItemIndex === 0">
                  <tr>
                    <th>{{getTableHeadings().ITEM}}</th>
                    <!--<th>Details</th>-->
                    <th>{{getTableHeadings().QUANTITY}}</th>
                    <th>{{getTableHeadings().UNIT}}</th>
                    <th>
                      <div *ngIf=" workItem.isDirectRate">{{getTableHeadings().BASIC_RATE_PER_UNIT}}</div>
                      <div *ngIf="!workItem.isDirectRate">{{getTableHeadings().RATE_PER_UNIT}}</div>
                    </th>
                    <th *ngIf=" workItem.isDirectRate">{{getTableHeadings().TOTAL_RATE}}</th>
                    <th *ngIf=" workItem.isDirectRate">{{getTableHeadings().GST}}</th>
                    <th>{{getTableHeadings().COST}}</th>
                    <th>{{getTableHeadings().RATEANALYSIS}}</th>
                    <th *ngIf=" workItem.isDirectRate">{{getTableHeadings().GST_COMPONENT}}</th>
                    <!--<th></th>-->
                  </tr>
                  </thead>
                  <tbody>
                    <tr [class.hide-hover]="rateView==='systemRA' || rateView==='rate' || rateView==='cost' || rateView==='quantity'">
                      <td class="work-item-panel">
                        <div class="panel-group" id="category-panel">
                          <div class="panel panel-default">
                            <table>
                              <tr id="show-embedded-table-row">
                                <td class="relative-position">
                                  <div class="panel-heading">
                                    <div class="panel-title clearfix" >
                                      <a data-toggle="collapse" href="#collapseDetails{{workItemIndex}}"
                                         class="work-item-panel-row collapsed" data-parent="#category-panel" (click)="toggleWorkItemPanel(workItemIndex, workItem)" aria-expanded="false">
                                      <span class="caret"
                                            *ngIf="workItem.quantity.quantityItemDetails.length > 0 && workItem.quantity.quantityItemDetails[0].name !== 'default'"></span>
                                        <!--{{ workItem.name }}-->
                                      </a>
                                    </div>
                                  </div>
                                  <div class="edit-field">
                                    <!--<input [(ngModel)]="workItem.name"
                                           id="workItemName"
                                           (change)="updateWorkItemName(category.rateAnalysisId, workItem)"
                                           (blur)="workItemNameFocus = !workItemNameFocus"
                                           [hidden]="!workItemNameFocus"
                                           class="form-control clear"
                                           title="Change item name" />
                                    <span [hidden]="workItemNameFocus" (click)="toggleInput()">{{ workItem.name }}</span>-->
                                    <textarea [(ngModel)]="workItem.name"
                                              id="workItemName"
                                              (change)="updateWorkItemName(category.rateAnalysisId, workItem)"
                                              class="form-control clear workItemNameTextarea"
                                              title="Change item name"></textarea>
                                    <!--<span [hidden]="workItemNameFocus" (click)="toggleInput()">{{ workItem.name }}</span>-->
                                  </div>
                                  <button class="add-more-details fixed-plus-btn" *ngIf="workItem.isItemBreakdownRequired"
                                          (click)="showAddFloorwiseQuantityModal(workItem, workItemIndex, category.rateAnalysisId, categoryIndex)"
                                          title="{{getMessages().ADD_MORE_DETAILS_TITLE}}">
                                    <span class="glyphicon glyphicon-plus-sign"></span>
                                  </button>
                                </td>
                                <!--<td>
                                  <button class="add-more-details-btn">{{getButton().ADD_MORE_DETAILS}} </button>
                                </td>-->
                                <td>
                                  <span class="mobile-headings">{{getTableHeadings().QUANTITY}}</span>
                                  <div class="edit-field"
                                       [class.disabled]="workItem.isDetailedQuantity" [class.active-quantity]="(showWorkItemTab == getLabel().WORKITEM_QUANTITY_TAB) && (workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)" >
                                    <input type="number" amountValidate="true"
                                           [(ngModel)]="workItem.quantity.total" (focus)="setQuantityTotal(workItem.quantity.total)"
                                           (change)="showUpdateDirectQuantityModal(workItem, category.rateAnalysisId, workItemIndex)"
                                            id="directQuantity" size="10" class="form-control clear" title="Add Quantity">
                                    <span class="calculator"
                                          id="getQuantity{{categoryIndex}}" [class.disabled]="workItem.isDetailedQuantity"
                                          *ngIf="workItem.isMeasurementSheet" title="Add Measurement Sheet"
                                          (click)="updateMeasurementSheet(category.rateAnalysisId, workItem, categoryIndex, workItemIndex);">
                                      <span *ngIf="!workItem.isMeasurmentSheetPresent"><img src="assets/build-info/dashboard/calculator2.png" /></span>
                                      <span *ngIf="workItem.isMeasurmentSheetPresent">
                                        <img src="assets/build-info/dashboard/calculator2.png" />
                                        <span class="calculator-dot"></span>
                                      </span>
                                    </span>
                                    <!--<span class="calculator" *ngIf="workItem.isSteelWorkItem" id="getQuantity1{{categoryIndex}}" [class.disabled]="!workItem.isMeasurementSheet" (click)="updateMeasurementSheet(category.rateAnalysisId, workItem, categoryIndex, workItemIndex,getLabel().WORKITEM_STEEL_QUANTITY_TAB)">
                                       <img src="assets/build-info/dashboard/calculator2.png" />
                                    </span>-->


                                  </div>
                                </td>
                                <td>
                                  <span class="mobile-headings">{{getTableHeadings().UNIT}}</span>
                                  <span class="value" *ngIf="workItem.unit">{{ workItem.unit }}</span>
                                  <span class="value" *ngIf="!workItem.unit">-</span>
                                </td>
                                <td>
                                  <span class="mobile-headings" *ngIf="workItem.isDirectRate">{{getTableHeadings().BASIC_RATE_PER_UNIT}}</span>
                                  <span class="mobile-headings" *ngIf="!workItem.isDirectRate">{{getTableHeadings().RATE_PER_UNIT}}</span>
                                  <div class="edit-field" [class.active-rate]="(showWorkItemTab == getLabel().WORKITEM_RATE_TAB) && (workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)" >
                                    <input amountValidate="true" title="Workitem Rate" *ngIf="workItem.isDirectRate" type = "number"
                                           [class.validate-amount] = 'workItem?.rate?.total?.toString().split(".")[0].length>7 ||
                                           workItem?.rate?.total?.toString().split(".")[1]?.length>4 ||workItem?.rate?.total?.toString().split(".").length>4 '
                                           [(ngModel)]="workItem.rate.total"
                                           (change)="changeDirectRate(category.rateAnalysisId,workItem.rateAnalysisId, workItem.workItemId, workItem.rate.total)" id="directRate1" size="10" class="form-control clear">
                                    <div class="edit-rate" *ngIf="!workItem.isDirectRate && workItem.rate.isEstimated && anySubscriptionAvailable">
                                      {{workItem.rate.total|number : '1.2-2'}}
                                    </div>
                                    <div class="edit-rate-null" *ngIf="!workItem.isDirectRate && !workItem.rate.isEstimated && anySubscriptionAvailable">
                                      -
                                    </div>
                                    <div class="edit-rate-null" *ngIf="!anySubscriptionAvailable && !workItem.isDirectRate">
                                      -
                                    </div>
                                     <span title="Get Rate" class="calculator"
                                           id ="getRate{{categoryIndex}}"
                                           *ngIf="workItem.isDirectRate === false"
                                           (click)="getRate( getLabel().GET_RATE, category.rateAnalysisId, workItem.rateAnalysisId, workItem, false, categoryIndex, workItemIndex)">
                                     <img src="assets/build-info/dashboard/calculator2.png" />
                                     </span>
                                  </div>
                                </td>

                                 <!--Total Rate-->
                               <td *ngIf=" workItem.isDirectRate">
                                <span class="mobile-headings">{{getTableHeadings().TOTAL_RATE}}</span>
                                  <div class="totalrate">
                                   -
                                  </div>
                              </td>

                                <!--GST-->
                              <td  *ngIf=" workItem.isDirectRate">
                                <span class="mobile-headings">{{getTableHeadings().GST}}</span>
                                <select  class="select-item" (change)="changeGst(category.rateAnalysisId, workItem,$event.target.value)">
                                  <option *ngFor="let gst of gstval" [value]="gst">{{gst}} %</option>
                                </select>
                              </td>

                                <!--Cost-->
                                <td>
                                  <span class="mobile-headings">{{getTableHeadings().COST}}</span>
                                  <div class="edit-cost-null" *ngIf="workItem.amount == 0  && workItem.isDirectRate === false">
                                    -
                                  </div>
                                  <div class="edit-cost" [class.active-cost]="(rateView==='cost' && workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)"
                                       *ngIf="workItem.amount != 0 && workItem.isDirectRate === false"
                                       (click)="getRateByQuantity( getLabel().GET_RATE_BY_QUANTITY, category.rateAnalysisId, workItem.rateAnalysisId, workItem, true, categoryIndex, workItemIndex)">
                                    {{ (workItem.amount)|number : '1.0-0'}}
                                  </div>
                                  <div class="value" *ngIf="workItem.isDirectRate">
                                    {{ (workItem.amount)|number : '1.0-0'}}
                                  </div>
                                </td>

                                <!--RateAnalysis-->
                                <td>
                                  <span class="mobile-headings">{{getTableHeadings().RATEANALYSIS}}</span>
                                  <div  *ngIf=" workItem.isDirectRate === false">
                                   <button class="btn-get-amount"
                                           [class.active]="(rateView==='systemRA' && workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)"
                                           type="button" title="Systern RA"
                                           (click)="getSystemRate( getLabel().GET_SYSTEM_RATE, category.rateAnalysisId, workItem.rateAnalysisId, workItem, true, categoryIndex, workItemIndex)">{{getButton().SYSTEM_RA}}
                                   </button>
                                  </div>
                                  <div class="value" *ngIf=" workItem.isDirectRate">
                                    -
                                  </div>
                                </td>

                                <!--GST Component-->
                                <td>
                                <span class="mobile-headings">{{getTableHeadings().GST_COMPONENT}}</span>
                                <div class="gst-component" *ngIf=" workItem.isDirectRate" >
                                  -
                                </div>
                                </td>

                                <td>
                                    <div class="file-attachment" [class.attachment-menu-open]="(showAttachmentView == getLabel().ATTACH_FILE && workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)">
                                      <span  *ngIf="workItem.attachmentDetails.length == 0"(click)="setVariable(category.rateAnalysisId, workItem.rateAnalysisId, workItem.workItemId, categoryIndex, workItemIndex)">
                                        <img src="assets/build-info/dashboard/attach-file.png" alt="Attach Support Files" title="Attach Support Files" />
                                      </span>
                                      <span class="file-attached" *ngIf="workItem.attachmentDetails.length != 0" (click)="setVariable(category.rateAnalysisId, workItem.rateAnalysisId, workItem.workItemId, categoryIndex, workItemIndex)">
                                        <img src="assets/build-info/dashboard/file-attached.png" alt="Attach Support Files" title="Attach Support Files" />
                                      </span>
                                      <div class="attachment-menu" *ngIf="(showAttachmentView == getLabel().ATTACH_FILE && workItemIndex===currentWorkItemIndex && currentCategoryIndex === categoryIndex)">
                                        <bi-attachment [costHeadId]="costHeadId"
                                                       [categoryId]="categoryId"
                                                       [fileNamesList]="fileNamesList"
                                                       [baseUrl] = "baseUrl" (showAttachmentView)="closeAttachmentView($event)"
                                                       (workItemRefresh) = "workItemRefresh($event)"
                                                       [workItem]="workItem"></bi-attachment>
                                      </div>
                                    </div>
                                    <!--<button class="add-more-details" *ngIf="workItem.isItemBreakdownRequired"
                                            (click)="showAddFloorwiseQuantityModal(workItem, workItemIndex, category.rateAnalysisId, categoryIndex)"
                                            title="{{getMessages().ADD_MORE_DETAILS_TITLE}}">
                                      <span class="glyphicon glyphicon-plus-sign"></span>
                                    </button>-->
                                    <div data-toggle="modal" data-target="#deleteWorkItem" class="delete-cost-head" title="Delete Work Item"
                                         (click)="setIdsForDeleteWorkItem(category.rateAnalysisId, workItem.rateAnalysisId, workItem.workItemId, workItemIndex )">
                                      <img alt="Delete Work Item" src="assets/build-info/dashboard/delete-blue.png" />
                                    </div>
                                  </td>

                                <td id="show-embedded-table" [class.steel-quantity-embedded-table]="showWorkItemTab==getLabel().WORKITEM_STEEL_QUANTITY_TAB"
                                    *ngIf="showWorkItemTab == getLabel().WORKITEM_RATE_TAB || showWorkItemTab == getLabel().WORKITEM_QUANTITY_TAB || showWorkItemTab == getLabel().WORKITEM_STEEL_QUANTITY_TAB">

                                  <div *ngIf="showWorkItemTab == getLabel().WORKITEM_RATE_TAB" [@fadeIn]="state">
                                      <div class="get-rate-component" *ngIf="compareWorkItemId == workItem.rateAnalysisId && compareCategoryId === category.rateAnalysisId && compareCCWorkItemId === workItem.workItemId">
                                        <bi-get-rate [rate]="rateItemsArray"
                                                     [categoryDetails] ="categoryDetails"
                                                     [rateView]="rateView"
                                                     [workItemsList] ="workItemsList"
                                                     [workItemUnit] = "workItem.unit"
                                                     [categoryRateAnalysisId]="category.rateAnalysisId"
                                                     [workItemRateAnalysisId]="workItem.rateAnalysisId"
                                                     [ccWorkItemId]="workItem.workItemId"
                                                     [ratePerUnitAmount]="ratePerUnitAmount"
                                                     [totalByUnit]="totalByUnit"
                                                     (categoriesTotalAmount)="setCategoriesTotal($event)"
                                                     (closeRateView)="closeRateView($event)"
                                                     [baseUrl] = "baseUrl"
                                                     [disableRateField]="disableRateField">
                                        </bi-get-rate>
                                      </div>
                                    </div>

                                  <div *ngIf="showWorkItemTab == getLabel().WORKITEM_QUANTITY_TAB">
                                    <div *ngIf="compareWorkItemId == workItem.rateAnalysisId && compareCategoryId === category.rateAnalysisId && compareCCWorkItemId === workItem.workItemId">
                                      <!-- <span class="glyphicon glyphicon-remove" (click)="closeQuantityTab()"></span>-->
                                    <bi-get-quantity [quantityItems]="quantityItemsArray"
                                                       [categoryDetails] ="categoryDetails"
                                                       [workItemsList] ="workItemsList"
                                                       [workItem]="workItem"
                                                       [workItemUnit] = "workItem.unit"
                                                       (categoriesTotalAmount)="setCategoriesTotal($event)"
                                                       (refreshWorkItemList)="refreshWorkItemList($event)"
                                                       (closeQuantityView) = "closeQuantityView($event)"
                                                       [categoryRateAnalysisId]="category.rateAnalysisId"
                                                       [workItemRateAnalysisId]="workItem.rateAnalysisId"
                                                       [ccWorkItemId]="workItem.workItemId"
                                                       [keyQuantity]="keyQuantity"
                                                       [quantityId]="quantityId"
                                                       [baseUrl] = "baseUrl">
                                      </bi-get-quantity>
                                  </div>
                                  </div>


                                  <div *ngIf="showWorkItemTab==getLabel().WORKITEM_STEEL_QUANTITY_TAB">
                                    <div *ngIf="compareWorkItemId == workItem.rateAnalysisId && compareCategoryId === category.rateAnalysisId && compareCCWorkItemId === workItem.workItemId">

                                    <bi-get-quantity-steel
                                      [steelQuantityItems]="steelQuantityItemsArray.steelQuantityItem"
                                      [totalDiamterQuantity]="steelQuantityItemsArray"
                                      [workItemsList] ="workItemsList"
                                      [categoryDetails] ="categoryDetails"
                                      [workItem]="workItem"
                                      [ccWorkItemId]="workItem?.workItemId"
                                      [workItemUnit] = "workItem.unit"
                                      (categoriesTotalAmount)="setCategoriesTotal($event)"
                                      (refreshWorkItemList)="refreshWorkItemList($event)"
                                      (closeQuantityView) = "closeQuantityView($event)"
                                      [categoryRateAnalysisId]="category.rateAnalysisId"
                                      [workItemRateAnalysisId]="workItem.rateAnalysisId"
                                      [keyQuantity]="keyQuantity"
                                      [quantityId]="quantityId"
                                      [baseUrl] = "baseUrl">
                                    </bi-get-quantity-steel>
                                  </div>
                                  </div>

                                </td>

                                <div class="modal fade default-modal" id="updateDirectQuantity{{workItemIndex}}" role="dialog">
                                  <bi-update-confirmation-modal
                                    [elementType]="updateConfirmationForDirectQuantity"
                                    [currentQuantity]="currentQuantityType"
                                    [categoryId]="categoryId"
                                    [workitem]="workItem"
                                    [total]="total"
                                    (updateTotalEvent) = "updateTotal($event)"
                                    (updateElementEvent)="updateElement($event)">
                                  </bi-update-confirmation-modal>
                                </div>

                                <div class="modal fade default-modal" id="updateMeasurementQuantity{{workItemIndex}}" role="dialog">
                                  <bi-update-confirmation-modal
                                    [elementType]="updateConfirmationForMeasurementSheet"
                                    [currentQuantity]="currentQuantityType"
                                    [categoryId]="categoryId"
                                    [workitem]="workItem"
                                    [workItemIndex] = "workItemIndex"
                                    [categoryIndex] = "categoryIndex"
                                    (updateElementEvent)="updateQuantityMeasurementSheet($event)">
                                  </bi-update-confirmation-modal>
                                </div>

                                <div class="modal fade default-modal" id="addFloorwiseQuantity{{workItemIndex}}" role="dialog">
                                  <bi-update-confirmation-modal
                                    [elementType]="updateConfirmationForFloorwiseQuantity"
                                    [currentQuantity]="currentQuantityType"
                                    [categoryId]="categoryId"
                                    [workitem]="workItem"
                                    [workItemIndex] = "workItemIndex"
                                    [categoryIndex] = "categoryIndex"
                                    (updateElementEvent)="addFloorwiseQuantity($event)">
                                  </bi-update-confirmation-modal>
                                </div>
                              </tr>

                              <tr class="add-work-item-row">
                                <td colspan="8" class="add-work-item">
                                  <div id="collapseDetails{{workItemIndex}}"  class="panel-collapse collapse">
                                    <div class="panel-body">
                                      <div *ngIf="showWorkItemTab !== getLabel().WORKITEM_RATE_TAB && showWorkItemTab !== getLabel().WORKITEM_SYSTEM_RATE_TAB
                                      && showWorkItemTab!==getLabel().WORKITEM_RATE_BY_QUANTITY_TAB && showWorkItemTab!==getLabel().WORKITEM_QUANTITY_TAB
                                      && showWorkItemTab!==getLabel().WORKITEM_STEEL_QUANTITY_TAB">

                                        <bi-quantity-details
                                          [quantityDetails]="workItem.quantity.quantityItemDetails"
                                          [workItem] ="workItem"
                                          [workItemsList] ="workItemsList"
                                          [categoryDetails] ="categoryDetails"
                                          (updateMeasurmentFlag)="updateMeasurmentFlag(workItem)"
                                          (categoriesTotalAmount)="setCategoriesTotal($event)"
                                          (categoriesTotalAmountOfQty)="setCategoriesTotalOfQty($event)"
                                          (quantityName)="setQuantityName($event)"
                                          (workItemRateId)="setWorkItemId($event)"
                                          (ccWorkItemRateId)="setccWorkItemRateId($event)"
                                          (refreshWorkItemList)="refreshCategoryList($event)"
                                          [categoryRateAnalysisId]="category.rateAnalysisId"
                                          [workItemRateAnalysisId]="workItem.rateAnalysisId"
                                          [ccWorkItemId]="workItem.workItemId"
                                          [baseUrl] = "baseUrl">
                                        </bi-quantity-details>

                                      </div>
                                    </div>
                                  </div>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="bg-white hidden-xs">
                <table class="table table-dashboard add-item-table">
                  <tbody>
                  <tr *ngIf="compareWorkItemRateAnalysisId==categoryIndex">
                    <td>
                      <select  class="select-item" (change)="onSelectedWorkItem($event.target.value)">
                        <option [value]="selectItem">Select Work Items</option>
                        <option *ngFor="let workItems of workItemListArray" [value]="workItems.name">{{ workItems.name }}</option>
                      </select>
                    </td>
                    <td colspan="6">&nbsp;</td>
                  </tr>
                  <!--<tr>
                    <td  class="add-items" colspan="7">
                      <button title="Add Item" type="button" class="btn-add-item"
                              (click)="getInActiveWorkItems(category.rateAnalysisId,categoryIndex)">
                        <span class="glyphicon glyphicon-plus"></span> {{getButton().ADD}} {{getButton().ITEM}}</button>
                    </td>
                  </tr>-->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<h1 *ngIf="!status"> Project Expired</h1>

<div class="modal fade default-modal" id="deleteWorkItem" role="dialog">
  <bi-delete-confirmation-modal [elementType]="deleteConfirmationWorkItem" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
</div>

<div class="modal fade default-modal" id="deleteQuantityDetails" role="dialog">
  <bi-delete-confirmation-modal [elementType]="deleteConfirmationForQuantityDetails" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
</div>

<div class="modal fade default-modal" id="removeAttachment" role="dialog">
  <bi-delete-confirmation-modal [elementType]="deleteConfirmationForAttachment" (deleteElementEvent)="deleteElement($event)"></bi-delete-confirmation-modal>
</div>

