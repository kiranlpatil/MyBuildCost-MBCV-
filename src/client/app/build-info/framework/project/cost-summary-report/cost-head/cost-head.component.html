<section class="settings main-form-wrapper" style="margin-top: 120px">

  <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"></div>
  <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8">
    <h4 align="center"> {{ buildingName }} : {{ costHead }}</h4>
    <br>

    <div *ngFor=" let subCategory of subCategoryDetails | keys; let i= index ">
        <div class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">
              <div class="panel-title" (click)="getSelectedWorkItems(subCategoryDetails[i].workitem)">
                  <a *ngIf="subCategoryDetails[subCategory].rateAnalysisId !== 0" data-toggle="collapse" href="#collapse{{i}}">
                     {{ subCategoryDetails[subCategory].name }}
                  </a>
                  <a *ngIf="subCategoryDetails[subCategory].rateAnalysisId === 0" data-toggle="collapse" href="#collapse{{i}}">
                    Workitems
                  </a>
                 {{ subCategoryDetails[subCategory].amount }}
                  <span *ngIf="subCategoryDetails[subCategory].rateAnalysisId !== 0"  data-toggle="modal" data-target="#deleteSubcategory" (click)="setCurrentSubcategory(subCategoryDetails[subCategory])"  class="glyphicon glyphicon-trash"></span>
              </div>
            </div>
            <div id="collapse{{i}}" class="panel-collapse collapse">
              <div class="panel-body">
                <div>
                  <div class="row col-md-12">
                    <div class="col-md-2">Item</div>
                    <div class="col-md-2">Qty.</div>
                    <div class="col-md-2">Unit</div>
                    <div class="col-md-2">RateAnalysis</div>
                    <div class="col-md-2">Amount</div>
                    <div class="col-md-2"></div>
                  </div>
                  <div  class="row" *ngFor="let workitemObj of subCategoryDetails[subCategory].workitem" >
                    <div class="col-md-2">
                     {{ workitemObj.name }}
                    </div>
                    <div class="col-md-2">
                      <input *ngIf="workitemObj.quantity.total" [(ngModel)]="workitemObj.quantity.total" id="quantity"  size="10" class="form-control clear">
                      <span *ngIf="workitemObj.quantity.total != 0" class="glyphicon glyphicon-pencil" (click)="getQuantity(i, workitemObj.quantity.item, workitemObj.name, workitemObj.rateAnalysisId)"></span>
                      <button *ngIf="workitemObj.quantity.total == 0" type="button"  id="getQuantity{{i}}" (click)="getQuantity(i, workitemObj.quantity.item, workitemObj.name, workitemObj.rateAnalysisId)">Get Quanity</button>
                    </div>
                    <div class="col-md-2">
                     {{ workitemObj.unit }}
                    </div>
                    <div class="col-md-2">
                      <input *ngIf="workitemObj.rate.total!= 0" [(ngModel)]="workitemObj.rate.total" id="rate"  size="10" class="form-control clear">
                      <span *ngIf="workitemObj.rate.total != 0" class="glyphicon glyphicon-pencil" (click)="getRateFromDatabase(i,workitemObj.rate,workitemObj.rateAnalysisId)"></span>
                      <button *ngIf="workitemObj.rate.total == 0" type="button" (click)="getRate(i,workitemObj.rateAnalysisId)">Get Rate</button>
                    </div>
                    <div class="col-md-2">
                     {{ workitemObj.amount }}
                    </div>
                    <div class="col-md-2">
                      <input [(ngModel)]="workitemObj.rate.quantity" id="rateQuantity" class="form-control clear" (change)="onTotalQuantityChange(workitemObj.rate.quantity)" (focus)="getPreviousQuantity(workitemObj.rate.quantity)"/>
                     {{ workitemObj.rate.unit }}
                    </div>
                  </div>
                  <div class="row" [ngStyle]="(toggleQty==true && compareIndex==i) ? {'display': 'table-row'}:{'display': 'none'}" style="display: none;">
                    <bi-cost-head-get-quantity [quantityItems]="quantityItemsArray"
                                               [subCategoryRateAnalysisId]="subCategoryDetails[subCategory].rateAnalysisId"
                                                (refreshDataList)="refreshDataList()">
                    </bi-cost-head-get-quantity>
                  </div>

                  <!--get rate-->
                  <div class="row" [ngStyle]="(toggleRate==true && compareIndex==i) ? {'display': 'table-row'}:{'display': 'none'}" style="display: none;">
                    <bi-rate-items [rateItemsArray]="rateItemsArray" [rateItemsObject]="rateIArray"
                                               [subCategoryRateAnalysisId]="subCategoryDetails[subCategory].rateAnalysisId"
                                                [totalAmount]="totalAmount"
                                                [totalRate]="totalRate"
                                                [totalQuantity]="totalQuantity"
                                               (refreshDataList)="refreshDataList()">
                    </bi-rate-items>
                  </div>
                  <!--get rate end-->


                  <!--Add workitem...-->

                <button type="button" class="btn btn-primary" (click)="showWorkItem(subCategoryDetails[subCategory].rateAnalysisId,i)"><span class="glyphicon glyphicon-plus"></span>Add Workitem</button>


                <!--<select  *ngIf="showWorkItemList===true" (change)="onChangeWorkItem($event.target.value)">
                  <option *ngFor="let cIn of costIn" [value]="cIn.costInId">{{cIn.costInId}}</option>
                </select>-->

                <div *ngIf="showWorkItemList==true && comapreWorkItemRateAnalysisId==i">
                  <select  (change)="onChangeWorkItem($event.target.value)">
                    <option [value]="selectItem">Select Work Item</option>
                    <option *ngFor="let workItems of workItemListArray" [value]="workItems.name">{{ workItems.name }}</option>

                  </select>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="deleteSubcategory" role="dialog">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h2 class="modal-title">Delete</h2>
            </div>
            <div class="modal-body">
              <p><small>You Want to Delete Subcategory</small></p>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" (click)="deleteSubcategory()"data-dismiss="modal">Yes</button>
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="col-md-12" *ngIf="showSubcategoryListvar">
      <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
          <select (change)="onSelectedAddSubCategory($event.target.value)">
            <option [value]="selectItem">Select Subcategory</option>
            <option *ngFor="let subCategoryObj of subcategoryArray" [value]="subCategoryObj.rateAnalysisId">{{ subCategoryObj.subCategory }}</option>
          </select>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-primary" (click)="showSubcategoryList()"><span class="glyphicon glyphicon-plus"></span>Add Subcategory</button>
  </div>

</section>

<tpl-footer></tpl-footer>
